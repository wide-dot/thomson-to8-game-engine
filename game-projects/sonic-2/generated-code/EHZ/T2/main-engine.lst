                      (C:\Users\bhrou\gi):00001                 INCLUDE "./generated-code/EHZ/ObjectId.glb"
                      (./generated-code/):00001         * Generated Code
                      (./generated-code/):00002         
     0001             (./generated-code/):00003         ObjID_EHZ_Mask equ 1
     0002             (./generated-code/):00004         ObjID_EHZ equ 2
     0003             (./generated-code/):00005         ObjID_Scroll equ 3
     0004             (./generated-code/):00006         ObjID_Sonic equ 4
     0005             (./generated-code/):00007         ObjID_Smps equ 5
     0006             (./generated-code/):00008         ObjID_EHZ_Back equ 6
                      (C:\Users\bhrou\gi):00002                 INCLUDE "./generated-code/Game.glb"
                      (./generated-code/):00001         * Generated Code
                      (./generated-code/):00002         
     010E             (./generated-code/):00003         Build_RAMLoaderManager equ $010E
     0000             (./generated-code/):00004         GmID_EHZ equ 0
     0000             (./generated-code/):00005         gmboot equ 0
                      (C:\Users\bhrou\gi):00003         
                      (C:\Users\bhrou\gi):00004                 opt   c,ct
                      (C:\Users\bhrou\gi):00005                 
                      (C:\Users\bhrou\gi):00006                 ********************************************************************************
                      (C:\Users\bhrou\gi):00007                 * Game Engine (TO8 Thomson) - Benoit Rousseau 2020-2021
                      (C:\Users\bhrou\gi):00008                 * ------------------------------------------------------------------------------
                      (C:\Users\bhrou\gi):00009                 *
                      (C:\Users\bhrou\gi):00010                 *
                      (C:\Users\bhrou\gi):00011                 ********************************************************************************
                      (C:\Users\bhrou\gi):00012                 
                      (C:\Users\bhrou\gi):00013                         INCLUDE "./Engine/Constants.asm"
                      (./Engine/Constant):00001                 * ---------------------------------------------------------------------------
                      (./Engine/Constant):00002                 * Constants
                      (./Engine/Constant):00003                 *
                      (./Engine/Constant):00004                 * Naming convention
                      (./Engine/Constant):00005                 * -----------------
                      (./Engine/Constant):00006                 * - lower case
                      (./Engine/Constant):00007                 * - underscore-separated names
                      (./Engine/Constant):00008                 *
                      (./Engine/Constant):00009                 * ---------------------------------------------------------------------------
                      (./Engine/Constant):00010                 
                      (./Engine/Constant):00011                 * ===========================================================================
                      (./Engine/Constant):00012                 * TO8 Registers
                      (./Engine/Constant):00013                 * ===========================================================================
                      (./Engine/Constant):00014                 
                      (./Engine/Constant):00015                 ; Disk routine registers (ROM)
                      (./Engine/Constant):00016                 
     6049             (./Engine/Constant):00017                 dk_drive                      equ $6049
     604A             (./Engine/Constant):00018                 dk_track                      equ $604A
     604B             (./Engine/Constant):00019                 dk_track_lsb                  equ $604B
     604C             (./Engine/Constant):00020                 dk_sector                     equ $604C
     604F             (./Engine/Constant):00021                 dk_write_location             equ $604F
                      (./Engine/Constant):00022                 
                      (./Engine/Constant):00023                 * ===========================================================================
                      (./Engine/Constant):00024                 * Globals
                      (./Engine/Constant):00025                 * ===========================================================================
                      (./Engine/Constant):00026                 
     009F             (./Engine/Constant):00027                 glb_direct_page               equ $9F    ; direct page for globals
                      (./Engine/Constant):00028                 
                      (./Engine/Constant):00029                 ; compilated sprite
     9FFE             (./Engine/Constant):00030                 glb_register_s                equ $9FFE  ; reverved space to store S from ROM routines
                      (./Engine/Constant):00031                 
                      (./Engine/Constant):00032                 ; DrawSprites
     9FFC             (./Engine/Constant):00033                 glb_screen_location_1         equ $9FFC  ; start address for rendering of current sprite Part1     
     9FFA             (./Engine/Constant):00034                 glb_screen_location_2         equ $9FFA  ; start address for rendering of current sprite Part2 (Must follow Part1)
                      (./Engine/Constant):00035                 
                      (./Engine/Constant):00036                 ; CheckSpritesRefresh
     9FF9             (./Engine/Constant):00037                 glb_cur_priority              equ $9FF9
     9FF7             (./Engine/Constant):00038                 glb_cur_ptr_sub_obj_erase     equ $9FF7
     9FF5             (./Engine/Constant):00039                 glb_cur_ptr_sub_obj_draw      equ $9FF5
     9FF3             (./Engine/Constant):00040                 glb_camera_x_pos              equ $9FF3 ; camera x position in palyfield coordinates
     9FF1             (./Engine/Constant):00041                 glb_camera_y_pos              equ $9FF1 ; camera y position in palyfield coordinates
     9FEF             (./Engine/Constant):00042                 glb_camera_x_min_pos          equ $9FEF
     9FED             (./Engine/Constant):00043                 glb_camera_y_min_pos          equ $9FED
     9FEB             (./Engine/Constant):00044                 glb_camera_x_max_pos          equ $9FEB
     9FE9             (./Engine/Constant):00045                 glb_camera_y_max_pos          equ $9FE9
     9FE8             (./Engine/Constant):00046                 glb_force_sprite_refresh      equ $9FE8
     9FE7             (./Engine/Constant):00047                 glb_camera_move               equ $9FE7
     9FE6             (./Engine/Constant):00048                 glb_alphaTiles                equ $9FE6
     9F00             (./Engine/Constant):00049                 glb_tmp_var                   equ $9F00 ; custom tmp var space for routine
     9F00             (./Engine/Constant):00050                 glb_system_stack              equ $9F00
                      (./Engine/Constant):00051                 
                      (./Engine/Constant):00052                 * ===========================================================================
                      (./Engine/Constant):00053                 * Display Constants
                      (./Engine/Constant):00054                 * ===========================================================================
                      (./Engine/Constant):00055                 
     00A0             (./Engine/Constant):00056                 screen_width                  equ 160    ; in pixel
     001C             (./Engine/Constant):00057                 screen_top                    equ 28     ; in pixel
     00E3             (./Engine/Constant):00058                 screen_bottom                 equ 28+199 ; in pixel
     0030             (./Engine/Constant):00059                 screen_left                   equ 48     ; in pixel
     00CF             (./Engine/Constant):00060                 screen_right                  equ 48+159 ; in pixel
     0008             (./Engine/Constant):00061                 nb_priority_levels            equ 8      ; number of priority levels (need code change if modified)
                      (./Engine/Constant):00062                 
                      (./Engine/Constant):00063                 * ===========================================================================
                      (./Engine/Constant):00064                 * Images Constants
                      (./Engine/Constant):00065                 * ===========================================================================
                      (./Engine/Constant):00066                 
     0004             (./Engine/Constant):00067                 image_x_size                  equ 4
     0005             (./Engine/Constant):00068                 image_y_size                  equ 5
     0006             (./Engine/Constant):00069                 image_center_offset           equ 6
                      (./Engine/Constant):00070                 
     0004             (./Engine/Constant):00071                 image_subset_x1_offset        equ 4
     0005             (./Engine/Constant):00072                 image_subset_y1_offset        equ 5
                      (./Engine/Constant):00073                 
     0000             (./Engine/Constant):00074                 page_draw_routine             equ 0
     0001             (./Engine/Constant):00075                 draw_routine                  equ 1
     0003             (./Engine/Constant):00076                 page_erase_routine            equ 3
     0004             (./Engine/Constant):00077                 erase_routine                 equ 4
     0006             (./Engine/Constant):00078                 erase_nb_cell                 equ 6
                      (./Engine/Constant):00079                 
                      (./Engine/Constant):00080                 * ===========================================================================
                      (./Engine/Constant):00081                 * Sound Constants
                      (./Engine/Constant):00082                 * ===========================================================================
                      (./Engine/Constant):00083                 
     0000             (./Engine/Constant):00084                 sound_page        equ 0
     0001             (./Engine/Constant):00085                 sound_start_addr  equ 1
     0003             (./Engine/Constant):00086                 sound_end_addr    equ 3
     0005             (./Engine/Constant):00087                 sound_meta_size   equ 5
                      (./Engine/Constant):00088                 
                      (./Engine/Constant):00089                 * ===========================================================================
                      (./Engine/Constant):00090                 * Object Constants
                      (./Engine/Constant):00091                 * ===========================================================================
                      (./Engine/Constant):00092                 
     005D             (./Engine/Constant):00093                 object_core_size              equ 93  ; the size of an object without ext_vars - DEPENDENCY ClearObj routine
     0064             (./Engine/Constant):00094                 object_size                   equ object_core_size+ext_variables_size ; the size of a dynamic object
     0064             (./Engine/Constant):00095                 next_object                   equ object_size
     005D             (./Engine/Constant):00096                 ext_variables                 equ object_core_size ; start of reserved space for additionnal variables
                      (./Engine/Constant):00097                 
     0000             (./Engine/Constant):00098                 id                            equ 0           ; reference to object model id (ObjID_) (0: free slot)
     0001             (./Engine/Constant):00099                 subtype                       equ 1           ; reference to object subtype (Sub_)
     0002             (./Engine/Constant):00100                 render_flags                  equ 2
                      (./Engine/Constant):00101                 
                      (./Engine/Constant):00102                 * --- render_flags bitfield variables ---
     0001             (./Engine/Constant):00103                 render_xmirror_mask           equ $01 ; (bit 0) DEPENDENCY should be bit 0 - tell display engine to mirror sprite on horizontal axis
     0002             (./Engine/Constant):00104                 render_ymirror_mask           equ $02 ; (bit 1) DEPENDENCY should be bit 1 - tell display engine to mirror sprite on vertical axis
     0004             (./Engine/Constant):00105                 render_overlay_mask           equ $04 ; (bit 2) DEPENDENCY should be bit 2 - compilated sprite with no background save
     0008             (./Engine/Constant):00106                 render_motionless_mask        equ $08 ; (bit 3) tell display engine to compute sub image and position check only once until the flag is removed  
     0010             (./Engine/Constant):00107                 render_playfieldcoord_mask    equ $10 ; (bit 4) tell display engine to use playfield (1) or screen (0) coordinates
     0020             (./Engine/Constant):00108                 render_hide_mask              equ $20 ; (bit 5) tell display engine to hide sprite (keep priority and mapping_frame)
     0040             (./Engine/Constant):00109                 render_todelete_mask          equ $40 ; (bit 6) tell display engine to delete sprite and clear OST for this object
     0080             (./Engine/Constant):00110                 render_xloop_mask             equ $80 ; (bit 7) (screen coordinate) tell display engine to hide sprite when x is out of screen (0) or to display (1)  
                      (./Engine/Constant):00111                  
     0003             (./Engine/Constant):00112                 priority                      equ 3           ; display priority (0: nothing to display, 1:front, ..., 8:back)
     0004             (./Engine/Constant):00113                 anim                          equ 4  ; and 5  ; reference to current animation (Ani_)
     0006             (./Engine/Constant):00114                 prev_anim                     equ 6  ; and 7  ; reference to previous animation (Ani_)
     0008             (./Engine/Constant):00115                 anim_frame                    equ 8           ; index of current frame in animation
     0009             (./Engine/Constant):00116                 anim_frame_duration           equ 9           ; number of frames for each image in animation, range: 00-7F (0-127), 0 means display only during one frame
     000A             (./Engine/Constant):00117                 anim_flags                    equ 10          ; byte offset to reference an anim_flags LUT (adv) / store a link flag (non adv)
                      (./Engine/Constant):00118                 
                      (./Engine/Constant):00119                 * --- anim_flags bitfield variables ---
     0001             (./Engine/Constant):00120                 anim_link_mask                equ $01 ; (bit 0) if set, allow the load of a new animation without reseting anim_frame and anim_frame_duration
                      (./Engine/Constant):00121                 
     000B             (./Engine/Constant):00122                 status_flags                  equ 11          ; orientation of sprite, is applied to animation xmirror flag during AnimateSprite
                      (./Engine/Constant):00123                 
                      (./Engine/Constant):00124                 * --- status_flags bitfield variables ---
     0001             (./Engine/Constant):00125                 status_xflip_mask             equ $01 ; (bit 0) X Flip
     0002             (./Engine/Constant):00126                 status_yflip_mask             equ $02 ; (bit 1) Y Flip
                      (./Engine/Constant):00127                 
     000C             (./Engine/Constant):00128                 image_set                     equ 12 ; and 13 ; reference to current image (Img_) (0000 if no image)
     000E             (./Engine/Constant):00129                 x_pos                         equ 14 ; and 15 ; x playfield coordinate
     0010             (./Engine/Constant):00130                 x_sub                         equ 16          ; x subpixel (1/256 of a pixel), must follow x_pos in data structure
     0011             (./Engine/Constant):00131                 y_pos                         equ 17 ; and 18 ; y playfield coordinate
     0013             (./Engine/Constant):00132                 y_sub                         equ 19          ; y subpixel (1/256 of a pixel), must follow y_pos in data structure
     0014             (./Engine/Constant):00133                 xy_pixel                      equ 20          ; x and y screen coordinate
     0014             (./Engine/Constant):00134                 x_pixel                       equ 20          ; x screen coordinate
     0015             (./Engine/Constant):00135                 y_pixel                       equ 21          ; y screen coordinate, must follow x_pixel
                      (./Engine/Constant):00136                 ;x_offset                      equ 93          ; x screen coordinate offset that is applied at rendering
                      (./Engine/Constant):00137                 ;y_offset                      equ 94          ; x screen coordinate offset that is applied at rendering
     0016             (./Engine/Constant):00138                 x_vel                         equ 22 ; and 23 ; horizontal velocity
     0018             (./Engine/Constant):00139                 y_vel                         equ 24 ; and 25 ; vertical velocity
     001A             (./Engine/Constant):00140                 x_acl                         equ 26 ; and 27 ; horizontal gravity
     001C             (./Engine/Constant):00141                 y_acl                         equ 28 ; and 29 ; vertical gravity
     001E             (./Engine/Constant):00142                 routine                       equ 30          ; index of current object routine
     001F             (./Engine/Constant):00143                 routine_secondary             equ 31          ; index of current secondary routine
     0020             (./Engine/Constant):00144                 routine_tertiary              equ 32          ; index of current tertiary routine
     0021             (./Engine/Constant):00145                 routine_quaternary            equ 33          ; index of current quaternary routine
                      (./Engine/Constant):00146                 
                      (./Engine/Constant):00147                 * ---------------------------------------------------------------------------
                      (./Engine/Constant):00148                 * reserved variables (update by engine)
                      (./Engine/Constant):00149                 
     0022             (./Engine/Constant):00150                 rsv_render_flags              equ 34
                      (./Engine/Constant):00151                 
                      (./Engine/Constant):00152                 * --- rsv_render_flags bitfield variables ---
     0001             (./Engine/Constant):00153                 rsv_render_checkrefresh_mask  equ $01 ; (bit 0) if erasesprite and display sprite flag are processed for this frame
     0002             (./Engine/Constant):00154                 rsv_render_erasesprite_mask   equ $02 ; (bit 1) if a sprite need to be cleared on screen
     0004             (./Engine/Constant):00155                 rsv_render_displaysprite_mask equ $04 ; (bit 2) if a sprite need to be rendered on screen
     0008             (./Engine/Constant):00156                 rsv_render_outofrange_mask    equ $08 ; (bit 3) if a sprite is out of range for full rendering in screen
     0080             (./Engine/Constant):00157                 rsv_render_onscreen_mask      equ $80 ; (bit 7) DEPENDENCY should be bit 7 - has been rendered on last screen buffer (may be 0 or 1)
                      (./Engine/Constant):00158                 
     0023             (./Engine/Constant):00159                 rsv_prev_anim                 equ 35 ; and 36 ; reference to previous animation (Ani_) w * UTILE ?
     0025             (./Engine/Constant):00160                 rsv_image_center_offset       equ 37 ; 0 or 1 offset that indicate if image center is even or odd (DRS_XYToAddress)
     0026             (./Engine/Constant):00161                 rsv_image_subset              equ 38 ; and 39 ; reference to current image regarding mirror flags w
     0028             (./Engine/Constant):00162                 rsv_mapping_frame             equ 40 ; and 41 ; reference to current image regarding mirror flags, overlay flag and x precision w
     002A             (./Engine/Constant):00163                 rsv_erase_nb_cell             equ 42 ; b 
     002B             (./Engine/Constant):00164                 rsv_page_draw_routine         equ 43 ; b
     002C             (./Engine/Constant):00165                 rsv_draw_routine              equ 44 ; and 45 ; w
     002E             (./Engine/Constant):00166                 rsv_page_erase_routine        equ 46 ; b
     002F             (./Engine/Constant):00167                 rsv_erase_routine             equ 47 ; and 48 ; w 
     0031             (./Engine/Constant):00168                 rsv_xy1_pixel                 equ 49 ;
     0031             (./Engine/Constant):00169                 rsv_x1_pixel                  equ 49 ; x+x_offset-(x_size/2) screen coordinate
     0032             (./Engine/Constant):00170                 rsv_y1_pixel                  equ 50 ; y+y_offset-(y_size/2) screen coordinate, must follow rsv_x1_pixel
     0033             (./Engine/Constant):00171                 rsv_xy2_pixel                 equ 51 ;
     0033             (./Engine/Constant):00172                 rsv_x2_pixel                  equ 51 ; x+x_offset+(x_size/2) screen coordinate
     0034             (./Engine/Constant):00173                 rsv_y2_pixel                  equ 52 ; y+y_offset+(y_size/2) screen coordinate, must follow rsv_x2_pixel
                      (./Engine/Constant):00174                 
                      (./Engine/Constant):00175                 * ---------------------------------------------------------------------------
                      (./Engine/Constant):00176                 * reserved variables (engine) - buffer specific
                      (./Engine/Constant):00177                 
     0035             (./Engine/Constant):00178                 rsv_buffer_0                  equ 53 ; Start index of buffer 0 variables
     0035             (./Engine/Constant):00179                 rsv_priority_0                equ 53 ; internal value that hold priority in video buffer 0
     0036             (./Engine/Constant):00180                 rsv_priority_prev_obj_0       equ 54 ; and 55 ; previous object (OST address) in display priority list for video buffer 0 (0000 if none) w
     0038             (./Engine/Constant):00181                 rsv_priority_next_obj_0       equ 56 ; and 57 ; next object (OST address) in display priority list for video buffer 0 (0000 if none) w
     003A             (./Engine/Constant):00182                 rsv_prev_mapping_frame_0      equ 58 ; and 59 ; reference to previous image in video buffer 0 w
     003C             (./Engine/Constant):00183                 rsv_prev_erase_nb_cell_0      equ 60 : b
     003D             (./Engine/Constant):00184                 rsv_prev_page_erase_routine_0 equ 61 ; b
     003E             (./Engine/Constant):00185                 rsv_prev_erase_routine_0      equ 62 ; and 63 ; w
     0040             (./Engine/Constant):00186                 rsv_bgdata_0                  equ 64 ; and 65 ; address of background data in screen 0 w
     0042             (./Engine/Constant):00187                 rsv_prev_xy_pixel_0           equ 66 ;
     0042             (./Engine/Constant):00188                 rsv_prev_x_pixel_0            equ 66 ; previous x screen coordinate b
     0043             (./Engine/Constant):00189                 rsv_prev_y_pixel_0            equ 67 ; previous y screen coordinate b, must follow x_pixel
     0044             (./Engine/Constant):00190                 rsv_prev_xy1_pixel_0          equ 68 ;
     0044             (./Engine/Constant):00191                 rsv_prev_x1_pixel_0           equ 68 ; previous x+x_offset-(x_size/2) screen coordinate b
     0045             (./Engine/Constant):00192                 rsv_prev_y1_pixel_0           equ 69 ; previous y+y_offset-(y_size/2) screen coordinate b, must follow x1_pixel
     0046             (./Engine/Constant):00193                 rsv_prev_xy2_pixel_0          equ 70 ;
     0046             (./Engine/Constant):00194                 rsv_prev_x2_pixel_0           equ 70 ; previous x+x_offset+(x_size/2) screen coordinate b
     0047             (./Engine/Constant):00195                 rsv_prev_y2_pixel_0           equ 71 ; previous y+y_offset+(y_size/2) screen coordinate b, must follow x2_pixel
     0048             (./Engine/Constant):00196                 rsv_prev_render_flags_0       equ 72 ;
                      (./Engine/Constant):00197                 * --- rsv_prev_render_flags_0 bitfield variables ---
     0001             (./Engine/Constant):00198                 rsv_prev_render_overlay_mask  equ $01 ; (bit 0) if a sprite has been rendered with compilated sprite and no background save on screen buffer 0/1
     0080             (./Engine/Constant):00199                 rsv_prev_render_onscreen_mask equ $80 ; (bit 7) DEPENDENCY should be bit 7 - has been rendered on screen buffer 0/1
                      (./Engine/Constant):00200                 
     0049             (./Engine/Constant):00201                 rsv_buffer_1                  equ 73 ; Start index of buffer 1 variables
     0049             (./Engine/Constant):00202                 rsv_priority_1                equ 73 ; internal value that hold priority in video buffer 1
     004A             (./Engine/Constant):00203                 rsv_priority_prev_obj_1       equ 74 ; and 75 ; previous object (OST address) in display priority list for video buffer 1 (0000 if none) w
     004C             (./Engine/Constant):00204                 rsv_priority_next_obj_1       equ 76 ; and 77 ; next object (OST address) in display priority list for video buffer 1 (0000 if none) w
     004E             (./Engine/Constant):00205                 rsv_prev_mapping_frame_1      equ 78 ; and 79 ; reference to previous image in video buffer 1 w
     0050             (./Engine/Constant):00206                 rsv_prev_erase_nb_cell_1      equ 80 ; b
     0051             (./Engine/Constant):00207                 rsv_prev_page_erase_routine_1 equ 81 ; b
     0052             (./Engine/Constant):00208                 rsv_prev_erase_routine_1      equ 82 ; and 83 ; w
     0054             (./Engine/Constant):00209                 rsv_bgdata_1                  equ 84 ; and 85 ; address of background data in screen 1 w
     0056             (./Engine/Constant):00210                 rsv_prev_xy_pixel_1           equ 86 ;
     0056             (./Engine/Constant):00211                 rsv_prev_x_pixel_1            equ 86 ; previous x screen coordinate b
     0057             (./Engine/Constant):00212                 rsv_prev_y_pixel_1            equ 87 ; previous y screen coordinate b, must follow x_pixel
     0058             (./Engine/Constant):00213                 rsv_prev_xy1_pixel_1          equ 88 ;
     0058             (./Engine/Constant):00214                 rsv_prev_x1_pixel_1           equ 88 ; previous x+x_size screen coordinate b
     0059             (./Engine/Constant):00215                 rsv_prev_y1_pixel_1           equ 89 ; previous y+y_size screen coordinate b, must follow x_pixel
     005A             (./Engine/Constant):00216                 rsv_prev_xy2_pixel_1          equ 90 ;
     005A             (./Engine/Constant):00217                 rsv_prev_x2_pixel_1           equ 90 ; previous x+x_size screen coordinate b
     005B             (./Engine/Constant):00218                 rsv_prev_y2_pixel_1           equ 91 ; previous y+y_size screen coordinate b, must follow x_pixel
     005C             (./Engine/Constant):00219                 rsv_prev_render_flags_1       equ 92 ;
                      (./Engine/Constant):00220                 
     0000             (./Engine/Constant):00221                 buf_priority                  equ 0  ; offset for each rsv_buffer variables
     0001             (./Engine/Constant):00222                 buf_priority_prev_obj         equ 1  ;
     0003             (./Engine/Constant):00223                 buf_priority_next_obj         equ 3  ;
     0005             (./Engine/Constant):00224                 buf_prev_mapping_frame        equ 5  ;
     0007             (./Engine/Constant):00225                 buf_erase_nb_cell             equ 7  ;
     0008             (./Engine/Constant):00226                 buf_page_erase_routine        equ 8 ;
     0009             (./Engine/Constant):00227                 buf_erase_routine             equ 9 ;
     000B             (./Engine/Constant):00228                 buf_bgdata                    equ 11 ;
     000D             (./Engine/Constant):00229                 buf_prev_xy_pixel             equ 13 ;
     000D             (./Engine/Constant):00230                 buf_prev_x_pixel              equ 13 ;
     000E             (./Engine/Constant):00231                 buf_prev_y_pixel              equ 14 ;
     000F             (./Engine/Constant):00232                 buf_prev_xy1_pixel            equ 15 ;
     000F             (./Engine/Constant):00233                 buf_prev_x1_pixel             equ 15 ;
     0010             (./Engine/Constant):00234                 buf_prev_y1_pixel             equ 16 ;
     0011             (./Engine/Constant):00235                 buf_prev_xy2_pixel            equ 17 ;
     0011             (./Engine/Constant):00236                 buf_prev_x2_pixel             equ 17 ;
     0012             (./Engine/Constant):00237                 buf_prev_y2_pixel             equ 18 ;
     0013             (./Engine/Constant):00238                 buf_prev_render_flags         equ 19 ;
                      (C:\Users\bhrou\gi):00014                         INCLUDE "./Engine/Macros.asm"        
0000                  (./Engine/Macros.a):00001                 _ldd MACRO
                      (./Engine/Macros.a):00002                         ldd   #((\1)*256)+\2
                      (./Engine/Macros.a):00003                  ENDM
                      (./Engine/Macros.a):00004                  
0000                  (./Engine/Macros.a):00005                 _ldx MACRO
                      (./Engine/Macros.a):00006                         ldx   #((\1)*256)+\2
                      (./Engine/Macros.a):00007                  ENDM
                      (./Engine/Macros.a):00008                  
0000                  (./Engine/Macros.a):00009                 _ldy MACRO
                      (./Engine/Macros.a):00010                         ldy   #((\1)*256)+\2
                      (./Engine/Macros.a):00011                  ENDM
                      (./Engine/Macros.a):00012                  
0000                  (./Engine/Macros.a):00013                 _ldu MACRO
                      (./Engine/Macros.a):00014                         ldu   #((\1)*256)+\2
                      (./Engine/Macros.a):00015                  ENDM  
                      (./Engine/Macros.a):00016                  
0000                  (./Engine/Macros.a):00017                 _lds MACRO
                      (./Engine/Macros.a):00018                         lds   #((\1)*256)+\2
                      (./Engine/Macros.a):00019                  ENDM   
                      (./Engine/Macros.a):00020                  
0000                  (./Engine/Macros.a):00021                 _SetCartPageA MACRO
                      (./Engine/Macros.a):00022                  IFDEF T2
                      (./Engine/Macros.a):00023                         jsr   SetCartPageA
                      (./Engine/Macros.a):00024                  ELSE
                      (./Engine/Macros.a):00025                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (./Engine/Macros.a):00026                  ENDC
                      (./Engine/Macros.a):00027                  ENDM      
                      (./Engine/Macros.a):00028                  
0000                  (./Engine/Macros.a):00029                 _GetCartPageA MACRO
                      (./Engine/Macros.a):00030                  IFDEF T2
                      (./Engine/Macros.a):00031                         jsr   GetCartPageA
                      (./Engine/Macros.a):00032                  ELSE
                      (./Engine/Macros.a):00033                         lda   $E7E6
                      (./Engine/Macros.a):00034                  ENDC
                      (./Engine/Macros.a):00035                  ENDM
                      (./Engine/Macros.a):00036                 
0000                  (./Engine/Macros.a):00037                 _SetCartPageB MACRO
                      (./Engine/Macros.a):00038                  IFDEF T2
                      (./Engine/Macros.a):00039                         jsr   SetCartPageB
                      (./Engine/Macros.a):00040                  ELSE
                      (./Engine/Macros.a):00041                         stb   $E7E6                    ; selection de la page RAM en zone cartouche
                      (./Engine/Macros.a):00042                  ENDC
                      (./Engine/Macros.a):00043                  ENDM      
                      (./Engine/Macros.a):00044                  
0000                  (./Engine/Macros.a):00045                 _GetCartPageB MACRO
                      (./Engine/Macros.a):00046                  IFDEF T2
                      (./Engine/Macros.a):00047                         jsr   GetCartPageB
                      (./Engine/Macros.a):00048                  ELSE
                      (./Engine/Macros.a):00049                         ldb   $E7E6
                      (./Engine/Macros.a):00050                  ENDC
                      (./Engine/Macros.a):00051                  ENDM     
                      (./Engine/Macros.a):00052                 
0000                  (./Engine/Macros.a):00053                 _RunObjectSwap MACRO
                      (./Engine/Macros.a):00054                         ; param 1 : ObjID_
                      (./Engine/Macros.a):00055                         ; param 2 : Object data RAM address
                      (./Engine/Macros.a):00056                         ; manual launch of an object from a different dynamic memory page and not from the resident page 1
                      (./Engine/Macros.a):00057                         lda   Obj_Index_Page+\1   
                      (./Engine/Macros.a):00058                         ldu   Obj_Index_Address+2*\1
                      (./Engine/Macros.a):00059                         stu   glb_Address       
                      (./Engine/Macros.a):00060                         ldu   \2             
                      (./Engine/Macros.a):00061                         jsr   RunPgSubRoutine
                      (./Engine/Macros.a):00062                  ENDM    
                      (./Engine/Macros.a):00063                 
0000                  (./Engine/Macros.a):00064                 _RunObjectSwapRoutine MACRO
                      (./Engine/Macros.a):00065                         ; param 1 : ObjID_
                      (./Engine/Macros.a):00066                         ; param 2 : Object routine
                      (./Engine/Macros.a):00067                         ; manual launch of an object from a different dynamic memory page and not from the resident page 1
                      (./Engine/Macros.a):00068                         lda   Obj_Index_Page+\1   
                      (./Engine/Macros.a):00069                         ldu   Obj_Index_Address+2*\1
                      (./Engine/Macros.a):00070                         stu   glb_Address       
                      (./Engine/Macros.a):00071                         lda   \2        
                      (./Engine/Macros.a):00072                         jsr   RunPgSubRoutine
                      (./Engine/Macros.a):00073                  ENDM 
                      (./Engine/Macros.a):00074                  
0000                  (./Engine/Macros.a):00075                 _MountObject MACRO 
                      (./Engine/Macros.a):00076                         ; param 1 : ObjID_
                      (./Engine/Macros.a):00077                         ; manual mount of an object from the resident page 1
                      (./Engine/Macros.a):00078                         lda   Obj_Index_Page+\1
                      (./Engine/Macros.a):00079                         _SetCartPageA
                      (./Engine/Macros.a):00080                         ldx   Obj_Index_Address+2*\1
                      (./Engine/Macros.a):00081                  ENDM
                      (./Engine/Macros.a):00082                 
0000                  (./Engine/Macros.a):00083                 _RunObject MACRO 
                      (./Engine/Macros.a):00084                         ; param 1 : ObjID_
                      (./Engine/Macros.a):00085                         ; param 2 : Object data RAM address
                      (./Engine/Macros.a):00086                         ; manual launch of an object from the resident page 1
                      (./Engine/Macros.a):00087                         _MountObject \1
                      (./Engine/Macros.a):00088                         ldu   \2        
                      (./Engine/Macros.a):00089                         jsr   ,x
                      (./Engine/Macros.a):00090                  ENDM
                      (./Engine/Macros.a):00091                 
0000                  (./Engine/Macros.a):00092                 _RunObjectRoutine MACRO 
                      (./Engine/Macros.a):00093                         ; param 1 : ObjID_
                      (./Engine/Macros.a):00094                         ; param 2 : Object routine
                      (./Engine/Macros.a):00095                         ; manual launch of an object from the resident page 1
                      (./Engine/Macros.a):00096                         ; this object does not need or have a data structure for this routine
                      (./Engine/Macros.a):00097                         _MountObject \1
                      (./Engine/Macros.a):00098                         lda   \2        
                      (./Engine/Macros.a):00099                         jsr   ,x
                      (./Engine/Macros.a):00100                  ENDM
                      (./Engine/Macros.a):00101                 
0000                  (./Engine/Macros.a):00102                 _asld MACRO
                      (./Engine/Macros.a):00103                         aslb
                      (./Engine/Macros.a):00104                         rola
                      (./Engine/Macros.a):00105                  ENDM        
                      (./Engine/Macros.a):00106                  
0000                  (./Engine/Macros.a):00107                 _asrd MACRO
                      (./Engine/Macros.a):00108                         asra
                      (./Engine/Macros.a):00109                         rorb
                      (./Engine/Macros.a):00110                  ENDM      
                      (./Engine/Macros.a):00111                  
0000                  (./Engine/Macros.a):00112                 _lsld MACRO
                      (./Engine/Macros.a):00113                         lslb
                      (./Engine/Macros.a):00114                         rola
                      (./Engine/Macros.a):00115                  ENDM        
                      (./Engine/Macros.a):00116                  
0000                  (./Engine/Macros.a):00117                 _lsrd MACRO
                      (./Engine/Macros.a):00118                         lsra
                      (./Engine/Macros.a):00119                         rorb
                      (./Engine/Macros.a):00120                  ENDM
                      (./Engine/Macros.a):00121                  
0000                  (./Engine/Macros.a):00122                 _rold MACRO
                      (./Engine/Macros.a):00123                         rolb
                      (./Engine/Macros.a):00124                         rola
                      (./Engine/Macros.a):00125                  ENDM    
                      (./Engine/Macros.a):00126                  
0000                  (./Engine/Macros.a):00127                 _rord MACRO
                      (./Engine/Macros.a):00128                         rora
                      (./Engine/Macros.a):00129                         rorb
                      (./Engine/Macros.a):00130                  ENDM
                      (./Engine/Macros.a):00131                 
0000                  (./Engine/Macros.a):00132                 _negd MACRO
                      (./Engine/Macros.a):00133                         nega
                      (./Engine/Macros.a):00134                         negb
                      (./Engine/Macros.a):00135                         sbca  #0
                      (./Engine/Macros.a):00136                  ENDM
                      (./Engine/Macros.a):00137                 
0000                  (./Engine/Macros.a):00138                 _cba MACRO
                      (./Engine/Macros.a):00139                         pshs  b
                      (./Engine/Macros.a):00140                         cmpa  ,s+
                      (./Engine/Macros.a):00141                  ENDM
                      (./Engine/Macros.a):00142                 
0000                  (./Engine/Macros.a):00143                 _aba MACRO
                      (./Engine/Macros.a):00144                         pshs  b
                      (./Engine/Macros.a):00145                         adda  ,s+
                      (./Engine/Macros.a):00146                  ENDM
                      (./Engine/Macros.a):00147                 
0000                  (./Engine/Macros.a):00148                 _sba MACRO
                      (./Engine/Macros.a):00149                         pshs  b
                      (./Engine/Macros.a):00150                         suba  ,s+
                      (./Engine/Macros.a):00151                  ENDM
                      (./Engine/Macros.a):00152                 
0000                  (./Engine/Macros.a):00153                 _cab MACRO
                      (./Engine/Macros.a):00154                         pshs  a
                      (./Engine/Macros.a):00155                         cmpb  ,s+
                      (./Engine/Macros.a):00156                  ENDM
                      (./Engine/Macros.a):00157                 
0000                  (./Engine/Macros.a):00158                 _aab MACRO
                      (./Engine/Macros.a):00159                         pshs  a
                      (./Engine/Macros.a):00160                         addb  ,s+
                      (./Engine/Macros.a):00161                  ENDM
                      (./Engine/Macros.a):00162                 
0000                  (./Engine/Macros.a):00163                 _sab MACRO
                      (./Engine/Macros.a):00164                         pshs  a
                      (./Engine/Macros.a):00165                         subb  ,s+
                      (./Engine/Macros.a):00166                  ENDM
                      (C:\Users\bhrou\gi):00015                         INCLUDE "./objects/engine/smps/SndID.equ"       
     0002             (./objects/engine/):00001                 SndID_Jump equ   ($A0-$A0)*2+2
     0004             (./objects/engine/):00002                 SndID_Checkpoint equ   ($A1-$A0)*2+2
     0006             (./objects/engine/):00003                 SndID_SpikeSwitch equ   ($A2-$A0)*2+2
     0008             (./objects/engine/):00004                 SndID_Hurt equ   ($A3-$A0)*2+2
     000A             (./objects/engine/):00005                 SndID_Skidding equ   ($A4-$A0)*2+2
     000C             (./objects/engine/):00006                 SndID_BlockPush equ   ($A5-$A0)*2+2
     000E             (./objects/engine/):00007                 SndID_HurtBySpikes equ   ($A6-$A0)*2+2
     0010             (./objects/engine/):00008                 SndID_Sparkle equ   ($A7-$A0)*2+2
     0012             (./objects/engine/):00009                 SndID_Beep equ   ($A8-$A0)*2+2
     0014             (./objects/engine/):00010                 SndID_Bwoop equ   ($A9-$A0)*2+2
     0016             (./objects/engine/):00011                 SndID_Splash equ   ($AA-$A0)*2+2
     0018             (./objects/engine/):00012                 SndID_Swish equ   ($AB-$A0)*2+2
     001A             (./objects/engine/):00013                 SndID_BossHit equ   ($AC-$A0)*2+2
     001C             (./objects/engine/):00014                 SndID_InhalingBubble equ   ($AD-$A0)*2+2
     001E             (./objects/engine/):00015                 SndID_ArrowFiring equ   ($AE-$A0)*2+2
     001E             (./objects/engine/):00016                 SndID_LavaBall equ   ($AE-$A0)*2+2
     0020             (./objects/engine/):00017                 SndID_Shield equ   ($AF-$A0)*2+2
     0022             (./objects/engine/):00018                 SndID_LaserBeam equ   ($B0-$A0)*2+2
     0024             (./objects/engine/):00019                 SndID_Zap equ   ($B1-$A0)*2+2
     0026             (./objects/engine/):00020                 SndID_Drown equ   ($B2-$A0)*2+2
     0028             (./objects/engine/):00021                 SndID_FireBurn equ   ($B3-$A0)*2+2
     002A             (./objects/engine/):00022                 SndID_Bumper equ   ($B4-$A0)*2+2
     002C             (./objects/engine/):00023                 SndID_Ring equ   ($B5-$A0)*2+2
     002C             (./objects/engine/):00024                 SndID_RingRight equ   ($B5-$A0)*2+2
     002E             (./objects/engine/):00025                 SndID_SpikesMove equ   ($B6-$A0)*2+2
     0030             (./objects/engine/):00026                 SndID_Rumbling equ   ($B7-$A0)*2+2
     0034             (./objects/engine/):00027                 SndID_Smash equ   ($B9-$A0)*2+2
     0038             (./objects/engine/):00028                 SndID_DoorSlam equ   ($BB-$A0)*2+2
     003A             (./objects/engine/):00029                 SndID_SpindashRelease equ   ($BC-$A0)*2+2
     003C             (./objects/engine/):00030                 SndID_Hammer equ   ($BD-$A0)*2+2
     003E             (./objects/engine/):00031                 SndID_Roll equ   ($BE-$A0)*2+2
     0040             (./objects/engine/):00032                 SndID_ContinueJingle equ   ($BF-$A0)*2+2
     0042             (./objects/engine/):00033                 SndID_CasinoBonus equ   ($C0-$A0)*2+2
     0044             (./objects/engine/):00034                 SndID_Explosion equ   ($C1-$A0)*2+2
     0046             (./objects/engine/):00035                 SndID_WaterWarning equ   ($C2-$A0)*2+2
     0048             (./objects/engine/):00036                 SndID_EnterGiantRing equ   ($C3-$A0)*2+2
     004A             (./objects/engine/):00037                 SndID_BossExplosion equ   ($C4-$A0)*2+2
     004C             (./objects/engine/):00038                 SndID_TallyEnd equ   ($C5-$A0)*2+2
     004E             (./objects/engine/):00039                 SndID_RingSpill equ   ($C6-$A0)*2+2
     0052             (./objects/engine/):00040                 SndID_Flamethrower equ   ($C8-$A0)*2+2
     0054             (./objects/engine/):00041                 SndID_Bonus equ   ($C9-$A0)*2+2
     0056             (./objects/engine/):00042                 SndID_SpecStageEntry equ   ($CA-$A0)*2+2
     0058             (./objects/engine/):00043                 SndID_SlowSmash equ   ($CB-$A0)*2+2
     005A             (./objects/engine/):00044                 SndID_Spring equ   ($CC-$A0)*2+2
     005C             (./objects/engine/):00045                 SndID_Blip equ   ($CD-$A0)*2+2
     005E             (./objects/engine/):00046                 SndID_RingLeft equ   ($CE-$A0)*2+2
     0060             (./objects/engine/):00047                 SndID_Signpost equ   ($CF-$A0)*2+2
     0062             (./objects/engine/):00048                 SndID_CNZBossZap equ   ($D0-$A0)*2+2
     0068             (./objects/engine/):00049                 SndID_Signpost2P equ   ($D3-$A0)*2+2
     006A             (./objects/engine/):00050                 SndID_OOZLidPop equ   ($D4-$A0)*2+2
     006C             (./objects/engine/):00051                 SndID_SlidingSpike equ   ($D5-$A0)*2+2
     006E             (./objects/engine/):00052                 SndID_CNZElevator equ   ($D6-$A0)*2+2
     0070             (./objects/engine/):00053                 SndID_PlatformKnock equ   ($D7-$A0)*2+2
     0072             (./objects/engine/):00054                 SndID_BonusBumper equ   ($D8-$A0)*2+2
     0074             (./objects/engine/):00055                 SndID_LargeBumper equ   ($D9-$A0)*2+2
     0076             (./objects/engine/):00056                 SndID_Gloop equ   ($DA-$A0)*2+2
     0078             (./objects/engine/):00057                 SndID_PreArrowFiring equ   ($DB-$A0)*2+2
     007A             (./objects/engine/):00058                 SndID_Fire equ   ($DC-$A0)*2+2
     007C             (./objects/engine/):00059                 SndID_ArrowStick equ   ($DD-$A0)*2+2
     007E             (./objects/engine/):00060                 SndID_Helicopter equ   ($DE-$A0)*2+2
     0080             (./objects/engine/):00061                 SndID_SuperTransform equ   ($DF-$A0)*2+2
     0082             (./objects/engine/):00062                 SndID_SpindashRev equ   ($E0-$A0)*2+2
     0084             (./objects/engine/):00063                 SndID_Rumbling2 equ   ($E1-$A0)*2+2
     0086             (./objects/engine/):00064                 SndID_CNZLaunch equ   ($E2-$A0)*2+2
     0088             (./objects/engine/):00065                 SndID_Flipper equ   ($E3-$A0)*2+2
     008A             (./objects/engine/):00066                 SndID_HTZLiftClick equ   ($E4-$A0)*2+2
     008C             (./objects/engine/):00067                 SndID_Leaves equ   ($E5-$A0)*2+2
     008E             (./objects/engine/):00068                 SndID_MegaMackDrop equ   ($E6-$A0)*2+2
     0090             (./objects/engine/):00069                 SndID_DrawbridgeMove equ   ($E7-$A0)*2+2
     0092             (./objects/engine/):00070                 SndID_QuickDoorSlam equ   ($E8-$A0)*2+2
     0094             (./objects/engine/):00071                 SndID_DrawbridgeDown equ   ($E9-$A0)*2+2
     0096             (./objects/engine/):00072                 SndID_LaserBurst equ   ($EA-$A0)*2+2
     0098             (./objects/engine/):00073                 SndID_Scatter equ   ($EB-$A0)*2+2
     0098             (./objects/engine/):00074                 SndID_LaserFloor equ   ($EB-$A0)*2+2
     009A             (./objects/engine/):00075                 SndID_Teleport equ   ($EC-$A0)*2+2
     009C             (./objects/engine/):00076                 SndID_Error equ   ($ED-$A0)*2+2
     009E             (./objects/engine/):00077                 SndID_MechaSonicBuzz equ   ($EE-$A0)*2+2
     00A0             (./objects/engine/):00078                 SndID_LargeLaser equ   ($EF-$A0)*2+2
     00A2             (./objects/engine/):00079                 SndID_OilSlide equ   ($F0-$A0)*2+2
                      (C:\Users\bhrou\gi):00016                         org   $6100
                      (C:\Users\bhrou\gi):00017                         INCLUDE "./Engine/InitGlobals.asm"      
                      (./Engine/InitGlob):00001                 
6100 CC0000           (./Engine/InitGlob):00002 [3]     3               ldd   #0
                      (./Engine/InitGlob):00003                 
                      (./Engine/InitGlob):00004                 ; compilated sprite
6103 FD9FFE           (./Engine/InitGlob):00005 [6]     9               std   glb_register_s
                      (./Engine/InitGlob):00006                 
                      (./Engine/InitGlob):00007                 ; DrawSprites
6106 FD9FFC           (./Engine/InitGlob):00008 [6]     15              std   glb_screen_location_1
6109 FD9FFA           (./Engine/InitGlob):00009 [6]     21              std   glb_screen_location_2
                      (./Engine/InitGlob):00010                 
                      (./Engine/InitGlob):00011                 ; CheckSpritesRefresh
610C FD9FF9           (./Engine/InitGlob):00012 [6]     27              std   glb_cur_priority         
610F FD9FF7           (./Engine/InitGlob):00013 [6]     33              std   glb_cur_ptr_sub_obj_erase
6112 FD9FF5           (./Engine/InitGlob):00014 [6]     39              std   glb_cur_ptr_sub_obj_draw 
6115 FD9FF3           (./Engine/InitGlob):00015 [6]     45              std   glb_camera_x_pos         
6118 FD9FF1           (./Engine/InitGlob):00016 [6]     51              std   glb_camera_y_pos         
611B B79FE8           (./Engine/InitGlob):00017 [5]     56              sta   glb_force_sprite_refresh
611E B79FE7           (./Engine/InitGlob):00018 [5]     61              sta   glb_camera_move
6121 B79FE6           (./Engine/InitGlob):00019 [5]     66              sta   glb_alphaTiles
                      (C:\Users\bhrou\gi):00018                 
6124 BD985D           (C:\Users\bhrou\gi):00019 [8]     74              jsr   LoadAct       
6127 BD800C           (C:\Users\bhrou\gi):00020 [8]     82              jsr   ReadJoypads
                      (C:\Users\bhrou\gi):00021                 
612A                  (C:\Users\bhrou\gi):00022                 LevelSizeLoad ; todo move to an object
                      (C:\Users\bhrou\gi):00023                 
612A CE639B           (C:\Users\bhrou\gi):00024 [3]     85              ldu   #MainCharacter
612D CC0060           (C:\Users\bhrou\gi):00025 [3]     88              ldd   #screen_left+$60/2
6130 ED4E             (C:\Users\bhrou\gi):00026 [6]     94              std   x_pos,u
6132 CC02BF           (C:\Users\bhrou\gi):00027 [3]     97              ldd   #screen_top+20+$028F
6135 EDC811           (C:\Users\bhrou\gi):00028 [6]     103             std   y_pos,u
                      (C:\Users\bhrou\gi):00029                 
6138 CC0070           (C:\Users\bhrou\gi):00030 [3]     106             ldd   #camera_Y_pos_bias_default
613B FD6F6E           (C:\Users\bhrou\gi):00031 [6]     112             std   Camera_Y_pos_bias
                      (C:\Users\bhrou\gi):00032                 
613E CC0000           (C:\Users\bhrou\gi):00033 [3]     115             ldd   #0
6141 DDF3             (C:\Users\bhrou\gi):00034 [5]     120             std   <glb_camera_x_pos
6143 ECC811           (C:\Users\bhrou\gi):00035 [6]     126             ldd   y_pos,u
6146 B36F6E           (C:\Users\bhrou\gi):00036 [7]     133             subd  Camera_Y_pos_bias
6149 DDF1             (C:\Users\bhrou\gi):00037 [5]     138             std   <glb_camera_y_pos
                      (C:\Users\bhrou\gi):00038                 
                      (C:\Users\bhrou\gi):00039                         ; global speed setting, animation and movement scale
614B 8605             (C:\Users\bhrou\gi):00040 [2]     140             lda   #5
614D B7703F           (C:\Users\bhrou\gi):00041 [5]     145             sta   Vint_Main_runcount_cap
                      (C:\Users\bhrou\gi):00042                 
                      (C:\Users\bhrou\gi):00043                         _RunObjectRoutine ObjID_EHZ,#0
                      (_RunObjectRoutine):00001                         _MountObject ObjID_EHZ
6150 B69822           (     _MountObject):00001 [5]     150             lda   Obj_Index_Page+ObjID_EHZ
                      (     _MountObject):00002                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
6153 BD6F74           (    _SetCartPageA):00002 [8]     158             jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
6156 BE982B           (     _MountObject):00003 [6]     164             ldx   Obj_Index_Address+2*ObjID_EHZ
6159 8600             (_RunObjectRoutine):00002 [2]     166             lda   #0        
615B AD84             (_RunObjectRoutine):00003 [7]     173             jsr   ,x
                      (C:\Users\bhrou\gi):00044                 
                      (C:\Users\bhrou\gi):00045                         ; init tile buffer based on camera pos
615D BD8353           (C:\Users\bhrou\gi):00046 [8]     181             jsr   InitTileBuffer
                      (C:\Users\bhrou\gi):00047                 
                      (C:\Users\bhrou\gi):00048                         ; init Animated tiles
6160 8E62D0           (C:\Users\bhrou\gi):00049 [3]     184             ldx   #Animated_EHZ_script
6163 BD6261           (C:\Users\bhrou\gi):00050 [8]     192             jsr   TileAnimScriptInit
                      (C:\Users\bhrou\gi):00051                 
6166 8601             (C:\Users\bhrou\gi):00052 [2]     194             lda   #$01                     ; 1: play 60hz track at 50hz, 0: do not skip frames
6168 B781ED           (C:\Users\bhrou\gi):00053 [5]     199             sta   Smps.60HzData 
                      (C:\Users\bhrou\gi):00054                         _RunObjectRoutine ObjID_Smps,#0 ; YM2413_DrumModeOn
                      (_RunObjectRoutine):00001                         _MountObject ObjID_Smps
616B B69825           (     _MountObject):00001 [5]     204             lda   Obj_Index_Page+ObjID_Smps
                      (     _MountObject):00002                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
616E BD6F74           (    _SetCartPageA):00002 [8]     212             jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
6171 BE9831           (     _MountObject):00003 [6]     218             ldx   Obj_Index_Address+2*ObjID_Smps
6174 8600             (_RunObjectRoutine):00002 [2]     220             lda   #0        
6176 AD84             (_RunObjectRoutine):00003 [7]     227             jsr   ,x
6178 C602             (C:\Users\bhrou\gi):00055 [2]     229             ldb   #2                        ; music id
                      (C:\Users\bhrou\gi):00056                         _RunObjectRoutine ObjID_Smps,#2 ; PlayMusic 
                      (_RunObjectRoutine):00001                         _MountObject ObjID_Smps
617A B69825           (     _MountObject):00001 [5]     234             lda   Obj_Index_Page+ObjID_Smps
                      (     _MountObject):00002                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
617D BD6F74           (    _SetCartPageA):00002 [8]     242             jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
6180 BE9831           (     _MountObject):00003 [6]     248             ldx   Obj_Index_Address+2*ObjID_Smps
6183 8602             (_RunObjectRoutine):00002 [2]     250             lda   #2        
6185 AD84             (_RunObjectRoutine):00003 [7]     257             jsr   ,x
                      (C:\Users\bhrou\gi):00057                 
                      (C:\Users\bhrou\gi):00058                         ; start music
6187 BD81EE           (C:\Users\bhrou\gi):00059 [8]     265             jsr   IrqSet50Hz 
                      (C:\Users\bhrou\gi):00060                 
                      (C:\Users\bhrou\gi):00061                 * ==============================================================================
                      (C:\Users\bhrou\gi):00062                 * Main Loop
                      (C:\Users\bhrou\gi):00063                 * ==============================================================================
618A                  (C:\Users\bhrou\gi):00064                 LevelMainLoop
618A BD6FE2           (C:\Users\bhrou\gi):00065 [8]     273             jsr   WaitVBL    
618D BD6289           (C:\Users\bhrou\gi):00066 [8]     281             jsr   TileAnimScript
6190 BD800C           (C:\Users\bhrou\gi):00067 [8]     289             jsr   ReadJoypads  
                      (C:\Users\bhrou\gi):00068                         _RunObject ObjID_Sonic,#MainCharacter 
                      (       _RunObject):00001                         _MountObject ObjID_Sonic
6193 B69824           (     _MountObject):00001 [5]     294             lda   Obj_Index_Page+ObjID_Sonic
                      (     _MountObject):00002                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
6196 BD6F74           (    _SetCartPageA):00002 [8]     302             jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
6199 BE982F           (     _MountObject):00003 [6]     308             ldx   Obj_Index_Address+2*ObjID_Sonic
619C CE639B           (       _RunObject):00002 [3]     311             ldu   #MainCharacter        
619F AD84             (       _RunObject):00003 [7]     318             jsr   ,x
                      (C:\Users\bhrou\gi):00069                         _RunObject ObjID_Scroll,#MainCharacter   
                      (       _RunObject):00001                         _MountObject ObjID_Scroll
61A1 B69823           (     _MountObject):00001 [5]     323             lda   Obj_Index_Page+ObjID_Scroll
                      (     _MountObject):00002                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
61A4 BD6F74           (    _SetCartPageA):00002 [8]     331             jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
61A7 BE982D           (     _MountObject):00003 [6]     337             ldx   Obj_Index_Address+2*ObjID_Scroll
61AA CE639B           (       _RunObject):00002 [3]     340             ldu   #MainCharacter        
61AD AD84             (       _RunObject):00003 [7]     347             jsr   ,x
61AF BD8073           (C:\Users\bhrou\gi):00070 [8]     355             jsr   RunObjects
61B2 BD61D2           (C:\Users\bhrou\gi):00071 [8]     363             jsr   ForceRefresh
61B5 BD7386           (C:\Users\bhrou\gi):00072 [8]     371             jsr   CheckSpritesRefresh
61B8 BD7A90           (C:\Users\bhrou\gi):00073 [8]     379             jsr   EraseSprites
61BB BD7CF6           (C:\Users\bhrou\gi):00074 [8]     387             jsr   UnsetDisplayPriority
61BE BD61DA           (C:\Users\bhrou\gi):00075 [8]     395             jsr   EHZ_Back
61C1 BD8364           (C:\Users\bhrou\gi):00076 [8]     403             jsr   ComputeTileBuffer
61C4 BD8614           (C:\Users\bhrou\gi):00077 [8]     411             jsr   DrawBufferedTile
61C7 BD7DD5           (C:\Users\bhrou\gi):00078 [8]     419             jsr   DrawSprites
61CA BD871F           (C:\Users\bhrou\gi):00079 [8]     427             jsr   DrawHighPriorityBufferedTile    
61CD BD6206           (C:\Users\bhrou\gi):00080 [8]     435             jsr   EHZ_Mask
61D0 20B8             (C:\Users\bhrou\gi):00081 [3]     438             bra   LevelMainLoop
                      (C:\Users\bhrou\gi):00082                 
61D2                  (C:\Users\bhrou\gi):00083                 ForceRefresh
                      (C:\Users\bhrou\gi):00084                         ; Force sprite to be refreshed when background changes
                      (C:\Users\bhrou\gi):00085                         ; ----------------------------------------------------
61D2 8601             (C:\Users\bhrou\gi):00086 [2]     440             lda   #1
61D4 97E8             (C:\Users\bhrou\gi):00087 [4]     444             sta   <glb_force_sprite_refresh
61D6 B79FE7           (C:\Users\bhrou\gi):00088 [5]     449             sta   glb_camera_move
61D9 39               (C:\Users\bhrou\gi):00089 [5]     454             rts
                      (C:\Users\bhrou\gi):00090                 
61DA                  (C:\Users\bhrou\gi):00091                 EHZ_Back
61DA B69FE7           (C:\Users\bhrou\gi):00092 [5]     459             lda   glb_camera_move
61DD 2601             (C:\Users\bhrou\gi):00093 [3]     462             bne   @a
61DF 39               (C:\Users\bhrou\gi):00094 [5]     467             rts
61E0                  (C:\Users\bhrou\gi):00095                 @a
                      (C:\Users\bhrou\gi):00096                 
                      (C:\Users\bhrou\gi):00097                         ; this is not perfect as it will cause a tiny glitch (nearly unoticable)
                      (C:\Users\bhrou\gi):00098                         ; will not refresh background if last frame was made 
                      (C:\Users\bhrou\gi):00099                         ; will only non alpha tiles, not the new one ...
61E0 B69FE6           (C:\Users\bhrou\gi):00100 [5]     472             lda   glb_alphaTiles
61E3 2601             (C:\Users\bhrou\gi):00101 [3]     475             bne   @a
61E5 39               (C:\Users\bhrou\gi):00102 [5]     480             rts
61E6                  (C:\Users\bhrou\gi):00103                 @a
61E6 8600             (C:\Users\bhrou\gi):00104 [2]     482             lda   #0
61E8 B79FE6           (C:\Users\bhrou\gi):00105 [5]     487             sta   glb_alphaTiles
                      (C:\Users\bhrou\gi):00106                 
                      (C:\Users\bhrou\gi):00107                         _RunObjectRoutine ObjID_EHZ_Back,#0
                      (_RunObjectRoutine):00001                         _MountObject ObjID_EHZ_Back
61EB B69826           (     _MountObject):00001 [5]     492             lda   Obj_Index_Page+ObjID_EHZ_Back
                      (     _MountObject):00002                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
61EE BD6F74           (    _SetCartPageA):00002 [8]     500             jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
61F1 BE9833           (     _MountObject):00003 [6]     506             ldx   Obj_Index_Address+2*ObjID_EHZ_Back
61F4 8600             (_RunObjectRoutine):00002 [2]     508             lda   #0        
61F6 AD84             (_RunObjectRoutine):00003 [7]     515             jsr   ,x
                      (C:\Users\bhrou\gi):00108                         _SetCartPageA        
                      (    _SetCartPageA):00001                  IFDEF T2
61F8 BD6F74           (    _SetCartPageA):00002 [8]     523             jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
                      (C:\Users\bhrou\gi):00109                 
                      (C:\Users\bhrou\gi):00110                         ; get image location, this code works for a ND0 only image
                      (C:\Users\bhrou\gi):00111                         ; please adapt metadata decoding if you want another image
61FB A60D             (C:\Users\bhrou\gi):00112 [5]     528             lda   13,x
61FD AE0E             (C:\Users\bhrou\gi):00113 [6]     534             ldx   14,x
                      (C:\Users\bhrou\gi):00114                         _SetCartPageA        
                      (    _SetCartPageA):00001                  IFDEF T2
61FF BD6F74           (    _SetCartPageA):00002 [8]     542             jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
6202 DEFA             (C:\Users\bhrou\gi):00115 [5]     547             ldu   <glb_screen_location_2
6204 6E84             (C:\Users\bhrou\gi):00116 [3]     550             jmp   ,x
                      (C:\Users\bhrou\gi):00117                 
6206                  (C:\Users\bhrou\gi):00118                 EHZ_Mask
                      (C:\Users\bhrou\gi):00119                         _RunObjectRoutine ObjID_EHZ_Mask,#0
                      (_RunObjectRoutine):00001                         _MountObject ObjID_EHZ_Mask
6206 B69821           (     _MountObject):00001 [5]     555             lda   Obj_Index_Page+ObjID_EHZ_Mask
                      (     _MountObject):00002                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
6209 BD6F74           (    _SetCartPageA):00002 [8]     563             jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
620C BE9829           (     _MountObject):00003 [6]     569             ldx   Obj_Index_Address+2*ObjID_EHZ_Mask
620F 8600             (_RunObjectRoutine):00002 [2]     571             lda   #0        
6211 AD84             (_RunObjectRoutine):00003 [7]     578             jsr   ,x
                      (C:\Users\bhrou\gi):00120                         _SetCartPageA        
                      (    _SetCartPageA):00001                  IFDEF T2
6213 BD6F74           (    _SetCartPageA):00002 [8]     586             jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
                      (C:\Users\bhrou\gi):00121                 
                      (C:\Users\bhrou\gi):00122                         ; get image location, this code works for a ND0 only image
                      (C:\Users\bhrou\gi):00123                         ; please adapt metadata decoding if you want another image
6216 A60D             (C:\Users\bhrou\gi):00124 [5]     591             lda   13,x
6218 AE0E             (C:\Users\bhrou\gi):00125 [6]     597             ldx   14,x
                      (C:\Users\bhrou\gi):00126                         _SetCartPageA        
                      (    _SetCartPageA):00001                  IFDEF T2
621A BD6F74           (    _SetCartPageA):00002 [8]     605             jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
621D DEFA             (C:\Users\bhrou\gi):00127 [5]     610             ldu   <glb_screen_location_2
621F 6E84             (C:\Users\bhrou\gi):00128 [3]     613             jmp   ,x
                      (C:\Users\bhrou\gi):00129                 
                      (C:\Users\bhrou\gi):00130                         INCLUDE "./Engine/Graphics/Tilemap/TileAnimScript.asm"  
                      (./Engine/Graphics):00001                 ; ===========================================================================
                      (./Engine/Graphics):00002                 ; ZONE ANIMATION SCRIPTS - TODO mettre dans une lib
                      (./Engine/Graphics):00003                 ;
                      (./Engine/Graphics):00004                 
     0000             (./Engine/Graphics):00005                 ZACurIndex equ   0 ; current index in animation script
     0001             (./Engine/Graphics):00006                 ZACurFrame equ   1 ; current frame in animation
     0002             (./Engine/Graphics):00007                 ZADuration equ   2 ; remaining duration of current frame (20ms by step)
     0003             (./Engine/Graphics):00008                 ZAMaxFrame equ   3 ; max index in animation script
     0004             (./Engine/Graphics):00009                 ZASize     equ   4 ; size of this data structure
6221                  (./Engine/Graphics):00010                 TileAnimScriptData
6221 0000000000000000 (./Engine/Graphics):00011                         fill  0,16*ZASize
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
                      (./Engine/Graphics):00012                 
6261                  (./Engine/Graphics):00013                 TileAnimScriptInit
6261 BF628A           (./Engine/Graphics):00014 [6]     619             stx   TileAnimScriptList
6264 CE6221           (./Engine/Graphics):00015 [3]     622             ldu   #TileAnimScriptData
6267 10AE81           (./Engine/Graphics):00016 [9]     631     @loop   ldy   ,x++
626A 271C             (./Engine/Graphics):00017 [3]     634             beq   @rts
626C ECA4             (./Engine/Graphics):00018 [5]     639             ldd   ,y                       ; load global frame duration, number of frames in animation
626E 2A09             (./Engine/Graphics):00019 [3]     642             bpl   @globalduration
6270 E743             (./Engine/Graphics):00020 [5]     647             stb   ZAMaxFrame,u
6272 EC22             (./Engine/Graphics):00021 [6]     653             ldd   2,y
6274 5C               (./Engine/Graphics):00022 [2]     655             incb
6275 ED41             (./Engine/Graphics):00023 [6]     661             std   ZACurFrame,u             ; and ZADuration
6277 2007             (./Engine/Graphics):00024 [3]     664             bra   @common 
6279                  (./Engine/Graphics):00025                 @globalduration
6279 4C               (./Engine/Graphics):00026 [2]     666             inca
627A ED42             (./Engine/Graphics):00027 [6]     672             std   ZADuration,u             ; and ZAMaxFrame
627C A622             (./Engine/Graphics):00028 [5]     677             lda   2,y
627E A741             (./Engine/Graphics):00029 [5]     682             sta   ZACurFrame,u
6280 8600             (./Engine/Graphics):00030 [2]     684     @common lda   #0
6282 A7C4             (./Engine/Graphics):00031 [4]     688             sta   ZACurIndex,u
6284 3344             (./Engine/Graphics):00032 [5]     693             leau  ZASize,u
6286 20DF             (./Engine/Graphics):00033 [3]     696             bra   @loop
6288 39               (./Engine/Graphics):00034 [5]     701     @rts    rts
                      (./Engine/Graphics):00035                 
6289                  (./Engine/Graphics):00036                 TileAnimScript
6289 8E0000           (./Engine/Graphics):00037 [3]     704             ldx   #0                       ; (dynamic)
     628A             (./Engine/Graphics):00038                 TileAnimScriptList equ *-2
628C 2739             (./Engine/Graphics):00039 [3]     707             beq   @rts                     ; no animation script to process
628E CE6221           (./Engine/Graphics):00040 [3]     710             ldu   #TileAnimScriptData
6291 10AE81           (./Engine/Graphics):00041 [9]     719     @loop   ldy   ,x++                     ; process a script
6294 2731             (./Engine/Graphics):00042 [3]     722             beq   @rts                     ; at the end of script list ?
6296 A642             (./Engine/Graphics):00043 [5]     727             lda   ZADuration,u
6298 B0703E           (./Engine/Graphics):00044 [5]     732             suba  Vint_Main_runcount       ; tick down animation frame in sync with elapsed 50hz IRQ
629B 2506             (./Engine/Graphics):00045 [3]     735             bcs   @loadScript
629D A742             (./Engine/Graphics):00046 [5]     740             sta   ZADuration,u             ; animation is not over
629F 3344             (./Engine/Graphics):00047 [5]     745             leau  ZASize,u
62A1 20EE             (./Engine/Graphics):00048 [3]     748             bra   @loop
62A3                  (./Engine/Graphics):00049                 @loadScript
62A3 A6C4             (./Engine/Graphics):00050 [4]     752             lda   ZACurIndex,u             ; animation frame is over, load next one
62A5 4C               (./Engine/Graphics):00051 [2]     754             inca  
62A6 A143             (./Engine/Graphics):00052 [5]     759             cmpa  ZAMaxFrame,u             ; at the end of script ?
62A8 2602             (./Engine/Graphics):00053 [3]     762             bne   @a                       ; if not continue
62AA 8600             (./Engine/Graphics):00054 [2]     764             lda   #0                       ; otherwise reset animation
62AC A7C4             (./Engine/Graphics):00055 [4]     768     @a      sta   ZACurIndex,u             ; save new index
62AE E621             (./Engine/Graphics):00056 [5]     773             ldb   1,y
62B0 E743             (./Engine/Graphics):00057 [5]     778             stb   ZAMaxFrame,u
62B2 E6A4             (./Engine/Graphics):00058 [4]     782             ldb   ,y                       ; load global frame duration
62B4 2A07             (./Engine/Graphics):00059 [3]     785             bpl   @globalduration
62B6 48               (./Engine/Graphics):00060 [2]     787             asla                           ; 2 data bytes per index
62B7 8B02             (./Engine/Graphics):00061 [2]     789             adda  #2                       ; skip header
62B9 ECA6             (./Engine/Graphics):00062 [6]     795             ldd   a,y
62BB 2004             (./Engine/Graphics):00063 [3]     798             bra   @b 
62BD                  (./Engine/Graphics):00064                 @globalduration
62BD 8B02             (./Engine/Graphics):00065 [2]     800             adda  #2                       ; skip header
62BF A6A6             (./Engine/Graphics):00066 [5]     805             lda   a,y
62C1 ED41             (./Engine/Graphics):00067 [6]     811     @b      std   ZACurFrame,u             ; and ZADuration
62C3 3344             (./Engine/Graphics):00068 [5]     816             leau  ZASize,u
62C5 20CA             (./Engine/Graphics):00069 [3]     819             bra   @loop
62C7 39               (./Engine/Graphics):00070 [5]     824     @rts    rts
                      (./Engine/Graphics):00071                 
62C8                  (./Engine/Graphics):00072                 TileAnimRun
62C8 E686             (./Engine/Graphics):00073 [5]     829             ldb   a,x
62CA F7E7E6           (./Engine/Graphics):00074 [5]     834             stb   $E7E6
62CD 4C               (./Engine/Graphics):00075 [2]     836             inca
62CE 6E96             (./Engine/Graphics):00076 [7]     843             jmp   [a,x]
                      (C:\Users\bhrou\gi):00131                 
                      (C:\Users\bhrou\gi):00132                 ; ===========================================================================
                      (C:\Users\bhrou\gi):00133                 ; for each script :
                      (C:\Users\bhrou\gi):00134                 ;       - Global frame duration. If -1, then each frame will use its own duration, instead
                      (C:\Users\bhrou\gi):00135                 ;       - Number of frames
                      (C:\Users\bhrou\gi):00136                 ;       - Tile ID
                      (C:\Users\bhrou\gi):00137                 ;       - Frame duration. Only here if global duration is -1
                      (C:\Users\bhrou\gi):00138                 
62D0                  (C:\Users\bhrou\gi):00139                 Animated_EHZ_script
62D0 62DC             (C:\Users\bhrou\gi):00140                         fdb   Animated_EHZ_1
62D2 62EA             (C:\Users\bhrou\gi):00141                         fdb   Animated_EHZ_2
62D4 62FC             (C:\Users\bhrou\gi):00142                         fdb   Animated_EHZ_3
62D6 6300             (C:\Users\bhrou\gi):00143                         fdb   Animated_EHZ_4
62D8 6312             (C:\Users\bhrou\gi):00144                         fdb   Animated_EHZ_5
62DA 0000             (C:\Users\bhrou\gi):00145                         fdb   0
                      (C:\Users\bhrou\gi):00146                 
62DC                  (C:\Users\bhrou\gi):00147                 Animated_EHZ_1
                      (C:\Users\bhrou\gi):00148                         ; Flowers 1
62DC FF06             (C:\Users\bhrou\gi):00149                         fcb   -1,6
62DE 007F             (C:\Users\bhrou\gi):00150                         fcb   0,127
62E0 0313             (C:\Users\bhrou\gi):00151                         fcb   3,19
62E2 0007             (C:\Users\bhrou\gi):00152                         fcb   0,7
62E4 0307             (C:\Users\bhrou\gi):00153                         fcb   3,7
62E6 0007             (C:\Users\bhrou\gi):00154                         fcb   0,7
62E8 0307             (C:\Users\bhrou\gi):00155                         fcb   3,7
62EA                  (C:\Users\bhrou\gi):00156                 Animated_EHZ_2
                      (C:\Users\bhrou\gi):00157                         ; Flowers 2
62EA FF08             (C:\Users\bhrou\gi):00158                         fcb  -1,8
62EC 037F             (C:\Users\bhrou\gi):00159                         fcb   3,127
62EE 000B             (C:\Users\bhrou\gi):00160                         fcb   0,11
62F0 030B             (C:\Users\bhrou\gi):00161                         fcb   3,11
62F2 000B             (C:\Users\bhrou\gi):00162                         fcb   0,11
62F4 0305             (C:\Users\bhrou\gi):00163                         fcb   3,5
62F6 0005             (C:\Users\bhrou\gi):00164                         fcb   0,5
62F8 0305             (C:\Users\bhrou\gi):00165                         fcb   3,5
62FA 0005             (C:\Users\bhrou\gi):00166                         fcb   0,5
62FC                  (C:\Users\bhrou\gi):00167                 Animated_EHZ_3
                      (C:\Users\bhrou\gi):00168                         ; Flowers 3
62FC 0702             (C:\Users\bhrou\gi):00169                         fcb   7,2
62FE 00               (C:\Users\bhrou\gi):00170                         fcb   0
62FF 03               (C:\Users\bhrou\gi):00171                         fcb   3
6300                  (C:\Users\bhrou\gi):00172                 Animated_EHZ_4
                      (C:\Users\bhrou\gi):00173                         ; Flowers 4
6300 FF08             (C:\Users\bhrou\gi):00174                         fcb   -1,8
6302 007F             (C:\Users\bhrou\gi):00175                         fcb   0,127
6304 0307             (C:\Users\bhrou\gi):00176                         fcb   3,7
6306 0007             (C:\Users\bhrou\gi):00177                         fcb   0,7
6308 0307             (C:\Users\bhrou\gi):00178                         fcb   3,7
630A 0007             (C:\Users\bhrou\gi):00179                         fcb   0,7
630C 030B             (C:\Users\bhrou\gi):00180                         fcb   3,11
630E 000B             (C:\Users\bhrou\gi):00181                         fcb   0,11
6310 030B             (C:\Users\bhrou\gi):00182                         fcb   3,11
6312                  (C:\Users\bhrou\gi):00183                 Animated_EHZ_5
                      (C:\Users\bhrou\gi):00184                         ; Pulsing thing against checkered background
6312 FF06             (C:\Users\bhrou\gi):00185                         fcb   -1,6
6314 007F             (C:\Users\bhrou\gi):00186                         fcb   0,127
6316 0309             (C:\Users\bhrou\gi):00187                         fcb   3,9
6318 060B             (C:\Users\bhrou\gi):00188                         fcb   6,11
631A 0917             (C:\Users\bhrou\gi):00189                         fcb   9,23
631C 060B             (C:\Users\bhrou\gi):00190                         fcb   6,11
631E 0309             (C:\Users\bhrou\gi):00191                         fcb   3,9
                      (C:\Users\bhrou\gi):00192                 
6320                  (C:\Users\bhrou\gi):00193                 TlsAni_EHZ_flower1
6320 B66222           (C:\Users\bhrou\gi):00194 [5]     848             lda   TileAnimScriptData+0*ZASize+1
6323 8E6329           (C:\Users\bhrou\gi):00195 [3]     851             ldx   #TlsAni_EHZ_flower1_imgs
6326 7E62C8           (C:\Users\bhrou\gi):00196 [4]     855             jmp   TileAnimRun
6329                  (C:\Users\bhrou\gi):00197                 TlsAni_EHZ_flower1_imgs
6329                  (C:\Users\bhrou\gi):00198                 gentag_24
6329 000000000000     (C:\Users\bhrou\gi):00199                         fill  0,6
                      (C:\Users\bhrou\gi):00200                 
632F                  (C:\Users\bhrou\gi):00201                 TlsAni_EHZ_flower2
632F B66226           (C:\Users\bhrou\gi):00202 [5]     860             lda   TileAnimScriptData+1*ZASize+1
6332 8E6338           (C:\Users\bhrou\gi):00203 [3]     863             ldx   #TlsAni_EHZ_flower2_imgs
6335 7E62C8           (C:\Users\bhrou\gi):00204 [4]     867             jmp   TileAnimRun
6338                  (C:\Users\bhrou\gi):00205                 TlsAni_EHZ_flower2_imgs
6338                  (C:\Users\bhrou\gi):00206                 gentag_25
6338 000000000000     (C:\Users\bhrou\gi):00207                         fill  0,6
                      (C:\Users\bhrou\gi):00208                 
633E                  (C:\Users\bhrou\gi):00209                 TlsAni_EHZ_flower3
633E B6622A           (C:\Users\bhrou\gi):00210 [5]     872             lda   TileAnimScriptData+2*ZASize+1
6341 8E6347           (C:\Users\bhrou\gi):00211 [3]     875             ldx   #TlsAni_EHZ_flower3_imgs
6344 7E62C8           (C:\Users\bhrou\gi):00212 [4]     879             jmp   TileAnimRun
6347                  (C:\Users\bhrou\gi):00213                 TlsAni_EHZ_flower3_imgs
6347                  (C:\Users\bhrou\gi):00214                 gentag_26
6347 000000000000     (C:\Users\bhrou\gi):00215                         fill  0,6
                      (C:\Users\bhrou\gi):00216                 
634D                  (C:\Users\bhrou\gi):00217                 TlsAni_EHZ_flower4
634D B6622E           (C:\Users\bhrou\gi):00218 [5]     884             lda   TileAnimScriptData+3*ZASize+1
6350 8E6356           (C:\Users\bhrou\gi):00219 [3]     887             ldx   #TlsAni_EHZ_flower4_imgs
6353 7E62C8           (C:\Users\bhrou\gi):00220 [4]     891             jmp   TileAnimRun
6356                  (C:\Users\bhrou\gi):00221                 TlsAni_EHZ_flower4_imgs
6356                  (C:\Users\bhrou\gi):00222                 gentag_27
6356 000000000000     (C:\Users\bhrou\gi):00223                         fill  0,6
                      (C:\Users\bhrou\gi):00224                 
635C                  (C:\Users\bhrou\gi):00225                 TlsAni_EHZ_pulseball1
635C B66232           (C:\Users\bhrou\gi):00226 [5]     896             lda   TileAnimScriptData+4*ZASize+1
635F 8E6365           (C:\Users\bhrou\gi):00227 [3]     899             ldx   #TlsAni_EHZ_pulseball1_imgs
6362 7E62C8           (C:\Users\bhrou\gi):00228 [4]     903             jmp   TileAnimRun
6365                  (C:\Users\bhrou\gi):00229                 TlsAni_EHZ_pulseball1_imgs
6365                  (C:\Users\bhrou\gi):00230                 gentag_28
6365 0000000000000000 (C:\Users\bhrou\gi):00231                         fill  0,12
     00000000
                      (C:\Users\bhrou\gi):00232                 
6371                  (C:\Users\bhrou\gi):00233                 TlsAni_EHZ_pulseball2
6371 B66232           (C:\Users\bhrou\gi):00234 [5]     908             lda   TileAnimScriptData+4*ZASize+1
6374 8E637A           (C:\Users\bhrou\gi):00235 [3]     911             ldx   #TlsAni_EHZ_pulseball2_imgs
6377 7E62C8           (C:\Users\bhrou\gi):00236 [4]     915             jmp   TileAnimRun
637A                  (C:\Users\bhrou\gi):00237                 TlsAni_EHZ_pulseball2_imgs
637A                  (C:\Users\bhrou\gi):00238                 gentag_29
637A 0000000000000000 (C:\Users\bhrou\gi):00239                         fill  0,12
     00000000
                      (C:\Users\bhrou\gi):00240                 
6386                  (C:\Users\bhrou\gi):00241                 TlsAni_EHZ_pulseball3
6386 B66232           (C:\Users\bhrou\gi):00242 [5]     920             lda   TileAnimScriptData+4*ZASize+1
6389 8E638F           (C:\Users\bhrou\gi):00243 [3]     923             ldx   #TlsAni_EHZ_pulseball3_imgs
638C 7E62C8           (C:\Users\bhrou\gi):00244 [4]     927             jmp   TileAnimRun
638F                  (C:\Users\bhrou\gi):00245                 TlsAni_EHZ_pulseball3_imgs
638F                  (C:\Users\bhrou\gi):00246                 gentag_30
638F 0000000000000000 (C:\Users\bhrou\gi):00247                         fill  0,12
     00000000
                      (C:\Users\bhrou\gi):00248                 
                      (C:\Users\bhrou\gi):00249                 * ---------------------------------------------------------------------------
                      (C:\Users\bhrou\gi):00250                 * Game Mode RAM variables
                      (C:\Users\bhrou\gi):00251                 * ---------------------------------------------------------------------------
                      (C:\Users\bhrou\gi):00252                         
                      (C:\Users\bhrou\gi):00253                         INCLUDE "./game-mode/EHZ/ram-data.asm"       
                      (./game-mode/EHZ/r):00001                 * ===========================================================================
                      (./game-mode/EHZ/r):00002                 * Object Constants
                      (./game-mode/EHZ/r):00003                 * ===========================================================================
                      (./game-mode/EHZ/r):00004                 
     0001             (./game-mode/EHZ/r):00005                 nb_reserved_objects               equ 1
     001D             (./game-mode/EHZ/r):00006                 nb_dynamic_objects                equ 29
     0000             (./game-mode/EHZ/r):00007                 nb_level_objects                  equ 0
     001E             (./game-mode/EHZ/r):00008                 nb_graphical_objects              equ 30 * max 64 total
                      (./game-mode/EHZ/r):00009                 
                      (./game-mode/EHZ/r):00010                 * ===========================================================================
                      (./game-mode/EHZ/r):00011                 * Object Status Table - OST
                      (./game-mode/EHZ/r):00012                 * ===========================================================================
                      (./game-mode/EHZ/r):00013                  
639B                  (./game-mode/EHZ/r):00014                 Reserved_Object_RAM
639B 04               (./game-mode/EHZ/r):00015                 MainCharacter                 fcb   ObjID_Sonic
639C 0000000000000000 (./game-mode/EHZ/r):00016                                               fill  0,main_object_size-1
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     000000000000
                      (./game-mode/EHZ/r):00017                 ;Sidekick                      fill  0,main_object_size
641A                  (./game-mode/EHZ/r):00018                 Reserved_Object_RAM_End
641A                  (./game-mode/EHZ/r):00019                 Object_RAM
641A 0000000000000000 (./game-mode/EHZ/r):00020                 Dynamic_Object_RAM            fill  0,nb_dynamic_objects*object_size
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     00000000
6F6E                  (./game-mode/EHZ/r):00021                 Dynamic_Object_RAM_End
                      (./game-mode/EHZ/r):00022                 
6F6E                  (./game-mode/EHZ/r):00023                 LevelOnly_Object_RAM                              * faire comme pour Dynamic_Object_RAM
                      (./game-mode/EHZ/r):00024                 ;Obj_TailsTails                fill  0,object_size * Positionnement et nommage a mettre dans objet Tails
                      (./game-mode/EHZ/r):00025                 ;Obj_SonicDust                 fill  0,object_size * Positionnement et nommage a mettre dans objet Tails
                      (./game-mode/EHZ/r):00026                 ;Obj_TailsDust                 fill  0,object_size * Positionnement et nommage a mettre dans objet Tails
6F6E                  (./game-mode/EHZ/r):00027                 LevelOnly_Object_RAM_End
6F6E                  (./game-mode/EHZ/r):00028                 Object_RAM_End
                      (./game-mode/EHZ/r):00029                 
                      (./game-mode/EHZ/r):00030                 * ===========================================================================
                      (./game-mode/EHZ/r):00031                 * Common object structure
                      (./game-mode/EHZ/r):00032                 * ===========================================================================
                      (./game-mode/EHZ/r):00033                 
                      (./game-mode/EHZ/r):00034                 ; ext_variables_size is for dynamic objects
     0007             (./game-mode/EHZ/r):00035                 ext_variables_size            equ 7
                      (./game-mode/EHZ/r):00036                 
     000B             (./game-mode/EHZ/r):00037                 status                        equ   status_flags   ; note  exact meaning depends on the object... for sonic/tails  bit 0  leftfacing. bit 1  inair. bit 2  spinning. bit 3  onobject. bit 4  rolljumping. bit 5  pushing. bit 6  underwater.
     005D             (./game-mode/EHZ/r):00038                 width_pixels                  equ   ext_variables
     005E             (./game-mode/EHZ/r):00039                 y_radius                      equ   ext_variables+1 ; collision height / 2
     005F             (./game-mode/EHZ/r):00040                 x_radius                      equ   ext_variables+2 ; collision width / 2
     0060             (./game-mode/EHZ/r):00041                 angle                         equ   ext_variables+3 ; angle about the z axis (360 degrees  equ  256)
     0061             (./game-mode/EHZ/r):00042                 collision_flags               equ   ext_variables+4
     0062             (./game-mode/EHZ/r):00043                 collision_property            equ   ext_variables+5
     0063             (./game-mode/EHZ/r):00044                 respawn_index                 equ   ext_variables+6
                      (./game-mode/EHZ/r):00045                 
                      (./game-mode/EHZ/r):00046                 * ===========================================================================
                      (./game-mode/EHZ/r):00047                 * Main characters object structure
                      (./game-mode/EHZ/r):00048                 * ===========================================================================
                      (./game-mode/EHZ/r):00049                 
     0022             (./game-mode/EHZ/r):00050                 main_ext_variables_size       equ   34
     007F             (./game-mode/EHZ/r):00051                 main_object_size              equ   object_core_size+main_ext_variables_size ; the size of a main character object
     007F             (./game-mode/EHZ/r):00052                 next_main_object              equ   main_object_size
                      (./game-mode/EHZ/r):00053                 
     0064             (./game-mode/EHZ/r):00054                 inertia            equ   ext_variables+7  ; and +8 ; directionless representation of speed... not updated in the air
     0066             (./game-mode/EHZ/r):00055                 flip_angle         equ   ext_variables+9  ; angle about the x axis (360 degrees  equ  256) (twist/tumble)
     0067             (./game-mode/EHZ/r):00056                 air_left           equ   ext_variables+10
     0068             (./game-mode/EHZ/r):00057                 flip_turned        equ   ext_variables+11 ; 0 for normal, 1 to invert flipping (it's a 180 degree rotation about the axis of Sonic's spine, so he stays in the same position but looks turned around)
     0069             (./game-mode/EHZ/r):00058                 obj_control        equ   ext_variables+12 ; 0 for normal, 1 for hanging or for resting on a flipper, $81 for going through CNZ/OOZ/MTZ tubes or stopped in CNZ cages or stoppers or flying if Tails
     006A             (./game-mode/EHZ/r):00059                 status_secondary   equ   ext_variables+13
     006B             (./game-mode/EHZ/r):00060                 flips_remaining    equ   ext_variables+14 ; number of flip revolutions remaining
     006C             (./game-mode/EHZ/r):00061                 flip_speed         equ   ext_variables+15 ; number of flip revolutions per frame / 256
     006D             (./game-mode/EHZ/r):00062                 move_lock          equ   ext_variables+16 ; and +17 ; horizontal control lock, counts down to 0
     006F             (./game-mode/EHZ/r):00063                 invulnerable_time  equ   ext_variables+18 ; and +19 ; time remaining until you stop blinking
     0071             (./game-mode/EHZ/r):00064                 invincibility_time equ   ext_variables+20 ; and +21 ; remaining
     0073             (./game-mode/EHZ/r):00065                 speedshoes_time    equ   ext_variables+22 ; and +23 ; remaining
     0075             (./game-mode/EHZ/r):00066                 next_tilt          equ   ext_variables+24 ; angle on ground in front of sprite
     0076             (./game-mode/EHZ/r):00067                 tilt               equ   ext_variables+25 ; angle on ground
     0077             (./game-mode/EHZ/r):00068                 stick_to_convex    equ   ext_variables+26 ; 0 for normal, 1 to make Sonic stick to convex surfaces like the rotating discs in Sonic 1 and 3 (unused in Sonic 2 but fully functional)
     0078             (./game-mode/EHZ/r):00069                 spindash_flag      equ   ext_variables+27 ; 0 for normal, 1 for charging a spindash or forced rolling
     0078             (./game-mode/EHZ/r):00070                 pinball_mode       equ   spindash_flag
     0079             (./game-mode/EHZ/r):00071                 spindash_counter   equ   ext_variables+28 ; and +29
     0079             (./game-mode/EHZ/r):00072                 restart_countdown  equ   spindash_counter ; and 1+spindash_counter
     007B             (./game-mode/EHZ/r):00073                 jumping            equ   ext_variables+30
     007C             (./game-mode/EHZ/r):00074                 interact           equ   ext_variables+31 ; RAM address of the last object Sonic stood on, minus $FFFFB000 and divided by $40
     007D             (./game-mode/EHZ/r):00075                 top_solid_bit      equ   ext_variables+32 ; the bit to check for top solidity (either $C or $E)
     007E             (./game-mode/EHZ/r):00076                 lrb_solid_bit      equ   ext_variables+33 ; the bit to check for left/right/bottom solidity (either $D or $F)
                      (./game-mode/EHZ/r):00077                 
                      (./game-mode/EHZ/r):00078                 ; ---------------------------------------------------------------------------
                      (./game-mode/EHZ/r):00079                 ; Bits 3-6 of an object's status after a SolidObject call is a
                      (./game-mode/EHZ/r):00080                 ; bitfield with the following meaning 
     0003             (./game-mode/EHZ/r):00081                 p1_standing_bit    equ   3
     0003             (./game-mode/EHZ/r):00082                 p2_standing_bit    equ   p1_standing_bit + 1
                      (./game-mode/EHZ/r):00083                 
     0008             (./game-mode/EHZ/r):00084                 p1_standing        equ   %00001000
     0010             (./game-mode/EHZ/r):00085                 p2_standing        equ   %00010000
                      (./game-mode/EHZ/r):00086                 
     0002             (./game-mode/EHZ/r):00087                 pushing_bit_delta  equ   2
     0005             (./game-mode/EHZ/r):00088                 p1_pushing_bit     equ   p1_standing_bit+pushing_bit_delta
     0006             (./game-mode/EHZ/r):00089                 p2_pushing_bit     equ   p1_pushing_bit+1
                      (./game-mode/EHZ/r):00090                 
     0020             (./game-mode/EHZ/r):00091                 p1_pushing         equ   %00100000
     0040             (./game-mode/EHZ/r):00092                 p2_pushing         equ   %01000000
                      (./game-mode/EHZ/r):00093                 
                      (./game-mode/EHZ/r):00094                 
     0018             (./game-mode/EHZ/r):00095                 standing_mask      equ   p1_standing|p2_standing
     0060             (./game-mode/EHZ/r):00096                 pushing_mask       equ   p1_pushing|p2_pushing
                      (./game-mode/EHZ/r):00097                 
                      (./game-mode/EHZ/r):00098                 ; ---------------------------------------------------------------------------
                      (./game-mode/EHZ/r):00099                 ; The high word of d6 after a SolidObject call is a bitfield
                      (./game-mode/EHZ/r):00100                 ; with the following meaning 
     0000             (./game-mode/EHZ/r):00101                 p1_touch_side_bit    equ   0
     0001             (./game-mode/EHZ/r):00102                 p2_touch_side_bit    equ   p1_touch_side_bit+1
                      (./game-mode/EHZ/r):00103                 
     0001             (./game-mode/EHZ/r):00104                 p1_touch_side        equ   %00000001
     0002             (./game-mode/EHZ/r):00105                 p2_touch_side        equ   %00000010
                      (./game-mode/EHZ/r):00106                 
     0003             (./game-mode/EHZ/r):00107                 touch_side_mask      equ   p1_touch_side|p2_touch_side
                      (./game-mode/EHZ/r):00108                 
     0002             (./game-mode/EHZ/r):00109                 p1_touch_bottom_bit  equ   p1_touch_side_bit+pushing_bit_delta
     0003             (./game-mode/EHZ/r):00110                 p2_touch_bottom_bit  equ   p1_touch_bottom_bit+1
                      (./game-mode/EHZ/r):00111                 
     0004             (./game-mode/EHZ/r):00112                 p1_touch_bottom      equ   %00000100
     0008             (./game-mode/EHZ/r):00113                 p2_touch_bottom      equ   %00001000
                      (./game-mode/EHZ/r):00114                 
     000C             (./game-mode/EHZ/r):00115                 touch_bottom_mask    equ   p1_touch_bottom|p2_touch_bottom
                      (./game-mode/EHZ/r):00116                 
     0004             (./game-mode/EHZ/r):00117                 p1_touch_top_bit     equ   p1_touch_bottom_bit+pushing_bit_delta
     0005             (./game-mode/EHZ/r):00118                 p2_touch_top_bit     equ   p1_touch_top_bit+1
                      (./game-mode/EHZ/r):00119                 
     0010             (./game-mode/EHZ/r):00120                 p1_touch_top         equ   %00010000
     0020             (./game-mode/EHZ/r):00121                 p2_touch_top         equ   %00100000
                      (./game-mode/EHZ/r):00122                 
     0030             (./game-mode/EHZ/r):00123                 touch_top_mask       equ   p1_touch_top|p2_touch_top
                      (./game-mode/EHZ/r):00124                 
                      (./game-mode/EHZ/r):00125                 ; ---------------------------------------------------------------------------
                      (./game-mode/EHZ/r):00126                 ; status_secondary bitfield variables
                      (./game-mode/EHZ/r):00127                 ;
                      (./game-mode/EHZ/r):00128                 ; status_secondary variable bit numbers
     0000             (./game-mode/EHZ/r):00129                 status_sec_hasShield            equ   0
     0001             (./game-mode/EHZ/r):00130                 status_sec_isInvincible         equ   1
     0002             (./game-mode/EHZ/r):00131                 status_sec_hasSpeedShoes        equ   2
     0007             (./game-mode/EHZ/r):00132                 status_sec_isSliding            equ   7
                      (./game-mode/EHZ/r):00133                 
     0001             (./game-mode/EHZ/r):00134                 status_sec_hasShield_mask       equ   $01
     0002             (./game-mode/EHZ/r):00135                 status_sec_isInvincible_mask    equ   $02
     0004             (./game-mode/EHZ/r):00136                 status_sec_hasSpeedShoes_mask   equ   $04
     0080             (./game-mode/EHZ/r):00137                 status_sec_isSliding_mask       equ   $80
                      (./game-mode/EHZ/r):00138                 
                      (./game-mode/EHZ/r):00139                 * --- status bitfield variables for objects ---
     0001             (./game-mode/EHZ/r):00140                 status_x_orientation          equ   $01 ; (bit 0) X Orientation. Clear is left and set is right
     0002             (./game-mode/EHZ/r):00141                 status_y_orientation          equ   $02 ; (bit 1) Y Orientation. Clear is right-side up, and set is upside-down
     0004             (./game-mode/EHZ/r):00142                 status_bit2                   equ   $04 ; (bit 2) Unused
     0008             (./game-mode/EHZ/r):00143                 status_mainchar_standing      equ   $08 ; (bit 3) Set if Main character is standing on this object
     0010             (./game-mode/EHZ/r):00144                 status_sidekick_standing      equ   $10 ; (bit 4) Set if Sidekick is standing on this object
     0020             (./game-mode/EHZ/r):00145                 status_mainchar_pushing       equ   $20 ; (bit 5) Set if Main character is pushing on this object
     0040             (./game-mode/EHZ/r):00146                 status_sidekick_pushing       equ   $40 ; (bit 6) Set if Sidekick is pushing on this object
     0080             (./game-mode/EHZ/r):00147                 status_bit7                   equ   $80 ; (bit 7) Unused
                      (./game-mode/EHZ/r):00148                 
                      (./game-mode/EHZ/r):00149                 * --- status bitfield variables for Main characters ---
     0002             (./game-mode/EHZ/r):00150                 status_inair                  equ   $02 ; (bit 1) Set if in the air (jump counts)
     0004             (./game-mode/EHZ/r):00151                 status_jumporroll             equ   $04 ; (bit 2) Set if jumping or rolling
     0008             (./game-mode/EHZ/r):00152                 status_norgroundnorfall       equ   $08 ; (bit 3) Set if isn't on the ground but shouldn't fall. (Usually when he is on a object that should stop him falling, like a platform or a bridge.)
     0010             (./game-mode/EHZ/r):00153                 status_jumpingafterrolling    equ   $10 ; (bit 4) Set if jumping after rolling
     0020             (./game-mode/EHZ/r):00154                 status_pushing                equ   $20 ; (bit 5) Set if pushing something
     0040             (./game-mode/EHZ/r):00155                 status_underwater             equ   $40 ; (bit 6) Set if underwater
                      (./game-mode/EHZ/r):00156                 
                      (./game-mode/EHZ/r):00157                 * ===========================================================================
                      (./game-mode/EHZ/r):00158                 * Physics Constants
                      (./game-mode/EHZ/r):00159                 * ===========================================================================
                      (./game-mode/EHZ/r):00160                 
     0038             (./game-mode/EHZ/r):00161                 gravity                       equ   $38 ; 56 sub-pixels par frame
     0070             (./game-mode/EHZ/r):00162                 camera_Y_pos_bias_default     equ   screen_top+(200/2)-16 ; position of default camera center on screen
                      (./game-mode/EHZ/r):00163                 
                      (./game-mode/EHZ/r):00164                 * ===========================================================================
                      (./game-mode/EHZ/r):00165                 * Game specific globals
                      (./game-mode/EHZ/r):00166                 * ===========================================================================
                      (./game-mode/EHZ/r):00167                 
6F6E 0000             (./game-mode/EHZ/r):00168                 Camera_Y_pos_bias             fdb   0
6F70 00               (./game-mode/EHZ/r):00169                 Camera_Max_Y_Pos_Changing     fcb   0
6F71 0000             (./game-mode/EHZ/r):00170                 Horiz_scroll_delay_val        fdb   0
                      (C:\Users\bhrou\gi):00254                         
                      (C:\Users\bhrou\gi):00255                 * ==============================================================================
                      (C:\Users\bhrou\gi):00256                 * Routines
                      (C:\Users\bhrou\gi):00257                 * ==============================================================================
                      (C:\Users\bhrou\gi):00258                         INCLUDE "./Engine/Ram/BankSwitch.asm"
6F73 00               (./Engine/Ram/Bank):00001                 glb_Page                      fcb   $00
                      (./Engine/Ram/Bank):00002                 
6F74                  (./Engine/Ram/Bank):00003                 SetCartPageA
6F74 B76F73           (./Engine/Ram/Bank):00004 [5]     932             sta   glb_Page
6F77 2A25             (./Engine/Ram/Bank):00005 [3]     935             bpl   @RAMPg
6F79 B6E7E6           (./Engine/Ram/Bank):00006 [5]     940             lda   $E7E6
6F7C 84DF             (./Engine/Ram/Bank):00007 [2]     942             anda  #$DF                     ; passe le bit5 a 0 pour cartouche au lieu de 1 pour RAM
6F7E B7E7E6           (./Engine/Ram/Bank):00008 [5]     947             sta   $E7E6
6F81 86F0             (./Engine/Ram/Bank):00009 [2]     949             lda   #$F0                     ; sortie du mode commande T.2
6F83 B70555           (./Engine/Ram/Bank):00010 [5]     954             sta   $0555                    ; dans le cas ou l'irq intervient en cours de changement de page
6F86 86AA             (./Engine/Ram/Bank):00011 [2]     956             lda   #$AA                     ; sequence pour commutation de page T.2
6F88 B70555           (./Engine/Ram/Bank):00012 [5]     961             sta   $0555
6F8B 44               (./Engine/Ram/Bank):00013 [2]     963             lsra                           ; lda   #$55
6F8C B702AA           (./Engine/Ram/Bank):00014 [5]     968             sta   $02AA
6F8F 86C0             (./Engine/Ram/Bank):00015 [2]     970             lda   #$C0
6F91 B70555           (./Engine/Ram/Bank):00016 [5]     975             sta   $0555
6F94 B66F73           (./Engine/Ram/Bank):00017 [5]     980             lda   glb_Page
6F97 847F             (./Engine/Ram/Bank):00018 [2]     982             anda  #$7F                     ; le bit 7 doit etre a 0        
6F99 B70555           (./Engine/Ram/Bank):00019 [5]     987             sta   $0555                    ; selection de la page T.2 en zone cartouche
6F9C 2003             (./Engine/Ram/Bank):00020 [3]     990             bra   @rts
6F9E B7E7E6           (./Engine/Ram/Bank):00021 [5]     995     @RAMPg  sta   $E7E6                    ; selection de la page RAM en zone cartouche (bit 5 integre au numero de page)
6FA1 39               (./Engine/Ram/Bank):00022 [5]     1000    @rts    rts
                      (./Engine/Ram/Bank):00023                 
6FA2                  (./Engine/Ram/Bank):00024                 SetCartPageB
6FA2 F76F73           (./Engine/Ram/Bank):00025 [5]     1005            stb   glb_Page
6FA5 2A25             (./Engine/Ram/Bank):00026 [3]     1008            bpl   @RAMPg
6FA7 F6E7E6           (./Engine/Ram/Bank):00027 [5]     1013            ldb   $E7E6
6FAA C4DF             (./Engine/Ram/Bank):00028 [2]     1015            andb  #$DF                     ; passe le bit5 a 0 pour cartouche au lieu de 1 pour RAM
6FAC F7E7E6           (./Engine/Ram/Bank):00029 [5]     1020            stb   $E7E6
6FAF C6F0             (./Engine/Ram/Bank):00030 [2]     1022            ldb   #$F0                     ; sortie du mode commande T.2
6FB1 F70555           (./Engine/Ram/Bank):00031 [5]     1027            stb   $0555                    ; dans le cas ou l'irq intervient en cours de changement de page
6FB4 C6AA             (./Engine/Ram/Bank):00032 [2]     1029            ldb   #$AA                     ; sequence pour commutation de page T.2
6FB6 F70555           (./Engine/Ram/Bank):00033 [5]     1034            stb   $0555
6FB9 54               (./Engine/Ram/Bank):00034 [2]     1036            lsrb                           ; lda   #$55
6FBA F702AA           (./Engine/Ram/Bank):00035 [5]     1041            stb   $02AA
6FBD C6C0             (./Engine/Ram/Bank):00036 [2]     1043            ldb   #$C0
6FBF F70555           (./Engine/Ram/Bank):00037 [5]     1048            stb   $0555
6FC2 F66F73           (./Engine/Ram/Bank):00038 [5]     1053            ldb   glb_Page
6FC5 C47F             (./Engine/Ram/Bank):00039 [2]     1055            andb  #$7F                     ; le bit 7 doit etre a 0        
6FC7 F70555           (./Engine/Ram/Bank):00040 [5]     1060            stb   $0555                    ; selection de la page T.2 en zone cartouche
6FCA 2003             (./Engine/Ram/Bank):00041 [3]     1063            bra   @rts
6FCC F7E7E6           (./Engine/Ram/Bank):00042 [5]     1068    @RAMPg  stb   $E7E6                    ; selection de la page RAM en zone cartouche (bit 5 integre au numero de page)
6FCF 39               (./Engine/Ram/Bank):00043 [5]     1073    @rts    rts
                      (./Engine/Ram/Bank):00044                 
6FD0                  (./Engine/Ram/Bank):00045                 GetCartPageA
6FD0 B66F73           (./Engine/Ram/Bank):00046 [5]     1078            lda   glb_Page                 ; glb_page at 0 means that glb_page variable is not in use
6FD3 2603             (./Engine/Ram/Bank):00047 [3]     1081            bne   @rts                     ; usefull when we dont work with T2 (ex: optimized tilemap that use only RAM)
6FD5 B6E7E6           (./Engine/Ram/Bank):00048 [5]     1086            lda   $E7E6
6FD8 39               (./Engine/Ram/Bank):00049 [5]     1091    @rts    rts
                      (./Engine/Ram/Bank):00050                 
6FD9                  (./Engine/Ram/Bank):00051                 GetCartPageB
6FD9 F66F73           (./Engine/Ram/Bank):00052 [5]     1096            ldb   glb_Page                 ; glb_page at 0 means that glb_page variable is not in use
6FDC 2603             (./Engine/Ram/Bank):00053 [3]     1099            bne   @rts                     ; usefull when we dont work with T2 (ex: optimized tilemap that use only RAM)
6FDE F6E7E6           (./Engine/Ram/Bank):00054 [5]     1104            ldb   $E7E6
6FE1 39               (./Engine/Ram/Bank):00055 [5]     1109    @rts   rts
                      (./Engine/Ram/Bank):00056                 
                      (C:\Users\bhrou\gi):00259                         INCLUDE "./Engine/Graphics/WaitVBL.asm"
                      (./Engine/Graphics):00001                 ********************************************************************************
                      (./Engine/Graphics):00002                 * Attente VBL
                      (./Engine/Graphics):00003                 * Alternance de la page 2 et 3 entre affichage et espace cartouche
                      (./Engine/Graphics):00004                 * Alternance de la RAMA et RAM B dans l'espace ecran
                      (./Engine/Graphics):00005                 * ------------------------------------------------------------------------------
                      (./Engine/Graphics):00006                 *
                      (./Engine/Graphics):00007                 * Page Affichee par l'automate Video
                      (./Engine/Graphics):00008                 * ----------------------------------
                      (./Engine/Graphics):00009                 *   $E7DD determine la page affichee a l'ecran
                      (./Engine/Graphics):00010                 *   bit7=0 bit6=0 bit5=0 bit4=0 (#$0_) : page 0
                      (./Engine/Graphics):00011                 *   bit7=0 bit6=1 bit5=0 bit4=0 (#$4_) : page 1
                      (./Engine/Graphics):00012                 *   bit7=1 bit6=0 bit5=0 bit4=0 (#$8_) : page 2
                      (./Engine/Graphics):00013                 *   bit7=1 bit6=1 bit5=0 bit4=0 (#$C_) : page 3
                      (./Engine/Graphics):00014                 *   bit3 bit2 bit1 bit0  (#$_0 a #$_F) : couleur du cadre
                      (./Engine/Graphics):00015                 *   Remarque : bit5 et bit4 utilisable uniquement en mode MO
                      (./Engine/Graphics):00016                 *
                      (./Engine/Graphics):00017                 * Page en espace cartouche
                      (./Engine/Graphics):00018                 * ------------------------
                      (./Engine/Graphics):00019                 *   $E7E6 determine la page visible dans l'espace cartouche (0000 a 3FFF)
                      (./Engine/Graphics):00020                 *   bit7 toujours a 0
                      (./Engine/Graphics):00021                 *   bit6=1 : ecriture autorisee
                      (./Engine/Graphics):00022                 *   bit5=1 : espace cartouche recouvert par de la RAM
                      (./Engine/Graphics):00023                 *   bit4=0 : CAS1N valide : banques 0-15 / 1 = CAS2N valide : banques 16-31
                      (./Engine/Graphics):00024                 *   bit5=1 bit4=0 bit3=0 bit2=0 bit1=0 bit0=0 (#$60) : page 0
                      (./Engine/Graphics):00025                 *   ...
                      (./Engine/Graphics):00026                 *   bit5=1 bit4=0 bit3=1 bit2=1 bit1=1 bit0=1 (#$6F) : page 15
                      (./Engine/Graphics):00027                 *   bit5=1 bit4=1 bit3=0 bit2=0 bit1=0 bit0=0 (#$70) : page 16
                      (./Engine/Graphics):00028                 *   ...
                      (./Engine/Graphics):00029                 *   bit5=1 bit4=1 bit3=1 bit2=1 bit1=1 bit0=1 (#$7F) : page 31
                      (./Engine/Graphics):00030                 *
                      (./Engine/Graphics):00031                 * Demi-Page 0 en espace ecran (4000 a 5FFF)
                      (./Engine/Graphics):00032                 * -----------------------------------------
                      (./Engine/Graphics):00033                 *   $E7C3 determine la demi-page de la page 0 visible dans l'espace ecran
                      (./Engine/Graphics):00034                 *   bit0=0 : 8Ko RAMA
                      (./Engine/Graphics):00035                 *   bit0=1 : 8ko RAMB
                      (./Engine/Graphics):00036                 *
                      (./Engine/Graphics):00037                 * Page en espace donnees
                      (./Engine/Graphics):00038                 * ----------------------
                      (./Engine/Graphics):00039                 * lda   #$04
                      (./Engine/Graphics):00040                 * sta   $E7E5                    * selection de la page 04 en RAM Donnees (A000-DFFF)
                      (./Engine/Graphics):00041                 *
                      (./Engine/Graphics):00042                 ********************************************************************************
6FE2                  (./Engine/Graphics):00043                 WaitVBL
6FE2 FC7039           (./Engine/Graphics):00044 [6]     1115            ldd   Vint_runcount
6FE5 B3703B           (./Engine/Graphics):00045 [7]     1122            subd  Vint_Last_runcount
6FE8 C102             (./Engine/Graphics):00046 [2]     1124            cmpb  #2
6FEA 240A             (./Engine/Graphics):00047 [3]     1127            bhs   SwapVideoPage
6FEC                  (./Engine/Graphics):00048                 @a
6FEC 7DE7E7           (./Engine/Graphics):00049 [7]     1134            tst   $E7E7              * le faisceau n'est pas dans l'ecran
6FEF 2AFB             (./Engine/Graphics):00050 [3]     1137            bpl   @a                 * tant que le bit est a 0 on boucle
6FF1                  (./Engine/Graphics):00051                 @b
6FF1 7DE7E7           (./Engine/Graphics):00052 [7]     1144            tst   $E7E7              * le faisceau est dans l'ecran
6FF4 2BFB             (./Engine/Graphics):00053 [3]     1147            bmi   @b                 * tant que le bit est a 1 on boucle
                      (./Engine/Graphics):00054                                         
6FF6                  (./Engine/Graphics):00055                 SwapVideoPage
6FF6 F67004           (./Engine/Graphics):00056 [5]     1152            ldb   am_SwapVideoPage+1 * charge la valeur du ldb suivant am_SwapVideoPage
6FF9 C440             (./Engine/Graphics):00057 [2]     1154            andb  #$40               * alterne bit6=0 et bit6=1 (suivant la valeur B $00 ou $FF)
6FFB                  (./Engine/Graphics):00058                 glb_screen_border_color        
6FFB CA80             (./Engine/Graphics):00059 [2]     1156            orb   #$80               * bit7=1, bit3 a bit0=couleur de cadre (ici 0)
6FFD F7E7DD           (./Engine/Graphics):00060 [5]     1161            stb   $E7DD              * changement page (2 ou 3) affichee a l'ecran
7000 737004           (./Engine/Graphics):00061 [7]     1168            com   am_SwapVideoPage+1 * alterne $00 et $FF sur le ldb suivant am_SwapVideoPage
7003                  (./Engine/Graphics):00062                 am_SwapVideoPage
7003 C600             (./Engine/Graphics):00063 [2]     1170            ldb   #$00
7005 C401             (./Engine/Graphics):00064 [2]     1172            andb  #$01               * alterne bit0=0 et bit0=1 (suivant la valeur B $00 ou $FF)
7007 F77040           (./Engine/Graphics):00065 [5]     1177            stb   glb_Cur_Wrk_Screen_Id
700A CA02             (./Engine/Graphics):00066 [2]     1179            orb   #$02               * bit1=1
700C F7E7E5           (./Engine/Graphics):00067 [5]     1184            stb   $E7E5              * changement page (2 ou 3) visible dans l'espace donnees
700F F6E7C3           (./Engine/Graphics):00068 [5]     1189            ldb   $E7C3              * charge l'identifiant de la demi-page 0 configuree en espace ecran
7012 C801             (./Engine/Graphics):00069 [2]     1191            eorb  #$01               * alterne bit0 = 0 ou 1 changement demi-page de la page 0 visible dans l'espace ecran
7014 F7E7C3           (./Engine/Graphics):00070 [5]     1196            stb   $E7C3
                      (./Engine/Graphics):00071                         
7017 7C7038           (./Engine/Graphics):00072 [7]     1203            inc   glb_Main_runcount+1
701A 2603             (./Engine/Graphics):00073 [3]     1206            bne   @a
701C 7C7037           (./Engine/Graphics):00074 [7]     1213            inc   glb_Main_runcount  
701F                  (./Engine/Graphics):00075                 @a
                      (./Engine/Graphics):00076                 
701F FC7039           (./Engine/Graphics):00077 [6]     1219            ldd   Vint_runcount            ; store in Vint_Main_runcount the number of elapsed 50Hz frames
7022 B3703B           (./Engine/Graphics):00078 [7]     1226            subd  Vint_Last_runcount       ; used in AnimateSpriteSync
7025 F1703F           (./Engine/Graphics):00079 [5]     1231            cmpb  Vint_Main_runcount_cap   ; allow to cap Animation and Mvt Sync
7028 2303             (./Engine/Graphics):00080 [3]     1234            bls   @a
702A F6703F           (./Engine/Graphics):00081 [5]     1239            ldb   Vint_Main_runcount_cap
702D F7703E           (./Engine/Graphics):00082 [5]     1244    @a      stb   Vint_Main_runcount
                      (./Engine/Graphics):00083                 
7030 FC7039           (./Engine/Graphics):00084 [6]     1250            ldd   Vint_runcount
7033 FD703B           (./Engine/Graphics):00085 [6]     1256            std   Vint_Last_runcount
7036 39               (./Engine/Graphics):00086 [5]     1261            rts
                      (./Engine/Graphics):00087                         
7037 0000             (./Engine/Graphics):00088                 glb_Main_runcount      fdb   0 ; page swap counter
7039 0000             (./Engine/Graphics):00089                 Vint_runcount          fdb   0 ; incremented in 50Hz IRQ
703B 0000             (./Engine/Graphics):00090                 Vint_Last_runcount     fdb   0
703D 00               (./Engine/Graphics):00091                 Vint_Main_runcount_w   fcb   0 ; pad to be able to load Vint_Main_runcount as a word
703E 00               (./Engine/Graphics):00092                 Vint_Main_runcount     fcb   0
703F 00               (./Engine/Graphics):00093                 Vint_Main_runcount_cap fcb   0
7040 00               (./Engine/Graphics):00094                 glb_Cur_Wrk_Screen_Id  fcb   0 ; screen buffer set to write operations (0 or 1)
                      (C:\Users\bhrou\gi):00260                         INCLUDE "./Engine/Graphics/AnimateSpriteSync.asm"       
                      (./Engine/Graphics):00001                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00002                 * Subroutine to animate a sprite using an animation script
                      (./Engine/Graphics):00003                 * Use VBL to keep a constant animation rate
                      (./Engine/Graphics):00004                 *
                      (./Engine/Graphics):00005                 * input REG : [u] pointeur sur l'objet
                      (./Engine/Graphics):00006                 *
                      (./Engine/Graphics):00007                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00008                 
                      (./Engine/Graphics):00009                                                             *; ---------------------------------------------------------------------------
                      (./Engine/Graphics):00010                                                             *; Subroutine to animate a sprite using an animation script
                      (./Engine/Graphics):00011                                                             *; ---------------------------------------------------------------------------
                      (./Engine/Graphics):00012                                                             *
                      (./Engine/Graphics):00013                                                             *; ||||||||||||||| S U B R O U T I N E |||||||||||||||||||||||||||||||||||||||
                      (./Engine/Graphics):00014                                                             *
                      (./Engine/Graphics):00015                                                             *; sub_16544:
7041                  (./Engine/Graphics):00016                 AnimateSpriteSync                           *AnimateSprite:
                      (./Engine/Graphics):00017                                                             *    moveq   #0,d0
                      (./Engine/Graphics):00018                         _GetCartPageA
                      (    _GetCartPageA):00001                  IFDEF T2
7041 BD6FD0           (    _GetCartPageA):00002 [8]     1269            jsr   GetCartPageA
                      (    _GetCartPageA):00003                  ELSE
                      (    _GetCartPageA):00004                         lda   $E7E6
                      (    _GetCartPageA):00005                  ENDC
7044 B770A3           (./Engine/Graphics):00019 [5]     1274            sta   Anim_Rts+1                    ; backup cart page     
7047 8E9848           (./Engine/Graphics):00020 [3]     1277            ldx   #Ani_Page_Index
704A E6C4             (./Engine/Graphics):00021 [4]     1281            ldb   id,u
704C 3A               (./Engine/Graphics):00022 [3]     1284            abx
704D A684             (./Engine/Graphics):00023 [4]     1288            lda   ,x
                      (./Engine/Graphics):00024                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
704F BD6F74           (    _SetCartPageA):00002 [8]     1296            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
                      (./Engine/Graphics):00025                 ;
7052 AE44             (./Engine/Graphics):00026 [6]     1302            ldx   anim,u                        *    move.b  anim(a0),d0      ; move animation number to d0
7054 2A0C             (./Engine/Graphics):00027 [3]     1305            bpl   @a                       ; branch if anim is an address of anim
7056 8E984F           (./Engine/Graphics):00028 [3]     1308            ldx   #Ani_Asd_Index           ; negative means anim,u is a signed 8 bit offset for a LUT
                      (./Engine/Graphics):00029                         ; ldb   id,u                   ; already loaded
7059 58               (./Engine/Graphics):00030 [2]     1310            aslb
705A 3A               (./Engine/Graphics):00031 [3]     1313            abx
705B AE94             (./Engine/Graphics):00032 [8]     1321            ldx   [,x]                     ; load Anim LUT (first entry in Asd LUT)
705D E645             (./Engine/Graphics):00033 [5]     1326            ldb   anim+1,u                 ; load offset
705F 3A               (./Engine/Graphics):00034 [3]     1329            abx                            ; apply offset
7060 AE84             (./Engine/Graphics):00035 [5]     1334            ldx   ,x                       ; load target anim address
7062 AC46             (./Engine/Graphics):00036 [7]     1341    @a      cmpx  prev_anim,u                   *    cmp.b   prev_anim(a0),d0 ; is animation set to change?
7064 270E             (./Engine/Graphics):00037 [3]     1344            beq   Anim_Run                      *    beq.s   Anim_Run         ; if not, branch
7066 AF46             (./Engine/Graphics):00038 [6]     1350            stx   prev_anim,u                   *    move.b  d0,prev_anim(a0) ; set prev anim to current animation
                      (./Engine/Graphics):00039                         
7068 A64A             (./Engine/Graphics):00040 [5]     1355            lda   anim_flags,u
706A 8401             (./Engine/Graphics):00041 [2]     1357            anda  #anim_link_mask               ; if animation link, when changing animation
706C 2613             (./Engine/Graphics):00042 [3]     1360            bne   Anim_Reload                   ; will skip frame and duration reinit
                      (./Engine/Graphics):00043                         
706E C600             (./Engine/Graphics):00044 [2]     1362            ldb   #0                            
7070 E748             (./Engine/Graphics):00045 [5]     1367            stb   anim_frame,u                  *    move.b  #0,anim_frame(a0)          ; reset animation
7072 2009             (./Engine/Graphics):00046 [3]     1370            bra   @b                            *    move.b  #0,anim_frame_duration(a0) ; reset frame duration
                      (./Engine/Graphics):00047                                                             *; loc_16560:
7074                  (./Engine/Graphics):00048                 Anim_Run                                    *Anim_Run:
7074 E649             (./Engine/Graphics):00049 [5]     1375            ldb   anim_frame_duration,u
7076 F0703E           (./Engine/Graphics):00050 [5]     1380            subb  Vint_Main_runcount
7079 E749             (./Engine/Graphics):00051 [5]     1385            stb   anim_frame_duration,u
                      (./Engine/Graphics):00052                                                             *    subq.b  #1,anim_frame_duration(a0)   ; subtract 1 from frame duration
707B 2A25             (./Engine/Graphics):00053 [3]     1388            bpl   Anim_Rts                      *    bpl.s   Anim_Wait                    ; if time remains, branch
                      (./Engine/Graphics):00054                         * no offset table                   *    add.w   d0,d0
                      (./Engine/Graphics):00055                         * anim is the address of anim       *    adda.w  (a1,d0.w),a1                 ; calculate address of appropriate animation script
707D E61F             (./Engine/Graphics):00056 [5]     1393    @b      ldb   -1,x                            
707F E749             (./Engine/Graphics):00057 [5]     1398            stb   anim_frame_duration,u         *    move.b  (a1),anim_frame_duration(a0) ; load frame duration
7081                  (./Engine/Graphics):00058                 Anim_Reload                                 *    moveq   #0,d1
7081 E648             (./Engine/Graphics):00059 [5]     1403            ldb   anim_frame,u                  *    move.b  anim_frame(a0),d1 ; load current frame number
7083 8600             (./Engine/Graphics):00060 [2]     1405            lda   #0
                      (./Engine/Graphics):00061                         _asld
7085 58               (            _asld):00001 [2]     1407            aslb
7086 49               (            _asld):00002 [2]     1409            rola
7087 318B             (./Engine/Graphics):00062 [8]     1417            leay  d,x
7089 ECA4             (./Engine/Graphics):00063 [5]     1422            ldd   ,y                            *    move.b  1(a1,d1.w),d0 ; read sprite number from script
                      (./Engine/Graphics):00064                         * bmi   Anim_End_FF                 *    bmi.s   Anim_End_FF   ; if animation is complete, branch MJ: Delete this line
708B 81FA             (./Engine/Graphics):00065 [2]     1424            cmpa  #$FA                          *    cmp.b   #$FA,d0       ; MJ: is it a flag from FA to FF?
708D 2419             (./Engine/Graphics):00066 [3]     1427            bhs   Anim_End_FF                   *    bhs     Anim_End_FF   ; MJ: if so, branch to flag routines
                      (./Engine/Graphics):00067                                                             *; loc_1657C:
708F                  (./Engine/Graphics):00068                 Anim_Next                                   *Anim_Next:
                      (./Engine/Graphics):00069                                                             *    andi.b  #$7F,d0               ; clear sign bit
708F ED4C             (./Engine/Graphics):00070 [6]     1433            std   image_set,u                   *    move.b  d0,mapping_frame(a0)  ; load sprite number
7091 A64B             (./Engine/Graphics):00071 [5]     1438            lda   status_flags,u
7093 8403             (./Engine/Graphics):00072 [2]     1440            anda  #status_xflip_mask|status_yflip_mask
7095 B7709D           (./Engine/Graphics):00073 [5]     1445            sta   @dyn+1
7098 A642             (./Engine/Graphics):00074 [5]     1450            lda   render_flags,u
709A 84FE             (./Engine/Graphics):00075 [2]     1452            anda  #^render_xmirror_mask
709C 8A00             (./Engine/Graphics):00076 [2]     1454    @dyn    ora   #0
709E A742             (./Engine/Graphics):00077 [5]     1459            sta   render_flags,u
                      (./Engine/Graphics):00078                                                             *    move.b  status(a0),d1         ; match the orientaion dictated by the object
                      (./Engine/Graphics):00079                                                             *    andi.b  #3,d1                 ; with the orientation used by the object engine
                      (./Engine/Graphics):00080                                                             *    andi.b  #$FC,render_flags(a0)
                      (./Engine/Graphics):00081                                                             *    or.b    d1,render_flags(a0)
70A0 6C48             (./Engine/Graphics):00082 [7]     1466            inc   anim_frame,u                  *    addq.b  #1,anim_frame(a0)     ; next frame number
                      (./Engine/Graphics):00083                                                             *; return_1659A:
70A2                  (./Engine/Graphics):00084                 Anim_Rts                                    *Anim_Wait:
70A2 8600             (./Engine/Graphics):00085 [2]     1468            lda   #$00                          ; (dynamic)
                      (./Engine/Graphics):00086                         _SetCartPageA                       ; restore data page
                      (    _SetCartPageA):00001                  IFDEF T2
70A4 BD6F74           (    _SetCartPageA):00002 [8]     1476            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
70A7 39               (./Engine/Graphics):00087 [5]     1481            rts                                 *    rts 
                      (./Engine/Graphics):00088                                                             *; ===========================================================================
                      (./Engine/Graphics):00089                                                             *; loc_1659C:
70A8                  (./Engine/Graphics):00090                 Anim_End_FF                                 *Anim_End_FF:
70A8 4C               (./Engine/Graphics):00091 [2]     1483            inca                                *    addq.b  #1,d0       ; is the end flag = $FF ?
70A9 2608             (./Engine/Graphics):00092 [3]     1486            bne   Anim_End_FE                   *    bne.s   Anim_End_FE ; if not, branch
70AB C600             (./Engine/Graphics):00093 [2]     1488            ldb   #0                            
70AD E748             (./Engine/Graphics):00094 [5]     1493            stb   anim_frame,u                  *    move.b  #0,anim_frame(a0) ; restart the animation
70AF EC84             (./Engine/Graphics):00095 [5]     1498            ldd   ,x                            *    move.b  1(a1),d0          ; read sprite number
70B1 20DC             (./Engine/Graphics):00096 [3]     1501            bra   Anim_Next                     *    bra.s   Anim_Next
                      (./Engine/Graphics):00097                                                             *; ===========================================================================
                      (./Engine/Graphics):00098                                                             *; loc_165AC:
70B3                  (./Engine/Graphics):00099                 Anim_End_FE                                 *Anim_End_FE:
70B3 4C               (./Engine/Graphics):00100 [2]     1503            inca                                *    addq.b  #1,d0             ; is the end flag = $FE ?
70B4 2610             (./Engine/Graphics):00101 [3]     1506            bne   Anim_End_FD                   *    bne.s   Anim_End_FD       ; if not, branch
70B6 A648             (./Engine/Graphics):00102 [5]     1511            lda   anim_frame,u                  
70B8 F770BC           (./Engine/Graphics):00103 [5]     1516            stb   Anim_End_FE_dyn+1             *    move.b  2(a1,d1.w),d0     ; read the next byte in the script
70BB                  (./Engine/Graphics):00104                 Anim_End_FE_dyn
70BB 8000             (./Engine/Graphics):00105 [2]     1518            suba  #$00                          ; (dynamic)                          
70BD A748             (./Engine/Graphics):00106 [5]     1523            sta   anim_frame,u                  *    sub.b   d0,anim_frame(a0) ; jump back d0 bytes in the script
                      (./Engine/Graphics):00107                                                             *    sub.b   d0,d1
70BF C602             (./Engine/Graphics):00108 [2]     1525            ldb   #2
70C1 3D               (./Engine/Graphics):00109 [11]    1536            mul                                             
70C2 EC8B             (./Engine/Graphics):00110 [9]     1545            ldd   d,x                           *    move.b  1(a1,d1.w),d0     ; read sprite number
70C4 20C9             (./Engine/Graphics):00111 [3]     1548            bra   Anim_Next                     *    bra.s   Anim_Next
                      (./Engine/Graphics):00112                                                             *; ===========================================================================
                      (./Engine/Graphics):00113                                                             *; loc_165C0:
70C6                  (./Engine/Graphics):00114                 Anim_End_FD                                 *Anim_End_FD:
70C6 4C               (./Engine/Graphics):00115 [2]     1550            inca                                *    addq.b  #1,d0               ; is the end flag = $FD ?
70C7 2606             (./Engine/Graphics):00116 [3]     1553            bne   Anim_End_FC                   *    bne.s   Anim_End_FC         ; if not, branch
70C9 EC21             (./Engine/Graphics):00117 [6]     1559            ldd   1,y                           ; read word after FD
70CB ED44             (./Engine/Graphics):00118 [6]     1565            std   anim,u                        *    move.b  2(a1,d1.w),anim(a0) ; read next byte, run that animation
70CD 20D3             (./Engine/Graphics):00119 [3]     1568            bra   Anim_Rts                      *    rts
                      (./Engine/Graphics):00120                                                             *; ===========================================================================
                      (./Engine/Graphics):00121                                                             *; loc_165CC:
70CF                  (./Engine/Graphics):00122                 Anim_End_FC                                 *Anim_End_FC:
70CF 4C               (./Engine/Graphics):00123 [2]     1570            inca                                *    addq.b  #1,d0          ; is the end flag = $FC ?
70D0 260B             (./Engine/Graphics):00124 [3]     1573            bne   Anim_End_FB                   *    bne.s   Anim_End_FB    ; if not, branch
70D2 6CC81E           (./Engine/Graphics):00125 [7]     1580            inc   routine,u                     *    addq.b  #2,routine(a0) ; jump to next routine
70D5 8600             (./Engine/Graphics):00126 [2]     1582            lda   #0                            
70D7 A749             (./Engine/Graphics):00127 [5]     1587            sta   anim_frame_duration,u         *    move.b  #0,anim_frame_duration(a0)
70D9 6C48             (./Engine/Graphics):00128 [7]     1594            inc   anim_frame,u                  *    addq.b  #1,anim_frame(a0)
70DB 20C5             (./Engine/Graphics):00129 [3]     1597            bra   Anim_Rts                      *    rts
                      (./Engine/Graphics):00130                                                             *; ===========================================================================
                      (./Engine/Graphics):00131                                                             *; loc_165E0:
70DD                  (./Engine/Graphics):00132                 Anim_End_FB                                 *Anim_End_FB:
70DD 4C               (./Engine/Graphics):00133 [2]     1599            inca                                *    addq.b  #1,d0                 ; is the end flag = $FB ?
70DE 2609             (./Engine/Graphics):00134 [3]     1602            bne   Anim_End_FA                   *    bne.s   Anim_End_FA           ; if not, branch
70E0 8600             (./Engine/Graphics):00135 [2]     1604            lda   #0                            
70E2 A748             (./Engine/Graphics):00136 [5]     1609            sta   anim_frame,u                  *    move.b  #0,anim_frame(a0)     ; reset animation
70E4 A7C81F           (./Engine/Graphics):00137 [5]     1614            sta   routine_secondary,u           *    clr.b   routine_secondary(a0) ; reset 2nd routine counter
70E7 20B9             (./Engine/Graphics):00138 [3]     1617            bra   Anim_Rts                      *    rts
                      (./Engine/Graphics):00139                                                             *; ===========================================================================
                      (./Engine/Graphics):00140                                                             *; loc_165F0:
70E9                  (./Engine/Graphics):00141                 Anim_End_FA                                 *Anim_End_FA:
70E9 4C               (./Engine/Graphics):00142 [2]     1619            inca                                *    addq.b  #1,d0                    ; is the end flag = $FA ?
70EA 2603             (./Engine/Graphics):00143 [3]     1622            bne   Anim_End                      *    bne.s   Anim_End_F9              ; if not, branch
70EC 6CC81F           (./Engine/Graphics):00144 [7]     1629            inc   routine_secondary,u           *    addq.b  #2,routine_secondary(a0) ; jump to next routine    
70EF                  (./Engine/Graphics):00145                 Anim_End               
70EF 20B1             (./Engine/Graphics):00146 [3]     1632            bra   Anim_Rts                      *    rts
                      (./Engine/Graphics):00147                                                             *; ===========================================================================
                      (./Engine/Graphics):00148                                                             *; loc_165FA:
                      (./Engine/Graphics):00149                                                             *Anim_End_F9:
                      (./Engine/Graphics):00150                                                             *    addq.b  #1,d0            ; is the end flag = $F9 ?
                      (./Engine/Graphics):00151                                                             *    bne.s   Anim_End         ; if not, branch
                      (./Engine/Graphics):00152                                                             *    addq.b  #2,objoff_2A(a0) ; Actually obj89_arrow_routine
                      (./Engine/Graphics):00153                                                             *; return_16602:
                      (./Engine/Graphics):00154                                                             *Anim_End:
                      (./Engine/Graphics):00155                                                             *    rts
                      (./Engine/Graphics):00156                                                             *; End of function AnimateSprite
                      (C:\Users\bhrou\gi):00261                         INCLUDE "./objects/main-characters/sonic/sonic-animate.asm"
                      (./objects/main-ch):00001                 
                      (./objects/main-ch):00002                 
                      (./objects/main-ch):00003                                                                       *; ---------------------------------------------------------------------------
                      (./objects/main-ch):00004                                                                       *; Subroutine to animate Sonic's sprites
                      (./objects/main-ch):00005                                                                       *; See also: AnimateSprite
                      (./objects/main-ch):00006                                                                       *; ---------------------------------------------------------------------------
                      (./objects/main-ch):00007                                                                       *
                      (./objects/main-ch):00008                                                                       *; ||||||||||||||| S U B R O U T I N E |||||||||||||||||||||||||||||||||||||||
                      (./objects/main-ch):00009                                                                       *
                      (./objects/main-ch):00010                                                                       *; loc_1B350:
70F1                  (./objects/main-ch):00011                 Sonic_Animate_Do                                      *Sonic_Animate:
                      (./objects/main-ch):00012                                                                       *  lea (SonicAniData).l,a1
                      (./objects/main-ch):00013                                                                       *  tst.b   (Super_Sonic_flag).w
                      (./objects/main-ch):00014                                                                       *  beq.s   +
                      (./objects/main-ch):00015                                                                       *  lea (SuperSonicAniData).l,a1
                      (./objects/main-ch):00016                                                                       *+
                      (./objects/main-ch):00017                                                                       *  moveq   #0,d0
                      (./objects/main-ch):00018                         _GetCartPageA
                      (    _GetCartPageA):00001                  IFDEF T2
70F1 BD6FD0           (    _GetCartPageA):00002 [8]     1640            jsr   GetCartPageA
                      (    _GetCartPageA):00003                  ELSE
                      (    _GetCartPageA):00004                         lda   $E7E6
                      (    _GetCartPageA):00005                  ENDC
70F4 B7714C           (./objects/main-ch):00019 [5]     1645            sta   @page                    ; backup cart page     
70F7 8E9848           (./objects/main-ch):00020 [3]     1648            ldx   #Ani_Page_Index
70FA E6C4             (./objects/main-ch):00021 [4]     1652            ldb   id,u
70FC 3A               (./objects/main-ch):00022 [3]     1655            abx
70FD A684             (./objects/main-ch):00023 [4]     1659            lda   ,x
                      (./objects/main-ch):00024                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
70FF BD6F74           (    _SetCartPageA):00002 [8]     1667            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
                      (./objects/main-ch):00025                 ;
7102 AE44             (./objects/main-ch):00026 [6]     1673            ldx   anim,u                                  *  move.b  anim(a0),d0
7104 AC46             (./objects/main-ch):00027 [7]     1680    !       cmpx  prev_anim,u                             *  cmp.b   prev_anim(a0),d0    ; has animation changed?
7106 270E             (./objects/main-ch):00028 [3]     1683            beq   SAnim_Do                                *  beq.s   SAnim_Do        ; if not, branch
7108 AF46             (./objects/main-ch):00029 [6]     1689            stx   prev_anim,u                             *  move.b  d0,prev_anim(a0)    ; set previous animation
710A C600             (./objects/main-ch):00030 [2]     1691            ldb   #0                            
710C E748             (./objects/main-ch):00031 [5]     1696            stb   anim_frame,u                            *  move.b  #0,anim_frame(a0)   ; reset animation frame
710E E749             (./objects/main-ch):00032 [5]     1701            stb   anim_frame_duration,u                   *  move.b  #0,anim_frame_duration(a0)  ; reset frame duration
7110 E64B             (./objects/main-ch):00033 [5]     1706            ldb   status,u
7112 C4DF             (./objects/main-ch):00034 [2]     1708            andb  #^status_pushing 
7114 E74B             (./objects/main-ch):00035 [5]     1713            stb   status,u                                *  bclr    #5,status(a0)
                      (./objects/main-ch):00036                                                                       *; loc_1B384:
7116                  (./objects/main-ch):00037                 SAnim_Do                                              *SAnim_Do:
                      (./objects/main-ch):00038                         ; no offset table                             *  add.w   d0,d0
                      (./objects/main-ch):00039                         ; anim is the address of anim                 *  adda.w  (a1,d0.w),a1    ; calculate address of appropriate animation script
7116 E61F             (./objects/main-ch):00040 [5]     1718            ldb   -1,x                            
7118 F77136           (./objects/main-ch):00041 [5]     1723            stb   @a                                      *  move.b  (a1),d0
711B 2B4A             (./objects/main-ch):00042 [3]     1726            bmi   Go_SAnim_WalkRun                        *  bmi.s   SAnim_WalkRun   ; if animation is walk/run/roll/jump, branch
711D E64B             (./objects/main-ch):00043 [5]     1731            ldb   status,u                                *  move.b  status(a0),d1
711F C401             (./objects/main-ch):00044 [2]     1733            andb  #status_x_orientation                   *  andi.b  #1,d1
7121 F77129           (./objects/main-ch):00045 [5]     1738            stb   @b
7124 E642             (./objects/main-ch):00046 [5]     1743            ldb   render_flags,u
7126 C4FC             (./objects/main-ch):00047 [2]     1745            andb  #^(render_xmirror_mask|render_ymirror_mask) *  andi.b  #$FC,render_flags(a0)
7128 CA00             (./objects/main-ch):00048 [2]     1747            orb   #0                                      *  or.b    d1,render_flags(a0)
     7129             (./objects/main-ch):00049                 @b      equ   *-1
712A E742             (./objects/main-ch):00050 [5]     1752            stb   render_flags,u
712C E649             (./objects/main-ch):00051 [5]     1757            ldb   anim_frame_duration,u
712E F0703E           (./objects/main-ch):00052 [5]     1762            subb  Vint_Main_runcount
7131 E749             (./objects/main-ch):00053 [5]     1767            stb   anim_frame_duration,u                   *  subq.b  #1,anim_frame_duration(a0)  ; subtract 1 from frame duration
7133 2A16             (./objects/main-ch):00054 [3]     1770            bpl   SAnim_Delay                             *  bpl.s   SAnim_Delay         ; if time remains, branch
7135 C600             (./objects/main-ch):00055 [2]     1772            ldb   #0
     7136             (./objects/main-ch):00056                 @a      equ   *-1
7137 E749             (./objects/main-ch):00057 [5]     1777            stb   anim_frame_duration,u                   *  move.b  d0,anim_frame_duration(a0)  ; load frame duration
                      (./objects/main-ch):00058                                                                       *; loc_1B3AA:
7139                  (./objects/main-ch):00059                 SAnim_Do2                                             *SAnim_Do2:
                      (./objects/main-ch):00060                                                                       *  moveq   #0,d1
7139 E648             (./objects/main-ch):00061 [5]     1782            ldb   anim_frame,u                            *  move.b  anim_frame(a0),d1   ; load current frame number
713B 8600             (./objects/main-ch):00062 [2]     1784            lda   #0
                      (./objects/main-ch):00063                         _asld
713D 58               (            _asld):00001 [2]     1786            aslb
713E 49               (            _asld):00002 [2]     1788            rola
713F 318B             (./objects/main-ch):00064 [8]     1796            leay  d,x
7141 ECA4             (./objects/main-ch):00065 [5]     1801            ldd   ,y                                      *  move.b  1(a1,d1.w),d0       ; read sprite number from script
7143 81F0             (./objects/main-ch):00066 [2]     1803            cmpa  #$F0                                    *  cmpi.b  #$F0,d0
7145 2427             (./objects/main-ch):00067 [3]     1806            bhs   SAnim_End_FF                            *  bhs.s   SAnim_End_FF        ; if animation is complete, branch
                      (./objects/main-ch):00068                                                                       *; loc_1B3BA:
7147                  (./objects/main-ch):00069                 SAnim_Next                                            *SAnim_Next:
7147 ED4C             (./objects/main-ch):00070 [6]     1812            std   image_set,u                             *  move.b  d0,mapping_frame(a0)    ; load sprite number
7149 6C48             (./objects/main-ch):00071 [7]     1819            inc   anim_frame,u                            *  addq.b  #1,anim_frame(a0)   ; go to next frame
                      (./objects/main-ch):00072                                                                       *; return_1B3C2:
714B                  (./objects/main-ch):00073                 SAnim_Delay                                           *SAnim_Delay:
714B CC0000           (./objects/main-ch):00074 [3]     1822            ldd   #$00 ; page in a and 0 in b
     714C             (./objects/main-ch):00075                 @page   equ   *-2
                      (./objects/main-ch):00076                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
714E BD6F74           (    _SetCartPageA):00002 [8]     1830            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
7151 39               (./objects/main-ch):00077 [5]     1835            rts                                           *  rts
                      (./objects/main-ch):00078                         ;
7152                  (./objects/main-ch):00079                 Call_SAnim_Do2
                      (./objects/main-ch):00080                         _GetCartPageA
                      (    _GetCartPageA):00001                  IFDEF T2
7152 BD6FD0           (    _GetCartPageA):00002 [8]     1843            jsr   GetCartPageA
                      (    _GetCartPageA):00003                  ELSE
                      (    _GetCartPageA):00004                         lda   $E7E6
                      (    _GetCartPageA):00005                  ENDC
7155 B7714C           (./objects/main-ch):00081 [5]     1848            sta   @page                    ; backup cart page     
7158 8E9848           (./objects/main-ch):00082 [3]     1851            ldx   #Ani_Page_Index
715B E6C4             (./objects/main-ch):00083 [4]     1855            ldb   id,u
715D 3A               (./objects/main-ch):00084 [3]     1858            abx
715E A684             (./objects/main-ch):00085 [4]     1862            lda   ,x
                      (./objects/main-ch):00086                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
7160 BD6F74           (    _SetCartPageA):00002 [8]     1870            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
7163 AE44             (./objects/main-ch):00087 [6]     1876            ldx   anim,u
7165 20D2             (./objects/main-ch):00088 [3]     1879            bra   SAnim_Do2
                      (./objects/main-ch):00089                         ;
7167                  (./objects/main-ch):00090                 Go_SAnim_WalkRun
7167 B6714C           (./objects/main-ch):00091 [5]     1884            lda   @page
                      (./objects/main-ch):00092                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
716A BD6F74           (    _SetCartPageA):00002 [8]     1892            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
716D 39               (./objects/main-ch):00093 [5]     1897            rts
                      (./objects/main-ch):00094                                                                       *; ===========================================================================
                      (./objects/main-ch):00095                                                                       *; loc_1B3C4:
716E                  (./objects/main-ch):00096                 SAnim_End_FF                                          *SAnim_End_FF:
716E 4C               (./objects/main-ch):00097 [2]     1899            inca                                          *  addq.b  #1,d0       ; is the end flag = $FF ?
716F 2608             (./objects/main-ch):00098 [3]     1902            bne   SAnim_End_FE                            *  bne.s   SAnim_End_FE    ; if not, branch
7171 C600             (./objects/main-ch):00099 [2]     1904            ldb   #0      
7173 E748             (./objects/main-ch):00100 [5]     1909            stb   anim_frame,u                            *  move.b  #0,anim_frame(a0)   ; restart the animation
7175 EC84             (./objects/main-ch):00101 [5]     1914            ldd   ,x                                      *  move.b  1(a1),d0    ; read sprite number
7177 20CE             (./objects/main-ch):00102 [3]     1917            bra   SAnim_Next                              *  bra.s   SAnim_Next
                      (./objects/main-ch):00103                                                                       *; ===========================================================================
                      (./objects/main-ch):00104                                                                       *; loc_1B3D4:
7179                  (./objects/main-ch):00105                 SAnim_End_FE                                          *SAnim_End_FE:
7179 4C               (./objects/main-ch):00106 [2]     1919            inca                                          *  addq.b  #1,d0       ; is the end flag = $FE ?
717A 2610             (./objects/main-ch):00107 [3]     1922            bne   SAnim_End_FD                            *  bne.s   SAnim_End_FD    ; if not, branch
717C A648             (./objects/main-ch):00108 [5]     1927            lda   anim_frame,u                  
717E F77182           (./objects/main-ch):00109 [5]     1932            stb   @c                                      *  move.b  2(a1,d1.w),d0   ; read the next byte in the script
7181 8000             (./objects/main-ch):00110 [2]     1934            suba  #0
     7182             (./objects/main-ch):00111                 @c      equ   *-1        
7183 A748             (./objects/main-ch):00112 [5]     1939            sta   anim_frame,u                            *  sub.b   d0,anim_frame(a0)   ; jump back d0 bytes in the script
                      (./objects/main-ch):00113                                                                       *  sub.b   d0,d1
7185 C602             (./objects/main-ch):00114 [2]     1941            ldb   #2
7187 3D               (./objects/main-ch):00115 [11]    1952            mul                                             
7188 EC8B             (./objects/main-ch):00116 [9]     1961            ldd   d,x                                     *  move.b  1(a1,d1.w),d0   ; read sprite number
718A 20BB             (./objects/main-ch):00117 [3]     1964            bra   SAnim_Next                              *  bra.s   SAnim_Next
                      (./objects/main-ch):00118                                                                       *; ===========================================================================
                      (./objects/main-ch):00119                                                                       *; loc_1B3E8:
718C                  (./objects/main-ch):00120                 SAnim_End_FD                                          *SAnim_End_FD:
718C 4C               (./objects/main-ch):00121 [2]     1966            inca                                          *  addq.b  #1,d0           ; is the end flag = $FD ?
718D 2604             (./objects/main-ch):00122 [3]     1969            bne   SAnim_End                               *  bne.s   SAnim_End       ; if not, branch
718F EC21             (./objects/main-ch):00123 [6]     1975            ldd   1,y
7191 ED44             (./objects/main-ch):00124 [6]     1981            std   anim,u                                  *  move.b  2(a1,d1.w),anim(a0) ; read next byte, run that animation
                      (./objects/main-ch):00125                                                                       *; return_1B3F2:
7193                  (./objects/main-ch):00126                 SAnim_End                                             *SAnim_End:
7193 FC714C           (./objects/main-ch):00127 [6]     1987            ldd   @page ; and set b to 0
                      (./objects/main-ch):00128                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
7196 BD6F74           (    _SetCartPageA):00002 [8]     1995            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
7199 39               (./objects/main-ch):00129 [5]     2000            rts                                           *  rts
                      (./objects/main-ch):00130                                                                       *
719A                  (./objects/main-ch):00131                 SAnim_WalkRun_Sub
                      (./objects/main-ch):00132                         _GetCartPageA
                      (    _GetCartPageA):00001                  IFDEF T2
719A BD6FD0           (    _GetCartPageA):00002 [8]     2008            jsr   GetCartPageA
                      (    _GetCartPageA):00003                  ELSE
                      (    _GetCartPageA):00004                         lda   $E7E6
                      (    _GetCartPageA):00005                  ENDC
719D B7714C           (./objects/main-ch):00133 [5]     2013            sta   @page                    ; backup cart page     
71A0 8E9848           (./objects/main-ch):00134 [3]     2016            ldx   #Ani_Page_Index
71A3 E6C4             (./objects/main-ch):00135 [4]     2020            ldb   id,u
71A5 3A               (./objects/main-ch):00136 [3]     2023            abx
71A6 A684             (./objects/main-ch):00137 [4]     2027            lda   ,x
                      (./objects/main-ch):00138                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
71A8 BD6F74           (    _SetCartPageA):00002 [8]     2035            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
71AB AE44             (./objects/main-ch):00139 [6]     2041            ldx   anim,u                                  *  moveq   #0,d1
71AD E648             (./objects/main-ch):00140 [5]     2046            ldb   anim_frame,u                            *  move.b  anim_frame(a0),d1   ; load current frame number
71AF 8600             (./objects/main-ch):00141 [2]     2048            lda   #0
                      (./objects/main-ch):00142                         _asld
71B1 58               (            _asld):00001 [2]     2050            aslb
71B2 49               (            _asld):00002 [2]     2052            rola
71B3 318B             (./objects/main-ch):00143 [8]     2060            leay  d,x
71B5 ECA4             (./objects/main-ch):00144 [5]     2065            ldd   ,y                                      *  move.b  1(a1,d1.w),d0       ; read sprite number from script
71B7 81FF             (./objects/main-ch):00145 [2]     2067            cmpa  #$FF                                    *  cmpi.b  #-1,d0
71B9 2606             (./objects/main-ch):00146 [3]     2070            bne   >                                       *  bne.s   +
71BB C600             (./objects/main-ch):00147 [2]     2072            ldb   #0      
71BD E748             (./objects/main-ch):00148 [5]     2077            stb   anim_frame,u                            *  move.b  #0,anim_frame(a0)   ; restart the animation
71BF EC84             (./objects/main-ch):00149 [5]     2082            ldd   ,x                                      *  move.b  1(a1),d0    ; read sprite number
                      (./objects/main-ch):00150                 !
71C1 ED4C             (./objects/main-ch):00151 [6]     2088            std   image_set,u                             *  move.b  d0,mapping_frame(a0)
71C3 2086             (./objects/main-ch):00152 [3]     2091            bra   SAnim_Delay
                      (C:\Users\bhrou\gi):00262                         INCLUDE "./Engine/Graphics/DisplaySprite.asm"   
                      (./Engine/Graphics):00001                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00002                 * DisplaySprite
                      (./Engine/Graphics):00003                 * -------------
                      (./Engine/Graphics):00004                 * Subroutine to manage sprite priority.
                      (./Engine/Graphics):00005                 * Object's priority is read and object is (un)registred in display engine.
                      (./Engine/Graphics):00006                 * priority: 0 - unregistred
                      (./Engine/Graphics):00007                 * priority: 1 - register non moving overlay sprite
                      (./Engine/Graphics):00008                 * priority; 2-8 - register moving sprite (2:front, ..., 8:back)  
                      (./Engine/Graphics):00009                 *
                      (./Engine/Graphics):00010                 * Unlike original S2 code, sprite priority is stored in an open doubly linked list
                      (./Engine/Graphics):00011                 * it allows to keep an exact sprite order for each screen buffer 
                      (./Engine/Graphics):00012                 *
                      (./Engine/Graphics):00013                 * DisplaySprite
                      (./Engine/Graphics):00014                 * input REG : [u] object pointer (OST)
                      (./Engine/Graphics):00015                 *
                      (./Engine/Graphics):00016                 * DisplaySprite_x
                      (./Engine/Graphics):00017                 * input REG : [x] object pointer (OST)
                      (./Engine/Graphics):00018                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00019                                                                                            
71C5                  (./Engine/Graphics):00020                 DisplaySprite_x 
71C5 3456             (./Engine/Graphics):00021 [11]    2102            pshs  d,x,u
71C7 1F13             (./Engine/Graphics):00022 [6]     2108            tfr   x,u
71C9 2002             (./Engine/Graphics):00023 [3]     2111            bra   DSP_Start
                      (./Engine/Graphics):00024                         
71CB                  (./Engine/Graphics):00025                 DisplaySprite 
71CB 3456             (./Engine/Graphics):00026 [11]    2122            pshs  d,x,u
                      (./Engine/Graphics):00027                         
71CD                  (./Engine/Graphics):00028                 DSP_Start
71CD A642             (./Engine/Graphics):00029 [5]     2127            lda   render_flags,u
71CF 84DF             (./Engine/Graphics):00030 [2]     2129            anda  #^render_hide_mask            ; unset hide flag
71D1 A742             (./Engine/Graphics):00031 [5]     2134            sta   render_flags,u
                      (./Engine/Graphics):00032                 
71D3 B67040           (./Engine/Graphics):00033 [5]     2139            lda   glb_Cur_Wrk_Screen_Id         ; read current screen buffer for write operations
71D6 2609             (./Engine/Graphics):00034 [3]     2142            bne   DSP_SetBuffer1
                      (./Engine/Graphics):00035                         
71D8                  (./Engine/Graphics):00036                 DSP_SetBuffer0        
71D8 30C835           (./Engine/Graphics):00037 [5]     2147            leax  rsv_buffer_0,u                ; set x pointer to object variables that belongs to screen buffer 0
71DB 108E724A         (./Engine/Graphics):00038 [4]     2151            ldy   #DPS_buffer_0                 ; set y pointer to Display Priority Structure that belongs to screen buffer 0
71DF 2007             (./Engine/Graphics):00039 [3]     2154            bra   DSP_BufferPositionned
                      (./Engine/Graphics):00040                         
71E1                  (./Engine/Graphics):00041                 DSP_SetBuffer1       
71E1 30C849           (./Engine/Graphics):00042 [5]     2159            leax  rsv_buffer_1,u                ; set x pointer to object variables that belongs to screen buffer 1
71E4 108E72AC         (./Engine/Graphics):00043 [4]     2163            ldy   #DPS_buffer_1                 ; set y pointer to Display Priority Structure that belongs to screen buffer 1        
                      (./Engine/Graphics):00044                         
71E8                  (./Engine/Graphics):00045                 DSP_BufferPositionned       
71E8 A643             (./Engine/Graphics):00046 [5]     2168            lda   priority,u                    ; read priority set for this object
71EA A184             (./Engine/Graphics):00047 [4]     2172            cmpa  buf_priority,x
71EC 271E             (./Engine/Graphics):00048 [3]     2175            beq   DSP_rts                       ; priority and current priority are the same: nothing to do
71EE E684             (./Engine/Graphics):00049 [4]     2179            ldb   buf_priority,x   
71F0 2641             (./Engine/Graphics):00050 [3]     2182            bne   DSP_ChangePriority
                      (./Engine/Graphics):00051                         
71F2                  (./Engine/Graphics):00052                 DSP_InitPriority
71F2 A784             (./Engine/Graphics):00053 [4]     2186            sta   buf_priority,x                ; init priority for this screen buffer with priority from object
                      (./Engine/Graphics):00054                         
71F4                  (./Engine/Graphics):00055                 DSP_CheckLastEntry
71F4 31A90012         (./Engine/Graphics):00056 [8]     2194            leay  buf_Tbl_Priority_Last_Entry,y
71F8 48               (./Engine/Graphics):00057 [2]     2196            asla                                ; change priority number to priority index (value x2)        
71F9 6DA6             (./Engine/Graphics):00058 [7]     2203            tst   a,y                           ; test left byte only is ok, no object will be stored at $00__ address
71FB 2611             (./Engine/Graphics):00059 [3]     2206            bne   DSP_addToExistingNode         ; not the first object at this priority level, branch
                      (./Engine/Graphics):00060                         
71FD                  (./Engine/Graphics):00061                 DSP_addFirstNode        
71FD EFA6             (./Engine/Graphics):00062 [6]     2212            stu   a,y                           ; save object as last entry in linked list
71FF 31A9FFEE         (./Engine/Graphics):00063 [8]     2220            leay  buf_Tbl_Priority_First_Entry-buf_Tbl_Priority_Last_Entry,y
7203 EFA6             (./Engine/Graphics):00064 [6]     2226            stu   a,y                           ; save object as first entry in linked list
7205 CC0000           (./Engine/Graphics):00065 [3]     2229            ldd   #0
7208 ED01             (./Engine/Graphics):00066 [6]     2235            std   buf_priority_prev_obj,x       ; clear object prev and next link, it's the only object at this priority level
720A ED03             (./Engine/Graphics):00067 [6]     2241            std   buf_priority_next_obj,x
                      (./Engine/Graphics):00068                         
720C                  (./Engine/Graphics):00069                 DSP_rts
720C 35D6             (./Engine/Graphics):00070 [13]    2254            puls  d,x,u,pc                      ; rts        
                      (./Engine/Graphics):00071                         
720E                  (./Engine/Graphics):00072                 DSP_addToExistingNode
720E AEA6             (./Engine/Graphics):00073 [6]     2260            ldx   a,y                           ; x register now store last object at the priority level of current object
7210 F67040           (./Engine/Graphics):00074 [5]     2265            ldb   glb_Cur_Wrk_Screen_Id
7213 260E             (./Engine/Graphics):00075 [3]     2268            bne   DSP_LinkBuffer1
7215 EF8838           (./Engine/Graphics):00076 [6]     2274            stu   rsv_priority_next_obj_0,x     ; link last object with current object if active screen buffer 0
7218 AFC836           (./Engine/Graphics):00077 [6]     2280            stx   rsv_priority_prev_obj_0,u     ; link current object with previous object
721B 6FC838           (./Engine/Graphics):00078 [7]     2287            clr   rsv_priority_next_obj_0,u     ; clear object next link        
721E 6FC839           (./Engine/Graphics):00079 [7]     2294            clr   rsv_priority_next_obj_0+1,u   ; clear object next link        
7221 200C             (./Engine/Graphics):00080 [3]     2297            bra   DSP_LinkCurWithPrev        
7223                  (./Engine/Graphics):00081                 DSP_LinkBuffer1        
7223 EF884C           (./Engine/Graphics):00082 [6]     2303            stu   rsv_priority_next_obj_1,x     ; link last object with current object if active screen buffer 1
7226 AFC84A           (./Engine/Graphics):00083 [6]     2309            stx   rsv_priority_prev_obj_1,u     ; link current object with previous object
7229 6FC84C           (./Engine/Graphics):00084 [7]     2316            clr   rsv_priority_next_obj_1,u     ; clear object next link        
722C 6FC84D           (./Engine/Graphics):00085 [7]     2323            clr   rsv_priority_next_obj_1+1,u   ; clear object next link        
                      (./Engine/Graphics):00086                         
722F                  (./Engine/Graphics):00087                 DSP_LinkCurWithPrev        
722F EFA6             (./Engine/Graphics):00088 [6]     2329            stu   a,y                           ; update last object in index
7231 35D6             (./Engine/Graphics):00089 [13]    2342            puls  d,x,u,pc                      ; rts
                      (./Engine/Graphics):00090                         
7233                  (./Engine/Graphics):00091                 DSP_ChangePriority
7233 3426             (./Engine/Graphics):00092 [9]     2351            pshs  d,y
7235 31A90024         (./Engine/Graphics):00093 [8]     2359            leay  buf_Lst_Priority_Unset,y
7239 EFB4             (./Engine/Graphics):00094 [8]     2367            stu   [,y]                          ; add current object address to last free unset list cell
723B ECA4             (./Engine/Graphics):00095 [5]     2372            ldd   ,y
723D C30002           (./Engine/Graphics):00096 [4]     2376            addd  #2
7240 EDA4             (./Engine/Graphics):00097 [5]     2381            std   ,y                            ; set unset list free index to next free cell of unset list
7242 3526             (./Engine/Graphics):00098 [9]     2390            puls  d,y                           ; get back DSP_buffer in y
7244 8100             (./Engine/Graphics):00099 [2]     2392            cmpa  #0
7246 26AC             (./Engine/Graphics):00100 [3]     2395            bne   DSP_CheckLastEntry            ; priority is != 0, branch to add object to display priority list
7248 35D6             (./Engine/Graphics):00101 [13]    2408            puls  d,x,u,pc                      ; rts
                      (./Engine/Graphics):00102                 
                      (./Engine/Graphics):00103                         
                      (./Engine/Graphics):00104                                                        *; ---------------------------------------------------------------------------
                      (./Engine/Graphics):00105                                                        *; Subroutine to display a sprite/object, when a0 is the object RAM
                      (./Engine/Graphics):00106                                                        *; ---------------------------------------------------------------------------
                      (./Engine/Graphics):00107                                                        *
                      (./Engine/Graphics):00108                                                        *; ||||||||||||||| S U B R O U T I N E |||||||||||||||||||||||||||||||||||||||
                      (./Engine/Graphics):00109                                                        *
                      (./Engine/Graphics):00110                                                        *; sub_164F4:
                      (./Engine/Graphics):00111                                                        *DisplaySprite:
                      (./Engine/Graphics):00112                                                        *    lea (Sprite_Table_Input).w,a1
                      (./Engine/Graphics):00113                                                        *    move.w  priority(a0),d0
                      (./Engine/Graphics):00114                                                        *    lsr.w   #1,d0
                      (./Engine/Graphics):00115                                                        *    andi.w  #$380,d0
                      (./Engine/Graphics):00116                                                        *    adda.w  d0,a1
                      (./Engine/Graphics):00117                                                        
                      (./Engine/Graphics):00118                                                        *    cmpi.w  #$7E,(a1)
                      (./Engine/Graphics):00119                                                        *    bhs.s   return_16510
                      (./Engine/Graphics):00120                                                        *    addq.w  #2,(a1)
                      (./Engine/Graphics):00121                                                        
                      (./Engine/Graphics):00122                                                        *    adda.w  (a1),a1
                      (./Engine/Graphics):00123                                                        *    move.w  a0,(a1)
                      (./Engine/Graphics):00124                                                        *
                      (./Engine/Graphics):00125                                                        *return_16510:
                      (./Engine/Graphics):00126                                                        
                      (./Engine/Graphics):00127                                                        *    rts
                      (./Engine/Graphics):00128                                                        *; End of function DisplaySprite       
                      (./Engine/Graphics):00129                 
                      (./Engine/Graphics):00130                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00131                 * Display Priority Structure - DPS
                      (./Engine/Graphics):00132                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00133                 
724A                  (./Engine/Graphics):00134                 DPS_buffer_0
724A 0000000000000000 (./Engine/Graphics):00135                 Tbl_Priority_First_Entry_0    fill  0,2+(nb_priority_levels*2) ; first address of object in linked list for each priority index (buffer 0) index 0 unused
     0000000000000000
     0000
725C 0000000000000000 (./Engine/Graphics):00136                 Tbl_Priority_Last_Entry_0     fill  0,2+(nb_priority_levels*2) ; last address of object in linked list for each priority index (buffer 0) index 0 unused
     0000000000000000
     0000
726E 7270             (./Engine/Graphics):00137                 Lst_Priority_Unset_0          fdb   Lst_Priority_Unset_0+2     ; pointer to end of list (initialized to its own address+2) (buffer 0)
7270 0000000000000000 (./Engine/Graphics):00138                                               fill  0,(nb_graphical_objects*2) ; objects to delete from priority list
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     00000000
72AC                  (./Engine/Graphics):00139                 DPS_buffer_1                              
72AC 0000000000000000 (./Engine/Graphics):00140                 Tbl_Priority_First_Entry_1    fill  0,2+(nb_priority_levels*2) ; first address of object in linked list for each priority index (buffer 1) index 0 unused
     0000000000000000
     0000
72BE 0000000000000000 (./Engine/Graphics):00141                 Tbl_Priority_Last_Entry_1     fill  0,2+(nb_priority_levels*2) ; last address of object in linked list for each priority index (buffer 1) index 0 unused
     0000000000000000
     0000
72D0 72D2             (./Engine/Graphics):00142                 Lst_Priority_Unset_1          fdb   Lst_Priority_Unset_1+2     ; pointer to end of list (initialized to its own address+2) (buffer 1)
72D2 0000000000000000 (./Engine/Graphics):00143                                               fill  0,(nb_graphical_objects*2) ; objects to delete from priority list
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     00000000
730E                  (./Engine/Graphics):00144                 DPS_buffer_end                              
                      (./Engine/Graphics):00145                 
     0000             (./Engine/Graphics):00146                 buf_Tbl_Priority_First_Entry  equ   0                                                            
     0012             (./Engine/Graphics):00147                 buf_Tbl_Priority_Last_Entry   equ   Tbl_Priority_Last_Entry_0-DPS_buffer_0          
     0024             (./Engine/Graphics):00148                 buf_Lst_Priority_Unset        equ   Lst_Priority_Unset_0-DPS_buffer_0                                       
                      (C:\Users\bhrou\gi):00263                         INCLUDE "./Engine/Graphics/CheckSpritesRefresh.asm"
                      (./Engine/Graphics):00001                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00002                 * CheckSpritesRefresh
                      (./Engine/Graphics):00003                 * -------------------
                      (./Engine/Graphics):00004                 * Subroutine to determine if sprites are gonna be erased and/or drawn
                      (./Engine/Graphics):00005                 * Read Display Priority Structure (back to front)
                      (./Engine/Graphics):00006                 * priority: 0 - unregistred
                      (./Engine/Graphics):00007                 * priority: 1 - register non moving overlay sprite
                      (./Engine/Graphics):00008                 * priority; 2-8 - register moving sprite (2:front, ..., 8:back)  
                      (./Engine/Graphics):00009                 *
                      (./Engine/Graphics):00010                 * input REG : none
                      (./Engine/Graphics):00011                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00012                                                 
                      (./Engine/Graphics):00013                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00014                 * Sub Priority Objects List - SOL
                      (./Engine/Graphics):00015                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00016                 
730E 0000000000000000 (./Engine/Graphics):00017                 Tbl_Sub_Object_Erase          fill  0,nb_graphical_objects*2    ; entries of objects that have erase flag in the order back to front
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     00000000
734A 0000000000000000 (./Engine/Graphics):00018                 Tbl_Sub_Object_Draw           fill  0,nb_graphical_objects*2    ; entries of objects that have draw flag in the order back to front                                
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     00000000
                      (./Engine/Graphics):00019                                                            
7386                  (./Engine/Graphics):00020                 CheckSpritesRefresh
                      (./Engine/Graphics):00021                 
7386                  (./Engine/Graphics):00022                 CSR_Start
7386 CC730E           (./Engine/Graphics):00023 [3]     2411            ldd   #Tbl_Sub_Object_Erase
7389 DDF7             (./Engine/Graphics):00024 [5]     2416            std   <glb_cur_ptr_sub_obj_erase
738B CC734A           (./Engine/Graphics):00025 [3]     2419            ldd   #Tbl_Sub_Object_Draw
738E DDF5             (./Engine/Graphics):00026 [5]     2424            std   <glb_cur_ptr_sub_obj_draw
7390 B67040           (./Engine/Graphics):00027 [5]     2429            lda   glb_Cur_Wrk_Screen_Id         ; read current screen buffer for write operations
7393 2666             (./Engine/Graphics):00028 [3]     2432            bne   CSR_SetBuffer1
                      (./Engine/Graphics):00029                         
7395                  (./Engine/Graphics):00030                 CSR_SetBuffer0        
7395 8635             (./Engine/Graphics):00031 [2]     2434            lda   #rsv_buffer_0                 ; set offset to object variables that belongs to screen buffer 0
7397 B77463           (./Engine/Graphics):00032 [5]     2439            sta   CSR_ProcessEachPriorityLevel+2    
739A                  (./Engine/Graphics):00033                 CSR_P8B0
739A FE725A           (./Engine/Graphics):00034 [6]     2445            ldu   DPS_buffer_0+buf_Tbl_Priority_First_Entry+16 ; read DPS from priority 8 to priority 1
739D 2707             (./Engine/Graphics):00035 [3]     2448            beq   CSR_P7B0
739F 8608             (./Engine/Graphics):00036 [2]     2450            lda   #$08
73A1 97F9             (./Engine/Graphics):00037 [4]     2454            sta   <glb_cur_priority        
73A3 BD7461           (./Engine/Graphics):00038 [8]     2462            jsr   CSR_ProcessEachPriorityLevel   
73A6                  (./Engine/Graphics):00039                 CSR_P7B0
73A6 FE7258           (./Engine/Graphics):00040 [6]     2468            ldu   DPS_buffer_0+buf_Tbl_Priority_First_Entry+14
73A9 2707             (./Engine/Graphics):00041 [3]     2471            beq   CSR_P6B0
73AB 8607             (./Engine/Graphics):00042 [2]     2473            lda   #$07
73AD 97F9             (./Engine/Graphics):00043 [4]     2477            sta   <glb_cur_priority        
73AF BD7461           (./Engine/Graphics):00044 [8]     2485            jsr   CSR_ProcessEachPriorityLevel   
73B2                  (./Engine/Graphics):00045                 CSR_P6B0
73B2 FE7256           (./Engine/Graphics):00046 [6]     2491            ldu   DPS_buffer_0+buf_Tbl_Priority_First_Entry+12
73B5 2707             (./Engine/Graphics):00047 [3]     2494            beq   CSR_P5B0
73B7 8606             (./Engine/Graphics):00048 [2]     2496            lda   #$06
73B9 97F9             (./Engine/Graphics):00049 [4]     2500            sta   <glb_cur_priority        
73BB BD7461           (./Engine/Graphics):00050 [8]     2508            jsr   CSR_ProcessEachPriorityLevel   
73BE                  (./Engine/Graphics):00051                 CSR_P5B0
73BE FE7254           (./Engine/Graphics):00052 [6]     2514            ldu   DPS_buffer_0+buf_Tbl_Priority_First_Entry+10
73C1 2707             (./Engine/Graphics):00053 [3]     2517            beq   CSR_P4B0
73C3 8605             (./Engine/Graphics):00054 [2]     2519            lda   #$05
73C5 97F9             (./Engine/Graphics):00055 [4]     2523            sta   <glb_cur_priority                       
73C7 BD7461           (./Engine/Graphics):00056 [8]     2531            jsr   CSR_ProcessEachPriorityLevel   
73CA                  (./Engine/Graphics):00057                 CSR_P4B0
73CA FE7252           (./Engine/Graphics):00058 [6]     2537            ldu   DPS_buffer_0+buf_Tbl_Priority_First_Entry+8
73CD 2707             (./Engine/Graphics):00059 [3]     2540            beq   CSR_P3B0
73CF 8604             (./Engine/Graphics):00060 [2]     2542            lda   #$04
73D1 97F9             (./Engine/Graphics):00061 [4]     2546            sta   <glb_cur_priority                       
73D3 BD7461           (./Engine/Graphics):00062 [8]     2554            jsr   CSR_ProcessEachPriorityLevel               
73D6                  (./Engine/Graphics):00063                 CSR_P3B0
73D6 FE7250           (./Engine/Graphics):00064 [6]     2560            ldu   DPS_buffer_0+buf_Tbl_Priority_First_Entry+6
73D9 2707             (./Engine/Graphics):00065 [3]     2563            beq   CSR_P2B0
73DB 8603             (./Engine/Graphics):00066 [2]     2565            lda   #$03
73DD 97F9             (./Engine/Graphics):00067 [4]     2569            sta   <glb_cur_priority                       
73DF BD7461           (./Engine/Graphics):00068 [8]     2577            jsr   CSR_ProcessEachPriorityLevel      
73E2                  (./Engine/Graphics):00069                 CSR_P2B0
73E2 FE724E           (./Engine/Graphics):00070 [6]     2583            ldu   DPS_buffer_0+buf_Tbl_Priority_First_Entry+4
73E5 2707             (./Engine/Graphics):00071 [3]     2586            beq   CSR_P1B0
73E7 8602             (./Engine/Graphics):00072 [2]     2588            lda   #$02
73E9 97F9             (./Engine/Graphics):00073 [4]     2592            sta   <glb_cur_priority                       
73EB BD7461           (./Engine/Graphics):00074 [8]     2600            jsr   CSR_ProcessEachPriorityLevel  
73EE                  (./Engine/Graphics):00075                 CSR_P1B0
73EE FE724C           (./Engine/Graphics):00076 [6]     2606            ldu   DPS_buffer_0+buf_Tbl_Priority_First_Entry+2
73F1 2707             (./Engine/Graphics):00077 [3]     2609            beq   CSR_rtsB0
73F3 8601             (./Engine/Graphics):00078 [2]     2611            lda   #$01
73F5 97F9             (./Engine/Graphics):00079 [4]     2615            sta   <glb_cur_priority                       
73F7 BD7461           (./Engine/Graphics):00080 [8]     2623            jsr   CSR_ProcessEachPriorityLevel
73FA                  (./Engine/Graphics):00081                 CSR_rtsB0        
73FA 39               (./Engine/Graphics):00082 [5]     2628            rts
                      (./Engine/Graphics):00083                         
73FB                  (./Engine/Graphics):00084                 CSR_SetBuffer1       
73FB 8649             (./Engine/Graphics):00085 [2]     2630            lda   #rsv_buffer_1                 ; set offset to object variables that belongs to screen buffer 1
73FD B77463           (./Engine/Graphics):00086 [5]     2635            sta   CSR_ProcessEachPriorityLevel+2        
7400                  (./Engine/Graphics):00087                 CSR_P8B1
7400 FE72BC           (./Engine/Graphics):00088 [6]     2641            ldu   DPS_buffer_1+buf_Tbl_Priority_First_Entry+16 ; read DPS from priority 8 to priority 1
7403 2707             (./Engine/Graphics):00089 [3]     2644            beq   CSR_P7B1
7405 8608             (./Engine/Graphics):00090 [2]     2646            lda   #$08
7407 97F9             (./Engine/Graphics):00091 [4]     2650            sta   <glb_cur_priority        
7409 BD7461           (./Engine/Graphics):00092 [8]     2658            jsr   CSR_ProcessEachPriorityLevel   
740C                  (./Engine/Graphics):00093                 CSR_P7B1
740C FE72BA           (./Engine/Graphics):00094 [6]     2664            ldu   DPS_buffer_1+buf_Tbl_Priority_First_Entry+14
740F 2707             (./Engine/Graphics):00095 [3]     2667            beq   CSR_P6B1
7411 8607             (./Engine/Graphics):00096 [2]     2669            lda   #$07
7413 97F9             (./Engine/Graphics):00097 [4]     2673            sta   <glb_cur_priority                       
7415 BD7461           (./Engine/Graphics):00098 [8]     2681            jsr   CSR_ProcessEachPriorityLevel   
7418                  (./Engine/Graphics):00099                 CSR_P6B1
7418 FE72B8           (./Engine/Graphics):00100 [6]     2687            ldu   DPS_buffer_1+buf_Tbl_Priority_First_Entry+12
741B 2707             (./Engine/Graphics):00101 [3]     2690            beq   CSR_P5B1
741D 8606             (./Engine/Graphics):00102 [2]     2692            lda   #$06
741F 97F9             (./Engine/Graphics):00103 [4]     2696            sta   <glb_cur_priority                       
7421 BD7461           (./Engine/Graphics):00104 [8]     2704            jsr   CSR_ProcessEachPriorityLevel   
7424                  (./Engine/Graphics):00105                 CSR_P5B1
7424 FE72B6           (./Engine/Graphics):00106 [6]     2710            ldu   DPS_buffer_1+buf_Tbl_Priority_First_Entry+10
7427 2707             (./Engine/Graphics):00107 [3]     2713            beq   CSR_P4B1
7429 8605             (./Engine/Graphics):00108 [2]     2715            lda   #$05
742B 97F9             (./Engine/Graphics):00109 [4]     2719            sta   <glb_cur_priority                       
742D BD7461           (./Engine/Graphics):00110 [8]     2727            jsr   CSR_ProcessEachPriorityLevel   
7430                  (./Engine/Graphics):00111                 CSR_P4B1
7430 FE72B4           (./Engine/Graphics):00112 [6]     2733            ldu   DPS_buffer_1+buf_Tbl_Priority_First_Entry+8
7433 2707             (./Engine/Graphics):00113 [3]     2736            beq   CSR_P3B1
7435 8604             (./Engine/Graphics):00114 [2]     2738            lda   #$04
7437 97F9             (./Engine/Graphics):00115 [4]     2742            sta   <glb_cur_priority
7439 BD7461           (./Engine/Graphics):00116 [8]     2750            jsr   CSR_ProcessEachPriorityLevel               
743C                  (./Engine/Graphics):00117                 CSR_P3B1
743C FE72B2           (./Engine/Graphics):00118 [6]     2756            ldu   DPS_buffer_1+buf_Tbl_Priority_First_Entry+6
743F 2707             (./Engine/Graphics):00119 [3]     2759            beq   CSR_P2B1
7441 8603             (./Engine/Graphics):00120 [2]     2761            lda   #$03
7443 97F9             (./Engine/Graphics):00121 [4]     2765            sta   <glb_cur_priority                       
7445 BD7461           (./Engine/Graphics):00122 [8]     2773            jsr   CSR_ProcessEachPriorityLevel      
7448                  (./Engine/Graphics):00123                 CSR_P2B1
7448 FE72B0           (./Engine/Graphics):00124 [6]     2779            ldu   DPS_buffer_1+buf_Tbl_Priority_First_Entry+4
744B 2707             (./Engine/Graphics):00125 [3]     2782            beq   CSR_P1B1
744D 8602             (./Engine/Graphics):00126 [2]     2784            lda   #$02
744F 97F9             (./Engine/Graphics):00127 [4]     2788            sta   <glb_cur_priority                       
7451 BD7461           (./Engine/Graphics):00128 [8]     2796            jsr   CSR_ProcessEachPriorityLevel  
7454                  (./Engine/Graphics):00129                 CSR_P1B1
7454 FE72AE           (./Engine/Graphics):00130 [6]     2802            ldu   DPS_buffer_1+buf_Tbl_Priority_First_Entry+2
7457 2707             (./Engine/Graphics):00131 [3]     2805            beq   CSR_rtsB1
7459 8601             (./Engine/Graphics):00132 [2]     2807            lda   #$01
745B 97F9             (./Engine/Graphics):00133 [4]     2811            sta   <glb_cur_priority                       
745D BD7461           (./Engine/Graphics):00134 [8]     2819            jsr   CSR_ProcessEachPriorityLevel
7460                  (./Engine/Graphics):00135                 CSR_rtsB1        
7460 39               (./Engine/Graphics):00136 [5]     2824            rts
                      (./Engine/Graphics):00137                 
7461                  (./Engine/Graphics):00138                 CSR_ProcessEachPriorityLevel
7461 30C810           (./Engine/Graphics):00139 [5]     2829            leax  16,u                          ; dynamic offset, x point to object variables relative to current writable buffer (beware that rsv_buffer_0 and rsv_buffer_1 should be equ >=16)
                      (./Engine/Graphics):00140                         
7464                  (./Engine/Graphics):00141                 CSR_CheckDelHide
7464 A642             (./Engine/Graphics):00142 [5]     2834            lda   render_flags,u
7466 8460             (./Engine/Graphics):00143 [2]     2836            anda  #render_hide_mask|render_todelete_mask
7468 1026005B         (./Engine/Graphics):00144 [5+?]   2841            lbne  CSR_DoNotDisplaySprite      
                      (./Engine/Graphics):00145                 
746C                  (./Engine/Graphics):00146                 CSR_CheckRefresh        
746C A6C822           (./Engine/Graphics):00147 [5]     2846            lda   rsv_render_flags,u
746F 8401             (./Engine/Graphics):00148 [2]     2848            anda  #rsv_render_checkrefresh_mask ; branch if checkrefresh is true
7471 1026014F         (./Engine/Graphics):00149 [5+?]   2853            lbne  CSR_CheckErase
                      (./Engine/Graphics):00150                 
7475                  (./Engine/Graphics):00151                 CSR_UpdSpriteImageBasedOnMirror
                      (./Engine/Graphics):00152                 
                      (./Engine/Graphics):00153                         ; an image set is made of 1 to 4 image subsets
                      (./Engine/Graphics):00154                         ; each subset represent a mirrored version of the image (N: normal, X: x mirror, Y: y mirror, XY: xy mirror)
                      (./Engine/Graphics):00155                         ; this code set the active image subset based on mirror flags
                      (./Engine/Graphics):00156                 
7475 A6C822           (./Engine/Graphics):00157 [5]     2858            lda   rsv_render_flags,u
7478 8A01             (./Engine/Graphics):00158 [2]     2860            ora   #rsv_render_checkrefresh_mask
747A A7C822           (./Engine/Graphics):00159 [5]     2865            sta   rsv_render_flags,u            ; set checkrefresh flag to true
                      (./Engine/Graphics):00160                         
747D 108E9841         (./Engine/Graphics):00161 [4]     2869            ldy   #Img_Page_Index               ; call page that store imageset for this object
7481 8600             (./Engine/Graphics):00162 [2]     2871            lda   #$00
7483 E6C4             (./Engine/Graphics):00163 [4]     2875            ldb   id,u
7485 A6AB             (./Engine/Graphics):00164 [8]     2883            lda   d,y
                      (./Engine/Graphics):00165                         _SetCartPageA        
                      (    _SetCartPageA):00001                  IFDEF T2
7487 BD6F74           (    _SetCartPageA):00002 [8]     2891            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
                      (./Engine/Graphics):00166                         
748A A642             (./Engine/Graphics):00167 [5]     2896            lda   render_flags,u                ; set image to display based on x and y mirror flags
748C 8403             (./Engine/Graphics):00168 [2]     2898            anda  #render_xmirror_mask|render_ymirror_mask
748E 10AE4C           (./Engine/Graphics):00169 [7]     2905            ldy   image_set,u
7491 E626             (./Engine/Graphics):00170 [5]     2910            ldb   image_center_offset,y
7493 E7C825           (./Engine/Graphics):00171 [5]     2915            stb   rsv_image_center_offset,u        
7496 E6A6             (./Engine/Graphics):00172 [5]     2920            ldb   a,y
7498 31A5             (./Engine/Graphics):00173 [5]     2925            leay  b,y                           ; read image set index
749A 10AFC826         (./Engine/Graphics):00174 [7]     2932            sty   rsv_image_subset,u
                      (./Engine/Graphics):00175                         
749E                  (./Engine/Graphics):00176                 CSR_CheckPlayFieldCoord
749E A642             (./Engine/Graphics):00177 [5]     2937            lda   render_flags,u
74A0 8410             (./Engine/Graphics):00178 [2]     2939            anda  #render_playfieldcoord_mask
74A2 274A             (./Engine/Graphics):00179 [3]     2942            beq   CSR_ComputeMappingFrame       ; branch if position is already expressed in screen coordinate
                      (./Engine/Graphics):00180                 
                      (./Engine/Graphics):00181                         ; purpose here is to check if image coordinate in the playfield
                      (./Engine/Graphics):00182                         ; can be converted to screen position, if not it is flagged out of range
                      (./Engine/Graphics):00183                 
74A4 EC4E             (./Engine/Graphics):00184 [6]     2948            ldd   x_pos,u
74A6 93F3             (./Engine/Graphics):00185 [6]     2954            subd  <glb_camera_x_pos
74A8 10250110         (./Engine/Graphics):00186 [5+?]   2959            lblo  CSR_SetOutOfRange             ; out of range if x_pos < glb_camera_x_pos
74AC 4D               (./Engine/Graphics):00187 [2]     2961            tsta 
74AD 1026010B         (./Engine/Graphics):00188 [5+?]   2966            lbne  CSR_SetOutOfRange             ; out of range if x_pos + 256 > glb_camera_x_pos
74B1 E7C814           (./Engine/Graphics):00189 [5]     2971            stb   x_pixel,u
                      (./Engine/Graphics):00190                 
74B4 ECC811           (./Engine/Graphics):00191 [6]     2977            ldd   y_pos,u
74B7 93F1             (./Engine/Graphics):00192 [6]     2983            subd  <glb_camera_y_pos
74B9 102500FF         (./Engine/Graphics):00193 [5+?]   2988            lblo  CSR_SetOutOfRange             ; out of range if y_pos < glb_camera_y_pos
74BD 4D               (./Engine/Graphics):00194 [2]     2990            tsta 
74BE 102600FA         (./Engine/Graphics):00195 [5+?]   2995            lbne  CSR_SetOutOfRange             ; out of range if y_pos + 256 > glb_camera_y_pos
74C2 E7C815           (./Engine/Graphics):00196 [5]     3000            stb   y_pixel,u
74C5 2027             (./Engine/Graphics):00197 [3]     3003            bra   CSR_ComputeMappingFrame
                      (./Engine/Graphics):00198                         
74C7                  (./Engine/Graphics):00199                 CSR_DoNotDisplaySprite
74C7 A643             (./Engine/Graphics):00200 [5]     3008            lda   priority,u                     
74C9 91F9             (./Engine/Graphics):00201 [4]     3012            cmpa  <glb_cur_priority 
74CB 261A             (./Engine/Graphics):00202 [3]     3015            bne   CSR_NextObject                ; next object if this one is a new priority record (no need to erase) 
                      (./Engine/Graphics):00203                         
74CD A6C822           (./Engine/Graphics):00204 [5]     3020            lda   rsv_render_flags,u
74D0 84F9             (./Engine/Graphics):00205 [2]     3022            anda  #^rsv_render_erasesprite_mask&^rsv_render_displaysprite_mask ; set erase and display flag to false
74D2 A7C822           (./Engine/Graphics):00206 [5]     3027            sta   rsv_render_flags,u
                      (./Engine/Graphics):00207                                 
74D5 E68813           (./Engine/Graphics):00208 [5]     3032            ldb   buf_prev_render_flags,x
74D8 2A0D             (./Engine/Graphics):00209 [3]     3035            bpl   CSR_NextObject                ; branch if not on screen
                      (./Engine/Graphics):00210                         
74DA 8A02             (./Engine/Graphics):00211 [2]     3037            ora   #rsv_render_erasesprite_mask  ; set erase flag to true if on screen                  
74DC A7C822           (./Engine/Graphics):00212 [5]     3042            sta   rsv_render_flags,u
                      (./Engine/Graphics):00213                         
74DF 109EF7           (./Engine/Graphics):00214 [6]     3048            ldy   <glb_cur_ptr_sub_obj_erase         ; maintain list of changing sprites to erase
74E2 EFA1             (./Engine/Graphics):00215 [8]     3056            stu   ,y++
74E4 109FF7           (./Engine/Graphics):00216 [6]     3062            sty   <glb_cur_ptr_sub_obj_erase 
                      (./Engine/Graphics):00217                         
74E7                  (./Engine/Graphics):00218                 CSR_NextObject
74E7 EE03             (./Engine/Graphics):00219 [6]     3068            ldu   buf_priority_next_obj,x
74E9 1026FF74         (./Engine/Graphics):00220 [5+?]   3073            lbne  CSR_ProcessEachPriorityLevel   
74ED 39               (./Engine/Graphics):00221 [5]     3078            rts
                      (./Engine/Graphics):00222                 
74EE                  (./Engine/Graphics):00223                 CSR_ComputeMappingFrame
                      (./Engine/Graphics):00224                 
                      (./Engine/Graphics):00225                         ; The image subset reference up to 4 version of an image
                      (./Engine/Graphics):00226                         ; Draw/Erase, Draw routines and shifted version by 1 pixel of these two routines
                      (./Engine/Graphics):00227                         ; The following code set the appropriate routine that will draw the image
                      (./Engine/Graphics):00228                         ; First thing is to check if the image position is odd or even
                      (./Engine/Graphics):00229                         ; and select the appropriate routine. If no routine is found, it will select the avaible routine.
                      (./Engine/Graphics):00230                         ; The selected image will also be based on image type overlay or not (Simple Draw or Draw/Erase)
                      (./Engine/Graphics):00231                 
74EE E6C814           (./Engine/Graphics):00232 [5]     3083    @a      ldb   x_pixel,u                     ; compute mapping_frame 
74F1 E8C825           (./Engine/Graphics):00233 [5]     3088    @b      eorb  rsv_image_center_offset,u     ; case of odd image center switch shifted image with normal
74F4 C401             (./Engine/Graphics):00234 [2]     3090            andb  #1                            ; index of sub image is encoded in two bits: 00|B0, 01|D0, 10|B1, 11|D1         
74F6 58               (./Engine/Graphics):00235 [2]     3092            aslb                                ; set bit2 for 1px shifted image  
74F7 A642             (./Engine/Graphics):00236 [5]     3097            lda   render_flags,u            
74F9 8404             (./Engine/Graphics):00237 [2]     3099            anda  #render_overlay_mask          ; set bit1 for normal (background save) or overlay sprite (no background save)
74FB 2701             (./Engine/Graphics):00238 [3]     3102            beq   @c
74FD 5C               (./Engine/Graphics):00239 [2]     3104            incb
74FE                  (./Engine/Graphics):00240                 @c
74FE A6A5             (./Engine/Graphics):00241 [5]     3109            lda   b,y
7500 2708             (./Engine/Graphics):00242 [3]     3112            beq   CSR_NoDefinedFrame
7502 31A6             (./Engine/Graphics):00243 [5]     3117            leay  a,y                           ; read image subset index
7504 10AFC828         (./Engine/Graphics):00244 [7]     3124            sty   rsv_mapping_frame,u
7508 2021             (./Engine/Graphics):00245 [3]     3127            bra   CSR_UpdateMetadata
750A                  (./Engine/Graphics):00246                 CSR_NoDefinedFrame
750A C802             (./Engine/Graphics):00247 [2]     3129            eorb  #%00000010                    ; check if there is an alternate shifted image available
750C 2705             (./Engine/Graphics):00248 [3]     3132            beq   @e
750E 6CC825           (./Engine/Graphics):00249 [7]     3139            inc   rsv_image_center_offset,u     ; ajust offset for alternate
7511 2003             (./Engine/Graphics):00250 [3]     3142            bra   @f
7513 6AC825           (./Engine/Graphics):00251 [7]     3149    @e      dec   rsv_image_center_offset,u
7516 6DA5             (./Engine/Graphics):00252 [7]     3156    @f      tst   b,y
7518 26E4             (./Engine/Graphics):00253 [3]     3159            bne   @c        
                      (./Engine/Graphics):00254                 
751A 108E0000         (./Engine/Graphics):00255 [4]     3163            ldy   #0                            ; no defined frame, nothing will be displayed
751E 10AFC828         (./Engine/Graphics):00256 [7]     3170            sty   rsv_mapping_frame,u
7522 A642             (./Engine/Graphics):00257 [5]     3175            lda   render_flags,u
7524 8A20             (./Engine/Graphics):00258 [2]     3177            ora   #render_hide_mask             ; set hide flag
7526 A742             (./Engine/Graphics):00259 [5]     3182            sta   render_flags,u
7528 7E75C4           (./Engine/Graphics):00260 [4]     3186            jmp   CSR_CheckErase
                      (./Engine/Graphics):00261                                 
752B                  (./Engine/Graphics):00262                 CSR_UpdateMetadata
752B A626             (./Engine/Graphics):00263 [5]     3191            lda   erase_nb_cell,y               ; copy current image metadata into object data
752D A7C82A           (./Engine/Graphics):00264 [5]     3196            sta   rsv_erase_nb_cell,u           ; this is needed to avoid a lot of page switch 
7530 A6A4             (./Engine/Graphics):00265 [4]     3200            lda   page_draw_routine,y           ; during following routines
7532 A7C82B           (./Engine/Graphics):00266 [5]     3205            sta   rsv_page_draw_routine,u
7535 EC21             (./Engine/Graphics):00267 [6]     3211            ldd   draw_routine,y
7537 EDC82C           (./Engine/Graphics):00268 [6]     3217            std   rsv_draw_routine,u
753A A623             (./Engine/Graphics):00269 [5]     3222            lda   page_erase_routine,y
753C A7C82E           (./Engine/Graphics):00270 [5]     3227            sta   rsv_page_erase_routine,u
753F EC24             (./Engine/Graphics):00271 [6]     3233            ldd   erase_routine,y
7541 EDC82F           (./Engine/Graphics):00272 [6]     3239            std   rsv_erase_routine,u
                      (./Engine/Graphics):00273                         
7544                  (./Engine/Graphics):00274                 CSR_CheckPosition        
7544 E6C815           (./Engine/Graphics):00275 [5]     3244            ldb   y_pixel,u                     ; check if sprite is fully in screen vertical range
7547 10AEC826         (./Engine/Graphics):00276 [7]     3251            ldy   rsv_image_subset,u
754B EB25             (./Engine/Graphics):00277 [5]     3256            addb  image_subset_y1_offset,y
754D C1E3             (./Engine/Graphics):00278 [2]     3258            cmpb  #screen_bottom
754F 226B             (./Engine/Graphics):00279 [3]     3261            bhi   CSR_SetOutOfRange
7551 C11C             (./Engine/Graphics):00280 [2]     3263            cmpb  #screen_top
7553 2567             (./Engine/Graphics):00281 [3]     3266            blo   CSR_SetOutOfRange        
7555 E7C832           (./Engine/Graphics):00282 [5]     3271            stb   rsv_y1_pixel,u
7558 10AE4C           (./Engine/Graphics):00283 [7]     3278            ldy   image_set,u
755B EB25             (./Engine/Graphics):00284 [5]     3283            addb  image_y_size,y
755D C1E3             (./Engine/Graphics):00285 [2]     3285            cmpb  #screen_bottom
755F 225B             (./Engine/Graphics):00286 [3]     3288            bhi   CSR_SetOutOfRange
7561 C11C             (./Engine/Graphics):00287 [2]     3290            cmpb  #screen_top
7563 2557             (./Engine/Graphics):00288 [3]     3293            blo   CSR_SetOutOfRange        
7565 E7C834           (./Engine/Graphics):00289 [5]     3298            stb   rsv_y2_pixel,u
7568 E1C832           (./Engine/Graphics):00290 [5]     3303            cmpb  rsv_y1_pixel,u                ; check wrapping
756B 254F             (./Engine/Graphics):00291 [3]     3306            blo   CSR_SetOutOfRange
                      (./Engine/Graphics):00292                                 
756D A642             (./Engine/Graphics):00293 [5]     3311            lda   render_flags,u                ; check if sprite is fully in screen horizontal range
756F 8580             (./Engine/Graphics):00294 [2]     3313            bita  #render_xloop_mask
7571 262B             (./Engine/Graphics):00295 [3]     3316            bne   CSR_DontCheckXFrontier   
                      (./Engine/Graphics):00296                         
7573 E6C814           (./Engine/Graphics):00297 [5]     3321            ldb   x_pixel,u
7576 10AEC826         (./Engine/Graphics):00298 [7]     3328            ldy   rsv_image_subset,u
757A EB24             (./Engine/Graphics):00299 [5]     3333            addb  image_subset_x1_offset,y
757C C1CF             (./Engine/Graphics):00300 [2]     3335            cmpb  #screen_right
757E 223C             (./Engine/Graphics):00301 [3]     3338            bhi   CSR_SetOutOfRange
7580 C130             (./Engine/Graphics):00302 [2]     3340            cmpb  #screen_left
7582 2538             (./Engine/Graphics):00303 [3]     3343            blo   CSR_SetOutOfRange
7584 E7C831           (./Engine/Graphics):00304 [5]     3348            stb   rsv_x1_pixel,u
7587 10AE4C           (./Engine/Graphics):00305 [7]     3355            ldy   image_set,u
758A EB24             (./Engine/Graphics):00306 [5]     3360            addb  image_x_size,y
758C C1CF             (./Engine/Graphics):00307 [2]     3362            cmpb  #screen_right
758E 222C             (./Engine/Graphics):00308 [3]     3365            bhi   CSR_SetOutOfRange
7590 C130             (./Engine/Graphics):00309 [2]     3367            cmpb  #screen_left
7592 2528             (./Engine/Graphics):00310 [3]     3370            blo   CSR_SetOutOfRange
7594 E7C833           (./Engine/Graphics):00311 [5]     3375            stb   rsv_x2_pixel,u
7597 E1C831           (./Engine/Graphics):00312 [5]     3380            cmpb  rsv_x1_pixel,u                ; check wrapping
759A 2520             (./Engine/Graphics):00313 [3]     3383            blo   CSR_SetOutOfRange 
                      (./Engine/Graphics):00314                                 
759C 2014             (./Engine/Graphics):00315 [3]     3386            bra   CSR_DontCheckXFrontier_end        
                      (./Engine/Graphics):00316                         
759E                  (./Engine/Graphics):00317                 CSR_DontCheckXFrontier  
759E E6C814           (./Engine/Graphics):00318 [5]     3391            ldb   x_pixel,u
75A1 10AEC826         (./Engine/Graphics):00319 [7]     3398            ldy   rsv_image_subset,u
75A5 EB24             (./Engine/Graphics):00320 [5]     3403            addb  image_subset_x1_offset,y
75A7 E7C831           (./Engine/Graphics):00321 [5]     3408            stb   rsv_x1_pixel,u
                      (./Engine/Graphics):00322                         
75AA 10AE4C           (./Engine/Graphics):00323 [7]     3415            ldy   image_set,u
75AD EB24             (./Engine/Graphics):00324 [5]     3420            addb  image_x_size,y
75AF E7C833           (./Engine/Graphics):00325 [5]     3425            stb   rsv_x2_pixel,u      
                      (./Engine/Graphics):00326                 
75B2                  (./Engine/Graphics):00327                 CSR_DontCheckXFrontier_end        
75B2 A6C822           (./Engine/Graphics):00328 [5]     3430            lda   rsv_render_flags,u
75B5 84F7             (./Engine/Graphics):00329 [2]     3432            anda  #^rsv_render_outofrange_mask  ; unset out of range flag
75B7 A7C822           (./Engine/Graphics):00330 [5]     3437            sta   rsv_render_flags,u
75BA 2008             (./Engine/Graphics):00331 [3]     3440            bra   CSR_CheckErase
                      (./Engine/Graphics):00332                                 
75BC                  (./Engine/Graphics):00333                 CSR_SetOutOfRange
75BC A6C822           (./Engine/Graphics):00334 [5]     3445            lda   rsv_render_flags,u
75BF 8A08             (./Engine/Graphics):00335 [2]     3447            ora   #rsv_render_outofrange_mask   ; set out of range flag
75C1 A7C822           (./Engine/Graphics):00336 [5]     3452            sta   rsv_render_flags,u
                      (./Engine/Graphics):00337                 
75C4                  (./Engine/Graphics):00338                 CSR_CheckErase
75C4 BF769E           (./Engine/Graphics):00339 [6]     3458            stx   CSR_CheckDraw+1
75C7 A684             (./Engine/Graphics):00340 [4]     3462            lda   buf_priority,x
75C9 91F9             (./Engine/Graphics):00341 [4]     3466            cmpa  <glb_cur_priority 
75CB 102600CE         (./Engine/Graphics):00342 [5+?]   3471            lbne  CSR_CheckDraw
                      (./Engine/Graphics):00343                         
75CF 109EF7           (./Engine/Graphics):00344 [6]     3477            ldy   <glb_cur_ptr_sub_obj_erase
                      (./Engine/Graphics):00345                         
75D2 A6C822           (./Engine/Graphics):00346 [5]     3482            lda   rsv_render_flags,u
75D5 8408             (./Engine/Graphics):00347 [2]     3484            anda  #rsv_render_outofrange_mask
75D7 2709             (./Engine/Graphics):00348 [3]     3487            beq   CSR_CheckErase_InRange
75D9 A68813           (./Engine/Graphics):00349 [5]     3492            lda   buf_prev_render_flags,x
75DC 102A0109         (./Engine/Graphics):00350 [5+?]   3497            lbpl  CSR_SetEraseDrawFalse         ; branch if object is not on screen    
75E0 2024             (./Engine/Graphics):00351 [3]     3500            bra   CSR_SetEraseTrue
                      (./Engine/Graphics):00352                                 
75E2                  (./Engine/Graphics):00353                 CSR_CheckErase_InRange        
75E2 A68813           (./Engine/Graphics):00354 [5]     3505            lda   buf_prev_render_flags,x
75E5 102A00AC         (./Engine/Graphics):00355 [5+?]   3510            lbpl  CSR_SetEraseFalse             ; branch if object is not on screen
75E9 96E8             (./Engine/Graphics):00356 [4]     3514            lda   <glb_force_sprite_refresh
75EB 2619             (./Engine/Graphics):00357 [3]     3517            bne   CSR_SetEraseTrue
75ED ECC814           (./Engine/Graphics):00358 [6]     3523            ldd   xy_pixel,u
75F0 44               (./Engine/Graphics):00359 [2]     3525            lsra                                ; x position precision is x_pixel/2 and mapping_frame with or without 1px shit, y position precision is y_pixel  
75F1 10A30D           (./Engine/Graphics):00360 [8]     3533            cmpd  buf_prev_xy_pixel,x
75F4 2610             (./Engine/Graphics):00361 [3]     3536            bne   CSR_SetEraseTrue              ; branch if object moved since last frame
75F6 ECC828           (./Engine/Graphics):00362 [6]     3542            ldd   rsv_mapping_frame,u
75F9 10A305           (./Engine/Graphics):00363 [8]     3550            cmpd  buf_prev_mapping_frame,x
75FC 2608             (./Engine/Graphics):00364 [3]     3553            bne   CSR_SetEraseTrue              ; branch if object image changed since last frame
75FE A643             (./Engine/Graphics):00365 [5]     3558            lda   priority,u
7600 A184             (./Engine/Graphics):00366 [4]     3562            cmpa  buf_priority,x
7602 2602             (./Engine/Graphics):00367 [3]     3565            bne   CSR_SetEraseTrue              ; branch if object priority changed since last frame
7604 2010             (./Engine/Graphics):00368 [3]     3568            bra   CSR_SubEraseSpriteSearchInit  ; branch if object is on screen but unchanged since last frame
                      (./Engine/Graphics):00369                         
7606                  (./Engine/Graphics):00370                 CSR_SetEraseTrue        
7606 A6C822           (./Engine/Graphics):00371 [5]     3573            lda   rsv_render_flags,u
7609 8A02             (./Engine/Graphics):00372 [2]     3575            ora   #rsv_render_erasesprite_mask
760B A7C822           (./Engine/Graphics):00373 [5]     3580            sta   rsv_render_flags,u
                      (./Engine/Graphics):00374                         
760E EFA1             (./Engine/Graphics):00375 [8]     3588            stu   ,y++
7610 109FF7           (./Engine/Graphics):00376 [6]     3594            sty   <glb_cur_ptr_sub_obj_erase
                      (./Engine/Graphics):00377                                 
7613 7E769D           (./Engine/Graphics):00378 [4]     3598            jmp   CSR_CheckDraw
                      (./Engine/Graphics):00379                         
7616                  (./Engine/Graphics):00380                 CSR_SubEraseSpriteSearchInit
                      (./Engine/Graphics):00381                 
                      (./Engine/Graphics):00382                         * search a collision with a sprite under the current sprite
                      (./Engine/Graphics):00383                         * the sprite under should have to be erased or displayed
                      (./Engine/Graphics):00384                         * in this case it forces the refresh of the current sprite that was not supposed to be refreshed
                      (./Engine/Graphics):00385                         * as a sub loop, this should be optimized as much as possible ... I hope it is
                      (./Engine/Graphics):00386                         * there are two lists because a sprite can be erased at a position
                      (./Engine/Graphics):00387                         * and displayed at another position : both cases should be tested !
                      (./Engine/Graphics):00388                 
7616 9EF7             (./Engine/Graphics):00389 [5]     3603            ldx   <glb_cur_ptr_sub_obj_erase       
7618 B67040           (./Engine/Graphics):00390 [5]     3608            lda   glb_Cur_Wrk_Screen_Id         ; read current screen buffer for write operations
761B 2627             (./Engine/Graphics):00391 [3]     3611            bne   CSR_SubEraseSearchB1
                      (./Engine/Graphics):00392                         
761D                  (./Engine/Graphics):00393                 CSR_SubEraseSearchB0
761D 8C730E           (./Engine/Graphics):00394 [4]     3615            cmpx  #Tbl_Sub_Object_Erase
7620 2749             (./Engine/Graphics):00395 [3]     3618            beq   CSR_SubDrawSpriteSearchInit   ; branch if no more sub objects
7622 10AE83           (./Engine/Graphics):00396 [9]     3627            ldy   ,--x
                      (./Engine/Graphics):00397                         
7625                  (./Engine/Graphics):00398                 CSR_SubEraseCheckCollisionB0
7625 ECA844           (./Engine/Graphics):00399 [6]     3633            ldd   rsv_prev_xy1_pixel_0,y        ; sub entry : rsv_prev_x_pixel_0 and rsv_prev_y_pixel_0 in one instruction
7628 A1C833           (./Engine/Graphics):00400 [5]     3638            cmpa  rsv_x2_pixel,u                ;     entry : x_pixel + rsv_mapping_frame.x_size
762B 22F0             (./Engine/Graphics):00401 [3]     3641            bhi   CSR_SubEraseSearchB0
762D E1C834           (./Engine/Graphics):00402 [5]     3646            cmpb  rsv_y2_pixel,u                ;     entry : y_pixel + rsv_mapping_frame.y_size
7630 22EB             (./Engine/Graphics):00403 [3]     3649            bhi   CSR_SubEraseSearchB0
7632 ECA846           (./Engine/Graphics):00404 [6]     3655            ldd   rsv_prev_xy2_pixel_0,y        ; sub entry : rsv_prev_x_pixel_0 + rsv_prev_mapping_frame_0.x_size and rsv_prev_y_pixel_0 + rsv_prev_mapping_frame_0.y_size in one instruction
7635 A1C831           (./Engine/Graphics):00405 [5]     3660            cmpa  rsv_x1_pixel,u                ;     entry : x_pixel
7638 25E3             (./Engine/Graphics):00406 [3]     3663            blo   CSR_SubEraseSearchB0
763A E1C832           (./Engine/Graphics):00407 [5]     3668            cmpb  rsv_y1_pixel,u                ;     entry : y_pixel
763D 25DE             (./Engine/Graphics):00408 [3]     3671            blo   CSR_SubEraseSearchB0
                      (./Engine/Graphics):00409                         
763F 109EF7           (./Engine/Graphics):00410 [6]     3677            ldy   <glb_cur_ptr_sub_obj_erase
7642 20C2             (./Engine/Graphics):00411 [3]     3680            bra   CSR_SetEraseTrue              ; found a collision
                      (./Engine/Graphics):00412                 
7644                  (./Engine/Graphics):00413                 CSR_SubEraseSearchB1
7644 8C730E           (./Engine/Graphics):00414 [4]     3684            cmpx  #Tbl_Sub_Object_Erase
7647 2722             (./Engine/Graphics):00415 [3]     3687            beq   CSR_SubDrawSpriteSearchInit   ; branch if no more sub objects
7649 10AE83           (./Engine/Graphics):00416 [9]     3696            ldy   ,--x
                      (./Engine/Graphics):00417                         
764C                  (./Engine/Graphics):00418                 CSR_SubEraseCheckCollisionB1
764C ECA858           (./Engine/Graphics):00419 [6]     3702            ldd   rsv_prev_xy1_pixel_1,y        ; sub entry : rsv_prev_x_pixel_1 and rsv_prev_y_pixel_1 in one instruction
764F A1C833           (./Engine/Graphics):00420 [5]     3707            cmpa  rsv_x2_pixel,u                ;     entry : x_pixel + rsv_mapping_frame.x_size
7652 22F0             (./Engine/Graphics):00421 [3]     3710            bhi   CSR_SubEraseSearchB1
7654 E1C834           (./Engine/Graphics):00422 [5]     3715            cmpb  rsv_y2_pixel,u                ;     entry : y_pixel + rsv_mapping_frame.y_size
7657 22EB             (./Engine/Graphics):00423 [3]     3718            bhi   CSR_SubEraseSearchB1
7659 ECA85A           (./Engine/Graphics):00424 [6]     3724            ldd   rsv_prev_xy2_pixel_1,y        ; sub entry : rsv_prev_x_pixel_1 + rsv_prev_mapping_frame_1.x_size and rsv_prev_y_pixel_1 + rsv_prev_mapping_frame_1.y_size in one instruction
765C A1C831           (./Engine/Graphics):00425 [5]     3729            cmpa  rsv_x1_pixel,u                ;     entry : x_pixel
765F 25E3             (./Engine/Graphics):00426 [3]     3732            blo   CSR_SubEraseSearchB1
7661 E1C832           (./Engine/Graphics):00427 [5]     3737            cmpb  rsv_y1_pixel,u                ;     entry : y_pixel
7664 25DE             (./Engine/Graphics):00428 [3]     3740            blo   CSR_SubEraseSearchB1
                      (./Engine/Graphics):00429                         
7666 109EF7           (./Engine/Graphics):00430 [6]     3746            ldy   <glb_cur_ptr_sub_obj_erase
7669 209B             (./Engine/Graphics):00431 [3]     3749            bra   CSR_SetEraseTrue              ; found a collision
                      (./Engine/Graphics):00432                 
766B                  (./Engine/Graphics):00433                 CSR_SubDrawSpriteSearchInit
766B 9EF5             (./Engine/Graphics):00434 [5]     3754            ldx   <glb_cur_ptr_sub_obj_draw
                      (./Engine/Graphics):00435                         
766D                  (./Engine/Graphics):00436                 CSR_SubDrawSearch
766D 8C734A           (./Engine/Graphics):00437 [4]     3758            cmpx  #Tbl_Sub_Object_Draw
7670 2723             (./Engine/Graphics):00438 [3]     3761            beq   CSR_SetEraseFalse             ; branch if no more sub objects
7672 10AE83           (./Engine/Graphics):00439 [9]     3770            ldy   ,--x
                      (./Engine/Graphics):00440                 
7675                  (./Engine/Graphics):00441                 CSR_SubDrawCheckCollision
7675 ECA831           (./Engine/Graphics):00442 [6]     3776            ldd   rsv_xy1_pixel,y               ; sub entry : x_pixel and y_pixel in one instruction
7678 A1C833           (./Engine/Graphics):00443 [5]     3781            cmpa  rsv_x2_pixel,u                ;     entry : x_pixel + rsv_mapping_frame.x_size
767B 22F0             (./Engine/Graphics):00444 [3]     3784            bhi   CSR_SubDrawSearch
767D E1C834           (./Engine/Graphics):00445 [5]     3789            cmpb  rsv_y2_pixel,u                ;     entry : y_pixel + rsv_mapping_frame.y_size
7680 22EB             (./Engine/Graphics):00446 [3]     3792            bhi   CSR_SubDrawSearch
7682 ECA833           (./Engine/Graphics):00447 [6]     3798            ldd   rsv_xy2_pixel,y               ; sub entry : x_pixel + rsv_mapping_frame.x_size and y_pixel + rsv_mapping_frame.y_size in one instruction
7685 A1C831           (./Engine/Graphics):00448 [5]     3803            cmpa  rsv_x1_pixel,u                ;     entry : x_pixel
7688 25E3             (./Engine/Graphics):00449 [3]     3806            blo   CSR_SubDrawSearch
768A E1C832           (./Engine/Graphics):00450 [5]     3811            cmpb  rsv_y1_pixel,u                ;     entry : y_pixel
768D 25DE             (./Engine/Graphics):00451 [3]     3814            blo   CSR_SubDrawSearch
                      (./Engine/Graphics):00452                         
768F 109EF7           (./Engine/Graphics):00453 [6]     3820            ldy   <glb_cur_ptr_sub_obj_erase
7692 7E7606           (./Engine/Graphics):00454 [4]     3824            jmp   CSR_SetEraseTrue              ; found a collision
                      (./Engine/Graphics):00455                 
7695                  (./Engine/Graphics):00456                 CSR_SetEraseFalse
7695 A6C822           (./Engine/Graphics):00457 [5]     3829            lda   rsv_render_flags,u 
7698 84FD             (./Engine/Graphics):00458 [2]     3831            anda  #^rsv_render_erasesprite_mask
769A A7C822           (./Engine/Graphics):00459 [5]     3836            sta   rsv_render_flags,u        
                      (./Engine/Graphics):00460                                
769D                  (./Engine/Graphics):00461                 CSR_CheckDraw
769D 8EFFFF           (./Engine/Graphics):00462 [3]     3839            ldx   #$FFFF                        ; dynamic restore x
76A0 A643             (./Engine/Graphics):00463 [5]     3844            lda   priority,u
76A2 91F9             (./Engine/Graphics):00464 [4]     3848            cmpa  <glb_cur_priority 
76A4 1026FE3F         (./Engine/Graphics):00465 [5+?]   3853            lbne  CSR_NextObject
                      (./Engine/Graphics):00466                         
76A8 109EF5           (./Engine/Graphics):00467 [6]     3859            ldy   <glb_cur_ptr_sub_obj_draw
                      (./Engine/Graphics):00468                         
76AB A6C822           (./Engine/Graphics):00469 [5]     3864            lda   rsv_render_flags,u
76AE 8408             (./Engine/Graphics):00470 [2]     3866            anda  #rsv_render_outofrange_mask
76B0 263F             (./Engine/Graphics):00471 [3]     3869            bne   CSR_SetDrawFalse              ; branch if object image is out of range
76B2 ECC828           (./Engine/Graphics):00472 [6]     3875            ldd   rsv_mapping_frame,u
76B5 273A             (./Engine/Graphics):00473 [3]     3878            beq   CSR_SetDrawFalse              ; branch if object have no image
76B7 A642             (./Engine/Graphics):00474 [5]     3883            lda   render_flags,u
76B9 8420             (./Engine/Graphics):00475 [2]     3885            anda  #render_hide_mask
76BB 2634             (./Engine/Graphics):00476 [3]     3888            bne   CSR_SetDrawFalse              ; branch if object is hidden
                      (./Engine/Graphics):00477                         
76BD                  (./Engine/Graphics):00478                 CSR_SetDrawTrue 
76BD A6C822           (./Engine/Graphics):00479 [5]     3893            lda   rsv_render_flags,u
76C0 8A04             (./Engine/Graphics):00480 [2]     3895            ora   #rsv_render_displaysprite_mask ; set displaysprite flag   
76C2 A7C822           (./Engine/Graphics):00481 [5]     3900            sta   rsv_render_flags,u         
                      (./Engine/Graphics):00482                         
76C5 8502             (./Engine/Graphics):00483 [2]     3902            bita  #rsv_render_erasesprite_mask
76C7 2702             (./Engine/Graphics):00484 [3]     3905            beq   CSR_SDT1
76C9 2007             (./Engine/Graphics):00485 [3]     3908            bra   CSR_SDT2
76CB                  (./Engine/Graphics):00486                 CSR_SDT1                      
76CB E68813           (./Engine/Graphics):00487 [5]     3913            ldb   buf_prev_render_flags,x
76CE 2B0C             (./Engine/Graphics):00488 [3]     3916            bmi   CSR_SetHide
76D0 2005             (./Engine/Graphics):00489 [3]     3919            bra   CSR_SDT3      
76D2                  (./Engine/Graphics):00490                 CSR_SDT2                      
76D2 E68813           (./Engine/Graphics):00491 [5]     3924            ldb   buf_prev_render_flags,x
76D5 2A05             (./Engine/Graphics):00492 [3]     3927            bpl   CSR_SetHide
76D7                  (./Engine/Graphics):00493                 CSR_SDT3
76D7 EFA1             (./Engine/Graphics):00494 [8]     3935            stu   ,y++
76D9 109FF5           (./Engine/Graphics):00495 [6]     3941            sty   <glb_cur_ptr_sub_obj_draw          ; maintain list of changing sprites to draw, should be to draw and ((on screen and to erase) or (not on screen and not to erase)) 
                      (./Engine/Graphics):00496                 
76DC                  (./Engine/Graphics):00497                 CSR_SetHide        
76DC A642             (./Engine/Graphics):00498 [5]     3946            lda   render_flags,u
76DE 8A20             (./Engine/Graphics):00499 [2]     3948            ora   #render_hide_mask             ; set hide flag
76E0 A742             (./Engine/Graphics):00500 [5]     3953            sta   render_flags,u        
                      (./Engine/Graphics):00501                         
76E2 EE03             (./Engine/Graphics):00502 [6]     3959            ldu   buf_priority_next_obj,x
76E4 1026FD79         (./Engine/Graphics):00503 [5+?]   3964            lbne  CSR_ProcessEachPriorityLevel   
76E8 39               (./Engine/Graphics):00504 [5]     3969            rts
                      (./Engine/Graphics):00505                 
76E9                  (./Engine/Graphics):00506                 CSR_SetEraseDrawFalse 
76E9 A6C822           (./Engine/Graphics):00507 [5]     3974            lda   rsv_render_flags,u 
76EC 84FD             (./Engine/Graphics):00508 [2]     3976            anda  #^rsv_render_erasesprite_mask
76EE A7C822           (./Engine/Graphics):00509 [5]     3981            sta   rsv_render_flags,u 
                      (./Engine/Graphics):00510                 
76F1                  (./Engine/Graphics):00511                 CSR_SetDrawFalse 
76F1 A6C822           (./Engine/Graphics):00512 [5]     3986            lda   rsv_render_flags,u
76F4 84FB             (./Engine/Graphics):00513 [2]     3988            anda  #^rsv_render_displaysprite_mask
76F6 A7C822           (./Engine/Graphics):00514 [5]     3993            sta   rsv_render_flags,u
                      (./Engine/Graphics):00515                         
76F9 EE03             (./Engine/Graphics):00516 [6]     3999            ldu   buf_priority_next_obj,x
76FB 1026FD62         (./Engine/Graphics):00517 [5+?]   4004            lbne   CSR_ProcessEachPriorityLevel   
76FF 39               (./Engine/Graphics):00518 [5]     4009            rts      
                      (C:\Users\bhrou\gi):00264                         INCLUDE "./Engine/Graphics/EraseSprites.asm"
                      (./Engine/Graphics):00001                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00002                 * EraseSprites
                      (./Engine/Graphics):00003                 * ------------
                      (./Engine/Graphics):00004                 * Subroutine to erase sprites on screen
                      (./Engine/Graphics):00005                 * Read Display Priority Structure (front to back)
                      (./Engine/Graphics):00006                 * priority: 0 - unregistred
                      (./Engine/Graphics):00007                 * priority: 1 - register non moving overlay sprite
                      (./Engine/Graphics):00008                 * priority; 2-8 - register moving sprite (2:front, ..., 8:back)  
                      (./Engine/Graphics):00009                 *
                      (./Engine/Graphics):00010                 * input REG : none
                      (./Engine/Graphics):00011                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00012                                                                                 
                      (./Engine/Graphics):00013                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00014                 * Background Backup Cells - BBC
                      (./Engine/Graphics):00015                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00016                 
                      (./Engine/Graphics):00017                 * ----- Cell variables
     0000             (./Engine/Graphics):00018                 nb_cells                      equ   0
     0001             (./Engine/Graphics):00019                 cell_start                    equ   1
     0003             (./Engine/Graphics):00020                 cell_end                      equ   3
     0005             (./Engine/Graphics):00021                 next_entry                    equ   5
     0007             (./Engine/Graphics):00022                 entry_size                    equ   7
                      (./Engine/Graphics):00023                 
                      (./Engine/Graphics):00024                 * ----- Cells List
     0080             (./Engine/Graphics):00025                 nb_free_cells                 equ   128
     0040             (./Engine/Graphics):00026                 cell_size                     equ   64     ; 64 bytes x 128 from $4000 to $5FFF
     6000             (./Engine/Graphics):00027                 cell_start_adr                equ   $6000
                      (./Engine/Graphics):00028                 
7700 7702             (./Engine/Graphics):00029                 Lst_FreeCellFirstEntry_0      fdb   Lst_FreeCell_0 ; Pointer to first entry in free cell list (buffer 0)
7702 80               (./Engine/Graphics):00030                 Lst_FreeCell_0                fcb   nb_free_cells ; init of first free cell
7703 4000             (./Engine/Graphics):00031                                               fdb   cell_start_adr-cell_size*nb_free_cells
7705 6000             (./Engine/Graphics):00032                                               fdb   cell_start_adr
7707 0000             (./Engine/Graphics):00033                                               fdb   $0000
7709 0000000000000000 (./Engine/Graphics):00034                                               fill  0,(entry_size*(nb_free_cells/2))-1 ; (buffer 0)
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     00000000000000
                      (./Engine/Graphics):00035                                               
78C8 78CA             (./Engine/Graphics):00036                 Lst_FreeCellFirstEntry_1      fdb   Lst_FreeCell_1 ; Pointer to first entry in free cell list (buffer 1)
78CA 80               (./Engine/Graphics):00037                 Lst_FreeCell_1                fcb   nb_free_cells ; init of first free cell
78CB 4000             (./Engine/Graphics):00038                                               fdb   cell_start_adr-cell_size*nb_free_cells
78CD 6000             (./Engine/Graphics):00039                                               fdb   cell_start_adr
78CF 0000             (./Engine/Graphics):00040                                               fdb   $0000
78D1 0000000000000000 (./Engine/Graphics):00041                                               fill  0,(entry_size*(nb_free_cells/2))-1 ; (buffer 1)                                                
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     00000000000000
                      (./Engine/Graphics):00042                                                                                            
7A90                  (./Engine/Graphics):00043                 EraseSprites
7A90 8600             (./Engine/Graphics):00044 [2]     4011            lda   #0
7A92 97E8             (./Engine/Graphics):00045 [4]     4015            sta   <glb_force_sprite_refresh
                      (./Engine/Graphics):00046                 
7A94                  (./Engine/Graphics):00047                 ESP_Start
7A94 B67040           (./Engine/Graphics):00048 [5]     4020            lda   glb_Cur_Wrk_Screen_Id         ; read current screen buffer for write operations
7A97 2669             (./Engine/Graphics):00049 [3]     4023            bne   ESP_P1B1
                      (./Engine/Graphics):00050                 
7A99                  (./Engine/Graphics):00051                 ESP_P1B0
7A99 FE725E           (./Engine/Graphics):00052 [6]     4029            ldu   DPS_buffer_0+buf_Tbl_Priority_Last_Entry+2 ; read DPS from priority 1 to priority 8
7A9C 2708             (./Engine/Graphics):00053 [3]     4032            beq   ESP_P2B0
7A9E 8601             (./Engine/Graphics):00054 [2]     4034            lda   #$01
7AA0 B77B6F           (./Engine/Graphics):00055 [5]     4039            sta   ESP_CheckPriorityB0+1        
7AA3 BD7B6B           (./Engine/Graphics):00056 [8]     4047            jsr   ESP_ProcessEachPriorityLevelB0
7AA6                  (./Engine/Graphics):00057                 ESP_P2B0
7AA6 FE7260           (./Engine/Graphics):00058 [6]     4053            ldu   DPS_buffer_0+buf_Tbl_Priority_Last_Entry+4
7AA9 2708             (./Engine/Graphics):00059 [3]     4056            beq   ESP_P3B0
7AAB 8602             (./Engine/Graphics):00060 [2]     4058            lda   #$02
7AAD B77B6F           (./Engine/Graphics):00061 [5]     4063            sta   ESP_CheckPriorityB0+1        
7AB0 BD7B6B           (./Engine/Graphics):00062 [8]     4071            jsr   ESP_ProcessEachPriorityLevelB0   
7AB3                  (./Engine/Graphics):00063                 ESP_P3B0
7AB3 FE7262           (./Engine/Graphics):00064 [6]     4077            ldu   DPS_buffer_0+buf_Tbl_Priority_Last_Entry+6
7AB6 2708             (./Engine/Graphics):00065 [3]     4080            beq   ESP_P4B0
7AB8 8603             (./Engine/Graphics):00066 [2]     4082            lda   #$03
7ABA B77B6F           (./Engine/Graphics):00067 [5]     4087            sta   ESP_CheckPriorityB0+1        
7ABD BD7B6B           (./Engine/Graphics):00068 [8]     4095            jsr   ESP_ProcessEachPriorityLevelB0   
7AC0                  (./Engine/Graphics):00069                 ESP_P4B0
7AC0 FE7264           (./Engine/Graphics):00070 [6]     4101            ldu   DPS_buffer_0+buf_Tbl_Priority_Last_Entry+8
7AC3 2708             (./Engine/Graphics):00071 [3]     4104            beq   ESP_P5B0
7AC5 8604             (./Engine/Graphics):00072 [2]     4106            lda   #$04
7AC7 B77B6F           (./Engine/Graphics):00073 [5]     4111            sta   ESP_CheckPriorityB0+1        
7ACA BD7B6B           (./Engine/Graphics):00074 [8]     4119            jsr   ESP_ProcessEachPriorityLevelB0   
7ACD                  (./Engine/Graphics):00075                 ESP_P5B0
7ACD FE7266           (./Engine/Graphics):00076 [6]     4125            ldu   DPS_buffer_0+buf_Tbl_Priority_Last_Entry+10
7AD0 2708             (./Engine/Graphics):00077 [3]     4128            beq   ESP_P6B0
7AD2 8605             (./Engine/Graphics):00078 [2]     4130            lda   #$05
7AD4 B77B6F           (./Engine/Graphics):00079 [5]     4135            sta   ESP_CheckPriorityB0+1        
7AD7 BD7B6B           (./Engine/Graphics):00080 [8]     4143            jsr   ESP_ProcessEachPriorityLevelB0               
7ADA                  (./Engine/Graphics):00081                 ESP_P6B0
7ADA FE7268           (./Engine/Graphics):00082 [6]     4149            ldu   DPS_buffer_0+buf_Tbl_Priority_Last_Entry+12
7ADD 2708             (./Engine/Graphics):00083 [3]     4152            beq   ESP_P7B0
7ADF 8606             (./Engine/Graphics):00084 [2]     4154            lda   #$06
7AE1 B77B6F           (./Engine/Graphics):00085 [5]     4159            sta   ESP_CheckPriorityB0+1        
7AE4 BD7B6B           (./Engine/Graphics):00086 [8]     4167            jsr   ESP_ProcessEachPriorityLevelB0      
7AE7                  (./Engine/Graphics):00087                 ESP_P7B0
7AE7 FE726A           (./Engine/Graphics):00088 [6]     4173            ldu   DPS_buffer_0+buf_Tbl_Priority_Last_Entry+14
7AEA 2708             (./Engine/Graphics):00089 [3]     4176            beq   ESP_P8B0
7AEC 8607             (./Engine/Graphics):00090 [2]     4178            lda   #$07
7AEE B77B6F           (./Engine/Graphics):00091 [5]     4183            sta   ESP_CheckPriorityB0+1        
7AF1 BD7B6B           (./Engine/Graphics):00092 [8]     4191            jsr   ESP_ProcessEachPriorityLevelB0  
7AF4                  (./Engine/Graphics):00093                 ESP_P8B0
7AF4 FE726C           (./Engine/Graphics):00094 [6]     4197            ldu   DPS_buffer_0+buf_Tbl_Priority_Last_Entry+16
7AF7 2708             (./Engine/Graphics):00095 [3]     4200            beq   ESP_rtsB0
7AF9 8608             (./Engine/Graphics):00096 [2]     4202            lda   #$08
7AFB B77B6F           (./Engine/Graphics):00097 [5]     4207            sta   ESP_CheckPriorityB0+1                   
7AFE BD7B6B           (./Engine/Graphics):00098 [8]     4215            jsr   ESP_ProcessEachPriorityLevelB0
7B01                  (./Engine/Graphics):00099                 ESP_rtsB0        
7B01 39               (./Engine/Graphics):00100 [5]     4220            rts
                      (./Engine/Graphics):00101                         
7B02                  (./Engine/Graphics):00102                 ESP_P1B1
7B02 FE72C0           (./Engine/Graphics):00103 [6]     4226            ldu   DPS_buffer_1+buf_Tbl_Priority_Last_Entry+2 ; read DPS from priority 1 to priority 8
7B05 2708             (./Engine/Graphics):00104 [3]     4229            beq   ESP_P2B1
7B07 8601             (./Engine/Graphics):00105 [2]     4231            lda   #$01
7B09 B77BE8           (./Engine/Graphics):00106 [5]     4236            sta   ESP_CheckPriorityB1+1        
7B0C BD7BE4           (./Engine/Graphics):00107 [8]     4244            jsr   ESP_ProcessEachPriorityLevelB1
7B0F                  (./Engine/Graphics):00108                 ESP_P2B1
7B0F FE72C2           (./Engine/Graphics):00109 [6]     4250            ldu   DPS_buffer_1+buf_Tbl_Priority_Last_Entry+4
7B12 2708             (./Engine/Graphics):00110 [3]     4253            beq   ESP_P3B1
7B14 8602             (./Engine/Graphics):00111 [2]     4255            lda   #$02
7B16 B77BE8           (./Engine/Graphics):00112 [5]     4260            sta   ESP_CheckPriorityB1+1        
7B19 BD7BE4           (./Engine/Graphics):00113 [8]     4268            jsr   ESP_ProcessEachPriorityLevelB1   
7B1C                  (./Engine/Graphics):00114                 ESP_P3B1
7B1C FE72C4           (./Engine/Graphics):00115 [6]     4274            ldu   DPS_buffer_1+buf_Tbl_Priority_Last_Entry+6
7B1F 2708             (./Engine/Graphics):00116 [3]     4277            beq   ESP_P4B1
7B21 8603             (./Engine/Graphics):00117 [2]     4279            lda   #$03
7B23 B77BE8           (./Engine/Graphics):00118 [5]     4284            sta   ESP_CheckPriorityB1+1        
7B26 BD7BE4           (./Engine/Graphics):00119 [8]     4292            jsr   ESP_ProcessEachPriorityLevelB1   
7B29                  (./Engine/Graphics):00120                 ESP_P4B1
7B29 FE72C6           (./Engine/Graphics):00121 [6]     4298            ldu   DPS_buffer_1+buf_Tbl_Priority_Last_Entry+8
7B2C 2708             (./Engine/Graphics):00122 [3]     4301            beq   ESP_P5B1
7B2E 8604             (./Engine/Graphics):00123 [2]     4303            lda   #$04
7B30 B77BE8           (./Engine/Graphics):00124 [5]     4308            sta   ESP_CheckPriorityB1+1        
7B33 BD7BE4           (./Engine/Graphics):00125 [8]     4316            jsr   ESP_ProcessEachPriorityLevelB1   
7B36                  (./Engine/Graphics):00126                 ESP_P5B1
7B36 FE72C8           (./Engine/Graphics):00127 [6]     4322            ldu   DPS_buffer_1+buf_Tbl_Priority_Last_Entry+10
7B39 2708             (./Engine/Graphics):00128 [3]     4325            beq   ESP_P6B1
7B3B 8605             (./Engine/Graphics):00129 [2]     4327            lda   #$05
7B3D B77BE8           (./Engine/Graphics):00130 [5]     4332            sta   ESP_CheckPriorityB1+1        
7B40 BD7BE4           (./Engine/Graphics):00131 [8]     4340            jsr   ESP_ProcessEachPriorityLevelB1               
7B43                  (./Engine/Graphics):00132                 ESP_P6B1
7B43 FE72CA           (./Engine/Graphics):00133 [6]     4346            ldu   DPS_buffer_1+buf_Tbl_Priority_Last_Entry+12
7B46 2708             (./Engine/Graphics):00134 [3]     4349            beq   ESP_P7B1
7B48 8606             (./Engine/Graphics):00135 [2]     4351            lda   #$06
7B4A B77BE8           (./Engine/Graphics):00136 [5]     4356            sta   ESP_CheckPriorityB1+1        
7B4D BD7BE4           (./Engine/Graphics):00137 [8]     4364            jsr   ESP_ProcessEachPriorityLevelB1      
7B50                  (./Engine/Graphics):00138                 ESP_P7B1
7B50 FE72CC           (./Engine/Graphics):00139 [6]     4370            ldu   DPS_buffer_1+buf_Tbl_Priority_Last_Entry+14
7B53 2708             (./Engine/Graphics):00140 [3]     4373            beq   ESP_P8B1
7B55 8607             (./Engine/Graphics):00141 [2]     4375            lda   #$07
7B57 B77BE8           (./Engine/Graphics):00142 [5]     4380            sta   ESP_CheckPriorityB1+1        
7B5A BD7BE4           (./Engine/Graphics):00143 [8]     4388            jsr   ESP_ProcessEachPriorityLevelB1  
7B5D                  (./Engine/Graphics):00144                 ESP_P8B1
7B5D FE72CE           (./Engine/Graphics):00145 [6]     4394            ldu   DPS_buffer_1+buf_Tbl_Priority_Last_Entry+16
7B60 2708             (./Engine/Graphics):00146 [3]     4397            beq   ESP_rtsB1
7B62 8608             (./Engine/Graphics):00147 [2]     4399            lda   #$08
7B64 B77BE8           (./Engine/Graphics):00148 [5]     4404            sta   ESP_CheckPriorityB1+1        
7B67 BD7BE4           (./Engine/Graphics):00149 [8]     4412            jsr   ESP_ProcessEachPriorityLevelB1
7B6A                  (./Engine/Graphics):00150                 ESP_rtsB1        
7B6A 39               (./Engine/Graphics):00151 [5]     4417            rts
                      (./Engine/Graphics):00152                 
                      (./Engine/Graphics):00153                 * -----------------------------------------------
                      (./Engine/Graphics):00154                 * BUFFER0
                      (./Engine/Graphics):00155                 * -----------------------------------------------
                      (./Engine/Graphics):00156                 
7B6B                  (./Engine/Graphics):00157                 ESP_ProcessEachPriorityLevelB0
7B6B A6C835           (./Engine/Graphics):00158 [5]     4422            lda   rsv_priority_0,u
                      (./Engine/Graphics):00159                         
7B6E                  (./Engine/Graphics):00160                 ESP_CheckPriorityB0
7B6E 8100             (./Engine/Graphics):00161 [2]     4424            cmpa  #0                            ; dynamic current priority
7B70 10260068         (./Engine/Graphics):00162 [5+?]   4429            lbne   ESP_NextObjectB0             ; do not process this entry (case of priority change)
                      (./Engine/Graphics):00163                         
7B74                  (./Engine/Graphics):00164                 ESP_UnsetCheckRefreshB0
7B74 A6C822           (./Engine/Graphics):00165 [5]     4434            lda   rsv_render_flags,u
7B77 E642             (./Engine/Graphics):00166 [5]     4439            ldb   render_flags,u
7B79 C408             (./Engine/Graphics):00167 [2]     4441            andb  #render_motionless_mask
7B7B 2605             (./Engine/Graphics):00168 [3]     4444            bne   ESP_CheckEraseB0
7B7D 84FE             (./Engine/Graphics):00169 [2]     4446            anda  #^rsv_render_checkrefresh_mask ; unset checkrefresh flag
7B7F A7C822           (./Engine/Graphics):00170 [5]     4451            sta   rsv_render_flags,u        
                      (./Engine/Graphics):00171                         
7B82                  (./Engine/Graphics):00172                 ESP_CheckEraseB0
7B82 8402             (./Engine/Graphics):00173 [2]     4453            anda  #rsv_render_erasesprite_mask
7B84 10270054         (./Engine/Graphics):00174 [5+?]   4458            lbeq   ESP_NextObjectB0
7B88 E6C848           (./Engine/Graphics):00175 [5]     4463            ldb   rsv_prev_render_flags_0,u
7B8B C401             (./Engine/Graphics):00176 [2]     4465            andb  #rsv_prev_render_overlay_mask
7B8D 263D             (./Engine/Graphics):00177 [3]     4468            bne   ESP_UnsetOnScreenFlagB0
                      (./Engine/Graphics):00178                         
7B8F                  (./Engine/Graphics):00179                 ESP_CallEraseRoutineB0
7B8F A6C83D           (./Engine/Graphics):00180 [5]     4473            lda   rsv_prev_page_erase_routine_0,u
                      (./Engine/Graphics):00181                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
7B92 BD6F74           (    _SetCartPageA):00002 [8]     4481            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
7B95 AEC83E           (./Engine/Graphics):00182 [6]     4487            ldx   rsv_prev_erase_routine_0,u
7B98 FF7BA4           (./Engine/Graphics):00183 [6]     4493            stu   ESP_CallEraseRoutineB0_00+1   ; backup u (pointer to object)                
7B9B EEC840           (./Engine/Graphics):00184 [6]     4499            ldu   rsv_bgdata_0,u                ; cell_start background data        
7B9E AD84             (./Engine/Graphics):00185 [7]     4506            jsr   ,x                            ; erase sprite on working screen buffer
7BA0 FF7C60           (./Engine/Graphics):00186 [6]     4512            stu   BBF_cell_end                  ; cell_end background data as parameter to BBF
7BA3                  (./Engine/Graphics):00187                 ESP_CallEraseRoutineB0_00        
7BA3 CE0000           (./Engine/Graphics):00188 [3]     4515            ldu   #$0000                        ; restore u (pointer to object)
7BA6 ECC840           (./Engine/Graphics):00189 [6]     4521            ldd   rsv_bgdata_0,u                ; cell_start
7BA9 830010           (./Engine/Graphics):00190 [4]     4525            subd  #16
7BAC C4C0             (./Engine/Graphics):00191 [2]     4527            andb  #256-cell_size                ; round cell_start to cell size
7BAE FD7C5E           (./Engine/Graphics):00192 [6]     4533            std   BBF_cell_start                ; cell_start rounded stored in x
                      (./Engine/Graphics):00193                                         
7BB1                  (./Engine/Graphics):00194                 ESP_FreeEraseBufferB0
7BB1 A6C83C           (./Engine/Graphics):00195 [5]     4538            lda   rsv_prev_erase_nb_cell_0,u     ; get nb of cell to free
7BB4 B77C5D           (./Engine/Graphics):00196 [5]     4543            sta   BBF_nb_cells
7BB7 FF7CF3           (./Engine/Graphics):00197 [6]     4549            stu   BBF_rts+1
7BBA CE7702           (./Engine/Graphics):00198 [3]     4552            ldu   #Lst_FreeCell_0
7BBD FF7CD1           (./Engine/Graphics):00199 [6]     4558            stu   BBF_AddNewEntry+1
7BC0 CE7700           (./Engine/Graphics):00200 [3]     4561            ldu   #Lst_FreeCellFirstEntry_0        
7BC3 FF7CF0           (./Engine/Graphics):00201 [6]     4567            stu   BBF_SetNewEntryPrevLink+1     ; init prev address destination as Lst_FreeCellFirstEntry                
7BC6 FE7700           (./Engine/Graphics):00202 [6]     4573            ldu   Lst_FreeCellFirstEntry_0      ; load first cell for screen buffer 0
7BC9 BD7C64           (./Engine/Graphics):00203 [8]     4581            jsr   BgBufferFree                  ; free background data in memory
                      (./Engine/Graphics):00204                         
7BCC                  (./Engine/Graphics):00205                 ESP_UnsetOnScreenFlagB0
7BCC A6C848           (./Engine/Graphics):00206 [5]     4586            lda   rsv_prev_render_flags_0,u
7BCF 847F             (./Engine/Graphics):00207 [2]     4588            anda  #^rsv_prev_render_onscreen_mask ; sprite is no longer on screen
7BD1 A7C848           (./Engine/Graphics):00208 [5]     4593            sta   rsv_prev_render_flags_0,u
7BD4 A6C822           (./Engine/Graphics):00209 [5]     4598            lda   rsv_render_flags,u
7BD7 847F             (./Engine/Graphics):00210 [2]     4600            anda  #^rsv_render_onscreen_mask      ; sprite is no longer on screen
7BD9 A7C822           (./Engine/Graphics):00211 [5]     4605            sta   rsv_render_flags,u
                      (./Engine/Graphics):00212                 
7BDC                  (./Engine/Graphics):00213                 ESP_NextObjectB0
7BDC EEC836           (./Engine/Graphics):00214 [6]     4611            ldu   rsv_priority_prev_obj_0,u
7BDF 1026FF88         (./Engine/Graphics):00215 [5+?]   4616            lbne   ESP_ProcessEachPriorityLevelB0   
7BE3 39               (./Engine/Graphics):00216 [5]     4621            rts      
                      (./Engine/Graphics):00217                 
                      (./Engine/Graphics):00218                 * -----------------------------------------------        
                      (./Engine/Graphics):00219                 * BUFFER1
                      (./Engine/Graphics):00220                 * -----------------------------------------------        
                      (./Engine/Graphics):00221                                 
7BE4                  (./Engine/Graphics):00222                 ESP_ProcessEachPriorityLevelB1
7BE4 A6C849           (./Engine/Graphics):00223 [5]     4626            lda   rsv_priority_1,u
                      (./Engine/Graphics):00224                         
7BE7                  (./Engine/Graphics):00225                 ESP_CheckPriorityB1
7BE7 8100             (./Engine/Graphics):00226 [2]     4628            cmpa  #0                            ; dynamic current priority
7BE9 10260068         (./Engine/Graphics):00227 [5+?]   4633            lbne   ESP_NextObjectB1             ; do not process this entry (case of priority change)
                      (./Engine/Graphics):00228                         
7BED                  (./Engine/Graphics):00229                 ESP_UnsetCheckRefreshB1
7BED A6C822           (./Engine/Graphics):00230 [5]     4638            lda   rsv_render_flags,u
7BF0 E642             (./Engine/Graphics):00231 [5]     4643            ldb   render_flags,u
7BF2 C408             (./Engine/Graphics):00232 [2]     4645            andb  #render_motionless_mask
7BF4 2605             (./Engine/Graphics):00233 [3]     4648            bne   ESP_CheckEraseB1
7BF6 84FE             (./Engine/Graphics):00234 [2]     4650            anda  #^rsv_render_checkrefresh_mask ; unset checkrefresh flag (CheckSpriteRefresh)
7BF8 A7C822           (./Engine/Graphics):00235 [5]     4655            sta   rsv_render_flags,u        
                      (./Engine/Graphics):00236                         
7BFB                  (./Engine/Graphics):00237                 ESP_CheckEraseB1
7BFB 8402             (./Engine/Graphics):00238 [2]     4657            anda  #rsv_render_erasesprite_mask
7BFD 10270054         (./Engine/Graphics):00239 [5+?]   4662            lbeq   ESP_NextObjectB1
7C01 E6C85C           (./Engine/Graphics):00240 [5]     4667            ldb   rsv_prev_render_flags_1,u
7C04 C401             (./Engine/Graphics):00241 [2]     4669            andb  #rsv_prev_render_overlay_mask
7C06 263D             (./Engine/Graphics):00242 [3]     4672            bne   ESP_UnsetOnScreenFlagB1        
                      (./Engine/Graphics):00243                         
7C08                  (./Engine/Graphics):00244                 ESP_CallEraseRoutineB1
7C08 A6C851           (./Engine/Graphics):00245 [5]     4677            lda   rsv_prev_page_erase_routine_1,u
                      (./Engine/Graphics):00246                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
7C0B BD6F74           (    _SetCartPageA):00002 [8]     4685            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
7C0E AEC852           (./Engine/Graphics):00247 [6]     4691            ldx   rsv_prev_erase_routine_1,u
7C11 FF7C1D           (./Engine/Graphics):00248 [6]     4697            stu   ESP_CallEraseRoutineB1_00+1   ; backup u (pointer to object)                
7C14 EEC854           (./Engine/Graphics):00249 [6]     4703            ldu   rsv_bgdata_1,u                ; cell_start background data        
7C17 AD84             (./Engine/Graphics):00250 [7]     4710            jsr   ,x                            ; erase sprite on working screen buffer
7C19 FF7C60           (./Engine/Graphics):00251 [6]     4716            stu   BBF_cell_end                  ; cell_end background data as parameter to BBF
7C1C                  (./Engine/Graphics):00252                 ESP_CallEraseRoutineB1_00        
7C1C CE0000           (./Engine/Graphics):00253 [3]     4719            ldu   #$0000                        ; restore u (pointer to object)
7C1F ECC854           (./Engine/Graphics):00254 [6]     4725            ldd   rsv_bgdata_1,u                ; cell_start
7C22 830010           (./Engine/Graphics):00255 [4]     4729            subd  #16
7C25 C4C0             (./Engine/Graphics):00256 [2]     4731            andb  #256-cell_size                ; round cell_start to cell size
7C27 FD7C5E           (./Engine/Graphics):00257 [6]     4737            std   BBF_cell_start                ; cell_start rounded stored in x
                      (./Engine/Graphics):00258                                         
7C2A                  (./Engine/Graphics):00259                 ESP_FreeEraseBufferB1
7C2A A6C850           (./Engine/Graphics):00260 [5]     4742            lda   rsv_prev_erase_nb_cell_1,u       
7C2D B77C5D           (./Engine/Graphics):00261 [5]     4747            sta   BBF_nb_cells         
7C30 FF7CF3           (./Engine/Graphics):00262 [6]     4753            stu   BBF_rts+1
7C33 CE78CA           (./Engine/Graphics):00263 [3]     4756            ldu   #Lst_FreeCell_1
7C36 FF7CD1           (./Engine/Graphics):00264 [6]     4762            stu   BBF_AddNewEntry+1
7C39 CE78C8           (./Engine/Graphics):00265 [3]     4765            ldu   #Lst_FreeCellFirstEntry_1        
7C3C FF7CF0           (./Engine/Graphics):00266 [6]     4771            stu   BBF_SetNewEntryPrevLink+1          
7C3F FE78C8           (./Engine/Graphics):00267 [6]     4777            ldu   Lst_FreeCellFirstEntry_1
7C42 BD7C64           (./Engine/Graphics):00268 [8]     4785            jsr   BgBufferFree                  ; free background data in memory
                      (./Engine/Graphics):00269                         
7C45                  (./Engine/Graphics):00270                 ESP_UnsetOnScreenFlagB1
7C45 A6C85C           (./Engine/Graphics):00271 [5]     4790            lda   rsv_prev_render_flags_1,u
7C48 847F             (./Engine/Graphics):00272 [2]     4792            anda  #^rsv_prev_render_onscreen_mask ; sprite is no longer on screen 
7C4A A7C85C           (./Engine/Graphics):00273 [5]     4797            sta   rsv_prev_render_flags_1,u
7C4D A6C822           (./Engine/Graphics):00274 [5]     4802            lda   rsv_render_flags,u
7C50 847F             (./Engine/Graphics):00275 [2]     4804            anda  #^rsv_render_onscreen_mask      ; sprite is no longer on screen
7C52 A7C822           (./Engine/Graphics):00276 [5]     4809            sta   rsv_render_flags,u
                      (./Engine/Graphics):00277                         
7C55                  (./Engine/Graphics):00278                 ESP_NextObjectB1
7C55 EEC84A           (./Engine/Graphics):00279 [6]     4815            ldu   rsv_priority_prev_obj_1,u
7C58 1026FF88         (./Engine/Graphics):00280 [5+?]   4820            lbne   ESP_ProcessEachPriorityLevelB1   
7C5C 39               (./Engine/Graphics):00281 [5]     4825            rts
                      (./Engine/Graphics):00282                         
                      (./Engine/Graphics):00283                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00284                 * BgBufferFree
                      (./Engine/Graphics):00285                 * ------------
                      (./Engine/Graphics):00286                 * Subroutine to free memory from background buffer
                      (./Engine/Graphics):00287                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00288                      
7C5D 00               (./Engine/Graphics):00289                 BBF_nb_cells   fcb   $00
7C5E 0000             (./Engine/Graphics):00290                 BBF_cell_start fdb   $0000
7C60 0000             (./Engine/Graphics):00291                 BBF_cell_end   fdb   $0000       
7C62 0000             (./Engine/Graphics):00292                 BBF_prev       fdb   $0000
                      (./Engine/Graphics):00293                 
                      (./Engine/Graphics):00294                         ; search position of the new free cells in the linked list
                      (./Engine/Graphics):00295                         ; linked list is ordered by cell_end (address) descending
                      (./Engine/Graphics):00296                         ; starting at Lst_FreeCellFirstEntry_x
                      (./Engine/Graphics):00297                         ; ----------------------------------------------------------
                      (./Engine/Graphics):00298                 
7C64                  (./Engine/Graphics):00299                 BgBufferFree        
7C64 2764             (./Engine/Graphics):00300 [3]     4828            beq   BBF_AddLastEntry
7C66                  (./Engine/Graphics):00301                 BBF_SearchPos 
7C66 AE43             (./Engine/Graphics):00302 [6]     4834            ldx   cell_end,u
7C68 BC7C60           (./Engine/Graphics):00303 [7]     4841            cmpx  BBF_cell_end
7C6B 2510             (./Engine/Graphics):00304 [3]     4844            blo   BBF_CombineNext
7C6D FF7C62           (./Engine/Graphics):00305 [6]     4850            stu   BBF_prev
7C70 EC45             (./Engine/Graphics):00306 [6]     4856            ldd   next_entry,u                  ; test next entry
7C72 273B             (./Engine/Graphics):00307 [3]     4859            beq   BBF_CombinePrevNoNext
7C74 3045             (./Engine/Graphics):00308 [5]     4864            leax  next_entry,u                  ; there is a next entry, save next_entry position
7C76 BF7CF0           (./Engine/Graphics):00309 [6]     4870            stx   BBF_SetNewEntryPrevLink+1   
7C79 EE45             (./Engine/Graphics):00310 [6]     4876            ldu   next_entry,u                  ; move to next entry        
7C7B 20E9             (./Engine/Graphics):00311 [3]     4879            bra   BBF_SearchPos        
                      (./Engine/Graphics):00312                         
                      (./Engine/Graphics):00313                         ; try to combine with next block
                      (./Engine/Graphics):00314                         ; ----------------------------------------------------------        
                      (./Engine/Graphics):00315                         
7C7D                  (./Engine/Graphics):00316                 BBF_CombineNext
7C7D FF7CEB           (./Engine/Graphics):00317 [6]     4885            stu   BBF_SetNewEntryNextentry+1
7C80 BE7C5E           (./Engine/Graphics):00318 [6]     4891            ldx   BBF_cell_start
7C83 AC43             (./Engine/Graphics):00319 [7]     4898            cmpx  cell_end,u
7C85 262E             (./Engine/Graphics):00320 [3]     4901            bne   BBF_CombinePrev
7C87 BE7C60           (./Engine/Graphics):00321 [6]     4907            ldx   BBF_cell_end
7C8A AF43             (./Engine/Graphics):00322 [6]     4913            stx   cell_end,u
7C8C A6C4             (./Engine/Graphics):00323 [4]     4917            lda   nb_cells,u
7C8E BB7C5D           (./Engine/Graphics):00324 [5]     4922            adda  BBF_nb_cells
7C91 A7C4             (./Engine/Graphics):00325 [4]     4926            sta   nb_cells,u
                      (./Engine/Graphics):00326                         
7C93                  (./Engine/Graphics):00327                 BBF_CombineNextAndPrev
7C93 10BE7C62         (./Engine/Graphics):00328 [7]     4933            ldy   BBF_prev
7C97 AC21             (./Engine/Graphics):00329 [7]     4940            cmpx  cell_start,y
7C99 2657             (./Engine/Graphics):00330 [3]     4943            bne   BBF_rts
7C9B AE41             (./Engine/Graphics):00331 [6]     4949            ldx   cell_start,u
7C9D AF21             (./Engine/Graphics):00332 [6]     4955            stx   cell_start,y
7C9F A6C4             (./Engine/Graphics):00333 [4]     4959            lda   nb_cells,u        
7CA1 ABA4             (./Engine/Graphics):00334 [4]     4963            adda  nb_cells,y
7CA3 A7A4             (./Engine/Graphics):00335 [4]     4967            sta   nb_cells,y
7CA5 EC45             (./Engine/Graphics):00336 [6]     4973            ldd   next_entry,u
7CA7 ED25             (./Engine/Graphics):00337 [6]     4979            std   next_entry,y
7CA9 8600             (./Engine/Graphics):00338 [2]     4981            lda   #$00
7CAB A7C4             (./Engine/Graphics):00339 [4]     4985            sta   nb_cells,u                    ; delete the entry
7CAD 2043             (./Engine/Graphics):00340 [3]     4988            bra   BBF_rts
                      (./Engine/Graphics):00341                                 
                      (./Engine/Graphics):00342                         ; try to combine with prev block 
                      (./Engine/Graphics):00343                         ; ----------------------------------------------------------      
                      (./Engine/Graphics):00344                         
7CAF                  (./Engine/Graphics):00345                 BBF_CombinePrevNoNext
7CAF CC0000           (./Engine/Graphics):00346 [3]     4991            ldd   #$0000
7CB2 FD7CEB           (./Engine/Graphics):00347 [6]     4997            std   BBF_SetNewEntryNextentry+1
7CB5                  (./Engine/Graphics):00348                 BBF_CombinePrev
7CB5 BE7C60           (./Engine/Graphics):00349 [6]     5003            ldx   BBF_cell_end
7CB8 AC41             (./Engine/Graphics):00350 [7]     5010            cmpx  cell_start,u
7CBA 2614             (./Engine/Graphics):00351 [3]     5013            bne   BBF_AddNewEntry
7CBC BE7C5E           (./Engine/Graphics):00352 [6]     5019            ldx   BBF_cell_start
7CBF AF41             (./Engine/Graphics):00353 [6]     5025            stx   cell_start,u
7CC1 A6C4             (./Engine/Graphics):00354 [4]     5029            lda   nb_cells,u        
7CC3 BB7C5D           (./Engine/Graphics):00355 [5]     5034            adda  BBF_nb_cells
7CC6 A7C4             (./Engine/Graphics):00356 [4]     5038            sta   nb_cells,u
7CC8 2028             (./Engine/Graphics):00357 [3]     5041            bra   BBF_rts   
                      (./Engine/Graphics):00358                 
                      (./Engine/Graphics):00359                         ; Add New Entry
                      (./Engine/Graphics):00360                         ; ----------------------------------------------------------
                      (./Engine/Graphics):00361                         
7CCA                  (./Engine/Graphics):00362                 BBF_AddLastEntry
7CCA CC0000           (./Engine/Graphics):00363 [3]     5044            ldd   #$0000
7CCD FD7CEB           (./Engine/Graphics):00364 [6]     5050            std   BBF_SetNewEntryNextentry+1        
7CD0                  (./Engine/Graphics):00365                 BBF_AddNewEntry
7CD0 CE0000           (./Engine/Graphics):00366 [3]     5053            ldu   #$0000                        ; (dynamic) start of linked list data index
7CD3                  (./Engine/Graphics):00367                 BBF_FindFreeSlot
7CD3 E6C4             (./Engine/Graphics):00368 [4]     5057            ldb   nb_cells,u                    ; read Lst_FreeCell as a table (not a linked list)
7CD5 2704             (./Engine/Graphics):00369 [3]     5060            beq   BBF_SetNewEntry               ; branch if empty entry
7CD7 3347             (./Engine/Graphics):00370 [5]     5065            leau  entry_size,u                  ; move to next entry
7CD9 20F8             (./Engine/Graphics):00371 [3]     5068            bra   BBF_FindFreeSlot              ; loop             
                      (./Engine/Graphics):00372                 
7CDB                  (./Engine/Graphics):00373                 BBF_SetNewEntry        
7CDB B67C5D           (./Engine/Graphics):00374 [5]     5073            lda   BBF_nb_cells              
7CDE A7C4             (./Engine/Graphics):00375 [4]     5077            sta   nb_cells,u                    ; store released cells
7CE0 FC7C5E           (./Engine/Graphics):00376 [6]     5083            ldd   BBF_cell_start
7CE3 ED41             (./Engine/Graphics):00377 [6]     5089            std   cell_start,u                  ; store cell start adress
7CE5 FC7C60           (./Engine/Graphics):00378 [6]     5095            ldd   BBF_cell_end
7CE8 ED43             (./Engine/Graphics):00379 [6]     5101            std   cell_end,u                    ; store cell end adress
                      (./Engine/Graphics):00380                         
7CEA                  (./Engine/Graphics):00381                 BBF_SetNewEntryNextentry        
7CEA CC0000           (./Engine/Graphics):00382 [3]     5104            ldd   #$0000                        ; (dynamic) value is dynamically set
7CED ED45             (./Engine/Graphics):00383 [6]     5110            std   next_entry,u                  ; link to 0000 if no more entry or next_entry
                      (./Engine/Graphics):00384                         
7CEF                  (./Engine/Graphics):00385                 BBF_SetNewEntryPrevLink        
7CEF FFFFFF           (./Engine/Graphics):00386 [6]     5116            stu   $FFFF                         ; (dynamic) set Lst_FreeCellFirstEntry or prev_entry.next_entry with new entry
                      (./Engine/Graphics):00387                         
7CF2                  (./Engine/Graphics):00388                 BBF_rts
7CF2 CE0000           (./Engine/Graphics):00389 [3]     5119            ldu   #$0000
7CF5 39               (./Engine/Graphics):00390 [5]     5124            rts
                      (./Engine/Graphics):00391                                 
                      (C:\Users\bhrou\gi):00265                         INCLUDE "./Engine/Graphics/UnsetDisplayPriority.asm"
                      (./Engine/Graphics):00001                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00002                 * UnsetDisplayPriority
                      (./Engine/Graphics):00003                 * --------------------
                      (./Engine/Graphics):00004                 * Subroutine to unset sprites in Display Sprite Priority structure
                      (./Engine/Graphics):00005                 * Read Lst_Priority_Unset_0/1
                      (./Engine/Graphics):00006                 *
                      (./Engine/Graphics):00007                 * input REG : none
                      (./Engine/Graphics):00008                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00009                                                                                            
7CF6                  (./Engine/Graphics):00010                 UnsetDisplayPriority
                      (./Engine/Graphics):00011                 
7CF6                  (./Engine/Graphics):00012                 UDP_Start
7CF6 B67040           (./Engine/Graphics):00013 [5]     5129            lda   glb_Cur_Wrk_Screen_Id         ; read current screen buffer for write operations
7CF9 266D             (./Engine/Graphics):00014 [3]     5132            bne   UDP_B1
                      (./Engine/Graphics):00015                         
7CFB                  (./Engine/Graphics):00016                 UDP_B0                                    
7CFB 8E7270           (./Engine/Graphics):00017 [3]     5135            ldx   #Lst_Priority_Unset_0+2
                      (./Engine/Graphics):00018                         
7CFE                  (./Engine/Graphics):00019                 UDP_CheckEndB0        
7CFE BC726E           (./Engine/Graphics):00020 [7]     5142            cmpx  Lst_Priority_Unset_0          ; end of priority unset list
7D01 2607             (./Engine/Graphics):00021 [3]     5145            bne   UDP_CheckPrioPrevB0
                      (./Engine/Graphics):00022                         
7D03                  (./Engine/Graphics):00023                 UDP_InitListB0      
7D03 8E7270           (./Engine/Graphics):00024 [3]     5148            ldx   #Lst_Priority_Unset_0+2 
7D06 BF726E           (./Engine/Graphics):00025 [6]     5154            stx   Lst_Priority_Unset_0          ; set Lst_Priority_Unset_0 index
7D09 39               (./Engine/Graphics):00026 [5]     5159            rts
                      (./Engine/Graphics):00027                         
7D0A                  (./Engine/Graphics):00028                 UDP_CheckPrioPrevB0
7D0A EE81             (./Engine/Graphics):00029 [8]     5167            ldu   ,x++
7D0C ECC836           (./Engine/Graphics):00030 [6]     5173            ldd   rsv_priority_prev_obj_0,u
7D0F 2611             (./Engine/Graphics):00031 [3]     5176            bne   UDP_ChainPrevB0
                      (./Engine/Graphics):00032                         
7D11 A6C835           (./Engine/Graphics):00033 [5]     5181            lda   rsv_priority_0,u
7D14 48               (./Engine/Graphics):00034 [2]     5183            lsla
7D15 108E724A         (./Engine/Graphics):00035 [4]     5187            ldy   #Tbl_Priority_First_Entry_0
7D19 31A6             (./Engine/Graphics):00036 [5]     5192            leay  a,y
7D1B ECC838           (./Engine/Graphics):00037 [6]     5198            ldd   rsv_priority_next_obj_0,u
7D1E EDA4             (./Engine/Graphics):00038 [5]     5203            std   ,y
7D20 200A             (./Engine/Graphics):00039 [3]     5206            bra   UDP_CheckPrioNextB0
                      (./Engine/Graphics):00040                                 
7D22                  (./Engine/Graphics):00041                 UDP_ChainPrevB0
7D22 ECC838           (./Engine/Graphics):00042 [6]     5212            ldd   rsv_priority_next_obj_0,u
7D25 10AEC836         (./Engine/Graphics):00043 [7]     5219            ldy   rsv_priority_prev_obj_0,u        
7D29 EDA838           (./Engine/Graphics):00044 [6]     5225            std   rsv_priority_next_obj_0,y        
                      (./Engine/Graphics):00045                 
7D2C                  (./Engine/Graphics):00046                 UDP_CheckPrioNextB0       
7D2C ECC838           (./Engine/Graphics):00047 [6]     5231            ldd   rsv_priority_next_obj_0,u
7D2F 2611             (./Engine/Graphics):00048 [3]     5234            bne   UDP_ChainNextB0
                      (./Engine/Graphics):00049                 
7D31 A6C835           (./Engine/Graphics):00050 [5]     5239            lda   rsv_priority_0,u
7D34 48               (./Engine/Graphics):00051 [2]     5241            lsla
7D35 108E725C         (./Engine/Graphics):00052 [4]     5245            ldy   #Tbl_Priority_Last_Entry_0
7D39 31A6             (./Engine/Graphics):00053 [5]     5250            leay  a,y
7D3B ECC836           (./Engine/Graphics):00054 [6]     5256            ldd   rsv_priority_prev_obj_0,u
7D3E EDA4             (./Engine/Graphics):00055 [5]     5261            std   ,y
7D40 200A             (./Engine/Graphics):00056 [3]     5264            bra   UDP_CheckDeleteB0
                      (./Engine/Graphics):00057                                 
7D42                  (./Engine/Graphics):00058                 UDP_ChainNextB0
7D42 ECC836           (./Engine/Graphics):00059 [6]     5270            ldd   rsv_priority_prev_obj_0,u
7D45 10AEC838         (./Engine/Graphics):00060 [7]     5277            ldy   rsv_priority_next_obj_0,u        
7D49 EDA836           (./Engine/Graphics):00061 [6]     5283            std   rsv_priority_prev_obj_0,y
                      (./Engine/Graphics):00062                         
7D4C                  (./Engine/Graphics):00063                 UDP_CheckDeleteB0
7D4C A642             (./Engine/Graphics):00064 [5]     5288            lda   render_flags,u
7D4E 8440             (./Engine/Graphics):00065 [2]     5290            anda  #render_todelete_mask
7D50 270F             (./Engine/Graphics):00066 [3]     5293            beq   UDP_SetNewPrioB0
7D52 A6C848           (./Engine/Graphics):00067 [5]     5298            lda   rsv_prev_render_flags_0,u
7D55 2B0A             (./Engine/Graphics):00068 [3]     5301            bmi   UDP_SetNewPrioB0
7D57 A6C85C           (./Engine/Graphics):00069 [5]     5306            lda   rsv_prev_render_flags_1,u
7D5A 2B05             (./Engine/Graphics):00070 [3]     5309            bmi   UDP_SetNewPrioB0
7D5C BD8166           (./Engine/Graphics):00071 [8]     5317            jsr   ClearObj
7D5F 209D             (./Engine/Graphics):00072 [3]     5320            bra   UDP_CheckEndB0
                      (./Engine/Graphics):00073                         
7D61                  (./Engine/Graphics):00074                 UDP_SetNewPrioB0
7D61 A643             (./Engine/Graphics):00075 [5]     5325            lda   priority,u
7D63 A7C835           (./Engine/Graphics):00076 [5]     5330            sta   rsv_priority_0,u
7D66 2096             (./Engine/Graphics):00077 [3]     5333            bra   UDP_CheckEndB0        
                      (./Engine/Graphics):00078                 
7D68                  (./Engine/Graphics):00079                 UDP_B1                                    
7D68 8E72D2           (./Engine/Graphics):00080 [3]     5336            ldx   #Lst_Priority_Unset_1+2
                      (./Engine/Graphics):00081                         
7D6B                  (./Engine/Graphics):00082                 UDP_CheckEndB1        
7D6B BC72D0           (./Engine/Graphics):00083 [7]     5343            cmpx  Lst_Priority_Unset_1          ; end of priority unset list
7D6E 2607             (./Engine/Graphics):00084 [3]     5346            bne   UDP_CheckPrioPrevB1
                      (./Engine/Graphics):00085                         
7D70                  (./Engine/Graphics):00086                 UDP_InitListB1      
7D70 8E72D2           (./Engine/Graphics):00087 [3]     5349            ldx   #Lst_Priority_Unset_1+2 
7D73 BF72D0           (./Engine/Graphics):00088 [6]     5355            stx   Lst_Priority_Unset_1          ; set Lst_Priority_Unset_0 index
7D76 39               (./Engine/Graphics):00089 [5]     5360            rts
                      (./Engine/Graphics):00090                         
7D77                  (./Engine/Graphics):00091                 UDP_CheckPrioPrevB1
7D77 EE81             (./Engine/Graphics):00092 [8]     5368            ldu   ,x++
7D79 ECC84A           (./Engine/Graphics):00093 [6]     5374            ldd   rsv_priority_prev_obj_1,u
7D7C 2611             (./Engine/Graphics):00094 [3]     5377            bne   UDP_ChainPrevB1
                      (./Engine/Graphics):00095                         
7D7E A6C849           (./Engine/Graphics):00096 [5]     5382            lda   rsv_priority_1,u
7D81 48               (./Engine/Graphics):00097 [2]     5384            lsla
7D82 108E72AC         (./Engine/Graphics):00098 [4]     5388            ldy   #Tbl_Priority_First_Entry_1
7D86 31A6             (./Engine/Graphics):00099 [5]     5393            leay  a,y
7D88 ECC84C           (./Engine/Graphics):00100 [6]     5399            ldd   rsv_priority_next_obj_1,u
7D8B EDA4             (./Engine/Graphics):00101 [5]     5404            std   ,y
7D8D 200A             (./Engine/Graphics):00102 [3]     5407            bra   UDP_CheckPrioNextB1
                      (./Engine/Graphics):00103                                 
7D8F                  (./Engine/Graphics):00104                 UDP_ChainPrevB1
7D8F ECC84C           (./Engine/Graphics):00105 [6]     5413            ldd   rsv_priority_next_obj_1,u
7D92 10AEC84A         (./Engine/Graphics):00106 [7]     5420            ldy   rsv_priority_prev_obj_1,u        
7D96 EDA84C           (./Engine/Graphics):00107 [6]     5426            std   rsv_priority_next_obj_1,y        
                      (./Engine/Graphics):00108                 
7D99                  (./Engine/Graphics):00109                 UDP_CheckPrioNextB1       
7D99 ECC84C           (./Engine/Graphics):00110 [6]     5432            ldd   rsv_priority_next_obj_1,u
7D9C 2611             (./Engine/Graphics):00111 [3]     5435            bne   UDP_ChainNextB1
                      (./Engine/Graphics):00112                 
7D9E A6C849           (./Engine/Graphics):00113 [5]     5440            lda   rsv_priority_1,u
7DA1 48               (./Engine/Graphics):00114 [2]     5442            lsla
7DA2 108E72BE         (./Engine/Graphics):00115 [4]     5446            ldy   #Tbl_Priority_Last_Entry_1
7DA6 31A6             (./Engine/Graphics):00116 [5]     5451            leay  a,y
7DA8 ECC84A           (./Engine/Graphics):00117 [6]     5457            ldd   rsv_priority_prev_obj_1,u
7DAB EDA4             (./Engine/Graphics):00118 [5]     5462            std   ,y
7DAD 200A             (./Engine/Graphics):00119 [3]     5465            bra   UDP_CheckDeleteB1
                      (./Engine/Graphics):00120                                 
7DAF                  (./Engine/Graphics):00121                 UDP_ChainNextB1
7DAF ECC84A           (./Engine/Graphics):00122 [6]     5471            ldd   rsv_priority_prev_obj_1,u
7DB2 10AEC84C         (./Engine/Graphics):00123 [7]     5478            ldy   rsv_priority_next_obj_1,u        
7DB6 EDA84A           (./Engine/Graphics):00124 [6]     5484            std   rsv_priority_prev_obj_1,y
                      (./Engine/Graphics):00125                         
7DB9                  (./Engine/Graphics):00126                 UDP_CheckDeleteB1
7DB9 A642             (./Engine/Graphics):00127 [5]     5489            lda   render_flags,u
7DBB 8440             (./Engine/Graphics):00128 [2]     5491            anda  #render_todelete_mask
7DBD 270F             (./Engine/Graphics):00129 [3]     5494            beq   UDP_SetNewPrioB1
7DBF A6C848           (./Engine/Graphics):00130 [5]     5499            lda   rsv_prev_render_flags_0,u
7DC2 2B0A             (./Engine/Graphics):00131 [3]     5502            bmi   UDP_SetNewPrioB1
7DC4 A6C85C           (./Engine/Graphics):00132 [5]     5507            lda   rsv_prev_render_flags_1,u
7DC7 2B05             (./Engine/Graphics):00133 [3]     5510            bmi   UDP_SetNewPrioB1
7DC9 BD8166           (./Engine/Graphics):00134 [8]     5518            jsr   ClearObj
7DCC 209D             (./Engine/Graphics):00135 [3]     5521            bra   UDP_CheckEndB1
                      (./Engine/Graphics):00136                         
7DCE                  (./Engine/Graphics):00137                 UDP_SetNewPrioB1
7DCE A643             (./Engine/Graphics):00138 [5]     5526            lda   priority,u
7DD0 A7C849           (./Engine/Graphics):00139 [5]     5531            sta   rsv_priority_1,u
7DD3 2096             (./Engine/Graphics):00140 [3]     5534            bra   UDP_CheckEndB1
                      (C:\Users\bhrou\gi):00266                         INCLUDE "./Engine/Graphics/DrawSprites.asm"
                      (./Engine/Graphics):00001                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00002                 * DrawSprites
                      (./Engine/Graphics):00003                 * ------------
                      (./Engine/Graphics):00004                 * Subroutine to draw sprites on screen
                      (./Engine/Graphics):00005                 * Read Display Priority Structure (back to front)
                      (./Engine/Graphics):00006                 * priority: 0 - unregistred
                      (./Engine/Graphics):00007                 * priority: 1 - register non moving overlay sprite
                      (./Engine/Graphics):00008                 * priority; 2-8 - register moving sprite (2:front, ..., 8:back)  
                      (./Engine/Graphics):00009                 *
                      (./Engine/Graphics):00010                 * input REG : none
                      (./Engine/Graphics):00011                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00012                                                                                            
7DD5                  (./Engine/Graphics):00013                 DrawSprites
                      (./Engine/Graphics):00014                 
7DD5                  (./Engine/Graphics):00015                 DRS_Start
7DD5 B67040           (./Engine/Graphics):00016 [5]     5539            lda   glb_Cur_Wrk_Screen_Id         ; read current screen buffer for write operations
7DD8 2641             (./Engine/Graphics):00017 [3]     5542            bne   DRS_P8B1
                      (./Engine/Graphics):00018                         
7DDA                  (./Engine/Graphics):00019                 DRS_P8B0                                    
7DDA BE725A           (./Engine/Graphics):00020 [6]     5548            ldx   DPS_buffer_0+buf_Tbl_Priority_First_Entry+16 ; read DPS from priority 8 to priority 1
7DDD 2703             (./Engine/Graphics):00021 [3]     5551            beq   DRS_P7B0
7DDF BD7E5C           (./Engine/Graphics):00022 [8]     5559            jsr   DRS_ProcessEachPriorityLevelB0   
7DE2                  (./Engine/Graphics):00023                 DRS_P7B0
7DE2 BE7258           (./Engine/Graphics):00024 [6]     5565            ldx   DPS_buffer_0+buf_Tbl_Priority_First_Entry+14
7DE5 2703             (./Engine/Graphics):00025 [3]     5568            beq   DRS_P6B0
7DE7 BD7E5C           (./Engine/Graphics):00026 [8]     5576            jsr   DRS_ProcessEachPriorityLevelB0  
7DEA                  (./Engine/Graphics):00027                 DRS_P6B0
7DEA BE7256           (./Engine/Graphics):00028 [6]     5582            ldx   DPS_buffer_0+buf_Tbl_Priority_First_Entry+12
7DED 2703             (./Engine/Graphics):00029 [3]     5585            beq   DRS_P5B0
7DEF BD7E5C           (./Engine/Graphics):00030 [8]     5593            jsr   DRS_ProcessEachPriorityLevelB0  
7DF2                  (./Engine/Graphics):00031                 DRS_P5B0
7DF2 BE7254           (./Engine/Graphics):00032 [6]     5599            ldx   DPS_buffer_0+buf_Tbl_Priority_First_Entry+10
7DF5 2703             (./Engine/Graphics):00033 [3]     5602            beq   DRS_P4B0
7DF7 BD7E5C           (./Engine/Graphics):00034 [8]     5610            jsr   DRS_ProcessEachPriorityLevelB0  
7DFA                  (./Engine/Graphics):00035                 DRS_P4B0
7DFA BE7252           (./Engine/Graphics):00036 [6]     5616            ldx   DPS_buffer_0+buf_Tbl_Priority_First_Entry+8
7DFD 2703             (./Engine/Graphics):00037 [3]     5619            beq   DRS_P3B0
7DFF BD7E5C           (./Engine/Graphics):00038 [8]     5627            jsr   DRS_ProcessEachPriorityLevelB0              
7E02                  (./Engine/Graphics):00039                 DRS_P3B0
7E02 BE7250           (./Engine/Graphics):00040 [6]     5633            ldx   DPS_buffer_0+buf_Tbl_Priority_First_Entry+6
7E05 2703             (./Engine/Graphics):00041 [3]     5636            beq   DRS_P2B0
7E07 BD7E5C           (./Engine/Graphics):00042 [8]     5644            jsr   DRS_ProcessEachPriorityLevelB0     
7E0A                  (./Engine/Graphics):00043                 DRS_P2B0
7E0A BE724E           (./Engine/Graphics):00044 [6]     5650            ldx   DPS_buffer_0+buf_Tbl_Priority_First_Entry+4
7E0D 2703             (./Engine/Graphics):00045 [3]     5653            beq   DRS_P1B0
7E0F BD7E5C           (./Engine/Graphics):00046 [8]     5661            jsr   DRS_ProcessEachPriorityLevelB0 
7E12                  (./Engine/Graphics):00047                 DRS_P1B0
7E12 BE724C           (./Engine/Graphics):00048 [6]     5667            ldx   DPS_buffer_0+buf_Tbl_Priority_First_Entry+2
7E15 2703             (./Engine/Graphics):00049 [3]     5670            beq   DRS_rtsB0
7E17 BD7E5C           (./Engine/Graphics):00050 [8]     5678            jsr   DRS_ProcessEachPriorityLevelB0
7E1A                  (./Engine/Graphics):00051                 DRS_rtsB0        
7E1A 39               (./Engine/Graphics):00052 [5]     5683            rts
                      (./Engine/Graphics):00053                         
7E1B                  (./Engine/Graphics):00054                 DRS_P8B1
7E1B BE72BC           (./Engine/Graphics):00055 [6]     5689            ldx   DPS_buffer_1+buf_Tbl_Priority_First_Entry+16 ; read DPS from priority 8 to priority 1
7E1E 2703             (./Engine/Graphics):00056 [3]     5692            beq   DRS_P7B1
7E20 BD7F1B           (./Engine/Graphics):00057 [8]     5700            jsr   DRS_ProcessEachPriorityLevelB1   
7E23                  (./Engine/Graphics):00058                 DRS_P7B1
7E23 BE72BA           (./Engine/Graphics):00059 [6]     5706            ldx   DPS_buffer_1+buf_Tbl_Priority_First_Entry+14
7E26 2703             (./Engine/Graphics):00060 [3]     5709            beq   DRS_P6B1
7E28 BD7F1B           (./Engine/Graphics):00061 [8]     5717            jsr   DRS_ProcessEachPriorityLevelB1   
7E2B                  (./Engine/Graphics):00062                 DRS_P6B1
7E2B BE72B8           (./Engine/Graphics):00063 [6]     5723            ldx   DPS_buffer_1+buf_Tbl_Priority_First_Entry+12
7E2E 2703             (./Engine/Graphics):00064 [3]     5726            beq   DRS_P5B1
7E30 BD7F1B           (./Engine/Graphics):00065 [8]     5734            jsr   DRS_ProcessEachPriorityLevelB1   
7E33                  (./Engine/Graphics):00066                 DRS_P5B1
7E33 BE72B6           (./Engine/Graphics):00067 [6]     5740            ldx   DPS_buffer_1+buf_Tbl_Priority_First_Entry+10
7E36 2703             (./Engine/Graphics):00068 [3]     5743            beq   DRS_P4B1
7E38 BD7F1B           (./Engine/Graphics):00069 [8]     5751            jsr   DRS_ProcessEachPriorityLevelB1   
7E3B                  (./Engine/Graphics):00070                 DRS_P4B1
7E3B BE72B4           (./Engine/Graphics):00071 [6]     5757            ldx   DPS_buffer_1+buf_Tbl_Priority_First_Entry+8
7E3E 2703             (./Engine/Graphics):00072 [3]     5760            beq   DRS_P3B1
7E40 BD7F1B           (./Engine/Graphics):00073 [8]     5768            jsr   DRS_ProcessEachPriorityLevelB1             
7E43                  (./Engine/Graphics):00074                 DRS_P3B1
7E43 BE72B2           (./Engine/Graphics):00075 [6]     5774            ldx   DPS_buffer_1+buf_Tbl_Priority_First_Entry+6
7E46 2703             (./Engine/Graphics):00076 [3]     5777            beq   DRS_P2B1
7E48 BD7F1B           (./Engine/Graphics):00077 [8]     5785            jsr   DRS_ProcessEachPriorityLevelB1    
7E4B                  (./Engine/Graphics):00078                 DRS_P2B1
7E4B BE72B0           (./Engine/Graphics):00079 [6]     5791            ldx   DPS_buffer_1+buf_Tbl_Priority_First_Entry+4
7E4E 2703             (./Engine/Graphics):00080 [3]     5794            beq   DRS_P1B1
7E50 BD7F1B           (./Engine/Graphics):00081 [8]     5802            jsr   DRS_ProcessEachPriorityLevelB1
7E53                  (./Engine/Graphics):00082                 DRS_P1B1
7E53 BE72AE           (./Engine/Graphics):00083 [6]     5808            ldx   DPS_buffer_1+buf_Tbl_Priority_First_Entry+2
7E56 2703             (./Engine/Graphics):00084 [3]     5811            beq   DRS_rtsB1
7E58 BD7F1B           (./Engine/Graphics):00085 [8]     5819            jsr   DRS_ProcessEachPriorityLevelB1
7E5B                  (./Engine/Graphics):00086                 DRS_rtsB1        
7E5B 39               (./Engine/Graphics):00087 [5]     5824            rts
                      (./Engine/Graphics):00088                 
7E5C                  (./Engine/Graphics):00089                 DRS_ProcessEachPriorityLevelB0    
7E5C A68822           (./Engine/Graphics):00090 [5]     5829            lda   rsv_render_flags,x
7E5F 8404             (./Engine/Graphics):00091 [2]     5831            anda  #rsv_render_displaysprite_mask
7E61 1027007F         (./Engine/Graphics):00092 [5+?]   5836            lbeq  DRS_NextObjectB0
                      (./Engine/Graphics):00093                         
7E65 A68848           (./Engine/Graphics):00094 [5]     5841            lda   rsv_prev_render_flags_0,x
7E68 102B0078         (./Engine/Graphics):00095 [5+?]   5846            lbmi  DRS_NextObjectB0
7E6C A602             (./Engine/Graphics):00096 [5]     5851            lda   render_flags,x
7E6E 8404             (./Engine/Graphics):00097 [2]     5853            anda  #render_overlay_mask
7E70 260E             (./Engine/Graphics):00098 [3]     5856            bne   DRS_DrawWithoutBackupB0
7E72 A6882A           (./Engine/Graphics):00099 [5]     5861            lda   rsv_erase_nb_cell,x        
7E75 BD7FAB           (./Engine/Graphics):00100 [8]     5869            jsr   BgBufferAlloc                 ; allocate free space to store sprite background data
7E78 108C0000         (./Engine/Graphics):00101 [5]     5874            cmpy  #$0000                        ; y contains cell_end of allocated space 
7E7C 10270064         (./Engine/Graphics):00102 [5+?]   5879            lbeq   DRS_NextObjectB0             ; branch if no more free space
7E80                  (./Engine/Graphics):00103                 DRS_DrawWithoutBackupB0        
7E80 EC8814           (./Engine/Graphics):00104 [6]     5885            ldd   xy_pixel,x                    ; load x position (48-207) and y position (28-227) in one operation
7E83 A08825           (./Engine/Graphics):00105 [5]     5890            suba  rsv_image_center_offset,x
7E86 BD7EEC           (./Engine/Graphics):00106 [8]     5898            jsr   DRS_XYToAddress
7E89 EC8828           (./Engine/Graphics):00107 [6]     5904            ldd   rsv_mapping_frame,x
7E8C ED883A           (./Engine/Graphics):00108 [6]     5910            std   rsv_prev_mapping_frame_0,x    ; save previous mapping_frame
7E8F A6882B           (./Engine/Graphics):00109 [5]     5915            lda   rsv_page_draw_routine,x
                      (./Engine/Graphics):00110                         _SetCartPageA        
                      (    _SetCartPageA):00001                  IFDEF T2
7E92 BD6F74           (    _SetCartPageA):00002 [8]     5923            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
7E95 BF7E9E           (./Engine/Graphics):00111 [6]     5929            stx   DRS_dyn3B0+1                  ; save x reg
7E98 DEFA             (./Engine/Graphics):00112 [5]     5934            ldu   <glb_screen_location_2
7E9A AD982C           (./Engine/Graphics):00113 [11]    5945            jsr   [rsv_draw_routine,x]          ; backup background and draw sprite on working screen buffer
7E9D                  (./Engine/Graphics):00114                 DRS_dyn3B0        
7E9D 8E0000           (./Engine/Graphics):00115 [3]     5948            ldx   #$0000                        ; (dynamic) restore x reg
7EA0 EF8840           (./Engine/Graphics):00116 [6]     5954            stu   rsv_bgdata_0,x                ; store pointer to saved background data
7EA3 EC8814           (./Engine/Graphics):00117 [6]     5960            ldd   xy_pixel,x                    ; load x position (48-207) and y position (28-227) in one operation
7EA6 44               (./Engine/Graphics):00118 [2]     5962            lsra                                ; x position precision is x_pixel/2 and mapping_frame with or without 1px shit
7EA7 ED8842           (./Engine/Graphics):00119 [6]     5968            std   rsv_prev_xy_pixel_0,x         ; save previous x_pixel and y_pixel in one operation             
7EAA EC8831           (./Engine/Graphics):00120 [6]     5974            ldd   rsv_xy1_pixel,x               ; load x' and y' in one operation
7EAD ED8844           (./Engine/Graphics):00121 [6]     5980            std   rsv_prev_xy1_pixel_0,x        ; save as previous x' and y'        
7EB0 EC8833           (./Engine/Graphics):00122 [6]     5986            ldd   rsv_xy2_pixel,x               ; load x'' and y'' in one operation
7EB3 ED8846           (./Engine/Graphics):00123 [6]     5992            std   rsv_prev_xy2_pixel_0,x        ; save as previous x'' and y''
7EB6 A6882A           (./Engine/Graphics):00124 [5]     5997            lda   rsv_erase_nb_cell,x
7EB9 A7883C           (./Engine/Graphics):00125 [5]     6002            sta   rsv_prev_erase_nb_cell_0,x
7EBC A6882E           (./Engine/Graphics):00126 [5]     6007            lda   rsv_page_erase_routine,x
7EBF A7883D           (./Engine/Graphics):00127 [5]     6012            sta   rsv_prev_page_erase_routine_0,x
7EC2 EC882F           (./Engine/Graphics):00128 [6]     6018            ldd   rsv_erase_routine,x
7EC5 ED883E           (./Engine/Graphics):00129 [6]     6024            std   rsv_prev_erase_routine_0,x
7EC8 A68848           (./Engine/Graphics):00130 [5]     6029            lda   rsv_prev_render_flags_0,x
7ECB 8A80             (./Engine/Graphics):00131 [2]     6031            ora   #rsv_prev_render_onscreen_mask
7ECD E602             (./Engine/Graphics):00132 [5]     6036            ldb   render_flags,x
7ECF C504             (./Engine/Graphics):00133 [2]     6038            bitb  #render_overlay_mask
7ED1 2704             (./Engine/Graphics):00134 [3]     6041            beq   DRS_NoOverlayB0
7ED3 8A01             (./Engine/Graphics):00135 [2]     6043            ora   #rsv_prev_render_overlay_mask
7ED5 2002             (./Engine/Graphics):00136 [3]     6046            bra   DRS_UpdateRenderFlagB0
                      (./Engine/Graphics):00137                         
7ED7                  (./Engine/Graphics):00138                 DRS_NoOverlayB0
7ED7 84FE             (./Engine/Graphics):00139 [2]     6048            anda   #^rsv_prev_render_overlay_mask
                      (./Engine/Graphics):00140                 
7ED9                  (./Engine/Graphics):00141                 DRS_UpdateRenderFlagB0        
7ED9 A78848           (./Engine/Graphics):00142 [5]     6053            sta   rsv_prev_render_flags_0,x     ; set the onscreen flag and save overlay flag
7EDC A68822           (./Engine/Graphics):00143 [5]     6058            lda   rsv_render_flags,x
7EDF 8A80             (./Engine/Graphics):00144 [2]     6060            ora   #rsv_render_onscreen_mask     ; sprite is on screen
7EE1 A78822           (./Engine/Graphics):00145 [5]     6065            sta   rsv_render_flags,x
                      (./Engine/Graphics):00146                         
7EE4                  (./Engine/Graphics):00147                 DRS_NextObjectB0        
7EE4 AE8838           (./Engine/Graphics):00148 [6]     6071            ldx   rsv_priority_next_obj_0,x
7EE7 1026FF71         (./Engine/Graphics):00149 [5+?]   6076            lbne  DRS_ProcessEachPriorityLevelB0   
7EEB 39               (./Engine/Graphics):00150 [5]     6081            rts
                      (./Engine/Graphics):00151                 
                      (./Engine/Graphics):00152                 ********************************************************************************
                      (./Engine/Graphics):00153                 * x_pixel and y_pixel coordinate system
                      (./Engine/Graphics):00154                 * x coordinates:
                      (./Engine/Graphics):00155                 *    - off-screen left 00-2F (0-47)
                      (./Engine/Graphics):00156                 *    - on screen 30-CF (48-207)
                      (./Engine/Graphics):00157                 *    - off-screen right D0-FF (208-255)
                      (./Engine/Graphics):00158                 *
                      (./Engine/Graphics):00159                 * y coordinates:
                      (./Engine/Graphics):00160                 *    - off-screen top 00-1B (0-27)
                      (./Engine/Graphics):00161                 *    - on screen 1C-E3 (28-227)
                      (./Engine/Graphics):00162                 *    - off-screen bottom E4-FF (228-255)
                      (./Engine/Graphics):00163                 ********************************************************************************
                      (./Engine/Graphics):00164                 
7EEC                  (./Engine/Graphics):00165                 DRS_XYToAddress
7EEC 8030             (./Engine/Graphics):00166 [2]     6083            suba  #$30
7EEE 2403             (./Engine/Graphics):00167 [3]     6086            bcc   DRS_XYToAddressPositive
7EF0 8060             (./Engine/Graphics):00168 [2]     6088            suba  #$60                          ; get x position one line up, skipping (160-255)
7EF2 5A               (./Engine/Graphics):00169 [2]     6090            decb
7EF3                  (./Engine/Graphics):00170                 DRS_XYToAddressPositive        
7EF3 C01C             (./Engine/Graphics):00171 [2]     6092            subb  #$1C                          ; TODO same thing as x for negative case
7EF5 44               (./Engine/Graphics):00172 [2]     6094            lsra                                ; x=x/2, sprites moves by 2 pixels on x axis
7EF6 44               (./Engine/Graphics):00173 [2]     6096            lsra                                ; x=x/2, RAMA RAMB enterlace  
7EF7 2511             (./Engine/Graphics):00174 [3]     6099            bcs   DRS_XYToAddressRAM2First      ; Branch if write must begin in RAM2 first
7EF9                  (./Engine/Graphics):00175                 DRS_XYToAddressRAM1First
7EF9 B77F01           (./Engine/Graphics):00176 [5]     6104            sta   DRS_dyn1+2
7EFC 8628             (./Engine/Graphics):00177 [2]     6106            lda   #$28                          ; 40 bytes per line in RAMA or RAMB
7EFE 3D               (./Engine/Graphics):00178 [11]    6117            mul
7EFF                  (./Engine/Graphics):00179                 DRS_dyn1        
7EFF C3C000           (./Engine/Graphics):00180 [4]     6121            addd  #$C000                        ; (dynamic)
7F02 DDFA             (./Engine/Graphics):00181 [5]     6126            std   <glb_screen_location_2
7F04 832000           (./Engine/Graphics):00182 [4]     6130            subd  #$2000
7F07 DDFC             (./Engine/Graphics):00183 [5]     6135            std   <glb_screen_location_1     
7F09 39               (./Engine/Graphics):00184 [5]     6140            rts
7F0A                  (./Engine/Graphics):00185                 DRS_XYToAddressRAM2First
7F0A B77F12           (./Engine/Graphics):00186 [5]     6145            sta   DRS_dyn2+2
7F0D 8628             (./Engine/Graphics):00187 [2]     6147            lda   #$28                          ; 40 bytes per line in RAMA or RAMB
7F0F 3D               (./Engine/Graphics):00188 [11]    6158            mul
7F10                  (./Engine/Graphics):00189                 DRS_dyn2        
7F10 C3A000           (./Engine/Graphics):00190 [4]     6162            addd  #$A000                        ; (dynamic)
7F13 DDFA             (./Engine/Graphics):00191 [5]     6167            std   <glb_screen_location_2
7F15 C32001           (./Engine/Graphics):00192 [4]     6171            addd  #$2001
7F18 DDFC             (./Engine/Graphics):00193 [5]     6176            std   <glb_screen_location_1
7F1A 39               (./Engine/Graphics):00194 [5]     6181            rts
                      (./Engine/Graphics):00195                         
7F1B                  (./Engine/Graphics):00196                 DRS_ProcessEachPriorityLevelB1
7F1B A68822           (./Engine/Graphics):00197 [5]     6186            lda   rsv_render_flags,x
7F1E 8404             (./Engine/Graphics):00198 [2]     6188            anda  #rsv_render_displaysprite_mask
7F20 1027007F         (./Engine/Graphics):00199 [5+?]   6193            lbeq  DRS_NextObjectB1
                      (./Engine/Graphics):00200                         
7F24 A6885C           (./Engine/Graphics):00201 [5]     6198            lda   rsv_prev_render_flags_1,x
7F27 102B0078         (./Engine/Graphics):00202 [5+?]   6203            lbmi  DRS_NextObjectB1
7F2B A602             (./Engine/Graphics):00203 [5]     6208            lda   render_flags,x
7F2D 8404             (./Engine/Graphics):00204 [2]     6210            anda  #render_overlay_mask
7F2F 260E             (./Engine/Graphics):00205 [3]     6213            bne   DRS_DrawWithoutBackupB1
7F31 A6882A           (./Engine/Graphics):00206 [5]     6218            lda   rsv_erase_nb_cell,x        
7F34 BD7FAB           (./Engine/Graphics):00207 [8]     6226            jsr   BgBufferAlloc                 ; allocate free space to store sprite background data
7F37 108C0000         (./Engine/Graphics):00208 [5]     6231            cmpy  #$0000                        ; y contains cell_end of allocated space
7F3B 10270064         (./Engine/Graphics):00209 [5+?]   6236            lbeq   DRS_NextObjectB1             ; branch if no more free space
7F3F                  (./Engine/Graphics):00210                 DRS_DrawWithoutBackupB1        
7F3F EC8814           (./Engine/Graphics):00211 [6]     6242            ldd   xy_pixel,x                    ; load x position (48-207) and y position (28-227) in one operation
7F42 A08825           (./Engine/Graphics):00212 [5]     6247            suba  rsv_image_center_offset,x
7F45 BD7EEC           (./Engine/Graphics):00213 [8]     6255            jsr   DRS_XYToAddress
7F48 EC8828           (./Engine/Graphics):00214 [6]     6261            ldd   rsv_mapping_frame,x
7F4B ED884E           (./Engine/Graphics):00215 [6]     6267            std   rsv_prev_mapping_frame_1,x    ; save previous mapping_frame
7F4E A6882B           (./Engine/Graphics):00216 [5]     6272            lda   rsv_page_draw_routine,x
                      (./Engine/Graphics):00217                         _SetCartPageA        
                      (    _SetCartPageA):00001                  IFDEF T2
7F51 BD6F74           (    _SetCartPageA):00002 [8]     6280            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
7F54 BF7F5D           (./Engine/Graphics):00218 [6]     6286            stx   DRS_dyn3B1+1                  ; save x reg
7F57 DEFA             (./Engine/Graphics):00219 [5]     6291            ldu   <glb_screen_location_2
7F59 AD982C           (./Engine/Graphics):00220 [11]    6302            jsr   [rsv_draw_routine,x]
7F5C                  (./Engine/Graphics):00221                 DRS_dyn3B1        
7F5C 8E0000           (./Engine/Graphics):00222 [3]     6305            ldx   #$0000                        ; (dynamic) restore x reg
7F5F EF8854           (./Engine/Graphics):00223 [6]     6311            stu   rsv_bgdata_1,x                ; store pointer to saved background data
7F62 EC8814           (./Engine/Graphics):00224 [6]     6317            ldd   xy_pixel,x                    ; load x position (48-207) and y position (28-227) in one operation
7F65 44               (./Engine/Graphics):00225 [2]     6319            lsra                                ; x position precision is x_pixel/2 and mapping_frame with or without 1px shit
7F66 ED8856           (./Engine/Graphics):00226 [6]     6325            std   rsv_prev_xy_pixel_1,x         ; save previous x_pixel and y_pixel in one operation         
7F69 EC8831           (./Engine/Graphics):00227 [6]     6331            ldd   rsv_xy1_pixel,x               ; load x' and y' in one operation
7F6C ED8858           (./Engine/Graphics):00228 [6]     6337            std   rsv_prev_xy1_pixel_1,x        ; save as previous x' and y'        
7F6F EC8833           (./Engine/Graphics):00229 [6]     6343            ldd   rsv_xy2_pixel,x               ; load x'' and y'' in one operation
7F72 ED885A           (./Engine/Graphics):00230 [6]     6349            std   rsv_prev_xy2_pixel_1,x        ; save as previous x'' and y''
7F75 A6882A           (./Engine/Graphics):00231 [5]     6354            lda   rsv_erase_nb_cell,x
7F78 A78850           (./Engine/Graphics):00232 [5]     6359            sta   rsv_prev_erase_nb_cell_1,x
7F7B A6882E           (./Engine/Graphics):00233 [5]     6364            lda   rsv_page_erase_routine,x
7F7E A78851           (./Engine/Graphics):00234 [5]     6369            sta   rsv_prev_page_erase_routine_1,x
7F81 EC882F           (./Engine/Graphics):00235 [6]     6375            ldd   rsv_erase_routine,x
7F84 ED8852           (./Engine/Graphics):00236 [6]     6381            std   rsv_prev_erase_routine_1,x                        
7F87 A6885C           (./Engine/Graphics):00237 [5]     6386            lda   rsv_prev_render_flags_1,x
7F8A 8A80             (./Engine/Graphics):00238 [2]     6388            ora   #rsv_prev_render_onscreen_mask
7F8C E602             (./Engine/Graphics):00239 [5]     6393            ldb   render_flags,x
7F8E C504             (./Engine/Graphics):00240 [2]     6395            bitb  #render_overlay_mask
7F90 2704             (./Engine/Graphics):00241 [3]     6398            beq   DRS_NoOverlayB1
7F92 8A01             (./Engine/Graphics):00242 [2]     6400            ora   #rsv_prev_render_overlay_mask
7F94 2002             (./Engine/Graphics):00243 [3]     6403            bra   DRS_UpdateRenderFlagB1
                      (./Engine/Graphics):00244                         
7F96                  (./Engine/Graphics):00245                 DRS_NoOverlayB1
7F96 84FE             (./Engine/Graphics):00246 [2]     6405            anda   #^rsv_prev_render_overlay_mask
                      (./Engine/Graphics):00247                 
7F98                  (./Engine/Graphics):00248                 DRS_UpdateRenderFlagB1
7F98 A7885C           (./Engine/Graphics):00249 [5]     6410            sta   rsv_prev_render_flags_1,x     ; set the onscreen flag and save overlay flag
7F9B A68822           (./Engine/Graphics):00250 [5]     6415            lda   rsv_render_flags,x
7F9E 8A80             (./Engine/Graphics):00251 [2]     6417            ora   #rsv_render_onscreen_mask     ; sprite is on screen
7FA0 A78822           (./Engine/Graphics):00252 [5]     6422            sta   rsv_render_flags,x        
                      (./Engine/Graphics):00253                                 
7FA3                  (./Engine/Graphics):00254                 DRS_NextObjectB1        
7FA3 AE884C           (./Engine/Graphics):00255 [6]     6428            ldx   rsv_priority_next_obj_1,x
7FA6 1026FF71         (./Engine/Graphics):00256 [5+?]   6433            lbne  DRS_ProcessEachPriorityLevelB1   
7FAA 39               (./Engine/Graphics):00257 [5]     6438            rts
                      (C:\Users\bhrou\gi):00267                         INCLUDE "./Engine/Graphics/BgBufferAlloc.asm"   
                      (./Engine/Graphics):00001                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00002                 * BgBufferAlloc
                      (./Engine/Graphics):00003                 * -------------
                      (./Engine/Graphics):00004                 * Subroutine to allocate memory into background buffer
                      (./Engine/Graphics):00005                 *
                      (./Engine/Graphics):00006                 * input  REG : [a] number of requested cells
                      (./Engine/Graphics):00007                 * output REG : [y] cell_end or 0000 if no more space
                      (./Engine/Graphics):00008                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00009                 
7FAB                  (./Engine/Graphics):00010                 BgBufferAlloc
7FAB 3414             (./Engine/Graphics):00011 [8]     6446            pshs  b,x
7FAD F67040           (./Engine/Graphics):00012 [5]     6451            ldb   glb_Cur_Wrk_Screen_Id         ; read current screen buffer for write operations
7FB0 2609             (./Engine/Graphics):00013 [3]     6454            bne   BBA1                          ; branch if buffer 1 is current
                      (./Engine/Graphics):00014                         
7FB2                  (./Engine/Graphics):00015                 BBA0        
7FB2 8E7700           (./Engine/Graphics):00016 [3]     6457            ldx   #Lst_FreeCellFirstEntry_0     ; save previous cell.next_entry into x for future update
7FB5 10BE7700         (./Engine/Graphics):00017 [7]     6464            ldy   Lst_FreeCellFirstEntry_0      ; load first cell for screen buffer 0
7FB9 2007             (./Engine/Graphics):00018 [3]     6467            bra   BBA_Next
                      (./Engine/Graphics):00019                         
7FBB                  (./Engine/Graphics):00020                 BBA1        
7FBB 8E78C8           (./Engine/Graphics):00021 [3]     6470            ldx   #Lst_FreeCellFirstEntry_1     ; save previous cell.next_entry into x for future update
7FBE 10BE78C8         (./Engine/Graphics):00022 [7]     6477            ldy   Lst_FreeCellFirstEntry_1      ; load first cell for screen buffer 1
                      (./Engine/Graphics):00023                         
7FC2                  (./Engine/Graphics):00024                 BBA_Next
7FC2 2740             (./Engine/Graphics):00025 [3]     6480            beq   BBA_rts                       ; loop thru all entries, branch if no more free space
7FC4 A1A4             (./Engine/Graphics):00026 [4]     6484            cmpa  nb_cells,y                    ; compare current nb of free cells with requested
7FC6 2709             (./Engine/Graphics):00027 [3]     6487            beq   BBA_FitCell                   ; branch if current free cells is the same size than requested
7FC8 231D             (./Engine/Graphics):00028 [3]     6490            bls   BBA_DivideCell                ; branch if current free cells are greater than requested
7FCA 3025             (./Engine/Graphics):00029 [5]     6495            leax  next_entry,y                  ; save previous cell.next_entry into x for future update        
7FCC 10AE25           (./Engine/Graphics):00030 [7]     6502            ldy   next_entry,y                  ; move to next entry
7FCF 20F1             (./Engine/Graphics):00031 [3]     6505            bra   BBA_Next
                      (./Engine/Graphics):00032                           
7FD1                  (./Engine/Graphics):00033                 BBA_FitCell
7FD1 EC25             (./Engine/Graphics):00034 [6]     6511            ldd   next_entry,y
7FD3 ED84             (./Engine/Graphics):00035 [5]     6516            std   ,x                            ; chain previous cell with next cell
7FD5 EC23             (./Engine/Graphics):00036 [6]     6522            ldd   cell_end,y                    ; return cell_end
7FD7 FD8002           (./Engine/Graphics):00037 [6]     6528            std   cell_end_return+2
                      (./Engine/Graphics):00038                 
7FDA CC0000           (./Engine/Graphics):00039 [3]     6531            ldd   #0
7FDD A7A4             (./Engine/Graphics):00040 [4]     6535            sta   nb_cells,y                    ; clean current cell
7FDF ED21             (./Engine/Graphics):00041 [6]     6541            std   cell_start,y                  ;
7FE1 ED23             (./Engine/Graphics):00042 [6]     6547            std   cell_end,y                    ;
7FE3 ED25             (./Engine/Graphics):00043 [6]     6553            std   next_entry,y                  ;
                      (./Engine/Graphics):00044                 
7FE5 2019             (./Engine/Graphics):00045 [3]     6556            bra   cell_end_return
                      (./Engine/Graphics):00046                         
7FE7                  (./Engine/Graphics):00047                 BBA_DivideCell
7FE7 B77FED           (./Engine/Graphics):00048 [5]     6561            sta   BBA_dyn+1
7FEA E6A4             (./Engine/Graphics):00049 [4]     6565            ldb   nb_cells,y
7FEC                  (./Engine/Graphics):00050                 BBA_dyn
7FEC C000             (./Engine/Graphics):00051 [2]     6567            subb  #$00                          ; substract requested cells to nb_cells
7FEE E7A4             (./Engine/Graphics):00052 [4]     6571            stb   nb_cells,y                    ; update nb_cells
                      (./Engine/Graphics):00053                         
7FF0 C640             (./Engine/Graphics):00054 [2]     6573            ldb   #cell_size
7FF2 3D               (./Engine/Graphics):00055 [11]    6584            mul
                      (./Engine/Graphics):00056                         _negd
7FF3 40               (            _negd):00001 [2]     6586            nega
7FF4 50               (            _negd):00002 [2]     6588            negb
7FF5 8200             (            _negd):00003 [2]     6590            sbca  #0
7FF7 AE23             (./Engine/Graphics):00057 [6]     6596            ldx   cell_end,y
7FF9 BF8002           (./Engine/Graphics):00058 [6]     6602            stx   cell_end_return+2        
7FFC 308B             (./Engine/Graphics):00059 [8]     6610            leax  d,x                           ; cell_end = cell_end - (number of requested cells * nb of bytes in a cell)
7FFE AF23             (./Engine/Graphics):00060 [6]     6616            stx   cell_end,y                    ; update cell_end
8000                  (./Engine/Graphics):00061                 cell_end_return        
8000 108E0000         (./Engine/Graphics):00062 [4]     6620            ldy   #$0000
8004                  (./Engine/Graphics):00063                 BBA_rts
8004 3594             (./Engine/Graphics):00064 [10]    6630            puls  b,x,pc
                      (C:\Users\bhrou\gi):00268                         INCLUDE "./Engine/Joypad/ReadJoypads2.asm"
                      (./Engine/Joypad/R):00001                 ********************************************************************************
                      (./Engine/Joypad/R):00002                 * Get joystick parameters (Version 2)
                      (./Engine/Joypad/R):00003                 *
                      (./Engine/Joypad/R):00004                 * Read Joypads and store result as Press and Help values :
                      (./Engine/Joypad/R):00005                 * One byte with direction and button for player 1
                      (./Engine/Joypad/R):00006                 * One byte with direction and button for player 2
                      (./Engine/Joypad/R):00007                 *
                      (./Engine/Joypad/R):00008                 * Note : to have one byte for direction and another for button, use V1
                      (./Engine/Joypad/R):00009                 * ------------------------------------------------------------------------------
                      (./Engine/Joypad/R):00010                 *
                      (./Engine/Joypad/R):00011                 * Joypads Direction
                      (./Engine/Joypad/R):00012                 * -----------------
                      (./Engine/Joypad/R):00013                 * Register: $E7CC (8bits)
                      (./Engine/Joypad/R):00014                 *
                      (./Engine/Joypad/R):00015                 * Joypad2     Joypad1
                      (./Engine/Joypad/R):00016                 * 1111        1111 (0: press | 1: release)  
                      (./Engine/Joypad/R):00017                 * ||||_Up     ||||_Up
                      (./Engine/Joypad/R):00018                 * |||__Down   |||__Down
                      (./Engine/Joypad/R):00019                 * ||___Left   ||___Left
                      (./Engine/Joypad/R):00020                 * |____Right  |____Right
                      (./Engine/Joypad/R):00021                 *
                      (./Engine/Joypad/R):00022                 * Joypads Bouttons
                      (./Engine/Joypad/R):00023                 * ----------------
                      (./Engine/Joypad/R):00024                 * Register: $E7CD (8bits)
                      (./Engine/Joypad/R):00025                 *
                      (./Engine/Joypad/R):00026                 *   [------] 6 bits DAC
                      (./Engine/Joypad/R):00027                 * 11 001100 (0: press | 1: release) 
                      (./Engine/Joypad/R):00028                 * ||   ||
                      (./Engine/Joypad/R):00029                 * ||   ||_ Btn B Joypad1
                      (./Engine/Joypad/R):00030                 * ||   |__ Btn B Joypad2
                      (./Engine/Joypad/R):00031                 * ||
                      (./Engine/Joypad/R):00032                 * ||______ Btn A Joypad1
                      (./Engine/Joypad/R):00033                 * |_______ Btn A Joypad2
                      (./Engine/Joypad/R):00034                 *
                      (./Engine/Joypad/R):00035                 * Result values: Joypads_Held, Joypads_Press
                      (./Engine/Joypad/R):00036                 * -----------------------------------------------
                      (./Engine/Joypad/R):00037                 * (16 bits)
                      (./Engine/Joypad/R):00038                 * Joypad1
                      (./Engine/Joypad/R):00039                 * 0000        0000 (0: release | 1: press)
                      (./Engine/Joypad/R):00040                 * ||||_Up     ||
                      (./Engine/Joypad/R):00041                 * |||__Down   ||
                      (./Engine/Joypad/R):00042                 * ||___Left   ||___Btn B
                      (./Engine/Joypad/R):00043                 * |____Right  |____Btn A
                      (./Engine/Joypad/R):00044                 *
                      (./Engine/Joypad/R):00045                 * Joypad2
                      (./Engine/Joypad/R):00046                 * 0000        0000 (0: release | 1: press)
                      (./Engine/Joypad/R):00047                 * ||||_Up     ||
                      (./Engine/Joypad/R):00048                 * |||__Down   ||
                      (./Engine/Joypad/R):00049                 * ||___Left   ||___Btn B
                      (./Engine/Joypad/R):00050                 * |____Right  |____Btn A
                      (./Engine/Joypad/R):00051                 *
                      (./Engine/Joypad/R):00052                 ********************************************************************************
                      (./Engine/Joypad/R):00053                 
                      (./Engine/Joypad/R):00054                 ; ---------------------------------------------------------------------------
                      (./Engine/Joypad/R):00055                 ; Controller Buttons
                      (./Engine/Joypad/R):00056                 ;
                      (./Engine/Joypad/R):00057                 ; Buttons bit numbers
     0004             (./Engine/Joypad/R):00058                 button_up                       equ   4
     0005             (./Engine/Joypad/R):00059                 button_down                     equ   5
     0006             (./Engine/Joypad/R):00060                 button_left                     equ   6
     0007             (./Engine/Joypad/R):00061                 button_right                    equ   7
     0002             (./Engine/Joypad/R):00062                 button_B                        equ   2
     0003             (./Engine/Joypad/R):00063                 button_C                        equ   3
     0003             (./Engine/Joypad/R):00064                 button_A                        equ   3
     0003             (./Engine/Joypad/R):00065                 button_start                    equ   3
                      (./Engine/Joypad/R):00066                 ; Buttons masks
     0010             (./Engine/Joypad/R):00067                 button_up_mask                  equ   %00010000
     0020             (./Engine/Joypad/R):00068                 button_down_mask                equ   %00100000
     0040             (./Engine/Joypad/R):00069                 button_left_mask                equ   %01000000
     0080             (./Engine/Joypad/R):00070                 button_right_mask               equ   %10000000
     0004             (./Engine/Joypad/R):00071                 button_B_mask                   equ   %00000100
     0008             (./Engine/Joypad/R):00072                 button_C_mask                   equ   %00001000
     0008             (./Engine/Joypad/R):00073                 button_A_mask                   equ   %00001000
     0008             (./Engine/Joypad/R):00074                 button_start_mask               equ   %00001000
                      (./Engine/Joypad/R):00075                 
8006                  (./Engine/Joypad/R):00076                 Ctrl_1_Logical
8006 00               (./Engine/Joypad/R):00077                 Ctrl_1_Held_Logical             fcb   0
8007 00               (./Engine/Joypad/R):00078                 Ctrl_1_Press_Logical            fcb   0
8008                  (./Engine/Joypad/R):00079                 Ctrl_1
8008 00               (./Engine/Joypad/R):00080                 Ctrl_1_Held                     fcb   0
8009 00               (./Engine/Joypad/R):00081                 Ctrl_1_Press                    fcb   0
800A                  (./Engine/Joypad/R):00082                 Ctrl_2
800A 00               (./Engine/Joypad/R):00083                 Ctrl_2_Held                     fcb   0
800B 00               (./Engine/Joypad/R):00084                 Ctrl_2_Press                    fcb   0
                      (./Engine/Joypad/R):00085                 
800C                  (./Engine/Joypad/R):00086                 ReadJoypads
800C FCE7CC           (./Engine/Joypad/R):00087 [6]     6636            ldd   $E7CC
                      (./Engine/Joypad/R):00088                         ; Ctrl 1
800F F78021           (./Engine/Joypad/R):00089 [5]     6641            stb   @a
8012 840F             (./Engine/Joypad/R):00090 [2]     6643            anda  #%00001111
8014 48               (./Engine/Joypad/R):00091 [2]     6645            lsla
8015 48               (./Engine/Joypad/R):00092 [2]     6647            lsla
8016 48               (./Engine/Joypad/R):00093 [2]     6649            lsla
8017 48               (./Engine/Joypad/R):00094 [2]     6651            lsla
8018 C440             (./Engine/Joypad/R):00095 [2]     6653            andb  #%01000000
801A 54               (./Engine/Joypad/R):00096 [2]     6655            lsrb
801B 54               (./Engine/Joypad/R):00097 [2]     6657            lsrb
801C 54               (./Engine/Joypad/R):00098 [2]     6659            lsrb
801D F78025           (./Engine/Joypad/R):00099 [5]     6664            stb   @b
8020 C600             (./Engine/Joypad/R):00100 [2]     6666            ldb   #0
     8021             (./Engine/Joypad/R):00101                 @a      equ   *-1
8022 C404             (./Engine/Joypad/R):00102 [2]     6668            andb  #%00000100
8024 CA00             (./Engine/Joypad/R):00103 [2]     6670            orb   #0
     8025             (./Engine/Joypad/R):00104                 @b      equ   *-1
8026 F7802A           (./Engine/Joypad/R):00105 [5]     6675            stb   @c
8029 8A00             (./Engine/Joypad/R):00106 [2]     6677            ora   #0
     802A             (./Engine/Joypad/R):00107                 @c      equ   *-1
802B 43               (./Engine/Joypad/R):00108 [2]     6679            coma
802C B7803C           (./Engine/Joypad/R):00109 [5]     6684            sta   @d
802F B68008           (./Engine/Joypad/R):00110 [5]     6689            lda   Ctrl_1_Held
8032 B8803C           (./Engine/Joypad/R):00111 [5]     6694            eora  @d
8035 B4803C           (./Engine/Joypad/R):00112 [5]     6699            anda  @d
8038 B78009           (./Engine/Joypad/R):00113 [5]     6704            sta   Ctrl_1_Press
803B 8600             (./Engine/Joypad/R):00114 [2]     6706            lda   #0
     803C             (./Engine/Joypad/R):00115                 @d      equ   *-1
803D B78008           (./Engine/Joypad/R):00116 [5]     6711            sta   Ctrl_1_Held
                      (./Engine/Joypad/R):00117                 
8040 FCE7CC           (./Engine/Joypad/R):00118 [6]     6717            ldd   $E7CC
                      (./Engine/Joypad/R):00119                         ; Ctrl 2
8043 F78052           (./Engine/Joypad/R):00120 [5]     6722            stb   @a
8046 84F0             (./Engine/Joypad/R):00121 [2]     6724            anda  #%11110000
8048 C480             (./Engine/Joypad/R):00122 [2]     6726            andb  #%10000000
804A 54               (./Engine/Joypad/R):00123 [2]     6728            lsrb
804B 54               (./Engine/Joypad/R):00124 [2]     6730            lsrb
804C 54               (./Engine/Joypad/R):00125 [2]     6732            lsrb
804D 54               (./Engine/Joypad/R):00126 [2]     6734            lsrb
804E F78057           (./Engine/Joypad/R):00127 [5]     6739            stb   @b
8051 C600             (./Engine/Joypad/R):00128 [2]     6741            ldb   #0
     8052             (./Engine/Joypad/R):00129                 @a      equ   *-1
8053 C408             (./Engine/Joypad/R):00130 [2]     6743            andb  #%00001000
8055 54               (./Engine/Joypad/R):00131 [2]     6745            lsrb
8056 CA00             (./Engine/Joypad/R):00132 [2]     6747            orb   #0
     8057             (./Engine/Joypad/R):00133                 @b      equ   *-1
8058 F7805C           (./Engine/Joypad/R):00134 [5]     6752            stb   @c
805B 8A00             (./Engine/Joypad/R):00135 [2]     6754            ora   #0
     805C             (./Engine/Joypad/R):00136                 @c      equ   *-1
805D 43               (./Engine/Joypad/R):00137 [2]     6756            coma
805E B7806E           (./Engine/Joypad/R):00138 [5]     6761            sta   @d
8061 B6800A           (./Engine/Joypad/R):00139 [5]     6766            lda   Ctrl_2_Held
8064 B8806E           (./Engine/Joypad/R):00140 [5]     6771            eora  @d
8067 B4806E           (./Engine/Joypad/R):00141 [5]     6776            anda  @d
806A B7800B           (./Engine/Joypad/R):00142 [5]     6781            sta   Ctrl_2_Press
806D 8600             (./Engine/Joypad/R):00143 [2]     6783            lda   #0
     806E             (./Engine/Joypad/R):00144                 @d      equ   *-1
806F B7800A           (./Engine/Joypad/R):00145 [5]     6788            sta   Ctrl_2_Held
8072 39               (./Engine/Joypad/R):00146 [5]     6793            rts
                      (./Engine/Joypad/R):00147                 
                      (C:\Users\bhrou\gi):00269                         INCLUDE "./Engine/ObjectManagement/RunObjects.asm"
                      (./Engine/ObjectMa):00001                 * ---------------------------------------------------------------------------
                      (./Engine/ObjectMa):00002                 * RunObjects
                      (./Engine/ObjectMa):00003                 * ------------
                      (./Engine/ObjectMa):00004                 * Subroutine to run objects code
                      (./Engine/ObjectMa):00005                 *
                      (./Engine/ObjectMa):00006                 * input REG : none
                      (./Engine/ObjectMa):00007                 * ---------------------------------------------------------------------------
                      (./Engine/ObjectMa):00008                                                             *; -------------------------------------------------------------------------------
                      (./Engine/ObjectMa):00009                                                             *; This runs the code of all the objects that are in Object_RAM
                      (./Engine/ObjectMa):00010                                                             *; -------------------------------------------------------------------------------
                      (./Engine/ObjectMa):00011                                                             *
                      (./Engine/ObjectMa):00012                                                             *; ||||||||||||||| S U B R O U T I N E |||||||||||||||||||||||||||||||||||||||
                      (./Engine/ObjectMa):00013                                                             *
                      (./Engine/ObjectMa):00014                                                             *; sub_15F9C: ObjectsLoad:
8073                  (./Engine/ObjectMa):00015                 RunObjects                                  *RunObjects:
                      (./Engine/ObjectMa):00016                                                             *    tst.b   (Teleport_flag).w
                      (./Engine/ObjectMa):00017                                                             *    bne.s   RunObjects_End  ; rts
8073 CE641A           (./Engine/ObjectMa):00018 [3]     6796            ldu   #Object_RAM                   *    lea (Object_RAM).w,a0 ; a0=object
8076 2017             (./Engine/ObjectMa):00019 [3]     6799            bra   am_RunNextObject
                      (./Engine/ObjectMa):00020                                                             *    moveq   #(Dynamic_Object_RAM_End-Object_RAM)/object_size-1,d7 ; run the first $80 objects out of levels
                      (./Engine/ObjectMa):00021                                                             *    moveq   #0,d0
                      (./Engine/ObjectMa):00022                                                             *    cmpi.b  #GameModeID_Demo,(Game_Mode).w  ; demo mode?
                      (./Engine/ObjectMa):00023                                                             *    beq.s   +   ; if in a level in a demo, branch
                      (./Engine/ObjectMa):00024                                                             *    cmpi.b  #GameModeID_Level,(Game_Mode).w ; regular level mode?
                      (./Engine/ObjectMa):00025                                                             *    bne.s   RunObject ; if not in a level, branch to RunObject
8078                  (./Engine/ObjectMa):00026                 RunObjects_01                               *+
                      (./Engine/ObjectMa):00027                                                             *    move.w  #(Object_RAM_End-Object_RAM)/object_size-1,d7   ; run the first $90 objects in levels
                      (./Engine/ObjectMa):00028                                                             *    tst.w   (Two_player_mode).w
                      (./Engine/ObjectMa):00029                                                             *    bne.s   RunObject ; if in 2 player competition mode, branch to RunObject
                      (./Engine/ObjectMa):00030                                                             *
                      (./Engine/ObjectMa):00031                         ;tst   glb_MainCharacter_Is_Dead     *    cmpi.b  #6,(MainCharacter+routine).w
                      (./Engine/ObjectMa):00032                         ;bne   RunObjectsWhenPlayerIsDead    *    bhs.s   RunObjectsWhenPlayerIsDead ; if dead, branch
                      (./Engine/ObjectMa):00033                                                             *    ; continue straight to RunObject
                      (./Engine/ObjectMa):00034                                                             *; ---------------------------------------------------------------------------
                      (./Engine/ObjectMa):00035                                                             *
                      (./Engine/ObjectMa):00036                                                             *; -------------------------------------------------------------------------------
                      (./Engine/ObjectMa):00037                                                             *; This is THE place where each individual object's code gets called from
                      (./Engine/ObjectMa):00038                                                             *; -------------------------------------------------------------------------------
                      (./Engine/ObjectMa):00039                                                             *
                      (./Engine/ObjectMa):00040                                                             *; ||||||||||||||| S U B R O U T I N E |||||||||||||||||||||||||||||||||||||||
                      (./Engine/ObjectMa):00041                                                             *
                      (./Engine/ObjectMa):00042                                                             *; sub_15FCC:
8078                  (./Engine/ObjectMa):00043                 RunObject                                   *RunObject:
8078 E6C4             (./Engine/ObjectMa):00044 [4]     6803            ldb   id,u                          *    move.b  id(a0),d0   ; get the object's ID
807A 2710             (./Engine/ObjectMa):00045 [3]     6806            beq   RunNextObject                 *    beq.s   RunNextObject ; if it's obj00, skip it
                      (./Engine/ObjectMa):00046                 
807C 8E9820           (./Engine/ObjectMa):00047 [3]     6809            ldx   #Obj_Index_Page
807F 3A               (./Engine/ObjectMa):00048 [3]     6812            abx
8080 A684             (./Engine/ObjectMa):00049 [4]     6816            lda   ,x                            ; page memoire
                      (./Engine/ObjectMa):00050                         _SetCartPageA                       ; selection de la page en RAM (0000-3FFF)
                      (    _SetCartPageA):00001                  IFDEF T2
8082 BD6F74           (    _SetCartPageA):00002 [8]     6824            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
8085 58               (./Engine/ObjectMa):00051 [2]     6826            aslb                                *    add.w   d0,d0
                      (./Engine/ObjectMa):00052                                                             *    add.w   d0,d0   ; d0 = object ID * 4
8086 8E9827           (./Engine/ObjectMa):00053 [3]     6829            ldx   #Obj_Index_Address            *    movea.l Obj_Index-4(pc,d0.w),a1 ; load the address of the object's code
8089 3A               (./Engine/ObjectMa):00054 [3]     6832            abx
808A AD94             (./Engine/ObjectMa):00055 [10]    6842            jsr   [,x]                          *    jsr (a1)    ; dynamic call! to one of the the entries in Obj_Index
                      (./Engine/ObjectMa):00056                                                             *    moveq   #0,d0
                      (./Engine/ObjectMa):00057                                                             *
                      (./Engine/ObjectMa):00058                                                             *; loc_15FDC:
808C                  (./Engine/ObjectMa):00059                 RunNextObject                               *RunNextObject:
808C 33C864           (./Engine/ObjectMa):00060 [5]     6847            leau  next_object,u                 *    lea next_object(a0),a0 ; load 0bj address
808F                  (./Engine/ObjectMa):00061                 am_RunNextObject                            
808F 11836F6E         (./Engine/ObjectMa):00062 [5]     6852            cmpu  #Object_RAM_End               *    dbf d7,RunObject
8093 26E3             (./Engine/ObjectMa):00063 [3]     6855            bne   RunObject                     *; return_15FE4:
8095                  (./Engine/ObjectMa):00064                 RunObjects_End                              *RunObjects_End:
8095 39               (./Engine/ObjectMa):00065 [5]     6860            rts                                 *    rts
                      (./Engine/ObjectMa):00066                                                             *
                      (./Engine/ObjectMa):00067                                                             *; ---------------------------------------------------------------------------
                      (./Engine/ObjectMa):00068                                                             *; this skips certain objects to make enemies and things pause when Sonic dies
                      (./Engine/ObjectMa):00069                                                             *; loc_15FE6:
8096                  (./Engine/ObjectMa):00070                 RunObjectsWhenPlayerIsDead                  *RunObjectsWhenPlayerIsDead:
                      (./Engine/ObjectMa):00071                         ;ldu   #Reserved_Object_RAM
                      (./Engine/ObjectMa):00072                         ;ldx   #Reserved_Object_RAM_End
                      (./Engine/ObjectMa):00073                         ;stx   am_RunNextObject+2            *    moveq   #(Reserved_Object_RAM_End-Reserved_Object_RAM)/object_size-1,d7
                      (./Engine/ObjectMa):00074                         ;bsr   RunObject                     *    bsr.s   RunObject   ; run the first $10 objects normally
                      (./Engine/ObjectMa):00075                                                             *    moveq   #(Dynamic_Object_RAM_End-Dynamic_Object_RAM)/object_size-1,d7
                      (./Engine/ObjectMa):00076                                                             *    bsr.s   RunObjectDisplayOnly ; all objects in this range are paused      
                      (./Engine/ObjectMa):00077                         ;ldu   #LevelOnly_Object_RAM 
                      (./Engine/ObjectMa):00078                         ;ldx   #LevelOnly_Object_RAM_End
                      (./Engine/ObjectMa):00079                         ;stx   am_RunNextObject+2            *    moveq   #(LevelOnly_Object_RAM_End-LevelOnly_Object_RAM)/object_size-1,d7
                      (./Engine/ObjectMa):00080                         ;bsr   RunObject                     *    bra.s   RunObject   ; run the last $10 objects normally
                      (./Engine/ObjectMa):00081                                                             *
                      (./Engine/ObjectMa):00082                         ;ldx   #Object_RAM_End               * repositionne la fin du RunObject avec sa valeur par d�faut
                      (./Engine/ObjectMa):00083                         ;stx   am_RunNextObject+2
                      (./Engine/ObjectMa):00084                         ;rts            
                      (./Engine/ObjectMa):00085                                                             *; ||||||||||||||| S U B R O U T I N E |||||||||||||||||||||||||||||||||||||||
                      (./Engine/ObjectMa):00086                                                             *
                      (./Engine/ObjectMa):00087                                                             *; sub_15FF2:
                      (./Engine/ObjectMa):00088                                                             *RunObjectDisplayOnly:
                      (./Engine/ObjectMa):00089                                                             *    moveq   #0,d0
                      (./Engine/ObjectMa):00090                                                             *    move.b  id(a0),d0   ; get the object's ID
                      (./Engine/ObjectMa):00091                                                             *    beq.s   +   ; if it's obj00, skip it
                      (./Engine/ObjectMa):00092                                                             *    tst.b   render_flags(a0)    ; should we render it?
                      (./Engine/ObjectMa):00093                                                             *    bpl.s   +           ; if not, skip it
                      (./Engine/ObjectMa):00094                                                             *    bsr.w   DisplaySprite
                      (./Engine/ObjectMa):00095                                                             *+
                      (./Engine/ObjectMa):00096                                                             *    lea next_object(a0),a0 ; load 0bj address
                      (./Engine/ObjectMa):00097                                                             *    dbf d7,RunObjectDisplayOnly
                      (./Engine/ObjectMa):00098                                                             
                      (./Engine/ObjectMa):00099                                                             *    rts
                      (./Engine/ObjectMa):00100                                                             *; End of function RunObjectDisplayOnly
                      (./Engine/ObjectMa):00101                                                             *
                      (./Engine/ObjectMa):00102                                                             *; ===========================================================================
                      (C:\Users\bhrou\gi):00270                         INCLUDE "./Engine/ObjectManagement/DeleteObject.asm"
                      (./Engine/ObjectMa):00001                 * ---------------------------------------------------------------------------
                      (./Engine/ObjectMa):00002                 * DeleteObject
                      (./Engine/ObjectMa):00003                 * ------------
                      (./Engine/ObjectMa):00004                 * Subroutine to delete an object.
                      (./Engine/ObjectMa):00005                 * If the object is rendered as a sprite it will be deleted by EraseSprites
                      (./Engine/ObjectMa):00006                 * routine
                      (./Engine/ObjectMa):00007                 *
                      (./Engine/ObjectMa):00008                 * DeleteObject
                      (./Engine/ObjectMa):00009                 * input REG : [u] object pointer (OST)
                      (./Engine/ObjectMa):00010                 *
                      (./Engine/ObjectMa):00011                 * DeleteObject_x
                      (./Engine/ObjectMa):00012                 * input REG : [x] object pointer (OST)
                      (./Engine/ObjectMa):00013                 * ---------------------------------------------------------------------------
                      (./Engine/ObjectMa):00014                 
                      (./Engine/ObjectMa):00015                                                        *; ---------------------------------------------------------------------------
                      (./Engine/ObjectMa):00016                                                        *; Subroutine to delete an object
                      (./Engine/ObjectMa):00017                                                        *; ---------------------------------------------------------------------------
                      (./Engine/ObjectMa):00018                                                        *
                      (./Engine/ObjectMa):00019                                                        *; ||||||||||||||| S U B R O U T I N E |||||||||||||||||||||||||||||||||||||||
                      (./Engine/ObjectMa):00020                                                        *
                      (./Engine/ObjectMa):00021                                                        *; freeObject:
8096                  (./Engine/ObjectMa):00022                 DeleteObject_x                *DeleteObject:
8096 3456             (./Engine/ObjectMa):00023 [11]    6871            pshs  d,x,u                    *    movea.l a0,a1
8098 3384             (./Engine/ObjectMa):00024 [4]     6875            leau  ,x                       *; sub_164E8:
809A 200A             (./Engine/ObjectMa):00025 [3]     6878            bra   DOB_Start
809C                  (./Engine/ObjectMa):00026                 DeleteObject_return
809C 35D6             (./Engine/ObjectMa):00027 [13]    6891            puls  d,x,u,pc                      ; rts
                      (./Engine/ObjectMa):00028                         
809E                  (./Engine/ObjectMa):00029                 DeleteObject                  *DeleteObject2:
809E 3456             (./Engine/ObjectMa):00030 [11]    6902            pshs  d,x,u
                      (./Engine/ObjectMa):00031                         
80A0 A642             (./Engine/ObjectMa):00032 [5]     6907            lda   render_flags,u
80A2 8440             (./Engine/ObjectMa):00033 [2]     6909            anda  #render_todelete_mask
80A4 26F6             (./Engine/ObjectMa):00034 [3]     6912            bne   DeleteObject_return           ; branch if already registred for deletion        
                      (./Engine/ObjectMa):00035                         
80A6                  (./Engine/ObjectMa):00036                 DOB_Start
80A6 A6C848           (./Engine/ObjectMa):00037 [5]     6917            lda   rsv_prev_render_flags_0,u
80A9 2A27             (./Engine/ObjectMa):00038 [3]     6920            bpl   DOB_RemoveFromDPSB0           ; branch if not onscreen on buffer 0
                      (./Engine/ObjectMa):00039                 
80AB                  (./Engine/ObjectMa):00040                 DOB_ToDeleteFlag0
80AB A642             (./Engine/ObjectMa):00041 [5]     6925            lda   render_flags,u
80AD 8A40             (./Engine/ObjectMa):00042 [2]     6927            ora   #render_todelete_mask
80AF A742             (./Engine/ObjectMa):00043 [5]     6932            sta   render_flags,u                ; set todelete flag, object will be deleted after sprite erase
                      (./Engine/ObjectMa):00044                         
80B1                  (./Engine/ObjectMa):00045                 DOB_Unset0        
80B1 BE726E           (./Engine/ObjectMa):00046 [6]     6938            ldx   Lst_Priority_Unset_0          ; add object to unset list on buffer 0
80B4 EF84             (./Engine/ObjectMa):00047 [5]     6943            stu   ,x
80B6 3002             (./Engine/ObjectMa):00048 [5]     6948            leax  2,x
80B8 BF726E           (./Engine/ObjectMa):00049 [6]     6954            stx   Lst_Priority_Unset_0
                      (./Engine/ObjectMa):00050                         
80BB                  (./Engine/ObjectMa):00051                 DOB_TestOnscreen1
80BB A6C85C           (./Engine/ObjectMa):00052 [5]     6959            lda   rsv_prev_render_flags_1,u
80BE 2A54             (./Engine/ObjectMa):00053 [3]     6962            bpl   DOB_RemoveFromDPSB1           ; branch if not onscreen on buffer 1
                      (./Engine/ObjectMa):00054                         
80C0                  (./Engine/ObjectMa):00055                 DOB_ToDeleteFlag1
80C0 A642             (./Engine/ObjectMa):00056 [5]     6967            lda   render_flags,u
80C2 8A40             (./Engine/ObjectMa):00057 [2]     6969            ora   #render_todelete_mask
80C4 A742             (./Engine/ObjectMa):00058 [5]     6974            sta   render_flags,u                ; set todelete flag, object will be deleted after sprite erase
                      (./Engine/ObjectMa):00059                         
80C6                  (./Engine/ObjectMa):00060                 DOB_Unset1
80C6 BE72D0           (./Engine/ObjectMa):00061 [6]     6980            ldx   Lst_Priority_Unset_1          ; add object to unset list on buffer 1                       
80C9 EF84             (./Engine/ObjectMa):00062 [5]     6985            stu   ,x
80CB 3002             (./Engine/ObjectMa):00063 [5]     6990            leax  2,x
80CD BF72D0           (./Engine/ObjectMa):00064 [6]     6996            stx   Lst_Priority_Unset_1
80D0 35D6             (./Engine/ObjectMa):00065 [13]    7009            puls  d,x,u,pc                      ; rts
                      (./Engine/ObjectMa):00066                 
80D2                  (./Engine/ObjectMa):00067                 DOB_RemoveFromDPSB0
80D2 ECC836           (./Engine/ObjectMa):00068 [6]     7015            ldd   rsv_priority_prev_obj_0,u     ; remove object from DSP on buffer 0
80D5 2611             (./Engine/ObjectMa):00069 [3]     7018            bne   DOB_ChainPrevB0
                      (./Engine/ObjectMa):00070                         
80D7 A6C835           (./Engine/ObjectMa):00071 [5]     7023            lda   rsv_priority_0,u
80DA 48               (./Engine/ObjectMa):00072 [2]     7025            lsla
80DB 108E724A         (./Engine/ObjectMa):00073 [4]     7029            ldy   #Tbl_Priority_First_Entry_0
80DF 31A6             (./Engine/ObjectMa):00074 [5]     7034            leay  a,y
80E1 ECC838           (./Engine/ObjectMa):00075 [6]     7040            ldd   rsv_priority_next_obj_0,u
80E4 EDA4             (./Engine/ObjectMa):00076 [5]     7045            std   ,y
80E6 200A             (./Engine/ObjectMa):00077 [3]     7048            bra   DOB_CheckPrioNextB0
                      (./Engine/ObjectMa):00078                                 
80E8                  (./Engine/ObjectMa):00079                 DOB_ChainPrevB0
80E8 ECC838           (./Engine/ObjectMa):00080 [6]     7054            ldd   rsv_priority_next_obj_0,u
80EB 10AEC836         (./Engine/ObjectMa):00081 [7]     7061            ldy   rsv_priority_prev_obj_0,u        
80EF EDA838           (./Engine/ObjectMa):00082 [6]     7067            std   rsv_priority_next_obj_0,y        
                      (./Engine/ObjectMa):00083                 
80F2                  (./Engine/ObjectMa):00084                 DOB_CheckPrioNextB0       
80F2 ECC838           (./Engine/ObjectMa):00085 [6]     7073            ldd   rsv_priority_next_obj_0,u
80F5 2611             (./Engine/ObjectMa):00086 [3]     7076            bne   DOB_ChainNextB0
                      (./Engine/ObjectMa):00087                 
80F7 A6C835           (./Engine/ObjectMa):00088 [5]     7081            lda   rsv_priority_0,u
80FA 48               (./Engine/ObjectMa):00089 [2]     7083            lsla
80FB 108E725C         (./Engine/ObjectMa):00090 [4]     7087            ldy   #Tbl_Priority_Last_Entry_0
80FF 31A6             (./Engine/ObjectMa):00091 [5]     7092            leay  a,y
8101 ECC836           (./Engine/ObjectMa):00092 [6]     7098            ldd   rsv_priority_prev_obj_0,u
8104 EDA4             (./Engine/ObjectMa):00093 [5]     7103            std   ,y
8106 20B3             (./Engine/ObjectMa):00094 [3]     7106            bra   DOB_TestOnscreen1
                      (./Engine/ObjectMa):00095                                 
8108                  (./Engine/ObjectMa):00096                 DOB_ChainNextB0
8108 ECC836           (./Engine/ObjectMa):00097 [6]     7112            ldd   rsv_priority_prev_obj_0,u
810B 10AEC838         (./Engine/ObjectMa):00098 [7]     7119            ldy   rsv_priority_next_obj_0,u        
810F EDA836           (./Engine/ObjectMa):00099 [6]     7125            std   rsv_priority_prev_obj_0,y
8112 20A7             (./Engine/ObjectMa):00100 [3]     7128            bra   DOB_TestOnscreen1        
                      (./Engine/ObjectMa):00101                 
8114                  (./Engine/ObjectMa):00102                 DOB_RemoveFromDPSB1
8114 ECC84A           (./Engine/ObjectMa):00103 [6]     7134            ldd   rsv_priority_prev_obj_1,u
8117 2611             (./Engine/ObjectMa):00104 [3]     7137            bne   DOB_ChainPrevB1
                      (./Engine/ObjectMa):00105                         
8119 A6C849           (./Engine/ObjectMa):00106 [5]     7142            lda   rsv_priority_1,u
811C 48               (./Engine/ObjectMa):00107 [2]     7144            lsla
811D 108E72AC         (./Engine/ObjectMa):00108 [4]     7148            ldy   #Tbl_Priority_First_Entry_1
8121 31A6             (./Engine/ObjectMa):00109 [5]     7153            leay  a,y
8123 ECC84C           (./Engine/ObjectMa):00110 [6]     7159            ldd   rsv_priority_next_obj_1,u
8126 EDA4             (./Engine/ObjectMa):00111 [5]     7164            std   ,y
8128 200A             (./Engine/ObjectMa):00112 [3]     7167            bra   DOB_CheckPrioNextB1
                      (./Engine/ObjectMa):00113                                 
812A                  (./Engine/ObjectMa):00114                 DOB_ChainPrevB1
812A ECC84C           (./Engine/ObjectMa):00115 [6]     7173            ldd   rsv_priority_next_obj_1,u
812D 10AEC84A         (./Engine/ObjectMa):00116 [7]     7180            ldy   rsv_priority_prev_obj_1,u        
8131 EDA84C           (./Engine/ObjectMa):00117 [6]     7186            std   rsv_priority_next_obj_1,y        
                      (./Engine/ObjectMa):00118                 
8134                  (./Engine/ObjectMa):00119                 DOB_CheckPrioNextB1       
8134 ECC84C           (./Engine/ObjectMa):00120 [6]     7192            ldd   rsv_priority_next_obj_1,u
8137 2619             (./Engine/ObjectMa):00121 [3]     7195            bne   DOB_ChainNextB1
                      (./Engine/ObjectMa):00122                 
8139 A6C849           (./Engine/ObjectMa):00123 [5]     7200            lda   rsv_priority_1,u
813C 48               (./Engine/ObjectMa):00124 [2]     7202            lsla
813D 108E72BE         (./Engine/ObjectMa):00125 [4]     7206            ldy   #Tbl_Priority_Last_Entry_1
8141 31A6             (./Engine/ObjectMa):00126 [5]     7211            leay  a,y
8143 ECC84A           (./Engine/ObjectMa):00127 [6]     7217            ldd   rsv_priority_prev_obj_1,u
8146 EDA4             (./Engine/ObjectMa):00128 [5]     7222            std   ,y
8148 A6C848           (./Engine/ObjectMa):00129 [5]     7227            lda   rsv_prev_render_flags_0,u
814B 2B03             (./Engine/ObjectMa):00130 [3]     7230            bmi   DOB_rts                       ; branch if onscreen on buffer 0 (do not erase object)        
814D BD8166           (./Engine/ObjectMa):00131 [8]     7238            jsr   ClearObj                      ; this object is not onscreen anymore, clear this object now
8150                  (./Engine/ObjectMa):00132                 DOB_rts                                *
8150 35D6             (./Engine/ObjectMa):00133 [13]    7251            puls  d,x,u,pc        
                      (./Engine/ObjectMa):00134                                 
8152                  (./Engine/ObjectMa):00135                 DOB_ChainNextB1
8152 ECC84A           (./Engine/ObjectMa):00136 [6]     7257            ldd   rsv_priority_prev_obj_1,u
8155 10AEC84C         (./Engine/ObjectMa):00137 [7]     7264            ldy   rsv_priority_next_obj_1,u        
8159 EDA84A           (./Engine/ObjectMa):00138 [6]     7270            std   rsv_priority_prev_obj_1,y
815C A6C848           (./Engine/ObjectMa):00139 [5]     7275            lda   rsv_prev_render_flags_0,u
815F 2BEF             (./Engine/ObjectMa):00140 [3]     7278            bmi   DOB_rts                       ; branch if onscreen on buffer 0 (do not erase object)        
8161 BD8166           (./Engine/ObjectMa):00141 [8]     7286            jsr   ClearObj                      ; this object is not onscreen anymore, clear this object now
8164 35D6             (./Engine/ObjectMa):00142 [13]    7299            puls  d,x,u,pc        
                      (./Engine/ObjectMa):00143                 
                      (./Engine/ObjectMa):00144                                                        *    moveq   #0,d1
                      (./Engine/ObjectMa):00145                                                        *
                      (./Engine/ObjectMa):00146                                                        *    moveq   #bytesToLcnt(next_object),d0 ; we want to clear up to the next object
                      (./Engine/ObjectMa):00147                                                        *    ; delete the object by setting all of its bytes to 0
                      (./Engine/ObjectMa):00148                                                        *-   move.l  d1,(a1)+
                      (./Engine/ObjectMa):00149                                                        *    dbf d0,-
                      (./Engine/ObjectMa):00150                                                        *    if object_size&3
                      (./Engine/ObjectMa):00151                                                        *    move.w  d1,(a1)+
                      (./Engine/ObjectMa):00152                                                        *    endif
                      (./Engine/ObjectMa):00153                                                        *
                      (./Engine/ObjectMa):00154                                                        *    rts
                      (./Engine/ObjectMa):00155                                                        *; End of function DeleteObject2                                            
                      (C:\Users\bhrou\gi):00271                         INCLUDE "./engine/object-management/clear-obj-107.asm"  
                      (./engine/object-m):00001                 * ---------------------------------------------------------------------------
                      (./engine/object-m):00002                 * ClearObj107
                      (./engine/object-m):00003                 * -----------
                      (./engine/object-m):00004                 * Subroutine to clear an object data in OST and ext_variables
                      (./engine/object-m):00005                 *
                      (./engine/object-m):00006                 * input REG : [u] pointer on objet (OST)
                      (./engine/object-m):00007                 * clear REG : [d,y]
                      (./engine/object-m):00008                 * ---------------------------------------------------------------------------
                      (./engine/object-m):00009                 
8166                  (./engine/object-m):00010                 ClearObj
8166 3476             (./engine/object-m):00011 [13]    7312            pshs  d,x,y,u
8168 10FF8195         (./engine/object-m):00012 [7]     7319            sts   CLO_1+2
816C 32C86B           (./engine/object-m):00013 [5]     7324            leas  107,u        
816F CC0000           (./engine/object-m):00014 [3]     7327            ldd   #$0000
8172 8E0000           (./engine/object-m):00015 [3]     7330            ldx   #$0000
8175 3184             (./engine/object-m):00016 [4]     7334            leay  ,x
8177 3384             (./engine/object-m):00017 [4]     7338            leau  ,x
8179 3476             (./engine/object-m):00018 [13]    7351            pshs  d,x,y,u
817B 3476             (./engine/object-m):00019 [13]    7364            pshs  d,x,y,u
817D 3476             (./engine/object-m):00020 [13]    7377            pshs  d,x,y,u
817F 3476             (./engine/object-m):00021 [13]    7390            pshs  d,x,y,u
8181 3476             (./engine/object-m):00022 [13]    7403            pshs  d,x,y,u
8183 3476             (./engine/object-m):00023 [13]    7416            pshs  d,x,y,u
8185 3476             (./engine/object-m):00024 [13]    7429            pshs  d,x,y,u
8187 3476             (./engine/object-m):00025 [13]    7442            pshs  d,x,y,u
8189 3476             (./engine/object-m):00026 [13]    7455            pshs  d,x,y,u
818B 3476             (./engine/object-m):00027 [13]    7468            pshs  d,x,y,u
818D 3476             (./engine/object-m):00028 [13]    7481            pshs  d,x,y,u
818F 3402             (./engine/object-m):00029 [6]     7487            pshs  a
8191 33E4             (./engine/object-m):00030 [4]     7491            leau  ,s
8193                  (./engine/object-m):00031                 CLO_1        
8193 10CE0000         (./engine/object-m):00032 [4]     7495            lds   #$0000        ; start of object should not be written with S as an index because of IRQ        
8197 3636             (./engine/object-m):00033 [11]    7506            pshu  d,x,y         ; saving 12 bytes + (2 bytes * _sr calls) inside IRQ routine
8199 3636             (./engine/object-m):00034 [11]    7517            pshu  d,x,y         ; DEPENDENCY on nb of _sr calls inside IRQ routine  (here 18 bytes of margin)
819B 3636             (./engine/object-m):00035 [11]    7528            pshu  d,x,y         ; DEPENDENCY on object_size definition
819D                  (./engine/object-m):00036                 CLO_2        
819D 35F6             (./engine/object-m):00037 [15]    7543            puls  d,x,y,u,pc
                      (C:\Users\bhrou\gi):00272                         INCLUDE "./Engine/Ram/ClearDataMemory.asm"
                      (./Engine/Ram/Clea):00001                 ********************************************************************************
                      (./Engine/Ram/Clea):00002                 * Clear memory in data area
                      (./Engine/Ram/Clea):00003                 ********************************************************************************
                      (./Engine/Ram/Clea):00004                 
819F                  (./Engine/Ram/Clea):00005                 ClearDataMem 
819F 3448             (./Engine/Ram/Clea):00006 [8]     7551            pshs  u,dp
81A1 10FF81CF         (./Engine/Ram/Clea):00007 [7]     7558            sts   ClearDataMem_3+2
81A5 10CEE000         (./Engine/Ram/Clea):00008 [4]     7562            lds   #$E000
81A9 3384             (./Engine/Ram/Clea):00009 [4]     7566            leau  ,x
81AB 3184             (./Engine/Ram/Clea):00010 [4]     7570            leay  ,x
81AD 1F10             (./Engine/Ram/Clea):00011 [6]     7576            tfr   x,d
81AF 1F8B             (./Engine/Ram/Clea):00012 [6]     7582            tfr   a,dp
81B1                  (./Engine/Ram/Clea):00013                 ClearDataMem_2
81B1 347E             (./Engine/Ram/Clea):00014 [14]    7596            pshs  u,y,x,dp,b,a
81B3 347E             (./Engine/Ram/Clea):00015 [14]    7610            pshs  u,y,x,dp,b,a
81B5 347E             (./Engine/Ram/Clea):00016 [14]    7624            pshs  u,y,x,dp,b,a
81B7 347E             (./Engine/Ram/Clea):00017 [14]    7638            pshs  u,y,x,dp,b,a
81B9 347E             (./Engine/Ram/Clea):00018 [14]    7652            pshs  u,y,x,dp,b,a
81BB 347E             (./Engine/Ram/Clea):00019 [14]    7666            pshs  u,y,x,dp,b,a
81BD 347E             (./Engine/Ram/Clea):00020 [14]    7680            pshs  u,y,x,dp,b,a
81BF 347E             (./Engine/Ram/Clea):00021 [14]    7694            pshs  u,y,x,dp,b,a
81C1 347E             (./Engine/Ram/Clea):00022 [14]    7708            pshs  u,y,x,dp,b,a
81C3 3478             (./Engine/Ram/Clea):00023 [12]    7720            pshs  u,y,x,dp
81C5 118CA010         (./Engine/Ram/Clea):00024 [5]     7725            cmps  #$A010                        
81C9 26E6             (./Engine/Ram/Clea):00025 [3]     7728            bne   ClearDataMem_2
81CB 33E4             (./Engine/Ram/Clea):00026 [4]     7732            leau  ,s        
81CD                  (./Engine/Ram/Clea):00027                 ClearDataMem_3        
81CD 10CE0000         (./Engine/Ram/Clea):00028 [4]     7736            lds   #$0000        ; start of memory should not be written with S as an index because of IRQ        
81D1 3636             (./Engine/Ram/Clea):00029 [11]    7747            pshu  d,x,y         ; saving 12 bytes + (2 bytes * _sr calls) inside IRQ routine
81D3 3636             (./Engine/Ram/Clea):00030 [11]    7758            pshu  d,x,y         ; DEPENDENCY on nb of _sr calls inside IRQ routine (here 16 bytes of margin)
81D5 3616             (./Engine/Ram/Clea):00031 [9]     7767            pshu  d,x
81D7 35C8             (./Engine/Ram/Clea):00032 [10]    7777            puls  dp,u,pc
                      (C:\Users\bhrou\gi):00273                         INCLUDE "./Engine/Irq/IrqSmpsObj.asm"      
                      (./Engine/Irq/IrqS):00001                 * ---------------------------------------------------------------------------
                      (./Engine/Irq/IrqS):00002                 * IrqSmps
                      (./Engine/Irq/IrqS):00003                 * -------
                      (./Engine/Irq/IrqS):00004                 * IRQ Subroutine to play sound with SN76489/YM2413
                      (./Engine/Irq/IrqS):00005                 *
                      (./Engine/Irq/IrqS):00006                 * input REG : [dp] with value E7 (from Monitor ROM)
                      (./Engine/Irq/IrqS):00007                 * reset REG : none
                      (./Engine/Irq/IrqS):00008                 *
                      (./Engine/Irq/IrqS):00009                 * IrqOn
                      (./Engine/Irq/IrqS):00010                 * reset REG : [a]
                      (./Engine/Irq/IrqS):00011                 *
                      (./Engine/Irq/IrqS):00012                 * IrqOff
                      (./Engine/Irq/IrqS):00013                 * reset REG : [a]
                      (./Engine/Irq/IrqS):00014                 *
                      (./Engine/Irq/IrqS):00015                 * IrqSync
                      (./Engine/Irq/IrqS):00016                 * input REG : [a] screen line (0-199)
                      (./Engine/Irq/IrqS):00017                 *             [x] timer value
                      (./Engine/Irq/IrqS):00018                 * reset REG : [d]
                      (./Engine/Irq/IrqS):00019                 * ---------------------------------------------------------------------------
                      (./Engine/Irq/IrqS):00020                 
     6027             (./Engine/Irq/IrqS):00021                 irq_routine       equ $6027 
     E7C5             (./Engine/Irq/IrqS):00022                 irq_timer_ctrl    equ $E7C5 
     E7C6             (./Engine/Irq/IrqS):00023                 irq_timer         equ $E7C6
     4DFF             (./Engine/Irq/IrqS):00024                 irq_one_frame     equ 312*64-1               ; one frame timer (lines*cycles_per_lines-1), timer launch at -1
                      (./Engine/Irq/IrqS):00025                 
                      (./Engine/Irq/IrqS):00026                 SmpsVar STRUCT
0000s                 (./Engine/Irq/IrqS):00027                 SFXPriorityVal                 rmb   1        
0001s                 (./Engine/Irq/IrqS):00028                 TempoTimeout                   rmb   1        
0002s                 (./Engine/Irq/IrqS):00029                 CurrentTempo                   rmb   1                ; Stores current tempo value here
0003s                 (./Engine/Irq/IrqS):00030                 StopMusic                      rmb   1                ; Set to 7Fh to pause music, set to 80h to unpause. Otherwise 00h
0004s                 (./Engine/Irq/IrqS):00031                 FadeOutCounter                 rmb   1        
0005s                 (./Engine/Irq/IrqS):00032                 FadeOutDelay                   rmb   1        
0006s                 (./Engine/Irq/IrqS):00033                 QueueToPlay                    rmb   1                ; if NOT set to 80h, means new index was requested by 68K
0007s                 (./Engine/Irq/IrqS):00034                 SFXToPlay                      rmb   1                ; When Genesis wants to play "normal" sound, it writes it here
0008s                 (./Engine/Irq/IrqS):00035                 VoiceTblPtr                    rmb   2                ; address of the voices
000As                 (./Engine/Irq/IrqS):00036                 SFXVoiceTblPtr                 rmb   2                ; address of the SFX voices
000Cs                 (./Engine/Irq/IrqS):00037                 FadeInFlag                     rmb   1        
000Ds                 (./Engine/Irq/IrqS):00038                 FadeInDelay                    rmb   1        
000Es                 (./Engine/Irq/IrqS):00039                 FadeInCounter                  rmb   1        
000Fs                 (./Engine/Irq/IrqS):00040                 1upPlaying                     rmb   1        
0010s                 (./Engine/Irq/IrqS):00041                 TempoMod                       rmb   1        
0011s                 (./Engine/Irq/IrqS):00042                 TempoTurbo                     rmb   1                ; Stores the tempo if speed shoes are acquired (or 7Bh is played anywho)
0012s                 (./Engine/Irq/IrqS):00043                 SpeedUpFlag                    rmb   1        
0013s                 (./Engine/Irq/IrqS):00044                 DACEnabled                     rmb   1                
0014s                 (./Engine/Irq/IrqS):00045                 60HzData                       rmb   1                ; 1: play 60hz track at 50hz, 0: do not skip frames
0015s                 (./Engine/Irq/IrqS):00046                  ENDSTRUCT
                      (./Engine/Irq/IrqS):00047                 
81D9                  (./Engine/Irq/IrqS):00048                 SmpsStructStart
81D9                  (./Engine/Irq/IrqS):00049                 Smps          SmpsVar
                      (./Engine/Irq/IrqS):00050                         org   SmpsStructStart                
81D9 0000000000000000 (./Engine/Irq/IrqS):00051                         fill  0,sizeof{SmpsVar}
     0000000000000000
     0000000000
                      (./Engine/Irq/IrqS):00052                        
81EE                  (./Engine/Irq/IrqS):00053                 IrqSet50Hz
81EE C642             (./Engine/Irq/IrqS):00054 [2]     7779            ldb   #$42
81F0 F7E7C5           (./Engine/Irq/IrqS):00055 [5]     7784            stb   irq_timer_ctrl                     ; timer precision x8
81F3 CC823A           (./Engine/Irq/IrqS):00056 [3]     7787            ldd   #IrqSmps
81F6 FD6027           (./Engine/Irq/IrqS):00057 [6]     7793            std   irq_routine
                      (./Engine/Irq/IrqS):00058                 
81F9 86C7             (./Engine/Irq/IrqS):00059 [2]     7795            lda   #199                               ; screen line to sync
81FB 8E4DFF           (./Engine/Irq/IrqS):00060 [3]     7798            ldx   #irq_one_frame                     ; on every frame
81FE BD821B           (./Engine/Irq/IrqS):00061 [8]     7806            jsr   IrqSync
8201 BD8205           (./Engine/Irq/IrqS):00062 [8]     7814            jsr   IrqOn 
8204 39               (./Engine/Irq/IrqS):00063 [5]     7819            rts
                      (./Engine/Irq/IrqS):00064                        
8205                  (./Engine/Irq/IrqS):00065                 IrqOn         
8205 B66019           (./Engine/Irq/IrqS):00066 [5]     7824            lda   $6019                           
8208 8A20             (./Engine/Irq/IrqS):00067 [2]     7826            ora   #$20
820A B76019           (./Engine/Irq/IrqS):00068 [5]     7831            sta   $6019                                   ; STATUS register
820D 1CEF             (./Engine/Irq/IrqS):00069 [3]     7834            andcc #$EF                                    ; tell 6809 to activate irq
820F 39               (./Engine/Irq/IrqS):00070 [5]     7839            rts
                      (./Engine/Irq/IrqS):00071                         
8210                  (./Engine/Irq/IrqS):00072                 IrqOff 
8210 B66019           (./Engine/Irq/IrqS):00073 [5]     7844            lda   $6019                           
8213 84DF             (./Engine/Irq/IrqS):00074 [2]     7846            anda  #$DF
8215 B76019           (./Engine/Irq/IrqS):00075 [5]     7851            sta   $6019                                   ; STATUS register
8218 1A10             (./Engine/Irq/IrqS):00076 [3]     7854            orcc  #$10                                    ; tell 6809 to activate irq
821A 39               (./Engine/Irq/IrqS):00077 [5]     7859            rts
                      (./Engine/Irq/IrqS):00078                         
821B                  (./Engine/Irq/IrqS):00079                 IrqSync 
821B C642             (./Engine/Irq/IrqS):00080 [2]     7861            ldb   #$42
821D F7E7C5           (./Engine/Irq/IrqS):00081 [5]     7866            stb   irq_timer_ctrl
                      (./Engine/Irq/IrqS):00082                         
8220 C608             (./Engine/Irq/IrqS):00083 [2]     7868            ldb   #8                                      ; ligne * 64 (cycles par ligne) / 8 (nb cycles boucle tempo)
8222 3D               (./Engine/Irq/IrqS):00084 [11]    7879            mul
8223 1F02             (./Engine/Irq/IrqS):00085 [6]     7885            tfr   d,y
8225 31A8E0           (./Engine/Irq/IrqS):00086 [5]     7890            leay  -32,y                                   ; manual adjustment
                      (./Engine/Irq/IrqS):00087                 
8228                  (./Engine/Irq/IrqS):00088                 IrqSync_1
8228 7DE7E7           (./Engine/Irq/IrqS):00089 [7]     7897            tst   $E7E7                                   ;
822B 2BFB             (./Engine/Irq/IrqS):00090 [3]     7900            bmi   IrqSync_1                               ; while spot is in a visible screen line        
822D                  (./Engine/Irq/IrqS):00091                 IrqSync_2
822D 7DE7E7           (./Engine/Irq/IrqS):00092 [7]     7907            tst   $E7E7                                   ;
8230 2AFB             (./Engine/Irq/IrqS):00093 [3]     7910            bpl   IrqSync_2                               ; while spot is not in a visible screen line
8232                  (./Engine/Irq/IrqS):00094                 IrqSync_3
8232 313F             (./Engine/Irq/IrqS):00095 [5]     7915            leay  -1,y                                    ;
8234 26FC             (./Engine/Irq/IrqS):00096 [3]     7918            bne   IrqSync_3                               ; wait until desired line
                      (./Engine/Irq/IrqS):00097                        
8236 BFE7C6           (./Engine/Irq/IrqS):00098 [6]     7924            stx   irq_timer                               ; spot is at the end of desired line
8239 39               (./Engine/Irq/IrqS):00099 [5]     7929            rts     
                      (./Engine/Irq/IrqS):00100                 
823A                  (./Engine/Irq/IrqS):00101                 IrqSmps 
823A 10FF828A         (./Engine/Irq/IrqS):00102 [7]     7936            sts   @bcks                                   ; backup system stack
823E 10CE82AF         (./Engine/Irq/IrqS):00103 [4]     7940            lds   #IRQSysStack                            ; set tmp system stack for IRQ 
                      (./Engine/Irq/IrqS):00104                         _GetCartPageA
                      (    _GetCartPageA):00001                  IFDEF T2
8242 BD6FD0           (    _GetCartPageA):00002 [8]     7948            jsr   GetCartPageA
                      (    _GetCartPageA):00003                  ELSE
                      (    _GetCartPageA):00004                         lda   $E7E6
                      (    _GetCartPageA):00005                  ENDC
8245 B78284           (./Engine/Irq/IrqS):00105 [5]     7953            sta   IrqSmps_end+1                           ; backup data page
8248 FC7039           (./Engine/Irq/IrqS):00106 [6]     7959            ldd   Vint_runcount
824B C30001           (./Engine/Irq/IrqS):00107 [4]     7963            addd  #1
824E FD7039           (./Engine/Irq/IrqS):00108 [6]     7969            std   Vint_runcount
8251                  (./Engine/Irq/IrqS):00109                 PaletteCycling
8251 B682AF           (./Engine/Irq/IrqS):00110 [5]     7974            lda   glb_pal_elapsed_frames
8254 4C               (./Engine/Irq/IrqS):00111 [2]     7976            inca
8255 B782AF           (./Engine/Irq/IrqS):00112 [5]     7981            sta   glb_pal_elapsed_frames
8258 8108             (./Engine/Irq/IrqS):00113 [2]     7983            cmpa  #8
825A 2F17             (./Engine/Irq/IrqS):00114 [3]     7986            ble   @a        
825C 8600             (./Engine/Irq/IrqS):00115 [2]     7988            lda   #0
825E B782AF           (./Engine/Irq/IrqS):00116 [5]     7993            sta   glb_pal_elapsed_frames
8261 B782B0           (./Engine/Irq/IrqS):00117 [5]     7998            sta   Refresh_palette
8264 BE82B1           (./Engine/Irq/IrqS):00118 [6]     8004            ldx   Cur_palette
8267 EE04             (./Engine/Irq/IrqS):00119 [6]     8010            ldu   4,x
8269 EC02             (./Engine/Irq/IrqS):00120 [6]     8016            ldd   2,x
826B ED04             (./Engine/Irq/IrqS):00121 [6]     8022            std   4,x
826D EC84             (./Engine/Irq/IrqS):00122 [5]     8027            ldd   ,x
826F ED02             (./Engine/Irq/IrqS):00123 [6]     8033            std   2,x
8271 EF84             (./Engine/Irq/IrqS):00124 [5]     8038            stu   ,x
8273                  (./Engine/Irq/IrqS):00125                 @a
8273 BD8313           (./Engine/Irq/IrqS):00126 [8]     8046            jsr   UpdatePalette
                      (./Engine/Irq/IrqS):00127                         _RunObjectRoutine ObjID_Smps,#4               ; MusicFrame
                      (_RunObjectRoutine):00001                         _MountObject ObjID_Smps
8276 B69825           (     _MountObject):00001 [5]     8051            lda   Obj_Index_Page+ObjID_Smps
                      (     _MountObject):00002                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
8279 BD6F74           (    _SetCartPageA):00002 [8]     8059            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
827C BE9831           (     _MountObject):00003 [6]     8065            ldx   Obj_Index_Address+2*ObjID_Smps
827F 8604             (_RunObjectRoutine):00002 [2]     8067            lda   #4        
8281 AD84             (_RunObjectRoutine):00003 [7]     8074            jsr   ,x
8283                  (./Engine/Irq/IrqS):00128                 IrqSmps_end        
8283 8600             (./Engine/Irq/IrqS):00129 [2]     8076            lda   #$00                                    ; (dynamic)
                      (./Engine/Irq/IrqS):00130                         _SetCartPageA                                 ; restore data page
                      (    _SetCartPageA):00001                  IFDEF T2
8285 BD6F74           (    _SetCartPageA):00002 [8]     8084            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
8288 10CE0000         (./Engine/Irq/IrqS):00131 [4]     8088            lds   #0                                      ; (dynamic) restore system stack   
     828A             (./Engine/Irq/IrqS):00132                 @bcks   equ   *-2
828C 7EE830           (./Engine/Irq/IrqS):00133 [4]     8092            jmp   $E830                                   ; return to caller
                      (./Engine/Irq/IrqS):00134                 
                      (./Engine/Irq/IrqS):00135                 ; This space allow the use of system stack inside IRQ calls
                      (./Engine/Irq/IrqS):00136                 ; otherwise the writes in sys stack will erase data when S is in use
                      (./Engine/Irq/IrqS):00137                 ; (outside of IRQ) for another task than sys stack, ex: stack blast copy 
828F 0000000000000000 (./Engine/Irq/IrqS):00138                               fill  0,32
     0000000000000000
     0000000000000000
     0000000000000000
82AF                  (./Engine/Irq/IrqS):00139                 IRQSysStack
                      (./Engine/Irq/IrqS):00140                 
82AF 00               (./Engine/Irq/IrqS):00141                 glb_pal_elapsed_frames fcb 0
                      (./Engine/Irq/IrqS):00142                         INCLUDE "./Engine/Palette/UpdatePalette.asm"
                      (./Engine/Palette/):00001                 * ---------------------------------------------------------------------------
                      (./Engine/Palette/):00002                 * UpdatePalette
                      (./Engine/Palette/):00003                 * -------------
                      (./Engine/Palette/):00004                 * Subroutine to update palette
                      (./Engine/Palette/):00005                 * should be called just after WaitVBL
                      (./Engine/Palette/):00006                 *
                      (./Engine/Palette/):00007                 * input REG : none
                      (./Engine/Palette/):00008                 * reset REG : [d] [x] [y]
                      (./Engine/Palette/):00009                 * ---------------------------------------------------------------------------
                      (./Engine/Palette/):00010                 
82B0 FF               (./Engine/Palette/):00011                 Refresh_palette fcb   $FF            
82B1 82B3             (./Engine/Palette/):00012                 Cur_palette     fdb   Dyn_palette    
82B3 0000000000000000 (./Engine/Palette/):00013                 Dyn_palette     fill  0,$20          
     0000000000000000
     0000000000000000
     0000000000000000
82D3 0000000000000000 (./Engine/Palette/):00014                 Black_palette   fill  0,$20          
     0000000000000000
     0000000000000000
     0000000000000000
82F3 FF0F             (./Engine/Palette/):00015                 White_palette   fdb   $ff0f          
82F5 FF0F             (./Engine/Palette/):00016                                 fdb   $ff0f
82F7 FF0F             (./Engine/Palette/):00017                                 fdb   $ff0f
82F9 FF0F             (./Engine/Palette/):00018                                 fdb   $ff0f
82FB FF0F             (./Engine/Palette/):00019                                 fdb   $ff0f
82FD FF0F             (./Engine/Palette/):00020                                 fdb   $ff0f
82FF FF0F             (./Engine/Palette/):00021                                 fdb   $ff0f
8301 FF0F             (./Engine/Palette/):00022                                 fdb   $ff0f
8303 FF0F             (./Engine/Palette/):00023                                 fdb   $ff0f               
8305 FF0F             (./Engine/Palette/):00024                                 fdb   $ff0f
8307 FF0F             (./Engine/Palette/):00025                                 fdb   $ff0f
8309 FF0F             (./Engine/Palette/):00026                                 fdb   $ff0f
830B FF0F             (./Engine/Palette/):00027                                 fdb   $ff0f
830D FF0F             (./Engine/Palette/):00028                                 fdb   $ff0f
830F FF0F             (./Engine/Palette/):00029                                 fdb   $ff0f
8311 FF0F             (./Engine/Palette/):00030                                 fdb   $ff0f
                      (./Engine/Palette/):00031                 
8313                  (./Engine/Palette/):00032                 UpdatePalette 
8313 7D82B0           (./Engine/Palette/):00033 [7]     8099            tst   Refresh_palette
8316 2701             (./Engine/Palette/):00034 [3]     8102            beq   @a
8318 39               (./Engine/Palette/):00035 [5]     8107            rts
8319 3408             (./Engine/Palette/):00036 [6]     8113    @a      pshs  dp        
831B 108E0195         (./Engine/Palette/):00037 [4]     8117            ldy   #0405                    * 3328 (52 lignes) - 88 (cycles apres VBL)
831F                  (./Engine/Palette/):00038                 UPP_Tempo        
831F 313F             (./Engine/Palette/):00039 [5]     8122            leay  -1,y
8321 26FC             (./Engine/Palette/):00040 [3]     8125            bne   UPP_Tempo                * tempo pour etre dans la bordure invisible
8323 C6E7             (./Engine/Palette/):00041 [2]     8127            ldb   #$E7
8325 1F9B             (./Engine/Palette/):00042 [6]     8133            tfr   b,dp        
8327 BE82B1           (./Engine/Palette/):00043 [6]     8139            ldx   Cur_palette
832A 0FDB             (./Engine/Palette/):00044 [6]     8145            clr   <$DB                     * indice couleur a 0
832C 108E0010         (./Engine/Palette/):00045 [4]     8149            ldy   #$0010                   * init cpt
8330                  (./Engine/Palette/):00046                 UPP_SetColor
8330 EC81             (./Engine/Palette/):00047 [8]     8157            ldd   ,x++                     * chargement de la couleur et increment du poiteur x
8332 97DA             (./Engine/Palette/):00048 [4]     8161            sta   <$DA                     * set de la couleur Vert et Rouge
8334 D7DA             (./Engine/Palette/):00049 [4]     8165            stb   <$DA                     * set de la couleur Bleu
8336 313F             (./Engine/Palette/):00050 [5]     8170            leay  -1,y
8338 26F6             (./Engine/Palette/):00051 [3]     8173            bne   UPP_SetColor             * on reboucle si fin de liste pas atteinte
833A 7382B0           (./Engine/Palette/):00052 [7]     8180            com   Refresh_palette          * update flag, next run this routine will be ignored if no pal update is requested
833D                  (./Engine/Palette/):00053                 UPP_return
833D 3588             (./Engine/Palette/):00054 [8]     8188            puls dp,pc
                      (./Engine/Palette/):00055                 
                      (./Engine/Palette/):00056                         
                      (./Engine/Palette/):00057                         
                      (C:\Users\bhrou\gi):00274                         INCLUDE "./Engine/Graphics/Tilemap/TilemapBuffer.asm"
                      (./Engine/Graphics):00001                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00002                 *
                      (./Engine/Graphics):00003                 * ---------------------------------------------------------------------------
                      (./Engine/Graphics):00004                 
                      (./Engine/Graphics):00005                         INCLUDE "./Engine/Graphics/Tilemap/DataTypes/map16bits.equ"
                      (./Engine/Graphics):00001                 ; ---------------------------------------------------------------------------
                      (./Engine/Graphics):00002                 ; DataType Offsets for tile layer
                      (./Engine/Graphics):00003                 ; ---------------------------------------------------------------------------
                      (./Engine/Graphics):00004                 
     0000             (./Engine/Graphics):00005                 submap_camera_x_min equ   0  ; w - camera position limit
     0002             (./Engine/Graphics):00006                 submap_camera_y_min equ   2  ; w - camera position limit
     0004             (./Engine/Graphics):00007                 submap_camera_x_max equ   4  ; w - camera position limit
     0006             (./Engine/Graphics):00008                 submap_camera_y_max equ   6  ; w - camera position limit   
     0008             (./Engine/Graphics):00009                 layer_map_width     equ   8  ; b - width (byte) nb of tiles in this layer map rows
     0009             (./Engine/Graphics):00010                 layer_map_height    equ   9  ; b - height (byte) nb of tiles in this layer map columns
     000A             (./Engine/Graphics):00011                 layer_map           equ   10 ; w->[b] map made of 64x128 tiles (1 byte index)
     000C             (./Engine/Graphics):00012                 layer_chunk0        equ   12 ; w->[w] index to chunk definition (subset of 8x8 tiles, 2 bytes index to tile) chunk id 0-127
     000E             (./Engine/Graphics):00013                 layer_chunk1        equ   14 ; w->[w] index to chunk definition (subset of 8x8 tiles, 2 bytes index to tile) chunk id 128-255
     0010             (./Engine/Graphics):00014                 layer_tiles         equ   16 ; w->[bw] index to tile index (page and adress for each tiles, 3 bytes index)
     0012             (./Engine/Graphics):00015                 layer_mul_ref       equ   18 ; [w] - table of precalculated values for y position in map
     9F               (./Engine/Graphics):00006                         SETDP $9F
                      (./Engine/Graphics):00007                 
                      (./Engine/Graphics):00008                 ; data structure for current loaded map
                      (./Engine/Graphics):00009                 ; -------------------------------------
833F 00               (./Engine/Graphics):00010                 glb_map_pge           fcb   0
8340 0000             (./Engine/Graphics):00011                 glb_map_adr           fdb   0
8342 00               (./Engine/Graphics):00012                 glb_map_chunk_pge     fcb   0 ; map data to chunk tiles (8x8 tiles group)
8343 0000             (./Engine/Graphics):00013                 glb_map_chunk_adr     fdb   0 ; map data to chunk tiles (8x8 tiles group)
8345 00               (./Engine/Graphics):00014                 glb_map_defchunk0_pge fcb   0 ; chunk data to tiles (8x16 px)
8346 0000             (./Engine/Graphics):00015                 glb_map_defchunk0_adr fdb   0 ; chunk data to tiles (8x16 px)
8348 00               (./Engine/Graphics):00016                 glb_map_defchunk1_pge fcb   0 ; chunk data to tiles (8x16 px)
8349 0000             (./Engine/Graphics):00017                 glb_map_defchunk1_adr fdb   0 ; chunk data to tiles (8x16 px)
834B 00               (./Engine/Graphics):00018                 glb_map_tiles_pge     fcb   0 ; tile index
834C 0000             (./Engine/Graphics):00019                 glb_map_tiles_adr     fdb   0 ; tile index
834E 00               (./Engine/Graphics):00020                 glb_map_width         fcb   0
                      (./Engine/Graphics):00021                 
                      (./Engine/Graphics):00022                 ; tmp variables
     9F00             (./Engine/Graphics):00023                 h_tl                  equ   glb_tmp_var    ; nb of full sized (middle) horizontal chunks
     9F01             (./Engine/Graphics):00024                 h_tl_bck              equ   glb_tmp_var+1
     9F02             (./Engine/Graphics):00025                 v_tl                  equ   glb_tmp_var+2  ; nb of full sized (middle) vertical chunks
     9F03             (./Engine/Graphics):00026                 c_h_tl                equ   glb_tmp_var+3  ; variable that stores current left, middle or right width of chunks
     9F04             (./Engine/Graphics):00027                 l_h_tl                equ   glb_tmp_var+4 
     9F05             (./Engine/Graphics):00028                 r_h_tl                equ   glb_tmp_var+5 
     9F06             (./Engine/Graphics):00029                 r_h_tl_bck            equ   glb_tmp_var+6 
     9F07             (./Engine/Graphics):00030                 c_v_tl                equ   glb_tmp_var+7  ; variable that stores current up, middle or bottom height of chunks
     9F08             (./Engine/Graphics):00031                 u_v_tl                equ   glb_tmp_var+8 
     9F09             (./Engine/Graphics):00032                 b_v_tl                equ   glb_tmp_var+9 
     9F0A             (./Engine/Graphics):00033                 c_h_tl_bck            equ   glb_tmp_var+10 ; backup value of horizontal width of chunks
     9F0B             (./Engine/Graphics):00034                 c_v_tl_bck            equ   glb_tmp_var+11 ; backup value of vertical height of chunks
     9F0C             (./Engine/Graphics):00035                 cur_c                 equ   glb_tmp_var+12 ; current chunk id
     9F0D             (./Engine/Graphics):00036                 x_off                 equ   glb_tmp_var+13 ; x start position in top left chunk
     9F0F             (./Engine/Graphics):00037                 y_off                 equ   glb_tmp_var+15 ; y start position in top left chunk
     9F11             (./Engine/Graphics):00038                 b_loc                 equ   glb_tmp_var+17 ; location in buffer
     9F13             (./Engine/Graphics):00039                 tmb_x                 equ   glb_tmp_var+19
     9F15             (./Engine/Graphics):00040                 tmb_y                 equ   glb_tmp_var+21
     9F17             (./Engine/Graphics):00041                 DBT_lcpt              equ   glb_tmp_var+23
     9F18             (./Engine/Graphics):00042                 DBT_ccpt              equ   glb_tmp_var+24
                      (./Engine/Graphics):00043                 
                      (./Engine/Graphics):00044                 ; persistant variables
834F 0000             (./Engine/Graphics):00045                 tmb_old_camera_x      fdb   0 ; last camera position (x axis)
8351 0000             (./Engine/Graphics):00046                 tmb_old_camera_y      fdb   0 ; last camera position (y axis)
                      (./Engine/Graphics):00047                 
     0012             (./Engine/Graphics):00048                 tmb_vp_h_tiles        equ   18 ; viewport tiles on x axis
     000B             (./Engine/Graphics):00049                 tmb_vp_v_tiles        equ   11 ; viewport tiles on y axis
     0090             (./Engine/Graphics):00050                 tmb_vp_h_px           equ   tmb_vp_h_tiles*8
     00B0             (./Engine/Graphics):00051                 tmb_vp_v_px           equ   tmb_vp_v_tiles*16
                      (./Engine/Graphics):00052                 
8353                  (./Engine/Graphics):00053                 InitTileBuffer
8353 DCF3             (./Engine/Graphics):00054 [5]     8193            ldd   <glb_camera_x_pos
8355 C30090           (./Engine/Graphics):00055 [4]     8197            addd  #tmb_vp_h_px
8358 FD834F           (./Engine/Graphics):00056 [6]     8203            std   tmb_old_camera_x
835B DCF1             (./Engine/Graphics):00057 [5]     8208            ldd   <glb_camera_y_pos
835D C300B0           (./Engine/Graphics):00058 [4]     8212            addd  #tmb_vp_v_px
8360 FD8351           (./Engine/Graphics):00059 [6]     8218            std   tmb_old_camera_y
8363 39               (./Engine/Graphics):00060 [5]     8223            rts
                      (./Engine/Graphics):00061                 
8364                  (./Engine/Graphics):00062                 ComputeTileBuffer
                      (./Engine/Graphics):00063                 
                      (./Engine/Graphics):00064                         ; check if a map was registred
                      (./Engine/Graphics):00065                         ; ---------------------------------------------------------------------
                      (./Engine/Graphics):00066                 
8364 B6833F           (./Engine/Graphics):00067 [5]     8228            lda   glb_map_pge
8367 2601             (./Engine/Graphics):00068 [3]     8231            bne   @a
8369 39               (./Engine/Graphics):00069 [5]     8236            rts
836A                  (./Engine/Graphics):00070                 @a
                      (./Engine/Graphics):00071                 
                      (./Engine/Graphics):00072                         ; compute tiles that needs to be added to buffer
                      (./Engine/Graphics):00073                         ; ---------------------------------------------------------------------
                      (./Engine/Graphics):00074                 
                      (./Engine/Graphics):00075                         ; compute y location
836A DEF1             (./Engine/Graphics):00076 [5]     8241            ldu   <glb_camera_y_pos
836C FC8351           (./Engine/Graphics):00077 [6]     8247            ldd   tmb_old_camera_y
836F 93F1             (./Engine/Graphics):00078 [6]     8253            subd  <glb_camera_y_pos
8371 2744             (./Engine/Graphics):00079 [3]     8256            beq   @next
8373 2A06             (./Engine/Graphics):00080 [3]     8259            bpl   @a
8375 33C900B0         (./Engine/Graphics):00081 [8]     8267            leau  tmb_vp_v_px,u
8379 33CB             (./Engine/Graphics):00082 [8]     8275            leau  d,u
837B DF15             (./Engine/Graphics):00083 [5]     8280    @a      stu   tmb_y
                      (./Engine/Graphics):00084                         ; compute height in tiles
837D DCF1             (./Engine/Graphics):00085 [5]     8285            ldd   <glb_camera_y_pos
                      (./Engine/Graphics):00086                         _asrd
837F 47               (            _asrd):00001 [2]     8287            asra
8380 56               (            _asrd):00002 [2]     8289            rorb
                      (./Engine/Graphics):00087                         _asrd
8381 47               (            _asrd):00001 [2]     8291            asra
8382 56               (            _asrd):00002 [2]     8293            rorb
                      (./Engine/Graphics):00088                         _asrd
8383 47               (            _asrd):00001 [2]     8295            asra
8384 56               (            _asrd):00002 [2]     8297            rorb
                      (./Engine/Graphics):00089                         _asrd
8385 47               (            _asrd):00001 [2]     8299            asra
8386 56               (            _asrd):00002 [2]     8301            rorb
8387 FD8396           (./Engine/Graphics):00090 [6]     8307            std   @dyn
838A FC8351           (./Engine/Graphics):00091 [6]     8313            ldd   tmb_old_camera_y
                      (./Engine/Graphics):00092                         _asrd
838D 47               (            _asrd):00001 [2]     8315            asra
838E 56               (            _asrd):00002 [2]     8317            rorb
                      (./Engine/Graphics):00093                         _asrd
838F 47               (            _asrd):00001 [2]     8319            asra
8390 56               (            _asrd):00002 [2]     8321            rorb
                      (./Engine/Graphics):00094                         _asrd
8391 47               (            _asrd):00001 [2]     8323            asra
8392 56               (            _asrd):00002 [2]     8325            rorb
                      (./Engine/Graphics):00095                         _asrd
8393 47               (            _asrd):00001 [2]     8327            asra
8394 56               (            _asrd):00002 [2]     8329            rorb
8395 830000           (./Engine/Graphics):00096 [4]     8333            subd   #0
     8396             (./Engine/Graphics):00097                 @dyn    equ   *-2
8398 271D             (./Engine/Graphics):00098 [3]     8336            beq   @next
839A 2A04             (./Engine/Graphics):00099 [3]     8339            bpl   @b
                      (./Engine/Graphics):00100                         _negd
839C 40               (            _negd):00001 [2]     8341            nega
839D 50               (            _negd):00002 [2]     8343            negb
839E 8200             (            _negd):00003 [2]     8345            sbca  #0
83A0 1083000B         (./Engine/Graphics):00101 [5]     8350    @b      cmpd  #tmb_vp_v_tiles
83A4 2F02             (./Engine/Graphics):00102 [3]     8353            ble   @c
83A6 C60B             (./Engine/Graphics):00103 [2]     8355            ldb   #tmb_vp_v_tiles
83A8 F78492           (./Engine/Graphics):00104 [5]     8360    @c      stb   glb_tmb_height
83AB DCF3             (./Engine/Graphics):00105 [5]     8365            ldd   <glb_camera_x_pos
83AD DD13             (./Engine/Graphics):00106 [5]     8370            std   tmb_x
83AF 8612             (./Engine/Graphics):00107 [2]     8372            lda   #tmb_vp_h_tiles
83B1 B7846A           (./Engine/Graphics):00108 [5]     8377            sta   glb_tmb_width
83B4 BD840B           (./Engine/Graphics):00109 [8]     8385            jsr   FeedTileBuffer
83B7                  (./Engine/Graphics):00110                 @next
                      (./Engine/Graphics):00111                 
                      (./Engine/Graphics):00112                         ; compute x location
83B7 DEF3             (./Engine/Graphics):00113 [5]     8390            ldu   <glb_camera_x_pos
83B9 FC834F           (./Engine/Graphics):00114 [6]     8396            ldd   tmb_old_camera_x
83BC 93F3             (./Engine/Graphics):00115 [6]     8402            subd  <glb_camera_x_pos
83BE 2740             (./Engine/Graphics):00116 [3]     8405            beq   @exit
83C0 2A06             (./Engine/Graphics):00117 [3]     8408            bpl   @a
83C2 33C90090         (./Engine/Graphics):00118 [8]     8416            leau  tmb_vp_h_px,u
83C6 33CB             (./Engine/Graphics):00119 [8]     8424            leau  d,u
83C8 DF13             (./Engine/Graphics):00120 [5]     8429    @a      stu   tmb_x
                      (./Engine/Graphics):00121                         ; compute width in tiles
83CA DCF3             (./Engine/Graphics):00122 [5]     8434            ldd   <glb_camera_x_pos
                      (./Engine/Graphics):00123                         _asrd
83CC 47               (            _asrd):00001 [2]     8436            asra
83CD 56               (            _asrd):00002 [2]     8438            rorb
                      (./Engine/Graphics):00124                         _asrd
83CE 47               (            _asrd):00001 [2]     8440            asra
83CF 56               (            _asrd):00002 [2]     8442            rorb
                      (./Engine/Graphics):00125                         _asrd
83D0 47               (            _asrd):00001 [2]     8444            asra
83D1 56               (            _asrd):00002 [2]     8446            rorb
83D2 FD83DF           (./Engine/Graphics):00126 [6]     8452            std   @dyn
83D5 FC834F           (./Engine/Graphics):00127 [6]     8458            ldd   tmb_old_camera_x
                      (./Engine/Graphics):00128                         _asrd
83D8 47               (            _asrd):00001 [2]     8460            asra
83D9 56               (            _asrd):00002 [2]     8462            rorb
                      (./Engine/Graphics):00129                         _asrd
83DA 47               (            _asrd):00001 [2]     8464            asra
83DB 56               (            _asrd):00002 [2]     8466            rorb
                      (./Engine/Graphics):00130                         _asrd
83DC 47               (            _asrd):00001 [2]     8468            asra
83DD 56               (            _asrd):00002 [2]     8470            rorb
83DE 830000           (./Engine/Graphics):00131 [4]     8474            subd   #0
     83DF             (./Engine/Graphics):00132                 @dyn    equ   *-2
83E1 271D             (./Engine/Graphics):00133 [3]     8477            beq   @exit
83E3 2A04             (./Engine/Graphics):00134 [3]     8480            bpl   @b
                      (./Engine/Graphics):00135                         _negd
83E5 40               (            _negd):00001 [2]     8482            nega
83E6 50               (            _negd):00002 [2]     8484            negb
83E7 8200             (            _negd):00003 [2]     8486            sbca  #0
83E9 10830012         (./Engine/Graphics):00136 [5]     8491    @b      cmpd  #tmb_vp_h_tiles
83ED 2F02             (./Engine/Graphics):00137 [3]     8494            ble   @c
83EF C612             (./Engine/Graphics):00138 [2]     8496            ldb   #tmb_vp_h_tiles
83F1 F7846A           (./Engine/Graphics):00139 [5]     8501    @c      stb   glb_tmb_width
83F4 DCF1             (./Engine/Graphics):00140 [5]     8506            ldd   <glb_camera_y_pos
83F6 DD15             (./Engine/Graphics):00141 [5]     8511            std   tmb_y
83F8 860B             (./Engine/Graphics):00142 [2]     8513            lda   #tmb_vp_v_tiles
83FA B78492           (./Engine/Graphics):00143 [5]     8518            sta   glb_tmb_height
83FD BD840B           (./Engine/Graphics):00144 [8]     8526            jsr   FeedTileBuffer
8400                  (./Engine/Graphics):00145                 @exit
8400 DCF3             (./Engine/Graphics):00146 [5]     8531            ldd   <glb_camera_x_pos
8402 FD834F           (./Engine/Graphics):00147 [6]     8537            std   tmb_old_camera_x
8405 DCF1             (./Engine/Graphics):00148 [5]     8542            ldd   <glb_camera_y_pos
8407 FD8351           (./Engine/Graphics):00149 [6]     8548            std   tmb_old_camera_y
840A 39               (./Engine/Graphics):00150 [5]     8553            rts
                      (./Engine/Graphics):00151                 
                      (./Engine/Graphics):00152                 ; ****************************************************************************************************************************
                      (./Engine/Graphics):00153                 ; * FeedTileBuffer
                      (./Engine/Graphics):00154                 ; * Feed the tile buffer, based on camera x and y and a number of tiles in width and height
                      (./Engine/Graphics):00155                 ; * 
                      (./Engine/Graphics):00156                 ; * tmb_x      (0-32767)                  
                      (./Engine/Graphics):00157                 ; * tmb_y      (0-32767)          
                      (./Engine/Graphics):00158                 ; * glb_tmb_width  (1-20)       
                      (./Engine/Graphics):00159                 ; * glb_tmb_height (1-13)        
                      (./Engine/Graphics):00160                 ; *
                      (./Engine/Graphics):00161                 ; ****************************************************************************************************************************
                      (./Engine/Graphics):00162                 
840B                  (./Engine/Graphics):00163                 FeedTileBuffer
                      (./Engine/Graphics):00164                 
                      (./Engine/Graphics):00165                         ; mount the map
                      (./Engine/Graphics):00166                         ; ---------------------------------------------------------------------
                      (./Engine/Graphics):00167                 
840B B6833F           (./Engine/Graphics):00168 [5]     8558            lda   glb_map_pge
                      (./Engine/Graphics):00169                         _SetCartPageA        
                      (    _SetCartPageA):00001                  IFDEF T2
840E BD6F74           (    _SetCartPageA):00002 [8]     8566            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
8411 FE8340           (./Engine/Graphics):00170 [6]     8572            ldu   glb_map_adr
                      (./Engine/Graphics):00171                 
                      (./Engine/Graphics):00172                         ; compute position in cycling buffer
                      (./Engine/Graphics):00173                         ; ---------------------------------------------------------------------
                      (./Engine/Graphics):00174                  
8414 D614             (./Engine/Graphics):00175 [4]     8576            ldb   tmb_x+1                       ; col mask (0-32)
8416 C4F8             (./Engine/Graphics):00176 [2]     8578            andb  #%11111000                    ; tile width 8px (>>3) 
8418 54               (./Engine/Graphics):00177 [2]     8580            lsrb                                ; col size 4 bytes (<<2)
8419 F7842A           (./Engine/Graphics):00178 [5]     8585            stb   @dyn
841C D616             (./Engine/Graphics):00179 [4]     8589            ldb   tmb_y+1                       
841E 8400             (./Engine/Graphics):00180 [2]     8591            anda  #%00000000
8420 C4F0             (./Engine/Graphics):00181 [2]     8593            andb  #%11110000                    ; line mask (0-16)
                      (./Engine/Graphics):00182                         _lsld                               ; tile height 16px (>>4) 
8422 58               (            _lsld):00001 [2]     8595            lslb
8423 49               (            _lsld):00002 [2]     8597            rola
                      (./Engine/Graphics):00183                         _lsld                               ; line skip 128 bytes (<<7)
8424 58               (            _lsld):00001 [2]     8599            lslb
8425 49               (            _lsld):00002 [2]     8601            rola
                      (./Engine/Graphics):00184                         _lsld
8426 58               (            _lsld):00001 [2]     8603            lslb
8427 49               (            _lsld):00002 [2]     8605            rola
8428 C30000           (./Engine/Graphics):00185 [4]     8609            addd  #0                            ; (dynamic) add x position to index 
     842A             (./Engine/Graphics):00186                 @dyn    equ   *-1
842B 8B90             (./Engine/Graphics):00187 [2]     8611            adda  #tile_buffer/256
842D DD11             (./Engine/Graphics):00188 [5]     8616            std   b_loc
                      (./Engine/Graphics):00189                 
                      (./Engine/Graphics):00190                         ; transform a camera position into an index to map (64x128px chunks)
                      (./Engine/Graphics):00191                         ; ---------------------------------------------------------------------
842F DC13             (./Engine/Graphics):00192 [5]     8621            ldd   tmb_x
                      (./Engine/Graphics):00193                         _lsrd
8431 44               (            _lsrd):00001 [2]     8623            lsra
8432 56               (            _lsrd):00002 [2]     8625            rorb
                      (./Engine/Graphics):00194                         _lsrd
8433 44               (            _lsrd):00001 [2]     8627            lsra
8434 56               (            _lsrd):00002 [2]     8629            rorb
                      (./Engine/Graphics):00195                         _lsrd
8435 44               (            _lsrd):00001 [2]     8631            lsra
8436 56               (            _lsrd):00002 [2]     8633            rorb
                      (./Engine/Graphics):00196                         _lsrd 
8437 44               (            _lsrd):00001 [2]     8635            lsra
8438 56               (            _lsrd):00002 [2]     8637            rorb
                      (./Engine/Graphics):00197                         _lsrd
8439 44               (            _lsrd):00001 [2]     8639            lsra
843A 56               (            _lsrd):00002 [2]     8641            rorb
                      (./Engine/Graphics):00198                         _lsrd                                                 
843B 44               (            _lsrd):00001 [2]     8643            lsra
843C 56               (            _lsrd):00002 [2]     8645            rorb
843D FD8456           (./Engine/Graphics):00199 [6]     8651            std   @dyn1
8440 DC15             (./Engine/Graphics):00200 [5]     8656            ldd   tmb_y
                      (./Engine/Graphics):00201                         _lsrd
8442 44               (            _lsrd):00001 [2]     8658            lsra
8443 56               (            _lsrd):00002 [2]     8660            rorb
                      (./Engine/Graphics):00202                         _lsrd
8444 44               (            _lsrd):00001 [2]     8662            lsra
8445 56               (            _lsrd):00002 [2]     8664            rorb
                      (./Engine/Graphics):00203                         _lsrd
8446 44               (            _lsrd):00001 [2]     8666            lsra
8447 56               (            _lsrd):00002 [2]     8668            rorb
                      (./Engine/Graphics):00204                         _lsrd 
8448 44               (            _lsrd):00001 [2]     8670            lsra
8449 56               (            _lsrd):00002 [2]     8672            rorb
                      (./Engine/Graphics):00205                         _lsrd
844A 44               (            _lsrd):00001 [2]     8674            lsra
844B 56               (            _lsrd):00002 [2]     8676            rorb
                      (./Engine/Graphics):00206                         _lsrd
844C 44               (            _lsrd):00001 [2]     8678            lsra
844D 56               (            _lsrd):00002 [2]     8680            rorb
844E C4FE             (./Engine/Graphics):00207 [2]     8682            andb  #%11111110                              ; faster than _lsrd (last shift for 128px map) and lsld (2 bytes index in mul ref)
8450 30C812           (./Engine/Graphics):00208 [5]     8687            leax  layer_mul_ref,u
8453 EC8B             (./Engine/Graphics):00209 [9]     8696            ldd   d,x                                     ; use precalculated values to get y in map (16 bits mul)
8455 C30000           (./Engine/Graphics):00210 [4]     8700            addd  #0                                      ; (dynamic) add x position to index 
     8456             (./Engine/Graphics):00211                 @dyn1   equ   *-2
8458 F38343           (./Engine/Graphics):00212 [7]     8707            addd  glb_map_chunk_adr                       ; (dynamic) add map data address to index
845B 1F01             (./Engine/Graphics):00213 [6]     8713            tfr   d,x
                      (./Engine/Graphics):00214                         
                      (./Engine/Graphics):00215                         ; compute tile offset in chunks
                      (./Engine/Graphics):00216                         ; ---------------------------------------------------------------------
                      (./Engine/Graphics):00217                 
845D 9614             (./Engine/Graphics):00218 [4]     8717            lda   tmb_x+1
845F 8438             (./Engine/Graphics):00219 [2]     8719            anda  #%00111000
8461 47               (./Engine/Graphics):00220 [2]     8721            asra
8462 47               (./Engine/Graphics):00221 [2]     8723            asra
8463 970E             (./Engine/Graphics):00222 [4]     8727            sta   x_off+1                                 ; horizontal offset to first tile in top left chunk
8465 47               (./Engine/Graphics):00223 [2]     8729            asra  
8466 8008             (./Engine/Graphics):00224 [2]     8731            suba  #8                                      ; chunk hold 8 tiles in a row
8468 40               (./Engine/Graphics):00225 [2]     8733            nega
8469 8100             (./Engine/Graphics):00226 [2]     8735            cmpa  #0
     846A             (./Engine/Graphics):00227                 glb_tmb_width equ *-1                                 ; (dynamic) nb of tile in screen width 
846B 2D03             (./Engine/Graphics):00228 [3]     8738            blt   @a                                      ; branch if requested tiles in width are covered by more chunks than the first one 
846D B6846A           (./Engine/Graphics):00229 [5]     8743            lda   glb_tmb_width                           ; if not cap to the requested width
8470 9704             (./Engine/Graphics):00230 [4]     8747    @a      sta   l_h_tl                                  ; save nb of tiles in left chunks
8472 B6846A           (./Engine/Graphics):00231 [5]     8752            lda   glb_tmb_width
8475 9004             (./Engine/Graphics):00232 [4]     8756            suba  l_h_tl
8477 1F89             (./Engine/Graphics):00233 [6]     8762            tfr   a,b
8479 57               (./Engine/Graphics):00234 [2]     8764            asrb
847A 57               (./Engine/Graphics):00235 [2]     8766            asrb
847B 57               (./Engine/Graphics):00236 [2]     8768            asrb
847C D701             (./Engine/Graphics):00237 [4]     8772            stb   h_tl_bck                                ; nb of full sized (middle) horizontal chunks
847E 8407             (./Engine/Graphics):00238 [2]     8774            anda  #%00000111                              ; skip middle chunks that are 8 tiles wide
8480 9705             (./Engine/Graphics):00239 [4]     8778            sta   r_h_tl                                  ; save nb of horizontal tiles in right chunks
8482 9706             (./Engine/Graphics):00240 [4]     8782            sta   r_h_tl_bck
                      (./Engine/Graphics):00241                 
8484 9616             (./Engine/Graphics):00242 [4]     8786            lda   tmb_y+1
8486 8470             (./Engine/Graphics):00243 [2]     8788            anda  #%01110000                              ; get tile position in chunk
8488 9710             (./Engine/Graphics):00244 [4]     8792            sta   y_off+1                                 ; vertical offset to first tile in top left chunk
848A 47               (./Engine/Graphics):00245 [2]     8794            asra  
848B 47               (./Engine/Graphics):00246 [2]     8796            asra  
848C 47               (./Engine/Graphics):00247 [2]     8798            asra  
848D 47               (./Engine/Graphics):00248 [2]     8800            asra  
848E 8008             (./Engine/Graphics):00249 [2]     8802            suba  #8                                      ; chunk hold 8 tiles in a col
8490 40               (./Engine/Graphics):00250 [2]     8804            nega
8491 8100             (./Engine/Graphics):00251 [2]     8806            cmpa  #0
     8492             (./Engine/Graphics):00252                 glb_tmb_height equ *-1                                ; (dynamic) nb of tile in screen width 
8493 2D03             (./Engine/Graphics):00253 [3]     8809            blt   @a                                      ; branch if requested tiles in width are covered by the first chunk 
8495 B68492           (./Engine/Graphics):00254 [5]     8814            lda   glb_tmb_height
8498 9708             (./Engine/Graphics):00255 [4]     8818    @a      sta   u_v_tl                                  ; save nb of vertical tiles in top chunks
849A B68492           (./Engine/Graphics):00256 [5]     8823            lda   glb_tmb_height                          ; (dynamic) nb of tile in screen height
849D 9008             (./Engine/Graphics):00257 [4]     8827            suba  u_v_tl
849F 1F89             (./Engine/Graphics):00258 [6]     8833            tfr   a,b
84A1 57               (./Engine/Graphics):00259 [2]     8835            asrb
84A2 57               (./Engine/Graphics):00260 [2]     8837            asrb
84A3 57               (./Engine/Graphics):00261 [2]     8839            asrb
84A4 D702             (./Engine/Graphics):00262 [4]     8843            stb   v_tl                                    ; nb of full sized (middle) vertical chunks
84A6 8407             (./Engine/Graphics):00263 [2]     8845            anda  #%00000111                              ; skip middle chunks that are 8 tiles high
84A8 9709             (./Engine/Graphics):00264 [4]     8849            sta   b_v_tl                                  ; save nb of vertical tiles in bottom chunks
                      (./Engine/Graphics):00265                 
                      (./Engine/Graphics):00266                         ; load chunks
                      (./Engine/Graphics):00267                         ; --------------------
84AA B68342           (./Engine/Graphics):00268 [5]     8854            lda   glb_map_chunk_pge
                      (./Engine/Graphics):00269                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
84AD BD6F74           (    _SetCartPageA):00002 [8]     8862            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
                      (./Engine/Graphics):00270                 
84B0 D608             (./Engine/Graphics):00271 [4]     8866            ldb   u_v_tl                   ; first line begin with upper vertical chunk height
84B2 D70B             (./Engine/Graphics):00272 [4]     8870            stb   c_v_tl_bck
                      (./Engine/Graphics):00273                 
84B4 DC0F             (./Engine/Graphics):00274 [5]     8875            ldd   y_off                    ; offset in top left chunk is horizontal and vertical
84B6 FD84E5           (./Engine/Graphics):00275 [6]     8881            std   c_y_off
84B9 D30D             (./Engine/Graphics):00276 [6]     8887            addd  x_off
84BB FD857B           (./Engine/Graphics):00277 [6]     8893            std   chunk_offset
84BE                  (./Engine/Graphics):00278                 @vloop
84BE BF851E           (./Engine/Graphics):00279 [6]     8899            stx   @start_pos_bck           ; position in chunk map
84C1 BF855A           (./Engine/Graphics):00280 [6]     8905            stx   start_pos
84C4 D601             (./Engine/Graphics):00281 [4]     8909            ldb   h_tl_bck                 ; restore nb of middle chunks (8 tiles width) on x axis for one row
84C6 D700             (./Engine/Graphics):00282 [4]     8913            stb   h_tl
84C8 DC11             (./Engine/Graphics):00283 [5]     8918            ldd   b_loc                    ; load location in cycling buffer
84CA C480             (./Engine/Graphics):00284 [2]     8920            andb  #%10000000               ; compute line start
84CC FD84F4           (./Engine/Graphics):00285 [6]     8926            std   cl_pos_bck
84CF D604             (./Engine/Graphics):00286 [4]     8930            ldb   l_h_tl                   ; nb of tiles on left chunk
84D1 D703             (./Engine/Graphics):00287 [4]     8934            stb   c_h_tl                   ; store in current nb of tiles               
84D3 960B             (./Engine/Graphics):00288 [4]     8938            lda   c_v_tl_bck               ; compute location for next row
84D5 C680             (./Engine/Graphics):00289 [2]     8940            ldb   #128                     ; ...
84D7 3D               (./Engine/Graphics):00290 [11]    8951            mul                            ; ...
84D8 D311             (./Engine/Graphics):00291 [6]     8957            addd  b_loc                    ; ...
84DA 8407             (./Engine/Graphics):00292 [2]     8959            anda  #%00000111
84DC 8B90             (./Engine/Graphics):00293 [2]     8961            adda  #tile_buffer/256 ; add base address
84DE FD8516           (./Engine/Graphics):00294 [6]     8967            std   @l1_bck                  ; save location for next row
84E1                  (./Engine/Graphics):00295                 @hloop
84E1 BD8545           (./Engine/Graphics):00296 [8]     8975            jsr   LoadChunk
84E4 CC0000           (./Engine/Graphics):00297 [3]     8978            ldd   #0
     84E5             (./Engine/Graphics):00298                 c_y_off equ   *-2
84E7 FD857B           (./Engine/Graphics):00299 [6]     8984            std   chunk_offset
84EA DC11             (./Engine/Graphics):00300 [5]     8989            ldd   b_loc                    ; compute location for next col
84EC C30004           (./Engine/Graphics):00301 [4]     8993            addd  #4
84EF 8400             (./Engine/Graphics):00302 [2]     8995            anda  #%00000000
84F1 C47C             (./Engine/Graphics):00303 [2]     8997            andb  #%01111100 ; cycle thru this line (0-127) by 4 bytes
84F3 C30000           (./Engine/Graphics):00304 [4]     9001            addd  #0
     84F4             (./Engine/Graphics):00305                 cl_pos_bck equ *-2
84F6 DD11             (./Engine/Graphics):00306 [5]     9006            std   b_loc                    ; set location for next col
84F8 9600             (./Engine/Graphics):00307 [4]     9010            lda   h_tl                     ; check number of middle chunks
84FA 2709             (./Engine/Graphics):00308 [3]     9013            beq   @rc
84FC C608             (./Engine/Graphics):00309 [2]     9015            ldb   #8                       ; middle chunks are 8 tiles width
84FE D703             (./Engine/Graphics):00310 [4]     9019            stb   c_h_tl
8500 4A               (./Engine/Graphics):00311 [2]     9021            deca
8501 9700             (./Engine/Graphics):00312 [4]     9025            sta   h_tl
8503 20DC             (./Engine/Graphics):00313 [3]     9028            bra   @hloop
8505 D605             (./Engine/Graphics):00314 [4]     9032    @rc     ldb   r_h_tl                   ; check right chunk
8507 2708             (./Engine/Graphics):00315 [3]     9035            beq   @hexit
8509 D703             (./Engine/Graphics):00316 [4]     9039            stb   c_h_tl
850B D706             (./Engine/Graphics):00317 [4]     9043            stb   r_h_tl_bck
850D 0F05             (./Engine/Graphics):00318 [6]     9049            clr   r_h_tl
850F 20D0             (./Engine/Graphics):00319 [3]     9052            bra   @hloop
8511 9606             (./Engine/Graphics):00320 [4]     9056    @hexit  lda   r_h_tl_bck
8513 9705             (./Engine/Graphics):00321 [4]     9060            sta   r_h_tl
8515 CC0000           (./Engine/Graphics):00322 [3]     9063            ldd   #0
     8516             (./Engine/Graphics):00323                 @l1_bck equ   *-2
8518 DD11             (./Engine/Graphics):00324 [5]     9068            std   b_loc                    ; set location for next row
851A F6834E           (./Engine/Graphics):00325 [5]     9073            ldb   glb_map_width
851D 8E0000           (./Engine/Graphics):00326 [3]     9076            ldx   #0
     851E             (./Engine/Graphics):00327                 @start_pos_bck equ *-2
8520 3A               (./Engine/Graphics):00328 [3]     9079            abx
8521 D602             (./Engine/Graphics):00329 [4]     9083            ldb   v_tl                     ; are we in middle or bottom chunk ?
8523 2708             (./Engine/Graphics):00330 [3]     9086            beq   @a
8525 2B1D             (./Engine/Graphics):00331 [3]     9089            bmi   @end
8527 8608             (./Engine/Graphics):00332 [2]     9091            lda   #8                       ; middle
8529 970B             (./Engine/Graphics):00333 [4]     9095            sta   c_v_tl_bck
852B 2006             (./Engine/Graphics):00334 [3]     9098            bra   @b
852D 9609             (./Engine/Graphics):00335 [4]     9102    @a      lda   b_v_tl                   ; bottom
852F 2713             (./Engine/Graphics):00336 [3]     9105            beq   @end
8531 970B             (./Engine/Graphics):00337 [4]     9109            sta   c_v_tl_bck
8533 5A               (./Engine/Graphics):00338 [2]     9111    @b      decb
8534 D702             (./Engine/Graphics):00339 [4]     9115            stb   v_tl
8536 CC0000           (./Engine/Graphics):00340 [3]     9118            ldd   #0
8539 FD84E5           (./Engine/Graphics):00341 [6]     9124            std   c_y_off
853C DC0D             (./Engine/Graphics):00342 [5]     9129            ldd   x_off
853E FD857B           (./Engine/Graphics):00343 [6]     9135            std   chunk_offset             ; offset in next row of chunk is only horizontal
8541 7E84BE           (./Engine/Graphics):00344 [4]     9139            jmp   @vloop
8544 39               (./Engine/Graphics):00345 [5]     9144    @end    rts
                      (./Engine/Graphics):00346                 
8545                  (./Engine/Graphics):00347                 LoadChunk
8545 DC11             (./Engine/Graphics):00348 [5]     9149            ldd   b_loc
8547 C480             (./Engine/Graphics):00349 [2]     9151            andb  #%10000000
8549 FD85E1           (./Engine/Graphics):00350 [6]     9157            std   cl_pos                                  ; save line start for cycling buffer
854C D603             (./Engine/Graphics):00351 [4]     9161            ldb   c_h_tl                                  ; preprocess line return
854E 58               (./Engine/Graphics):00352 [2]     9163            lslb                                          ; buffer : 4 bytes per tile in width
854F 58               (./Engine/Graphics):00353 [2]     9165            lslb
8550 86FF             (./Engine/Graphics):00354 [2]     9167            lda   #%11111111
8552 50               (./Engine/Graphics):00355 [2]     9169            negb
8553 C30084           (./Engine/Graphics):00356 [4]     9173            addd  #128+4                                  ; one line in buffer and one tile width
8556 FD8601           (./Engine/Graphics):00357 [6]     9179            std   r_stp_1
                      (./Engine/Graphics):00358                 
8559 8E0000           (./Engine/Graphics):00359 [3]     9182            ldx   #0
     855A             (./Engine/Graphics):00360                 start_pos equ *-2
855C A680             (./Engine/Graphics):00361 [6]     9188            lda   ,x+
855E 2A0A             (./Engine/Graphics):00362 [3]     9191            bpl   @a
8560 FE8349           (./Engine/Graphics):00363 [6]     9197            ldu   glb_map_defchunk1_adr
8563 847F             (./Engine/Graphics):00364 [2]     9199            anda  #%01111111
8565 F68348           (./Engine/Graphics):00365 [5]     9204            ldb   glb_map_defchunk1_pge
8568 2006             (./Engine/Graphics):00366 [3]     9207            bra   @b
856A FE8346           (./Engine/Graphics):00367 [6]     9213    @a      ldu   glb_map_defchunk0_adr
856D F68345           (./Engine/Graphics):00368 [5]     9218            ldb   glb_map_defchunk0_pge
8570 F785CC           (./Engine/Graphics):00369 [5]     9223    @b      stb   chk_idx_pge
                      (./Engine/Graphics):00370                         _SetCartPageB                                 ; set chunk definition page
                      (    _SetCartPageB):00001                  IFDEF T2
8573 BD6FA2           (    _SetCartPageB):00002 [8]     9231            jsr   SetCartPageB
                      (    _SetCartPageB):00003                  ELSE
                      (    _SetCartPageB):00004                         stb   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageB):00005                  ENDC
8576 C600             (./Engine/Graphics):00371 [2]     9233            ldb   #0
                      (./Engine/Graphics):00372                         _asrd
8578 47               (            _asrd):00001 [2]     9235            asra
8579 56               (            _asrd):00002 [2]     9237            rorb
857A C30000           (./Engine/Graphics):00373 [4]     9241            addd  #0                                      ; (dynamic) ajust position of first tile in chunk
     857B             (./Engine/Graphics):00374                 chunk_offset  equ   *-2
857D 33CB             (./Engine/Graphics):00375 [8]     9249            leau  d,u
                      (./Engine/Graphics):00376                 
857F BF855A           (./Engine/Graphics):00377 [6]     9255            stx   start_pos
8582 FF85F8           (./Engine/Graphics):00378 [6]     9261            stu   start_x                                 ; start position in chunk
                      (./Engine/Graphics):00379                 
8585                  (./Engine/Graphics):00380                 DrawChunk
8585 9603             (./Engine/Graphics):00381 [4]     9265            lda   c_h_tl
                      (./Engine/Graphics):00382                  IFDEF T2
8587 10270061         (./Engine/Graphics):00383 [5+?]   9270            lbeq  EndOfChunk
                      (./Engine/Graphics):00384                  ELSE
                      (./Engine/Graphics):00385                         beq   EndOfChunk
                      (./Engine/Graphics):00386                  ENDC
858B 970A             (./Engine/Graphics):00387 [4]     9274            sta   c_h_tl_bck
858D 960B             (./Engine/Graphics):00388 [4]     9278            lda   c_v_tl_bck
                      (./Engine/Graphics):00389                  IFDEF T2
858F 10270059         (./Engine/Graphics):00390 [5+?]   9283            lbeq  EndOfChunk
                      (./Engine/Graphics):00391                  ELSE
                      (./Engine/Graphics):00392                         beq   EndOfChunk
                      (./Engine/Graphics):00393                  ENDC
8593 9707             (./Engine/Graphics):00394 [4]     9287            sta   c_v_tl
                      (./Engine/Graphics):00395                 
8595                  (./Engine/Graphics):00396                 DrawTile
8595 109E11           (./Engine/Graphics):00397 [6]     9293            ldy   b_loc
8598 ECC1             (./Engine/Graphics):00398 [8]     9301            ldd   ,u++                                    ; load tile index in d (16 bits)
859A 2608             (./Engine/Graphics):00399 [3]     9304            bne   @a
859C CC0000           (./Engine/Graphics):00400 [3]     9307            ldd   #0
859F EDA4             (./Engine/Graphics):00401 [5]     9312            std   ,y
85A1 7E85D3           (./Engine/Graphics):00402 [4]     9316            jmp   NextCol
85A4 FF85D1           (./Engine/Graphics):00403 [6]     9322    @a      stu   @dyn2
85A7 B785AF           (./Engine/Graphics):00404 [5]     9327            sta   @dyn0
85AA 8480             (./Engine/Graphics):00405 [2]     9329            anda  #%10000000
85AC A7A4             (./Engine/Graphics):00406 [4]     9333            sta   ,y
85AE 8600             (./Engine/Graphics):00407 [2]     9335            lda   #0
     85AF             (./Engine/Graphics):00408                 @dyn0   equ   *-1
85B0 847F             (./Engine/Graphics):00409 [2]     9337            anda  #%01111111
85B2 FD85B8           (./Engine/Graphics):00410 [6]     9343            std   @dyn1                                   ; multiply tile index by 3 to load tile page and addr
                      (./Engine/Graphics):00411                         _lsld
85B5 58               (            _lsld):00001 [2]     9345            lslb
85B6 49               (            _lsld):00002 [2]     9347            rola
85B7 C30000           (./Engine/Graphics):00412 [4]     9351            addd  #0                                      ; (dynamic)
     85B8             (./Engine/Graphics):00413                 @dyn1   equ   *-2
85BA FE834C           (./Engine/Graphics):00414 [6]     9357            ldu   glb_map_tiles_adr
85BD 33CB             (./Engine/Graphics):00415 [8]     9365            leau  d,u
85BF B6834B           (./Engine/Graphics):00416 [5]     9370            lda   glb_map_tiles_pge
                      (./Engine/Graphics):00417                         _SetCartPageA                                 ; set tile index page
                      (    _SetCartPageA):00001                  IFDEF T2
85C2 BD6F74           (    _SetCartPageA):00002 [8]     9378            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
85C5 3712             (./Engine/Graphics):00418 [8]     9386            pulu  a,x                                     ; a: tile routine page, x: tile routine address
85C7 A721             (./Engine/Graphics):00419 [5]     9391            sta   1,y
85C9 AF22             (./Engine/Graphics):00420 [6]     9397            stx   2,y
85CB 8600             (./Engine/Graphics):00421 [2]     9399            lda   #0
     85CC             (./Engine/Graphics):00422                 chk_idx_pge equ *-1
                      (./Engine/Graphics):00423                         _SetCartPageA                                 ; restore chunk definition page
                      (    _SetCartPageA):00001                  IFDEF T2
85CD BD6F74           (    _SetCartPageA):00002 [8]     9407            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
85D0 CE0000           (./Engine/Graphics):00424 [3]     9410            ldu   #0
     85D1             (./Engine/Graphics):00425                 @dyn2   equ *-2
                      (./Engine/Graphics):00426                 
85D3                  (./Engine/Graphics):00427                 NextCol
85D3 0A03             (./Engine/Graphics):00428 [6]     9416            dec   c_h_tl                                  ; check remaining tiles in this row
85D5 2711             (./Engine/Graphics):00429 [3]     9419            beq   EndOfRow
                      (./Engine/Graphics):00430                 
                      (./Engine/Graphics):00431                         ; Move tile position on screen to next column
                      (./Engine/Graphics):00432                         ; -------------------------------------------
85D7 CC0004           (./Engine/Graphics):00433 [3]     9422            ldd   #4                                    ; nb of linear memory bytes between two tiles in a column
85DA D311             (./Engine/Graphics):00434 [6]     9428            addd  b_loc
85DC 8400             (./Engine/Graphics):00435 [2]     9430            anda  #%00000000
85DE C47C             (./Engine/Graphics):00436 [2]     9432            andb  #%01111100 ; cycle thru this line (0-127) by 4 bytes
85E0 C30000           (./Engine/Graphics):00437 [4]     9436            addd  #0
     85E1             (./Engine/Graphics):00438                 cl_pos  equ   *-2
85E3 DD11             (./Engine/Graphics):00439 [5]     9441            std   b_loc
                      (./Engine/Graphics):00440                  IFDEF T2
85E5 7E8595           (./Engine/Graphics):00441 [4]     9445            jmp   DrawTile
                      (./Engine/Graphics):00442                  ELSE
                      (./Engine/Graphics):00443                         bra   DrawTile
                      (./Engine/Graphics):00444                  ENDC
                      (./Engine/Graphics):00445                 
                      (./Engine/Graphics):00446                         ; Check end of line of current Chunk
                      (./Engine/Graphics):00447                         ; ----------------------------------
85E8                  (./Engine/Graphics):00448                 EndOfRow                                              ; end of line on right chunk, do we need to go to bottom chunk or exit ?
85E8 0A07             (./Engine/Graphics):00449 [6]     9451            dec   c_v_tl
85EA 2607             (./Engine/Graphics):00450 [3]     9454            bne   DrawNextRow
                      (./Engine/Graphics):00451                 
                      (./Engine/Graphics):00452                         ; End of DrawChunk, restore map of chunks page
                      (./Engine/Graphics):00453                         ; ------------------------------------------------------------------
85EC                  (./Engine/Graphics):00454                 EndOfChunk
85EC B68342           (./Engine/Graphics):00455 [5]     9459            lda   glb_map_chunk_pge
                      (./Engine/Graphics):00456                         _SetCartPageA
                      (    _SetCartPageA):00001                  IFDEF T2
85EF BD6F74           (    _SetCartPageA):00002 [8]     9467            jsr   SetCartPageA
                      (    _SetCartPageA):00003                  ELSE
                      (    _SetCartPageA):00004                         sta   $E7E6                    ; selection de la page RAM en zone cartouche
                      (    _SetCartPageA):00005                  ENDC
85F2 39               (./Engine/Graphics):00457 [5]     9472            rts
                      (./Engine/Graphics):00458                 
85F3                  (./Engine/Graphics):00459                 DrawNextRow
85F3 960A             (./Engine/Graphics):00460 [4]     9476            lda   c_h_tl_bck
85F5 9703             (./Engine/Graphics):00461 [4]     9480            sta   c_h_tl
                      (./Engine/Graphics):00462                 
85F7 CE0000           (./Engine/Graphics):00463 [3]     9483            ldu   #0                                      ; (dynamic)
     85F8             (./Engine/Graphics):00464                 start_x equ   *-2
85FA 33C810           (./Engine/Graphics):00465 [5]     9488            leau  16,u                                    ; a chunk is made of 8 tiles in width
85FD FF85F8           (./Engine/Graphics):00466 [6]     9494            stu   start_x
                      (./Engine/Graphics):00467                         ; Move tile position on screen to next row
                      (./Engine/Graphics):00468                         ; -----------------------------------------
8600 CC0000           (./Engine/Graphics):00469 [3]     9497            ldd   #0                                      ; (dynamic) nb of linear memory bytes to go from the last tile of a row to the first tile of the next row
     8601             (./Engine/Graphics):00470                 r_stp_1 equ   *-2
8603 D311             (./Engine/Graphics):00471 [6]     9503            addd  b_loc
8605 8407             (./Engine/Graphics):00472 [2]     9505            anda  #%00000111
8607 8B90             (./Engine/Graphics):00473 [2]     9507            adda  #tile_buffer/256 ; add base address
8609 DD11             (./Engine/Graphics):00474 [5]     9512            std   b_loc
860B C480             (./Engine/Graphics):00475 [2]     9514            andb  #%10000000
860D FD85E1           (./Engine/Graphics):00476 [6]     9520            std   cl_pos                                  ; save start of line for cycling buffer
8610 7E8595           (./Engine/Graphics):00477 [4]     9524            jmp   DrawTile
                      (./Engine/Graphics):00478                 
8613 00               (./Engine/Graphics):00479                 cpt_x fcb 0
                      (./Engine/Graphics):00480                 
                      (./Engine/Graphics):00481                 ; ****************************************************************************************************************************
                      (./Engine/Graphics):00482                 ; *
                      (./Engine/Graphics):00483                 ; *
                      (./Engine/Graphics):00484                 ; *
                      (./Engine/Graphics):00485                 ; *
                      (./Engine/Graphics):00486                 ; *
                      (./Engine/Graphics):00487                 ; *
                      (./Engine/Graphics):00488                 ; *
                      (./Engine/Graphics):00489                 ; *
                      (./Engine/Graphics):00490                 ; *
                      (./Engine/Graphics):00491                 ; *
                      (./Engine/Graphics):00492                 ; *
                      (./Engine/Graphics):00493                 ; ****************************************************************************************************************************
                      (./Engine/Graphics):00494                 
8614                  (./Engine/Graphics):00495                 DrawBufferedTile
                      (./Engine/Graphics):00496                 
8614 96E7             (./Engine/Graphics):00497 [4]     9528            lda   glb_camera_move
8616 2601             (./Engine/Graphics):00498 [3]     9531            bne   @a
8618 39               (./Engine/Graphics):00499 [5]     9536            rts
8619                  (./Engine/Graphics):00500                 @a
                      (./Engine/Graphics):00501                 
                      (./Engine/Graphics):00502                         ; compute number of tiles to render
                      (./Engine/Graphics):00503                         ; saves one tile row or col when camera pos is a multiple of tile size
                      (./Engine/Graphics):00504                         ; ---------------------------------------------------------------------
8619 C611             (./Engine/Graphics):00505 [2]     9538            ldb   #tmb_vp_h_tiles-1               ; nb of tile in screen width 
861B 96F4             (./Engine/Graphics):00506 [4]     9542            lda   <glb_camera_x_pos+1
861D 8407             (./Engine/Graphics):00507 [2]     9544            anda  #%00000111
861F 2601             (./Engine/Graphics):00508 [3]     9547            bne   @skip
8621 5A               (./Engine/Graphics):00509 [2]     9549            decb
8622 D718             (./Engine/Graphics):00510 [4]     9553    @skip   stb   DBT_ccpt
8624 F786D8           (./Engine/Graphics):00511 [5]     9558            stb   DBT_ccpt_bck
                      (./Engine/Graphics):00512                 
8627 C60B             (./Engine/Graphics):00513 [2]     9560            ldb   #tmb_vp_v_tiles               ; nb of tile in screen height
8629 96F2             (./Engine/Graphics):00514 [4]     9564            lda   <glb_camera_y_pos+1
862B 840F             (./Engine/Graphics):00515 [2]     9566            anda  #%00001111
862D 2601             (./Engine/Graphics):00516 [3]     9569            bne   @skip
862F 5A               (./Engine/Graphics):00517 [2]     9571            decb
8630 D717             (./Engine/Graphics):00518 [4]     9575    @skip   stb   DBT_lcpt
                      (./Engine/Graphics):00519                 
                      (./Engine/Graphics):00520                         ; compute top left tile position on screen
                      (./Engine/Graphics):00521                         ; position is rounder to 2 px horizontally beacuse of 2px per byte
                      (./Engine/Graphics):00522                         ; and vertically beacuse of interlacing
                      (./Engine/Graphics):00523                         ; ---------------------------------------------------------------------
8632 96F4             (./Engine/Graphics):00524 [4]     9579            lda   <glb_camera_x_pos+1
8634 8406             (./Engine/Graphics):00525 [2]     9581            anda  #%00000110                    ; mask for 8px tile in width
8636 40               (./Engine/Graphics):00526 [2]     9583            nega
8637 8B0C             (./Engine/Graphics):00527 [2]     9585            adda  #12                           ; on screen position of camera
                      (./Engine/Graphics):00528                 
8639 D6F2             (./Engine/Graphics):00529 [4]     9589            ldb   <glb_camera_y_pos+1
863B C40E             (./Engine/Graphics):00530 [2]     9591            andb  #%00001110                    ; mask for 16px tile in height
863D 50               (./Engine/Graphics):00531 [2]     9593            negb
863E CB14             (./Engine/Graphics):00532 [2]     9595            addb  #20                           ; on screen position of camera
                      (./Engine/Graphics):00533                 
8640 44               (./Engine/Graphics):00534 [2]     9597            lsra                                ; x=x/2, sprites moves by 2 pixels on x axis
8641 44               (./Engine/Graphics):00535 [2]     9599            lsra                                ; x=x/2, RAMA RAMB interlace  
8642 2516             (./Engine/Graphics):00536 [3]     9602            bcs   @RAM2First                    ; Branch if write must begin in RAM2 first
8644                  (./Engine/Graphics):00537                 @RAM1First
8644 B7864C           (./Engine/Graphics):00538 [5]     9607            sta   @dyn1
8647 8628             (./Engine/Graphics):00539 [2]     9609            lda   #40                           ; 40 bytes per line in RAMA or RAMB
8649 3D               (./Engine/Graphics):00540 [11]    9620            mul
864A C3C000           (./Engine/Graphics):00541 [4]     9624            addd  #$C000                        ; (dynamic)
     864C             (./Engine/Graphics):00542                 @dyn1   equ   *-1        
864D DDFA             (./Engine/Graphics):00543 [5]     9629            std   <glb_screen_location_2
864F 3406             (./Engine/Graphics):00544 [7]     9636            pshs  d
8651 FD86EF           (./Engine/Graphics):00545 [6]     9642            std   s_loc2
8654 8020             (./Engine/Graphics):00546 [2]     9644            suba  #$20
8656 DDFC             (./Engine/Graphics):00547 [5]     9649            std   <glb_screen_location_1     
8658 2015             (./Engine/Graphics):00548 [3]     9652            bra   @end
865A                  (./Engine/Graphics):00549                 @RAM2First
865A B78662           (./Engine/Graphics):00550 [5]     9657            sta   @dyn2
865D 8628             (./Engine/Graphics):00551 [2]     9659            lda   #40                           ; 40 bytes per line in RAMA or RAMB
865F 3D               (./Engine/Graphics):00552 [11]    9670            mul
8660 C3A000           (./Engine/Graphics):00553 [4]     9674            addd  #$A000                        ; (dynamic)
     8662             (./Engine/Graphics):00554                 @dyn2   equ   *-1        
8663 DDFA             (./Engine/Graphics):00555 [5]     9679            std   <glb_screen_location_2
8665 3406             (./Engine/Graphics):00556 [7]     9686            pshs  d
8667 FD86EF           (./Engine/Graphics):00557 [6]     9692            std   s_loc2
866A C32001           (./Engine/Graphics):00558 [4]     9696            addd  #$2001
866D DDFC             (./Engine/Graphics):00559 [5]     9701            std   <glb_screen_location_1
866F                  (./Engine/Graphics):00560                 @end
866F 3406             (./Engine/Graphics):00561 [7]     9708            pshs  d
8671 FD86FB           (./Engine/Graphics):00562 [6]     9714            std   s_loc1
                      (./Engine/Graphics):00563                 
                      (./Engine/Graphics):00564                         ; compute position in cycling buffer
                      (./Engine/Graphics):00565                         ; ---------------------------------------------------------------------
8674 D6F4             (./Engine/Graphics):00566 [4]     9718            ldb   <glb_camera_x_pos+1           ; col mask (0-32)
8676 C4F8             (./Engine/Graphics):00567 [2]     9720            andb  #%11111000                    ; tile width 8px (>>3) 
8678 54               (./Engine/Graphics):00568 [2]     9722            lsrb                                ; col size 4 bytes (<<2)
8679 F7868A           (./Engine/Graphics):00569 [5]     9727            stb   @dyn2
867C D6F2             (./Engine/Graphics):00570 [4]     9731            ldb   <glb_camera_y_pos+1
867E 8400             (./Engine/Graphics):00571 [2]     9733            anda  #%00000000
8680 C4F0             (./Engine/Graphics):00572 [2]     9735            andb  #%11110000                    ; line mask (0-16)
                      (./Engine/Graphics):00573                         _lsld                               ; tile height 16px (>>4) 
8682 58               (            _lsld):00001 [2]     9737            lslb
8683 49               (            _lsld):00002 [2]     9739            rola
                      (./Engine/Graphics):00574                         _lsld                               ; line skip 128 bytes (<<7)
8684 58               (            _lsld):00001 [2]     9741            lslb
8685 49               (            _lsld):00002 [2]     9743            rola
                      (./Engine/Graphics):00575                         _lsld
8686 58               (            _lsld):00001 [2]     9745            lslb
8687 49               (            _lsld):00002 [2]     9747            rola
8688 C30000           (./Engine/Graphics):00576 [4]     9751            addd  #0                            ; (dynamic) add x position to index 
     868A             (./Engine/Graphics):00577                 @dyn2   equ   *-1
868B C39000           (./Engine/Graphics):00578 [4]     9755            addd  #tile_buffer
                      (./Engine/Graphics):00579                 
868E 108E8738         (./Engine/Graphics):00580 [4]     9759            ldy   #tmb_hprio_tiles              ; high priority tiles queue
                      (./Engine/Graphics):00581                 
                      (./Engine/Graphics):00582                 ; **************************************
                      (./Engine/Graphics):00583                 ; * Tile rendering Loop
                      (./Engine/Graphics):00584                 ; **************************************
                      (./Engine/Graphics):00585                 
8692                  (./Engine/Graphics):00586                 DBT_lloop
8692 1F03             (./Engine/Graphics):00587 [6]     9765            tfr   d,u
8694 FD8709           (./Engine/Graphics):00588 [6]     9771            std   ls_pos
8697 C480             (./Engine/Graphics):00589 [2]     9773            andb  #%10000000
8699 FD86CF           (./Engine/Graphics):00590 [6]     9779            std   l_pos
                      (./Engine/Graphics):00591                 
                      (./Engine/Graphics):00592                         ; tiles in col
                      (./Engine/Graphics):00593                         ; ****************
869C                  (./Engine/Graphics):00594                 DBT_cloop
869C 3716             (./Engine/Graphics):00595 [9]     9788            pulu  d,x
869E 3440             (./Engine/Graphics):00596 [7]     9795            pshs  u
86A0 F7E7E6           (./Engine/Graphics):00597 [5]     9800            stb   $E7E6
86A3 2604             (./Engine/Graphics):00598 [3]     9803            bne   @a
86A5 0CE6             (./Engine/Graphics):00599 [6]     9809            inc   glb_alphaTiles           ; if a tile contains transparency, set the tag
86A7 2015             (./Engine/Graphics):00600 [3]     9812            bra   @skip
86A9 4D               (./Engine/Graphics):00601 [2]     9814    @a      tsta
86AA 2A0E             (./Engine/Graphics):00602 [3]     9817            bpl   @low
86AC E7A0             (./Engine/Graphics):00603 [6]     9823            stb   ,y+
86AE AFA1             (./Engine/Graphics):00604 [8]     9831            stx   ,y++
86B0 9EFC             (./Engine/Graphics):00605 [5]     9836            ldx   <glb_screen_location_1
86B2 AFA1             (./Engine/Graphics):00606 [8]     9844            stx   ,y++
86B4 9EFA             (./Engine/Graphics):00607 [5]     9849            ldx   <glb_screen_location_2
86B6 AFA1             (./Engine/Graphics):00608 [8]     9857            stx   ,y++
86B8 2004             (./Engine/Graphics):00609 [3]     9860            bra   @skip
86BA DEFA             (./Engine/Graphics):00610 [5]     9865    @low    ldu   <glb_screen_location_2
86BC AD84             (./Engine/Graphics):00611 [7]     9872            jsr   ,x
86BE 3556             (./Engine/Graphics):00612 [11]    9883    @skip   puls  d,x,u
86C0 3342             (./Engine/Graphics):00613 [5]     9888            leau  2,u
86C2 DFFA             (./Engine/Graphics):00614 [5]     9893            stu   <glb_screen_location_2
86C4 3002             (./Engine/Graphics):00615 [5]     9898            leax  2,x
86C6 9FFC             (./Engine/Graphics):00616 [5]     9903            stx   <glb_screen_location_1
86C8 3450             (./Engine/Graphics):00617 [9]     9912            pshs  x,u
86CA 8400             (./Engine/Graphics):00618 [2]     9914            anda  #%00000000
86CC C47C             (./Engine/Graphics):00619 [2]     9916            andb  #%01111100 ; cycle thru this line (0-127) by 4 bytes
86CE C30000           (./Engine/Graphics):00620 [4]     9920            addd  #0
     86CF             (./Engine/Graphics):00621                 l_pos   equ   *-2
86D1 1F03             (./Engine/Graphics):00622 [6]     9926            tfr   d,u
                      (./Engine/Graphics):00623                 
86D3 0A18             (./Engine/Graphics):00624 [6]     9932            dec   DBT_ccpt
86D5 26C5             (./Engine/Graphics):00625 [3]     9935            bne   DBT_cloop
                      (./Engine/Graphics):00626                 
86D7 8600             (./Engine/Graphics):00627 [2]     9937            lda   #0
     86D8             (./Engine/Graphics):00628                 DBT_ccpt_bck equ   *-1
86D9 9718             (./Engine/Graphics):00629 [4]     9941            sta   DBT_ccpt
                      (./Engine/Graphics):00630                  
                      (./Engine/Graphics):00631                         ; last tile in col
                      (./Engine/Graphics):00632                         ; ****************
                      (./Engine/Graphics):00633                 
86DB 3716             (./Engine/Graphics):00634 [9]     9950            pulu  d,x
86DD 3440             (./Engine/Graphics):00635 [7]     9957            pshs  u
86DF F7E7E6           (./Engine/Graphics):00636 [5]     9962            stb   $E7E6
86E2 2604             (./Engine/Graphics):00637 [3]     9965            bne   @a
86E4 0CE6             (./Engine/Graphics):00638 [6]     9971            inc   glb_alphaTiles           ; if a tile contains transparency, set the tag
86E6 2004             (./Engine/Graphics):00639 [3]     9974            bra   @skip
86E8 DEFA             (./Engine/Graphics):00640 [5]     9979    @a      ldu   <glb_screen_location_2
86EA AD84             (./Engine/Graphics):00641 [7]     9986            jsr   ,x
86EC 3556             (./Engine/Graphics):00642 [11]    9997    @skip   puls  d,x,u
                      (./Engine/Graphics):00643                 
                      (./Engine/Graphics):00644                  
                      (./Engine/Graphics):00645                         ; next line
                      (./Engine/Graphics):00646                         ; ****************
                      (./Engine/Graphics):00647                 
86EE CE0000           (./Engine/Graphics):00648 [3]     10000           ldu   #0
     86EF             (./Engine/Graphics):00649                 s_loc2  equ   *-2
86F1 33C90280         (./Engine/Graphics):00650 [8]     10008           leau  40*16,u
86F5 DFFA             (./Engine/Graphics):00651 [5]     10013           stu   <glb_screen_location_2
86F7 FF86EF           (./Engine/Graphics):00652 [6]     10019           stu   s_loc2
86FA 8E0000           (./Engine/Graphics):00653 [3]     10022           ldx   #0
     86FB             (./Engine/Graphics):00654                 s_loc1  equ   *-2
86FD 30890280         (./Engine/Graphics):00655 [8]     10030           leax  40*16,x
8701 9FFC             (./Engine/Graphics):00656 [5]     10035           stx   <glb_screen_location_1
8703 BF86FB           (./Engine/Graphics):00657 [6]     10041           stx   s_loc1
8706 3450             (./Engine/Graphics):00658 [9]     10050           pshs  x,u
                      (./Engine/Graphics):00659                         
8708 CC0000           (./Engine/Graphics):00660 [3]     10053           ldd   #0
     8709             (./Engine/Graphics):00661                 ls_pos  equ   *-2              ; line start pos
870B C30080           (./Engine/Graphics):00662 [4]     10057           addd  #128
870E 8407             (./Engine/Graphics):00663 [2]     10059           anda  #%00000111
8710 8B90             (./Engine/Graphics):00664 [2]     10061           adda  #tile_buffer/256 ; add base address
                      (./Engine/Graphics):00665                 
8712 0A17             (./Engine/Graphics):00666 [6]     10067           dec   DBT_lcpt
8714 1026FF7A         (./Engine/Graphics):00667 [5+?]   10072           lbne  DBT_lloop
8718 3264             (./Engine/Graphics):00668 [5]     10077   @rts    leas  4,s               ; empty the stack
871A 8600             (./Engine/Graphics):00669 [2]     10079           lda   #0
871C A7A4             (./Engine/Graphics):00670 [4]     10083           sta   ,y                ; end marker for high priority tiles
871E 39               (./Engine/Graphics):00671 [5]     10088           rts
                      (./Engine/Graphics):00672                 
                      (./Engine/Graphics):00673                 ; ****************************************************************************************************************************
                      (./Engine/Graphics):00674                 ; *
                      (./Engine/Graphics):00675                 ; *
                      (./Engine/Graphics):00676                 ; *
                      (./Engine/Graphics):00677                 ; *
                      (./Engine/Graphics):00678                 ; *
                      (./Engine/Graphics):00679                 ; *
                      (./Engine/Graphics):00680                 ; *
                      (./Engine/Graphics):00681                 ; *
                      (./Engine/Graphics):00682                 ; *
                      (./Engine/Graphics):00683                 ; *
                      (./Engine/Graphics):00684                 ; *
                      (./Engine/Graphics):00685                 ; ****************************************************************************************************************************
                      (./Engine/Graphics):00686                 
871F                  (./Engine/Graphics):00687                 DrawHighPriorityBufferedTile
871F 108E8738         (./Engine/Graphics):00688 [4]     10092           ldy   #tmb_hprio_tiles
8723 200B             (./Engine/Graphics):00689 [3]     10095           bra   @entry
8725                  (./Engine/Graphics):00690                 @loop
8725 EE23             (./Engine/Graphics):00691 [6]     10101           ldu   3,y
8727 DFFC             (./Engine/Graphics):00692 [5]     10106           stu   <glb_screen_location_1
8729 EE25             (./Engine/Graphics):00693 [6]     10112           ldu   5,y
872B 3127             (./Engine/Graphics):00694 [5]     10117           leay  7,y
872D ADB8FA           (./Engine/Graphics):00695 [11]    10128           jsr   [-6,y]  ; y register should be saved and restored (it works without, only for small tiles)
8730                  (./Engine/Graphics):00696                 @entry
8730 E6A4             (./Engine/Graphics):00697 [4]     10132           ldb   ,y
8732 F7E7E6           (./Engine/Graphics):00698 [5]     10137           stb   $E7E6
8735 26EE             (./Engine/Graphics):00699 [3]     10140           bne   @loop
8737 39               (./Engine/Graphics):00700 [5]     10145           rts
                      (./Engine/Graphics):00701                 
8738                  (./Engine/Graphics):00702                 tmb_hprio_tiles
8738 0000000000000000 (./Engine/Graphics):00703                         fill  0,tmb_vp_h_tiles*tmb_vp_v_tiles*7 ; all tiles in high priority ... that's crazy
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000
8CA2 00               (./Engine/Graphics):00704                         fcb   0 ; end marker
                      (./Engine/Graphics):00705                 
8CA3 0000000000000000 (./Engine/Graphics):00706                         align 2048
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000
9000                  (./Engine/Graphics):00707                 tile_buffer
9000 0000000000000000 (./Engine/Graphics):00708                         fill  0,16*128
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
     0000000000000000
                      (C:\Users\bhrou\gi):00275                         INCLUDE "./generated-code/EHZ/BuilderMainGenCode.asm"
                      (./generated-code/):00001                 * Generated Code
                      (./generated-code/):00002                 
9800                  (./generated-code/):00003                 Pal_EHZ
9800 3206             (./generated-code/):00004                         fdb   $3206
9802 630E             (./generated-code/):00005                         fdb   $630e
9804 A60E             (./generated-code/):00006                         fdb   $a60e
9806 0100             (./generated-code/):00007                         fdb   $0100
9808 1400             (./generated-code/):00008                         fdb   $1400
980A 3B00             (./generated-code/):00009                         fdb   $3b00
980C 1000             (./generated-code/):00010                         fdb   $1000
980E 6000             (./generated-code/):00011                         fdb   $6000
9810 9200             (./generated-code/):00012                         fdb   $9200
9812 0009             (./generated-code/):00013                         fdb   $0009
9814 100B             (./generated-code/):00014                         fdb   $100b
9816 1B01             (./generated-code/):00015                         fdb   $1b01
9818 5C03             (./generated-code/):00016                         fdb   $5c03
981A 0000             (./generated-code/):00017                         fdb   $0000
981C 3303             (./generated-code/):00018                         fdb   $3303
981E CA0D             (./generated-code/):00019                         fdb   $ca0d
                      (./generated-code/):00020                 
9820                  (./generated-code/):00021                 Obj_Index_Page
9820 00               (./generated-code/):00022                         fcb   $00
9821 64               (./generated-code/):00023                         fcb   $64
9822 64               (./generated-code/):00024                         fcb   $64
9823 64               (./generated-code/):00025                         fcb   $64
9824 64               (./generated-code/):00026                         fcb   $64
9825 64               (./generated-code/):00027                         fcb   $64
9826 64               (./generated-code/):00028                         fcb   $64
9827                  (./generated-code/):00029                 Obj_Index_Address
9827 0000             (./generated-code/):00030                         fcb   $00,$00
9829 3CA3             (./generated-code/):00031                         fcb   $3C,$A3
982B 372D             (./generated-code/):00032                         fcb   $37,$2D
982D 35C5             (./generated-code/):00033                         fcb   $35,$C5
982F 28FB             (./generated-code/):00034                         fcb   $28,$FB
9831 0218             (./generated-code/):00035                         fcb   $02,$18
9833 0203             (./generated-code/):00036                         fcb   $02,$03
9835                  (./generated-code/):00037                 Map_EHZ 
9835 883BF93FF9       (./generated-code/):00038                         fcb   $88,$3B,$F9,$3F,$F9
983A 00               (./generated-code/):00039                         fcb   $00
983B                  (./generated-code/):00040                 Chunk_EHZ_0 
983B 9500003980       (./generated-code/):00041                         fcb   $95,$00,$00,$39,$80
9840 00               (./generated-code/):00042                         fcb   $00
9841                  (./generated-code/):00043                 Img_Page_Index
9841 00               (./generated-code/):00044                         fcb   $00
9842 80               (./generated-code/):00045                         fcb   $80
9843 80               (./generated-code/):00046                         fcb   $80
9844 80               (./generated-code/):00047                         fcb   $80
9845 94               (./generated-code/):00048                         fcb   $94
9846 80               (./generated-code/):00049                         fcb   $80
9847 80               (./generated-code/):00050                         fcb   $80
9848                  (./generated-code/):00051                 Ani_Page_Index
9848 00               (./generated-code/):00052                         fcb   $00
9849 80               (./generated-code/):00053                         fcb   $80
984A 80               (./generated-code/):00054                         fcb   $80
984B 80               (./generated-code/):00055                         fcb   $80
984C 64               (./generated-code/):00056                         fcb   $64
984D 80               (./generated-code/):00057                         fcb   $80
984E 80               (./generated-code/):00058                         fcb   $80
984F                  (./generated-code/):00059                 Ani_Asd_Index
984F 0000             (./generated-code/):00060                         fdb   $0000
9851 0000             (./generated-code/):00061                         fdb   $0000
9853 0000             (./generated-code/):00062                         fdb   $0000
9855 0000             (./generated-code/):00063                         fdb   $0000
9857 3318             (./generated-code/):00064                         fdb   $3318
9859 0000             (./generated-code/):00065                         fdb   $0000
985B 0000             (./generated-code/):00066                         fdb   $0000
985D                  (./generated-code/):00067                 LoadAct
985D C602             (./generated-code/):00068 [2]     10147           ldb   #$02                     * load page 2
985F F7E7E5           (./generated-code/):00069 [5]     10152           stb   $E7E5                    * in data space ($A000-$DFFF)
9862 8EDDDD           (./generated-code/):00070 [3]     10155           ldx   #$DDDD                   * set Background solid color
9865 BD819F           (./generated-code/):00071 [8]     10163           jsr   ClearDataMem
9868 B6E7DD           (./generated-code/):00072 [5]     10168           lda   $E7DD                    * set border color
986B 84F0             (./generated-code/):00073 [2]     10170           anda  #$F0
986D 8B0D             (./generated-code/):00074 [2]     10172           adda  #$0D                     * color ref
986F B7E7DD           (./generated-code/):00075 [5]     10177           sta   $E7DD
9872 840F             (./generated-code/):00076 [2]     10179           anda  #$0F
9874 8B80             (./generated-code/):00077 [2]     10181           adda  #$80
9876 B76FFC           (./generated-code/):00078 [5]     10186           sta   glb_screen_border_color+1    * maj WaitVBL
9879 BD6FE2           (./generated-code/):00079 [8]     10194           jsr   WaitVBL
987C C603             (./generated-code/):00080 [2]     10196           ldb   #$03                     * load page 3
987E F7E7E5           (./generated-code/):00081 [5]     10201           stb   $E7E5                    * data space ($A000-$DFFF)
9881 8EDDDD           (./generated-code/):00082 [3]     10204           ldx   #$DDDD                   * set Background solid color
9884 BD819F           (./generated-code/):00083 [8]     10212           jsr   ClearDataMem
9887 CC9800           (./generated-code/):00084 [3]     10215           ldd   #Pal_EHZ
988A FD82B1           (./generated-code/):00085 [6]     10221           std   Cur_palette
988D 7F82B0           (./generated-code/):00086 [7]     10228           clr   Refresh_palette
9890 39               (./generated-code/):00087 [5]     10233           rts
